--------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/log 10-22/log_part_year.txt
  log type:  text
 opened on:  22 Oct 2016, 12:56:07
. }

. 
. if "`mine_sample'" == "big" { 
.         local directory "C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/big/`version'/`injury_type'/estout `
> date'/"
.         capture log close
.         log using "C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/big/`version'/`injury_type'/log `date'/log
> _`violation_level'_`log_time'.txt", text
. }       

.         
. if "`mine_sample'" == "bad" | "`mine_sample'" == "big_bad" { 
.         local directory "C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/`mine_sample'/`badness'/`version'/`i
> njury_type'/estout `date'/"
.         capture log close
.         log using "C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/`mine_sample'/`/`badness'/`version'/`injur
> y_type'/log `date'/log_`violation_level'_`log_time'.txt", text
. }

. 
. ********************************************************************************
. ********************************************************************************
. // DATA SET-UP
. 
. // format variables
. if "`injury_type'" == "MR" {
.         rename MR dv
.         rename MR_indicator dv_indicator
.         local injury_label "MR"
.         local relevant_parts "47 48 71 72 75 77"
. }

. 
. if "`injury_type'" == "PS" {
.         rename PS dv
.         rename PS_indicator dv_indicator
.         local injury_label "PS"
.         local relevant_parts "48 75"
. }

. 
. if "`violation_level'" == "part" {
.         local violation_level_label "P"
. }

. 
. if "`violation_level'" == "subpart" {
.         local violation_level_label "SP"
. }

. 
. gen sample_pp = quarter >= 2007 // flag obs after or equal to 2007 to use in penlaty points analyses (assessments changed for the last time in 2007)

. 
. tostring quarter, replace
quarter was double now str7

. encode quarter, gen(quart)

. drop quarter year

. rename quart time

. 
. local time_label "Q" // will be overwritten if unit_of_analysis is year_sum or year_avg

. 
. if "`unit_of_analysis'" == "year_sum" { // collapse to mine years - sums 
.         local time_label "Y"
.         
.         // count number of complete quarters per year
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
(22,385 real changes made)
.         gen marker = 1
.         bysort mineid year: egen num_quarts = sum(marker)
.                 /*tab num_quarts
>                          num_quarts |      Freq.     Percent        Cum.
>                         ------------+-----------------------------------
>                                           1 |      1,100        3.63        3.63
>                                           2 |      1,666        5.50        9.13
>                                           3 |      2,511        8.29       17.42
>                                           4 |     25,012       82.58      100.00
>                         ------------+-----------------------------------
>                                   Total |     30,289      100.00 - Sarah 9/21/2016 @ 10:54 PM */
.         drop if num_quarts < 4
(5,277 observations deleted)
.         
.         // collapse to the mine-year 
.         collapse (sum) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp union longwall, by(mineid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_sum collapse"
. }

. 
. if "`unit_of_analysis'" == "year_avg" { // collapse on mine years - averages
.         local time_label "Y"
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
.         pause "collapsing to mine-year"
.         collapse (mean) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp union longwall, by(mineid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_avg collapse"
. }

. 
. drop dv_indicator

. gen dv_binary = 0 if dv == 0
(5,204 missing values generated)

. replace dv_binary = 1 if dv != 0
(5,204 real changes made)

. rename dv_binary dv_indicator

.         
. gen lnhours = log(hours)

. 
. pause "complete: data formatting"

. 
. // group variables
. local covariates "mine_time onsite_insp_hours longwall"

. 
. if "`union_status'" == "on" {
.         local covariates "`covariates' union"
. }

. 
. *** lag 0 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
p48 p75
. 
.         foreach var of varlist p*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
p48_ss p75_ss
. 
.         foreach var of varlist p*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
p48_pp p75_pp
.         
.         pause "complete: variable groups - part no lag"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
. 
.         foreach var of varlist sp*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
. 
.         foreach var of varlist sp*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
.         
.         pause "complete: variable groups - subpart no lag"
. }

. 
. *** lag 1 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
p48_1lag p75_1lag
. 
.         foreach var of varlist p*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
p48_ss_1lag p75_ss_1lag
. 
.         foreach var of varlist p*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
p48_pp_1lag p75_pp_1lag
.         
.         pause "complete: variable groups - part lag 1"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
. 
.         foreach var of varlist sp*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
. 
. 
.         foreach var of varlist sp*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
. 
.         pause "complete: variable groups - subpart lag 1"
. } 

. 
. *** lag 4 ***
. if "`violation_level'" == "part" {
.         
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
p48_c_4lag p75_c_4lag
. 
.         foreach var of varlist p*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
p48_ss_c_4lag p75_ss_c_4lag
. 
.         foreach var of varlist p*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
p48_pp_c_4lag p75_pp_c_4lag
. 
.         pause "complete: variable groups - part lag 4"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
. 
.         foreach var of varlist sp*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
. 
.         foreach var of varlist sp*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
. 
.         pause "complete: variable groups - subpart lag 4"
. }

. 
. *** lag all ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
p48_c_lag_all p75_c_lag_all
. 
.         foreach var of varlist p*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
p48_ss_c_lag_all p75_ss_c_lag_all
. 
.         foreach var of varlist p*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
p48_pp_c_lag_all p75_pp_c_lag_all
. 
.         pause "complete: variable groups - part lag all"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
.         
.         foreach var of varlist sp*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
.         
.         foreach var of varlist sp*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
. 
.         pause "complete: variable groups - subpart lag all"
. }

. 
. ********************************************************************************
. *******************************************************************************
. // DATA OVERVIEW
. 
. // outcome variables
. summ dv

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200

. 
. pause "next"

. 
. tab dv_indicator

dv_indicato |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,049       16.78       16.78
          1 |      5,204       83.22      100.00
------------+-----------------------------------
      Total |      6,253      100.00

.           
. pause "next"

. 
. if "`violation_level'" == "part" {
.         summ `count_vars' `ss_vars' `pp_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         p48 |      6,253     .318727    1.248145          0         69
         p75 |      6,253    86.81753    106.1219          0       1177
      p48_ss |      6,253    .0702063    .3739304          0          7
      p75_ss |      6,253    26.72909    34.58116          0        321
      p48_pp |      6,253    13.45146    66.03334          0       3787
-------------+---------------------------------------------------------
      p75_pp |      6,253    4560.291    7477.474          0      83190
.         
.         pause "next"
.         
.         summ `count_lag_1_vars' `ss_lag_1_vars' `pp_lag_1_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    p48_1lag |      6,253    .3144091    1.259505          0         69
    p75_1lag |      6,253    84.70494    105.5627          0       1231
 p48_ss_1lag |      6,253    .0705261    .3831667          0          9
 p75_ss_1lag |      6,253    26.06701    34.26183          0        298
 p48_pp_1lag |      6,253    13.25172    66.63073          0       3787
-------------+---------------------------------------------------------
 p75_pp_1lag |      6,253    4429.851    7438.808          0      95414
.         
.         pause "next"
.         
.         summ `count_lag_4_vars' `ss_lag_4_vars' `pp_lag_4_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  p48_c_4lag |      6,253    1.159923    3.899655          0        143
  p75_c_4lag |      6,253    318.6472     418.753          0       4860
p48_ss_c_4~g |      6,253    .2534783    1.196286          0         30
p75_ss_c_4~g |      6,253    97.46905    133.7162          0       1222
p48_pp_c_4~g |      6,253    49.52407    207.2291          0       7851
-------------+---------------------------------------------------------
p75_pp_c_4~g |      6,253    16979.21    29254.98          0     378581
.         
.         pause "next"
.         
.         summ `count_lag_all_vars' `ss_lag_all_vars' `pp_lag_all_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
p48_c_lag_~l |      6,253    4.830641    13.17843          0        288
p75_c_lag_~l |      6,253    1402.214    3242.545          0      38328
p48_ss_c_l~l |      6,253    1.384296    4.759533          0         52
p75_ss_c_l~l |      6,253    448.1796    1035.258          0      13253
p48_pp_c_l~l |      6,253    170.4297    577.2885          0      15716
-------------+---------------------------------------------------------
p75_pp_c_l~l |      6,253    58941.83    157916.8          0    2148250
. }

. 
. pause "complete: data overview"

. 
. *******************************************************************************/
. /*******************************************************************************
> // MODEL LABEL KEY
> 
> Model X.Y.Z
>   X
>     C: response variable is count of injuries
>     B: response variable is binary of injuries
>   Y
>     V: predictors are number of violations
>     SSV: predictors are number of significant and substantial violations
>     PP: predictors are number of penalty points
>   Z
>     1: inj_t ~ viol_t
>     2: inj_t ~ viol_(t_-1)
>     3: inj_t ~ viol_(annual sum pre_t)
>     4: inj_t ~ viol_(sum since study period) 
> 
> *******************************************************************************/
. ********************************************************************************
. // NULL MODELS (V & SSV)
. 
. // count outcome (V & SSV)
. /*
> glm dv, family(poisson) link(log) vce(cl mineid) exposure(hours) eform
>         
> pause "next"    
>         
> quietly poisson dv, vce(cl mineid) exposure(hours) irr
> estat gof
> 
> pause "next"
>         
> glm dv, family(nbinomial) link(log) vce(cl mineid) exposure(hours) eform
> 
> pause "next"
> */
. 
. nbreg dv, vce(cl mineid) exposure(hours) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -24975.694  
Iteration 1:   log pseudolikelihood = -24975.694  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -17389.648  
Iteration 1:   log pseudolikelihood = -17389.648  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(0)      =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -17389.648               Pseudo R2         =     0.0000

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000636   1.41e-06  -437.06   0.000     .0000609    .0000664
   ln(hours) |          1  (exposure)
-------------+----------------------------------------------------------------
    /lnalpha |  -.7806193   .0564603                     -.8912795   -.6699592
-------------+----------------------------------------------------------------
       alpha |   .4581222   .0258657                      .4101306    .5117295
------------------------------------------------------------------------------

. 
. pause "next"

. 
. predict c_null_yhat 
(option n assumed; predicted number of events)

. summ dv c_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
 c_null_yhat |      6,253    11.62161    17.26537   .0040684   179.0143

. 
. pause "complete: null model - count outcome"

. 
. // binary outcome (V & SSV)
. logit dv_indicator, vce(cl mineid) offset(lnhours) or

Iteration 0:   log pseudolikelihood = -1978.0504  
Iteration 1:   log pseudolikelihood = -1893.3905  
Iteration 2:   log pseudolikelihood = -1893.3681  
Iteration 3:   log pseudolikelihood = -1893.3681  

Logistic regression                             Number of obs     =      6,253
                                                Wald chi2(0)      =          .
Log pseudolikelihood = -1893.3681               Prob > chi2       =          .

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000987   5.20e-06  -174.94   0.000      .000089    .0001094
     lnhours |          1  (offset)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6253
 number of covariate patterns =         1
              Pearson chi2(0) =         0.00
                  Prob > chi2 =              .

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2828.3302  
Iteration 1:   log likelihood = -1965.1216  
Iteration 2:   log likelihood = -1826.6339  
Iteration 3:   log likelihood = -1780.1485  
Iteration 4:   log likelihood = -1778.5091  
Iteration 5:   log likelihood = -1778.5084  
Iteration 6:   log likelihood = -1778.5084  

Logistic regression                             Number of obs     =      6,253
                                                LR chi2(2)        =    2099.64
                                                Prob > chi2       =     0.0000
Log likelihood = -1778.5084                     Pseudo R2         =     0.3712

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.102418   .0515933    21.37   0.000     1.001297    1.203539
      _hatsq |   .2453823   .0240955    10.18   0.000     .1981559    .2926087
       _cons |  -.6749075   .0655041   -10.30   0.000    -.8032932   -.5465217
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5115           747  |       5862
     -     |        89           302  |        391
-----------+--------------------------+-----------
   Total   |      5204          1049  |       6253

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.29%
Specificity                     Pr( -|~D)   28.79%
Positive predictive value       Pr( D| +)   87.26%
Negative predictive value       Pr(~D| -)   77.24%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   71.21%
False - rate for true D         Pr( -| D)    1.71%
False + rate for classified +   Pr(~D| +)   12.74%
False - rate for classified -   Pr( D| -)   22.76%
--------------------------------------------------
Correctly classified                        86.63%
--------------------------------------------------

. 
. pause "next"

. 
. predict b_null_yhat 
(option pr assumed; Pr(dv_indicator))

. summ dv_indicator b_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
 b_null_yhat |      6,253    .8322405     .176821   .0062748   .9964138

. 
. pause "complete: null model - binary outcome"

. 
. *******************************************************************************/
. ********************************************************************************
. // NULL MODELS (PP)
. 
. // count outcome (PP)
. /*
> glm dv if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) eform
>         
> pause "next"    
>         
> quietly poisson dv if sample_pp == 1, vce(cl mineid) exposure(hours) irr
> estat gof
> 
> pause "next"
>         
> glm dv if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) eform
> 
> pause "next"
> */
. 
. nbreg dv if sample_pp == 1, vce(cl mineid) exposure(hours) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -11782.286  
Iteration 1:   log pseudolikelihood = -11782.286  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8994.0816  
Iteration 1:   log pseudolikelihood = -8994.0816  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(0)      =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8994.0816               Pseudo R2         =     0.0000

                               (Std. Err. adjusted for 727 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000496   1.21e-06  -404.98   0.000     .0000473     .000052
   ln(hours) |          1  (exposure)
-------------+----------------------------------------------------------------
    /lnalpha |  -.9956402   .0717213                     -1.136211    -.855069
-------------+----------------------------------------------------------------
       alpha |   .3694868   .0265001                       .321033    .4252538
------------------------------------------------------------------------------

. 
. pause "next"

. 
. predict c_pp_null_yhat 
(option n assumed; predicted number of events)

. summ dv_indicator c_pp_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
c_pp_null_~t |      6,253    9.068361     13.4722   .0031746   139.6851

. 
. pause "complete: null model - count outcome"

. 
. // binary outcome (PP)
. logit dv_indicator if sample_pp == 1, vce(cl mineid) offset(lnhours) or

Iteration 0:   log pseudolikelihood = -1052.7165  
Iteration 1:   log pseudolikelihood = -1006.7469  
Iteration 2:   log pseudolikelihood = -1006.7273  
Iteration 3:   log pseudolikelihood = -1006.7273  

Logistic regression                             Number of obs     =      3,333
                                                Wald chi2(0)      =          .
Log pseudolikelihood = -1006.7273               Prob > chi2       =          .

                               (Std. Err. adjusted for 727 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000784   5.25e-06  -141.08   0.000     .0000687    .0000894
     lnhours |          1  (offset)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3333
 number of covariate patterns =         1
              Pearson chi2(0) =         0.00
                  Prob > chi2 =              .

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1548.2719  
Iteration 1:   log likelihood = -1045.9495  
Iteration 2:   log likelihood = -957.81057  
Iteration 3:   log likelihood = -932.47829  
Iteration 4:   log likelihood = -931.63263  
Iteration 5:   log likelihood = -931.62985  
Iteration 6:   log likelihood = -931.62985  

Logistic regression                             Number of obs     =      3,333
                                                LR chi2(2)        =    1233.28
                                                Prob > chi2       =     0.0000
Log likelihood = -931.62985                     Pseudo R2         =     0.3983

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |    1.14455   .0639224    17.91   0.000     1.019264    1.269835
      _hatsq |   .2588853   .0289098     8.95   0.000     .2022232    .3155474
       _cons |   -.713419   .0867457    -8.22   0.000    -.8834374   -.5434005
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2693           409  |       3102
     -     |        55           176  |        231
-----------+--------------------------+-----------
   Total   |      2748           585  |       3333

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.00%
Specificity                     Pr( -|~D)   30.09%
Positive predictive value       Pr( D| +)   86.81%
Negative predictive value       Pr(~D| -)   76.19%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   69.91%
False - rate for true D         Pr( -| D)    2.00%
False + rate for classified +   Pr(~D| +)   13.19%
False - rate for classified -   Pr( D| -)   23.81%
--------------------------------------------------
Correctly classified                        86.08%
--------------------------------------------------

. 
. pause "next"

. 
. predict b_pp_null_yhat 
(option pr assumed; Pr(dv_indicator))

. summ dv_indicator b_pp_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
b_pp_null_~t |      6,253    .8058796    .1892077   .0049906   .9954894

. 
. pause "complete: null model - binary outcome"

. 
. ********************************************************************************
. ********************************************************************************
. 
. if "`violation_level'" == "subpart" {
.         set matsize 11000, perm
.         set emptycells drop
. }

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.1
. 
. // poisson model
. /*
> glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -23703.524  
Iteration 1:   log pseudolikelihood = -20549.443  
Iteration 2:   log pseudolikelihood = -20489.926  
Iteration 3:   log pseudolikelihood = -20489.566  
Iteration 4:   log pseudolikelihood = -20489.566  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16806.512  
Iteration 1:   log pseudolikelihood = -16678.368  
Iteration 2:   log pseudolikelihood =  -16671.62  
Iteration 3:   log pseudolikelihood = -16671.609  
Iteration 4:   log pseudolikelihood = -16671.609  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(32)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16671.609               Pseudo R2         =     0.0413

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p48 |   1.009137    .007259     1.26   0.206      .995009    1.023465
              p75 |   1.001103   .0002008     5.49   0.000     1.000709    1.001496
        mine_time |   1.010771    .005554     1.95   0.051     .9999438    1.021716
onsite_insp_hours |   .9998305   .0000371    -4.57   0.000     .9997579    .9999032
         longwall |   .6575327   .0415665    -6.63   0.000     .5809086    .7442637
                  |
            state |
               1  |    .999868   .1093985    -0.00   0.999     .8068824    1.239011
               2  |   1.215535   .0539722     4.40   0.000     1.114224    1.326058
               3  |   .8105142    .092063    -1.85   0.064     .6487481    1.012617
               4  |   1.067825   .0979477     0.72   0.474     .8921179    1.278137
               5  |   .8136397   .0654218    -2.56   0.010     .6950086      .95252
               6  |   .7601422   .0350534    -5.95   0.000     .6944522     .832046
               7  |   1.045641   .2067494     0.23   0.821     .7097067    1.540588
               8  |   .6297994   .0316692    -9.19   0.000     .5706897    .6950316
               9  |   .7743046   .0460835    -4.30   0.000     .6890515    .8701055
              10  |   .8821039   .0810233    -1.37   0.172      .736775    1.056099
              11  |   1.513339   .2560335     2.45   0.014     1.086241    2.108368
              12  |   1.096618   .0707939     1.43   0.153     .9662833    1.244531
              13  |   1.502563   .1608753     3.80   0.000     1.218139    1.853397
              14  |   .5068197   .0745054    -4.62   0.000      .379946    .6760597
              15  |   .7238821   .0374942    -6.24   0.000     .6540019     .801229
              17  |   .8681032    .053102    -2.31   0.021     .7700223    .9786772
                  |
             time |
            2000  |    1.03232   .0476888     0.69   0.491     .9429585    1.130151
            2002  |   .9290754   .0414874    -1.65   0.099     .8512183    1.014054
            2003  |   .8386913   .0463684    -3.18   0.001     .7525616    .9346784
            2004  |    .776755   .0400516    -4.90   0.000     .7020916    .8593584
            2005  |   .6992367    .038024    -6.58   0.000      .628545    .7778789
            2006  |   .6804249   .0382615    -6.85   0.000     .6094185    .7597046
            2007  |   .6646131   .0410285    -6.62   0.000     .5888732    .7500946
            2008  |   .5799739   .0366566    -8.62   0.000        .5124    .6564592
            2009  |   .5199798   .0339928   -10.00   0.000     .4574469    .5910611
            2010  |   .5150927   .0345008    -9.90   0.000     .4517229    .5873523
            2011  |   .4822344   .0313827   -11.21   0.000     .4244867    .5478383
            2012  |   .4275413   .0304574   -11.93   0.000      .371826    .4916051
            2013  |     .41971   .0310182   -11.75   0.000     .3631133    .4851281
            2014  |   .4093579   .0308198   -11.86   0.000     .3531976     .474448
            2015  |   .3945529   .0311174   -11.79   0.000     .3380439    .4605083
                  |
            _cons |   .0001094   6.36e-06  -156.95   0.000     .0000976    .0001226
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.221858   .0598222                     -1.339107   -1.104609
------------------+----------------------------------------------------------------
            alpha |   .2946821   .0176285                      .2620795    .3313405
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.1.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.V.1.csv not foun
> d)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.V.1.csv)

. /* 
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cv1_yhat 
(option n assumed; predicted number of events)

. gen cv1_res = dv - cv1_yhat

. 
. summ dv cv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
    cv1_yhat |      6,253    10.36602    14.65835   .0033412   178.5296

. /*
> pause "next"
> 
> scatter dv cv1_yhat
> 
> pause "next"
> 
> scatter cv1_res dv
> 
> pause "next"
> 
> scatter cv1_res cv1_yhat
> */
. pause "complete: C.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.2
. 
. // poisson model
. /*
> glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =  -23323.57  
Iteration 1:   log pseudolikelihood = -20574.203  
Iteration 2:   log pseudolikelihood = -20515.268  
Iteration 3:   log pseudolikelihood = -20514.267  
Iteration 4:   log pseudolikelihood = -20514.264  
Iteration 5:   log pseudolikelihood = -20514.264  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16809.456  
Iteration 1:   log pseudolikelihood = -16682.999  
Iteration 2:   log pseudolikelihood = -16676.495  
Iteration 3:   log pseudolikelihood = -16676.485  
Iteration 4:   log pseudolikelihood = -16676.485  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(32)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16676.485               Pseudo R2         =     0.0410

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p48_1lag |   1.003937   .0049866     0.79   0.429     .9942107    1.013758
         p75_1lag |   1.001038   .0001944     5.34   0.000     1.000657    1.001419
        mine_time |   1.009518   .0055951     1.71   0.087     .9986115    1.020544
onsite_insp_hours |   .9998467   .0000365    -4.20   0.000     .9997752    .9999183
         longwall |   .6590579   .0414201    -6.63   0.000     .5826768    .7454514
                  |
            state |
               1  |   .9971965    .108594    -0.03   0.979     .8055371    1.234457
               2  |   1.220672    .054292     4.48   0.000     1.118768    1.331858
               3  |   .8118237    .092189    -1.84   0.066     .6498318    1.014197
               4  |   1.070583   .0975277     0.75   0.454     .8955253    1.279862
               5  |   .8183491   .0666527    -2.46   0.014      .697606    .9599907
               6  |   .7589138   .0350347    -5.98   0.000     .6932619     .830783
               7  |   1.042565   .2062499     0.21   0.833     .7074737    1.536369
               8  |   .6231437   .0312308    -9.44   0.000     .5648428    .6874622
               9  |   .7743614   .0459232    -4.31   0.000     .6893876    .8698089
              10  |   .8806147    .080927    -1.38   0.167     .7354648    1.054411
              11  |   1.513499    .253125     2.48   0.013     1.090493     2.10059
              12  |   1.088441   .0704579     1.31   0.190     .9587473    1.235679
              13  |   1.496135   .1608014     3.75   0.000     1.211952    1.846954
              14  |   .5040846   .0741079    -4.66   0.000     .3778889    .6724232
              15  |   .7230179   .0375505    -6.24   0.000     .6530421    .8004917
              17  |   .8664068   .0528241    -2.35   0.019     .7688202    .9763801
                  |
             time |
            2000  |   1.044385   .0485157     0.93   0.350     .9534963    1.143937
            2002  |   .9219271   .0414964    -1.81   0.071       .84408    1.006954
            2003  |    .836488   .0466071    -3.20   0.001     .7499508    .9330107
            2004  |   .7763539   .0404178    -4.86   0.000     .7010439     .859754
            2005  |   .6979999   .0382946    -6.55   0.000     .6268384      .77724
            2006  |   .6826659   .0386834    -6.74   0.000     .6109064    .7628546
            2007  |   .6709029   .0413634    -6.47   0.000     .5945389    .7570752
            2008  |   .5810127   .0368999    -8.55   0.000     .5130104    .6580291
            2009  |   .5180309   .0340729   -10.00   0.000     .4553746    .5893083
            2010  |   .5148647   .0348591    -9.81   0.000     .4508813    .5879277
            2011  |   .4820113   .0315298   -11.16   0.000     .4240115    .5479447
            2012  |   .4250586   .0304667   -11.94   0.000     .3693497      .48917
            2013  |   .4171601   .0310076   -11.76   0.000     .3606059    .4825838
            2014  |   .4112677   .0312027   -11.71   0.000     .3544413    .4772048
            2015  |   .3897064   .0309272   -11.87   0.000     .3335692    .4552911
                  |
            _cons |   .0001103   6.48e-06  -155.14   0.000     .0000983    .0001238
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.218132   .0596515                     -1.335047   -1.101217
------------------+----------------------------------------------------------------
            alpha |   .2957822   .0176438                      .2631458    .3324661
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.2.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.V.2.csv not foun
> d)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.V.2.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cv2_yhat 
(option n assumed; predicted number of events)

. gen cv2_res = dv - cv2_yhat

. 
. summ dv cv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
    cv2_yhat |      6,253    10.35074    14.51428   .0033444     150.29

. /*
> pause "next"
> 
> scatter dv cv2_yhat
> 
> pause "next"
> 
> scatter cv2_res dv
> 
> pause "next"
> 
> scatter cv2_res cv2_yhat
> */
. pause "complete: C.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.3
. 
. // poisson model
. /*
> glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22928.943  
Iteration 1:   log pseudolikelihood = -20577.436  
Iteration 2:   log pseudolikelihood =  -20546.34  
Iteration 3:   log pseudolikelihood = -20546.199  
Iteration 4:   log pseudolikelihood = -20546.199  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16813.103  
Iteration 1:   log pseudolikelihood = -16688.238  
Iteration 2:   log pseudolikelihood = -16681.803  
Iteration 3:   log pseudolikelihood = -16681.792  
Iteration 4:   log pseudolikelihood = -16681.792  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(32)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16681.792               Pseudo R2         =     0.0407

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p48_c_4lag |   1.002149   .0023159     0.93   0.353     .9976207    1.006699
       p75_c_4lag |   1.000241     .00005     4.82   0.000     1.000143    1.000339
        mine_time |   1.008479   .0056514     1.51   0.132     .9974632    1.019617
onsite_insp_hours |   .9998589   .0000372    -3.79   0.000      .999786    .9999319
         longwall |   .6625755   .0415101    -6.57   0.000      .586014    .7491396
                  |
            state |
               1  |   .9961713   .1087521    -0.04   0.972     .8042818    1.233843
               2  |   1.228794   .0549917     4.60   0.000     1.125604    1.341444
               3  |   .8114254   .0921016    -1.84   0.066     .6495793    1.013596
               4  |   1.075178   .0972048     0.80   0.423     .9005858    1.283619
               5  |   .8207673   .0672972    -2.41   0.016     .6989199    .9638571
               6  |   .7586498   .0351107    -5.97   0.000     .6928628    .8306832
               7  |   1.042119   .2050213     0.21   0.834       .70869    1.532423
               8  |   .6195215   .0311199    -9.53   0.000     .5614339     .683619
               9  |   .7705778   .0455267    -4.41   0.000     .6863196    .8651802
              10  |    .880626    .081126    -1.38   0.168     .7351504    1.054889
              11  |   1.531769   .2579852     2.53   0.011     1.101111    2.130861
              12  |   1.081094   .0703533     1.20   0.231     .9516355    1.228164
              13  |   1.492853    .160786     3.72   0.000     1.208759    1.843719
              14  |   .5022376   .0744008    -4.65   0.000      .375676    .6714368
              15  |   .7217605   .0376354    -6.25   0.000     .6516407    .7994256
              17  |   .8569231    .052028    -2.54   0.011     .7607837    .9652116
                  |
             time |
            2000  |   1.070222    .050139     1.45   0.147     .9763279    1.173145
            2002  |   .9182231   .0413931    -1.89   0.058     .8405749    1.003044
            2003  |   .8343513     .04666    -3.24   0.001      .747733    .9310035
            2004  |   .7750576   .0404473    -4.88   0.000     .6997018     .858529
            2005  |    .696454   .0383392    -6.57   0.000     .6252224     .775801
            2006  |   .6848517   .0390241    -6.64   0.000     .6124822    .7657721
            2007  |   .6713816   .0415547    -6.44   0.000     .5946821    .7579735
            2008  |   .5846468   .0371253    -8.45   0.000     .5162286    .6621329
            2009  |    .518433   .0341849    -9.96   0.000     .4555807    .5899565
            2010  |   .5149598   .0348767    -9.80   0.000     .4509454    .5880615
            2011  |   .4803317   .0315762   -11.15   0.000     .4222646    .5463839
            2012  |   .4239305   .0305167   -11.92   0.000     .3681467    .4881671
            2013  |   .4161787   .0311189   -11.72   0.000     .3594455    .4818664
            2014  |   .4102571   .0313309   -11.67   0.000     .3532244    .4764985
            2015  |   .3878632   .0309252   -11.88   0.000     .3317496     .453468
                  |
            _cons |   .0001112   6.58e-06  -153.92   0.000      .000099    .0001248
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.213859   .0595827                     -1.330639   -1.097079
------------------+----------------------------------------------------------------
            alpha |   .2970486    .017699                      .2643082    .3338447
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.3.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.V.3.csv not foun
> d)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.V.3.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cv3_yhat 
(option n assumed; predicted number of events)

. gen cv3_res = dv - cv3_yhat

. 
. summ dv cv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
    cv3_yhat |      6,253    10.33807    14.41095   .0033555   146.7694

. 
. pause "next"

. /*
> scatter dv cv3_yhat
> 
> pause "next"
> 
> scatter cv3_res dv
> 
> pause "next"
> 
> scatter cv3_res cv3_yhat
> */
. pause "complete: C.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.4
. 
. // poisson model
. /*
> glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22227.212  
Iteration 1:   log pseudolikelihood = -20637.049  
Iteration 2:   log pseudolikelihood = -20625.927  
Iteration 3:   log pseudolikelihood = -20625.907  
Iteration 4:   log pseudolikelihood = -20625.907  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16827.534  
Iteration 1:   log pseudolikelihood = -16711.369  
Iteration 2:   log pseudolikelihood = -16706.132  
Iteration 3:   log pseudolikelihood = -16706.125  
Iteration 4:   log pseudolikelihood = -16706.125  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(32)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16706.125               Pseudo R2         =     0.0393

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_c_lag_all |    1.00073   .0011544     0.63   0.527     .9984704    1.002995
    p75_c_lag_all |   1.000003   5.91e-06     0.56   0.573     .9999918    1.000015
        mine_time |   1.009229    .006112     1.52   0.129     .9973201    1.021279
onsite_insp_hours |   .9999742   .0000369    -0.70   0.484     .9999019    1.000047
         longwall |   .6764662   .0436776    -6.05   0.000     .5960549    .7677255
                  |
            state |
               1  |   .9865543   .1089933    -0.12   0.902      .794477    1.225069
               2  |   1.226614   .0566855     4.42   0.000     1.120396    1.342903
               3  |   .8071996   .0921479    -1.88   0.061     .6453716    1.009606
               4  |   1.102898   .0991117     1.09   0.276     .9247885    1.315311
               5  |   .8243795   .0707534    -2.25   0.024     .6967415    .9753998
               6  |     .75057   .0351153    -6.13   0.000     .6848064     .822649
               7  |   1.056274   .2016683     0.29   0.774     .7265432    1.535647
               8  |   .5803088   .0307093   -10.28   0.000     .5231358    .6437301
               9  |   .7424861   .0438635    -5.04   0.000     .6613058    .8336319
              10  |   .8708742   .0812932    -1.48   0.139     .7252681    1.045712
              11  |   1.541261   .2556354     2.61   0.009     1.113512    2.133327
              12  |   1.015849   .0676273     0.24   0.813     .8915855    1.157432
              13  |   1.467408   .1629915     3.45   0.001     1.180332    1.824306
              14  |   .4814146   .0751901    -4.68   0.000     .3544653    .6538299
              15  |   .7194311   .0383126    -6.18   0.000     .6481257    .7985813
              17  |   .8070966   .0491685    -3.52   0.000     .7162591    .9094543
                  |
             time |
            2000  |   1.025305    .048116     0.53   0.594     .9352063    1.124084
            2002  |    .915643   .0411752    -1.96   0.050     .8383953    1.000008
            2003  |   .8275041    .046238    -3.39   0.001     .7416653    .9232776
            2004  |   .7660703   .0400768    -5.09   0.000      .691414    .8487877
            2005  |   .6867471   .0380209    -6.79   0.000     .6161283    .7654601
            2006  |   .6818275   .0389736    -6.70   0.000     .6095641    .7626577
            2007  |   .6712128   .0420003    -6.37   0.000     .5937414    .7587926
            2008  |   .5844587   .0374714    -8.38   0.000     .5154431    .6627152
            2009  |   .5227741   .0347872    -9.75   0.000     .4588516    .5956017
            2010  |   .5135092   .0349761    -9.79   0.000      .449336    .5868475
            2011  |   .4752653   .0316919   -11.16   0.000     .4170381    .5416222
            2012  |   .4145543   .0303267   -12.04   0.000     .3591798    .4784659
            2013  |   .4037323   .0306534   -11.95   0.000     .3479092    .4685124
            2014  |    .392628   .0303917   -12.08   0.000     .3373597    .4569507
            2015  |   .3712481   .0300668   -12.23   0.000     .3167575    .4351126
                  |
            _cons |   .0001142   6.99e-06  -148.25   0.000     .0001013    .0001287
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.197077   .0593995                     -1.313498   -1.080657
------------------+----------------------------------------------------------------
            alpha |   .3020757   .0179432                      .2688778    .3393726
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.4.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.V.4.csv not foun
> d)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.V.4.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cv4_yhat 
(option n assumed; predicted number of events)

. gen cv4_res = dv - cv4_yhat

. 
. summ dv cv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
    cv4_yhat |      6,253    10.25087    13.76525    .003349    108.092

. /*
> pause "next"
> 
> scatter dv cv4_yhat
> 
> pause "next"
> 
> scatter cv4_res dv
> 
> pause "next"
> 
> scatter cv4_res cv4_yhat
> */
. pause "complete: C.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.1
. 
. // poisson model
. /*
> glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22521.729  
Iteration 1:   log pseudolikelihood = -20550.598  
Iteration 2:   log pseudolikelihood =  -20536.89  
Iteration 3:   log pseudolikelihood = -20536.867  
Iteration 4:   log pseudolikelihood = -20536.867  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16806.008  
Iteration 1:   log pseudolikelihood = -16673.115  
Iteration 2:   log pseudolikelihood = -16664.669  
Iteration 3:   log pseudolikelihood =  -16664.65  
Iteration 4:   log pseudolikelihood =  -16664.65  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(32)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood =  -16664.65               Pseudo R2         =     0.0417

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_ss |    1.01137   .0221548     0.52   0.606     .9688666    1.055738
           p75_ss |   1.003074   .0005419     5.68   0.000     1.002013    1.004137
        mine_time |   1.010498   .0055451     1.90   0.057      .999688    1.021425
onsite_insp_hours |   .9998632   .0000345    -3.97   0.000     .9997956    .9999307
         longwall |   .6597995   .0416375    -6.59   0.000     .5830366    .7466691
                  |
            state |
               1  |   .9888946   .1080559    -0.10   0.919     .7982514    1.225068
               2  |   1.202129   .0534086     4.14   0.000     1.101878      1.3115
               3  |   .8615584   .0937732    -1.37   0.171     .6960474    1.066426
               4  |   1.126035   .1061146     1.26   0.208     .9361317    1.354462
               5  |    .844138   .0675804    -2.12   0.034     .7215518    .9875506
               6  |   .7604628   .0347687    -5.99   0.000     .6952815    .8317548
               7  |   1.046794   .2041116     0.23   0.815     .7143118    1.534034
               8  |   .6423147   .0321569    -8.84   0.000     .5822819    .7085369
               9  |   .7876205   .0465339    -4.04   0.000     .7014982    .8843158
              10  |   .8558316    .077327    -1.72   0.085     .7169347    1.021638
              11  |   1.505464   .2640694     2.33   0.020     1.067489    2.123134
              12  |   1.085512   .0698679     1.27   0.202     .9568586    1.231463
              13  |   1.493428   .1583996     3.78   0.000     1.213116    1.838512
              14  |   .5086758   .0738333    -4.66   0.000     .3827285    .6760696
              15  |   .7217202   .0374335    -6.29   0.000     .6519578    .7989475
              17  |   .9035483   .0560545    -1.63   0.102     .8001003    1.020372
                  |
             time |
            2000  |   1.036287   .0474449     0.78   0.436     .9473468    1.133577
            2002  |   .9346281   .0416154    -1.52   0.129     .8565212    1.019858
            2003  |   .8435233   .0464958    -3.09   0.002     .7571433     .939758
            2004  |   .7735387   .0396705    -5.01   0.000     .6995659    .8553334
            2005  |   .6982249   .0377609    -6.64   0.000     .6280024    .7762997
            2006  |   .6780868   .0380059    -6.93   0.000     .6075424    .7568225
            2007  |   .6726163   .0410085    -6.50   0.000     .5968575     .757991
            2008  |   .5937692   .0370693    -8.35   0.000     .5253839    .6710558
            2009  |    .538635   .0345826    -9.64   0.000     .4749457    .6108649
            2010  |    .523569   .0347445    -9.75   0.000     .4597137     .596294
            2011  |   .4912772   .0317651   -10.99   0.000     .4328021    .5576528
            2012  |   .4402092   .0311528   -11.59   0.000     .3831962    .5057048
            2013  |   .4357199   .0322259   -11.23   0.000     .3769229    .5036889
            2014  |   .4272738   .0321224   -11.31   0.000     .3687338    .4951076
            2015  |   .4114201   .0326545   -11.19   0.000     .3521481    .4806685
                  |
            _cons |   .0001074   6.13e-06  -160.21   0.000      .000096    .0001201
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.222477    .059403                     -1.338904   -1.106049
------------------+----------------------------------------------------------------
            alpha |   .2944999   .0174942                      .2621327    .3308636
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.1.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.SSV.1.csv not fo
> und)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.SSV.1.csv
> )

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cssv1_yhat 
(option n assumed; predicted number of events)

. gen cssv1_res = dv - cssv1_yhat

. 
. summ dv cssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
  cssv1_yhat |      6,253    10.38492    14.67136   .0034015   152.6444

. /*
> pause "next"
> 
> scatter dv cssv1_yhat
> 
> pause "next"
> 
> scatter cssv1_res dv
> 
> pause "next"
> 
> scatter cssv1_res cssv1_yhat
> */
. pause "complete: C.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.2
. 
. // poisson model
. /*
> glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22391.642  
Iteration 1:   log pseudolikelihood = -20557.623  
Iteration 2:   log pseudolikelihood = -20547.233  
Iteration 3:   log pseudolikelihood = -20547.214  
Iteration 4:   log pseudolikelihood = -20547.214  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16808.045  
Iteration 1:   log pseudolikelihood = -16676.582  
Iteration 2:   log pseudolikelihood = -16668.355  
Iteration 3:   log pseudolikelihood = -16668.337  
Iteration 4:   log pseudolikelihood = -16668.337  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(32)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16668.337               Pseudo R2         =     0.0415

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_ss_1lag |   .9921175   .0192345    -0.41   0.683     .9551259    1.030542
      p75_ss_1lag |   1.002987   .0005399     5.54   0.000     1.001929    1.004046
        mine_time |   1.009343   .0055767     1.68   0.092     .9984716    1.020332
onsite_insp_hours |   .9998731   .0000338    -3.75   0.000     .9998068    .9999393
         longwall |   .6600296   .0415255    -6.60   0.000     .5834591    .7466489
                  |
            state |
               1  |   .9919059   .1074711    -0.08   0.940     .8021293    1.226582
               2  |   1.214902   .0540773     4.37   0.000     1.113404    1.325653
               3  |   .8613673   .0938562    -1.37   0.171     .6957287    1.066441
               4  |   1.128744   .1064772     1.28   0.199     .9382087    1.357974
               5  |     .84825   .0687894    -2.03   0.042     .7235942    .9943807
               6  |   .7611849   .0348468    -5.96   0.000     .6958609    .8326412
               7  |   1.044923   .2038375     0.23   0.822     .7129134    1.531552
               8  |   .6399018   .0321708    -8.88   0.000     .5798552    .7061665
               9  |   .7918721   .0468877    -3.94   0.000      .705106    .8893151
              10  |   .8577337   .0775527    -1.70   0.090     .7184399    1.024034
              11  |   1.508329   .2622677     2.36   0.018     1.072727    2.120814
              12  |   1.081609   .0697817     1.22   0.224     .9531337    1.227402
              13  |   1.486534   .1578998     3.73   0.000     1.207147    1.830583
              14  |   .5071001   .0732752    -4.70   0.000      .382029    .6731178
              15  |   .7219955   .0374759    -6.28   0.000     .6521567    .7993133
              17  |   .9062623   .0562963    -1.58   0.113      .802376    1.023599
                  |
             time |
            2000  |   1.050184   .0482351     1.07   0.286      .959775    1.149109
            2002  |   .9279538   .0415474    -1.67   0.095      .849993    1.013065
            2003  |   .8410559   .0464931    -3.13   0.002     .7546941    .9373004
            2004  |   .7744608   .0400679    -4.94   0.000     .6997796    .8571121
            2005  |   .6968691   .0379615    -6.63   0.000     .6263002    .7753893
            2006  |   .6813019   .0382861    -6.83   0.000     .6102473    .7606298
            2007  |   .6750795   .0412638    -6.43   0.000     .5988607    .7609989
            2008  |   .5933483   .0370978    -8.35   0.000     .5249164    .6707015
            2009  |   .5352653   .0345983    -9.67   0.000     .4715734    .6075595
            2010  |   .5245582   .0349781    -9.68   0.000     .4602934    .5977955
            2011  |   .4901299   .0317897   -10.99   0.000     .4316209    .5565703
            2012  |     .43589    .030939   -11.70   0.000     .3792796      .50095
            2013  |   .4322681   .0319917   -11.33   0.000      .373901    .4997464
            2014  |    .426036   .0321113   -11.32   0.000     .3675271    .4938593
            2015  |   .4074932   .0323889   -11.29   0.000     .3487098     .476186
                  |
            _cons |   .0001082   6.21e-06  -158.96   0.000     .0000966     .000121
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.220043   .0592073                     -1.336087   -1.103999
------------------+----------------------------------------------------------------
            alpha |   .2952174    .017479                      .2628722    .3315426
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.2.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.SSV.2.csv not fo
> und)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.SSV.2.csv
> )

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cssv2_yhat 
(option n assumed; predicted number of events)

. gen cssv2_res = dv - cssv2_yhat

. 
. summ dv cssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
  cssv2_yhat |      6,253    10.37431    14.58147   .0033944   157.7929

. /*
> pause "next"
> 
> scatter dv cssv2_yhat
> 
> pause "next"
> 
> scatter cssv2_res dv
> 
> pause "next"
> 
> scatter cssv2_res cssv2_yhat
> */
. pause "complete: C.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.3
. 
. // poisson model
. /*
> glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22357.347  
Iteration 1:   log pseudolikelihood = -20581.817  
Iteration 2:   log pseudolikelihood = -20572.301  
Iteration 3:   log pseudolikelihood = -20572.285  
Iteration 4:   log pseudolikelihood = -20572.285  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16812.215  
Iteration 1:   log pseudolikelihood = -16682.331  
Iteration 2:   log pseudolikelihood = -16674.362  
Iteration 3:   log pseudolikelihood = -16674.345  
Iteration 4:   log pseudolikelihood = -16674.345  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(32)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16674.345               Pseudo R2         =     0.0411

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_ss_c_4lag |   1.003861   .0074595     0.52   0.604     .9893461    1.018588
    p75_ss_c_4lag |    1.00072   .0001456     4.95   0.000     1.000435    1.001006
        mine_time |   1.008292   .0056252     1.48   0.139     .9973269    1.019378
onsite_insp_hours |   .9998799   .0000341    -3.52   0.000     .9998131    .9999468
         longwall |   .6604102   .0415312    -6.60   0.000     .5838271     .747039
                  |
            state |
               1  |   .9844203   .1079944    -0.14   0.886     .7939639    1.220564
               2  |   1.216973   .0546732     4.37   0.000     1.114398     1.32899
               3  |   .8589414   .0938381    -1.39   0.164     .6933796    1.064035
               4  |   1.125584   .1049427     1.27   0.204     .9375987     1.35126
               5  |   .8464442   .0693354    -2.04   0.042      .720897     .993856
               6  |   .7599266   .0347764    -6.00   0.000     .6947335    .8312373
               7  |   1.043511   .2027641     0.22   0.826     .7130185    1.527192
               8  |   .6370934    .032401    -8.86   0.000      .576651    .7038711
               9  |   .7875229   .0468809    -4.01   0.000     .7007959    .8849827
              10  |   .8567571   .0773108    -1.71   0.087     .7178741    1.022509
              11  |   1.525992   .2660548     2.42   0.015     1.084292    2.147624
              12  |   1.077394   .0695779     1.15   0.248     .9493017    1.222771
              13  |   1.485934   .1581081     3.72   0.000     1.206227    1.830502
              14  |   .5069077   .0738529    -4.66   0.000      .380991    .6744395
              15  |   .7208905   .0375252    -6.29   0.000     .6509699    .7983213
              17  |   .8943087   .0561572    -1.78   0.075     .7907463    1.011435
                  |
             time |
            2000  |   1.077865   .0499952     1.62   0.106     .9841986    1.180446
            2002  |   .9207407    .041374    -1.84   0.066     .8431175     1.00551
            2003  |   .8376515   .0465152    -3.19   0.001     .7512695    .9339658
            2004  |   .7733618   .0402694    -4.94   0.000     .6983291    .8564564
            2005  |   .6941225    .038049    -6.66   0.000     .6234141    .7728507
            2006  |   .6824161   .0386685    -6.74   0.000     .6106842    .7625737
            2007  |   .6724732     .04129    -6.46   0.000     .5962262    .7584708
            2008  |   .5932876   .0372517    -8.31   0.000     .5245893    .6709823
            2009  |   .5323978    .034606    -9.70   0.000      .468714    .6047343
            2010  |   .5247684   .0351043    -9.64   0.000     .4602848    .5982858
            2011  |    .486788   .0317103   -11.05   0.000      .428441    .5530809
            2012  |   .4333388   .0308921   -11.73   0.000      .376831    .4983202
            2013  |   .4303364    .031986   -11.34   0.000     .3719975    .4978242
            2014  |   .4250096   .0322727   -11.27   0.000     .3662381    .4932123
            2015  |   .4044993   .0322478   -11.35   0.000     .3459852    .4729094
                  |
            _cons |   .0001092   6.31e-06  -157.86   0.000     .0000975    .0001223
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |   -1.21569   .0591115                     -1.331546   -1.099834
------------------+----------------------------------------------------------------
            alpha |   .2965053   .0175269                      .2640686    .3329265
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.3.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.SSV.3.csv not fo
> und)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.SSV.3.csv
> )

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cssv3_yhat 
(option n assumed; predicted number of events)

. gen cssv3_res = dv - cssv3_yhat

. 
. summ dv cssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
  cssv3_yhat |      6,253     10.3672    14.52888     .00341   150.7451

. /*
> pause "next"
> 
> scatter dv cssv3_yhat
> 
> pause "next"
> 
> scatter cssv3_res dv
> 
> pause "next"
> 
> scatter cssv3_res cssv3_yhat
> */
. pause "complete: C.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.4
. 
. // poisson model
. /*
> glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22050.875  
Iteration 1:   log pseudolikelihood = -20628.965  
Iteration 2:   log pseudolikelihood = -20623.077  
Iteration 3:   log pseudolikelihood =  -20623.07  
Iteration 4:   log pseudolikelihood =  -20623.07  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16826.656  
Iteration 1:   log pseudolikelihood = -16710.792  
Iteration 2:   log pseudolikelihood = -16705.639  
Iteration 3:   log pseudolikelihood = -16705.632  
Iteration 4:   log pseudolikelihood = -16705.632  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(32)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16705.632               Pseudo R2         =     0.0393

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_ss_c_lag_all |   1.002678   .0033635     0.80   0.425     .9961073    1.009292
 p75_ss_c_lag_all |   1.000009   .0000205     0.42   0.673     .9999684    1.000049
        mine_time |   1.009095   .0062249     1.47   0.142     .9969683     1.02137
onsite_insp_hours |   .9999765   .0000359    -0.65   0.513     .9999061    1.000047
         longwall |   .6743841   .0433702    -6.13   0.000     .5945192    .7649777
                  |
            state |
               1  |   .9793219   .1103751    -0.19   0.853     .7852181    1.221408
               2  |   1.225907   .0570992     4.37   0.000     1.118951    1.343087
               3  |   .8154457   .0917636    -1.81   0.070     .6540452    1.016675
               4  |   1.099165   .0994656     1.04   0.296     .9205259    1.312471
               5  |   .8229849    .071357    -2.25   0.025     .6943658    .9754285
               6  |   .7501118   .0350722    -6.15   0.000     .6844273    .8221002
               7  |   1.055631   .2015673     0.28   0.777     .7260723    1.534775
               8  |   .5802208   .0297036   -10.63   0.000     .5248283    .6414596
               9  |   .7392424   .0443003    -5.04   0.000     .6573206    .8313741
              10  |   .8523312   .0819548    -1.66   0.097      .705931    1.029093
              11  |   1.540304   .2547614     2.61   0.009     1.113834    2.130064
              12  |   1.015624   .0671927     0.23   0.815     .8921098    1.156239
              13  |   1.467887   .1627707     3.46   0.001      1.18115    1.824234
              14  |   .4841612   .0754516    -4.65   0.000     .3567294    .6571146
              15  |   .7195559   .0383562    -6.17   0.000      .648173    .7988001
              17  |   .7934742   .0583427    -3.15   0.002     .6869822    .9164739
                  |
             time |
            2000  |   1.025272   .0480984     0.53   0.595     .9352051    1.124013
            2002  |   .9155095   .0411497    -1.96   0.050     .8383081    .9998206
            2003  |   .8275856   .0462221    -3.39   0.001     .7417744    .9233237
            2004  |   .7657869   .0400433    -5.10   0.000     .6911914     .848433
            2005  |   .6866814   .0379523    -6.80   0.000     .6161835    .7652451
            2006  |   .6816975   .0389528    -6.71   0.000     .6094714    .7624828
            2007  |   .6709086   .0419167    -6.39   0.000     .5935843    .7583056
            2008  |   .5839218   .0373165    -8.42   0.000     .5151779    .6618387
            2009  |    .522633   .0346875    -9.78   0.000      .458883    .5952393
            2010  |   .5136807    .034945    -9.79   0.000     .4495595    .5869475
            2011  |   .4754895   .0316807   -11.16   0.000     .4172799    .5418192
            2012  |   .4150124   .0304375   -11.99   0.000     .3594454    .4791694
            2013  |   .4048968    .030831   -11.87   0.000     .3487621    .4700667
            2014  |   .3943651   .0306247   -11.98   0.000     .3386865    .4591971
            2015  |   .3733292   .0303439   -12.12   0.000     .3183515    .4378012
                  |
            _cons |   .0001142   6.98e-06  -148.46   0.000     .0001013    .0001287
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.197619   .0594596                     -1.314158    -1.08108
------------------+----------------------------------------------------------------
            alpha |   .3019122   .0179516                      .2687005    .3392289
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.4.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.SSV.4.csv not fo
> und)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.SSV.4.csv
> )

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cssv4_yhat 
(option n assumed; predicted number of events)

. gen cssv4_res = dv - cssv4_yhat

. 
. summ dv cssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
  cssv4_yhat |      6,253    10.25448    13.79412   .0033587    109.544

. /*
> pause "next"
> 
> scatter dv cssv4_yhat
> 
> pause "next"
> 
> scatter cssv4_res dv
> 
> pause "next"
> 
> scatter cssv4_res cssv4_yhat
> */
. pause "complete: C.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.1
. 
. // poisson model
. /*
> glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -10860.771  
Iteration 1:   log pseudolikelihood = -10345.589  
Iteration 2:   log pseudolikelihood = -10343.423  
Iteration 3:   log pseudolikelihood = -10343.421  
Iteration 4:   log pseudolikelihood = -10343.421  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8780.4919  
Iteration 1:   log pseudolikelihood = -8738.7847  
Iteration 2:   log pseudolikelihood = -8737.3596  
Iteration 3:   log pseudolikelihood = -8737.3585  
Iteration 4:   log pseudolikelihood = -8737.3585  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(25)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8737.3585               Pseudo R2         =     0.0285

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_pp |   1.000203   .0001389     1.46   0.144     .9999306    1.000475
           p75_pp |   1.000014   2.53e-06     5.43   0.000     1.000009    1.000019
        mine_time |   1.007286   .0058113     1.26   0.208       .99596     1.01874
onsite_insp_hours |    .999796   .0000376    -5.42   0.000     .9997223    .9998697
         longwall |   .7459063   .0524608    -4.17   0.000     .6498571    .8561517
                  |
            state |
               1  |   1.154828   .1375737     1.21   0.227     .9143544    1.458547
               2  |   1.461648   .0763982     7.26   0.000     1.319325    1.619324
               3  |    .759172     .09154    -2.29   0.022     .5993816    .9615614
               4  |   1.097922   .1055495     0.97   0.331     .9093699    1.325569
               5  |   .8141633    .083092    -2.01   0.044     .6665603    .9944515
               6  |    .822945   .0461769    -3.47   0.001     .7372391    .9186143
               7  |   1.187759   .2186876     0.93   0.350     .8279553    1.703922
               8  |   .5551432   .0398105    -8.21   0.000     .4823513    .6389201
               9  |    .764967   .0582353    -3.52   0.000     .6589351     .888061
              10  |    .893388   .1132583    -0.89   0.374     .6968349    1.145382
              11  |   1.383706   .3521286     1.28   0.202     .8402879    2.278555
              12  |   1.171455   .0952055     1.95   0.052     .9989583    1.373737
              13  |    1.74749    .306759     3.18   0.001     1.238776    2.465113
              14  |   .5303847   .0942777    -3.57   0.000     .3743579     .751441
              15  |   .7008973   .0470302    -5.30   0.000     .6145239    .7994109
              17  |   .7566548   .0537569    -3.92   0.000     .6582998    .8697047
                  |
             time |
            2007  |   1.154736   .0481531     3.45   0.001     1.064112    1.253079
            2009  |   .8968075   .0352806    -2.77   0.006     .8302575    .9686918
            2010  |   .9005357   .0430092    -2.19   0.028     .8200644    .9889035
            2011  |   .8353418   .0374223    -4.02   0.000     .7651234    .9120046
            2012  |    .741774   .0380127    -5.83   0.000     .6708898    .8201476
            2013  |   .7299645   .0422895    -5.43   0.000     .6516112    .8177394
            2014  |   .7188098    .040567    -5.85   0.000     .6435396    .8028837
            2015  |   .6966202   .0430307    -5.85   0.000      .617187    .7862766
                  |
            _cons |   .0000643   3.92e-06  -158.29   0.000     .0000571    .0000725
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.327803   .0735373                     -1.471933   -1.183672
------------------+----------------------------------------------------------------
            alpha |    .265059   .0194917                      .2294814    .3061524
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.1.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.PP.1.csv not fou
> nd)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.PP.1.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cpp1_yhat 
(option n assumed; predicted number of events)

. gen cpp1_res = dv - cpp1_yhat

. 
. summ dv cpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
   cpp1_yhat |      6,253    8.486119    11.61598   .0034019   142.2906

. /*
> pause "next"
> 
> scatter dv cpp1_yhat
> 
> pause "next"
> 
> scatter cpp1_res dv
> 
> pause "next"
> 
> scatter cpp1_res cpp1_yhat
> */
. pause "complete: C.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.2
. 
. // poisson model
. /*
> glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =   -10848.5  
Iteration 1:   log pseudolikelihood = -10365.379  
Iteration 2:   log pseudolikelihood = -10363.054  
Iteration 3:   log pseudolikelihood = -10363.052  
Iteration 4:   log pseudolikelihood = -10363.052  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8782.2189  
Iteration 1:   log pseudolikelihood = -8741.4204  
Iteration 2:   log pseudolikelihood = -8740.0565  
Iteration 3:   log pseudolikelihood = -8740.0555  
Iteration 4:   log pseudolikelihood = -8740.0555  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(25)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8740.0555               Pseudo R2         =     0.0282

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_pp_1lag |   1.000133   .0001005     1.32   0.187     .9999357     1.00033
      p75_pp_1lag |   1.000013   2.49e-06     5.24   0.000     1.000008    1.000018
        mine_time |   1.006386   .0058475     1.10   0.273     .9949904    1.017913
onsite_insp_hours |   .9998099    .000037    -5.14   0.000     .9997374    .9998824
         longwall |   .7478491    .052288    -4.16   0.000     .6520783    .8576857
                  |
            state |
               1  |    1.14557   .1365527     1.14   0.254      .906897    1.447056
               2  |   1.459045   .0759471     7.26   0.000     1.317533    1.615757
               3  |    .757182   .0917863    -2.29   0.022     .5970584    .9602487
               4  |   1.099127    .105557     0.98   0.325     .9105443    1.326768
               5  |   .8141976   .0815977    -2.05   0.040     .6689963    .9909141
               6  |    .819812   .0460311    -3.54   0.000     .7343798    .9151829
               7  |   1.181861   .2186614     0.90   0.366     .8223977    1.698443
               8  |    .548061   .0394188    -8.36   0.000     .4759999    .6310313
               9  |   .7623262   .0579437    -3.57   0.000     .6568131    .8847894
              10  |   .8893433   .1129676    -0.92   0.356     .6933408    1.140754
              11  |   1.377135   .3437821     1.28   0.200     .8442792    2.246295
              12  |   1.158724   .0939083     1.82   0.069     .9885409    1.358205
              13  |    1.74252   .3064406     3.16   0.002     1.234482    2.459634
              14  |   .5260514   .0934587    -3.62   0.000     .3713668    .7451665
              15  |   .6991226   .0469735    -5.33   0.000     .6128608     .797526
              17  |   .7521911   .0531686    -4.03   0.000     .6548789    .8639634
                  |
             time |
            2007  |   1.184254   .0503368     3.98   0.000     1.089593    1.287138
            2009  |   .8917208   .0351108    -2.91   0.004     .8254933    .9632617
            2010  |   .8978545   .0431864    -2.24   0.025     .8170781    .9866165
            2011  |   .8345883   .0373287    -4.04   0.000     .7645404    .9110539
            2012  |   .7359836   .0377236    -5.98   0.000     .6656391    .8137619
            2013  |   .7237352   .0419785    -5.57   0.000     .6459633    .8108706
            2014  |   .7195539   .0406614    -5.82   0.000      .644114    .8038296
            2015  |   .6867562   .0419723    -6.15   0.000      .609228    .7741503
                  |
            _cons |   .0000649   3.93e-06  -159.26   0.000     .0000576    .0000731
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.322815   .0730936                     -1.466076   -1.179554
------------------+----------------------------------------------------------------
            alpha |   .2663844    .019471                      .2308295    .3074157
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.2.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.PP.2.csv not fou
> nd)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.PP.2.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cpp2_yhat 
(option n assumed; predicted number of events)

. gen cpp2_res = dv - cpp2_yhat

. 
. summ dv cpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
   cpp2_yhat |      6,253    8.514966    11.60121   .0034006   142.1611

. /*
> pause "next"
> 
> scatter dv cpp2_yhat
> 
> pause "next"
> 
> scatter cpp2_res dv
> 
> pause "next"
> 
> scatter cpp2_res cpp2_yhat
> */
. pause "complete: C.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.3
. 
. // poisson model
. /*
> glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -10845.052  
Iteration 1:   log pseudolikelihood = -10379.687  
Iteration 2:   log pseudolikelihood = -10377.859  
Iteration 3:   log pseudolikelihood = -10377.858  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8783.0966  
Iteration 1:   log pseudolikelihood = -8742.9262  
Iteration 2:   log pseudolikelihood = -8741.6008  
Iteration 3:   log pseudolikelihood = -8741.5998  
Iteration 4:   log pseudolikelihood = -8741.5998  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(25)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8741.5998               Pseudo R2         =     0.0281

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_pp_c_4lag |   1.000064   .0000473     1.35   0.178      .999971    1.000156
    p75_pp_c_4lag |   1.000003   6.65e-07     4.77   0.000     1.000002    1.000004
        mine_time |   1.005797   .0058924     0.99   0.324      .994314    1.017412
onsite_insp_hours |   .9998142   .0000376    -4.94   0.000     .9997404    .9998879
         longwall |   .7491907   .0521806    -4.15   0.000     .6535922    .8587721
                  |
            state |
               1  |   1.139023   .1365244     1.09   0.277      .900548     1.44065
               2  |   1.467836   .0767464     7.34   0.000     1.324867    1.626234
               3  |   .7561875    .091648    -2.31   0.021     .5963018    .9589433
               4  |   1.102999   .1055927     1.02   0.306     .9142974    1.330646
               5  |   .8147266   .0814715    -2.05   0.040     .6697195    .9911306
               6  |   .8198552   .0459342    -3.55   0.000     .7345929    .9150138
               7  |   1.181677   .2180868     0.90   0.366     .8230074    1.696657
               8  |    .547923   .0396429    -8.32   0.000      .475482    .6314007
               9  |   .7586618   .0577207    -3.63   0.000      .653562    .8806627
              10  |   .8893371   .1128763    -0.92   0.355     .6934742    1.140519
              11  |   1.380716   .3422232     1.30   0.193     .8494273    2.244308
              12  |   1.154685   .0939654     1.77   0.077      .984453    1.354354
              13  |   1.741942   .3060842     3.16   0.002     1.234427    2.458114
              14  |   .5252779    .093479    -3.62   0.000     .3706026    .7445087
              15  |   .6994631    .046987    -5.32   0.000     .6131752    .7978936
              17  |   .7462011    .052757    -4.14   0.000     .6496437    .8571099
                  |
             time |
            2007  |   1.184794   .0506442     3.97   0.000     1.089578    1.288332
            2009  |   .8865956   .0350831    -3.04   0.002     .8204328    .9580941
            2010  |   .8907912    .042837    -2.40   0.016     .8106675     .978834
            2011  |   .8268313   .0367994    -4.27   0.000     .7577621    .9021961
            2012  |   .7298143     .03723    -6.17   0.000     .6603741    .8065563
            2013  |    .717658   .0415002    -5.74   0.000     .6407593    .8037856
            2014  |   .7139117   .0402279    -5.98   0.000     .6392643    .7972756
            2015  |   .6796932   .0412237    -6.37   0.000     .6035137    .7654886
                  |
            _cons |   .0000656   3.95e-06  -160.09   0.000     .0000583    .0000738
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.319482   .0725727                     -1.461722   -1.177242
------------------+----------------------------------------------------------------
            alpha |   .2672736   .0193968                      .2318366    .3081272
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.3.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.PP.3.csv not fou
> nd)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.PP.3.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cpp3_yhat 
(option n assumed; predicted number of events)

. gen cpp3_res = dv - cpp3_yhat

. 
. summ dv cpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
   cpp3_yhat |      6,253    8.546513    11.62331   .0034037   143.0869

. /*
> pause "next"
> 
> scatter dv cpp3_yhat
> 
> pause "next"
> 
> scatter cpp3_res dv
> 
> pause "next"
> 
> scatter cpp3_res cpp3_yhat
> */
. pause "complete: C.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.4
. 
. // poisson model
. /*
> glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */ 
. eststo clear

. eststo: nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -10986.357  
Iteration 1:   log pseudolikelihood = -10478.958  
Iteration 2:   log pseudolikelihood = -10476.638  
Iteration 3:   log pseudolikelihood = -10476.637  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood =  -8795.025  
Iteration 1:   log pseudolikelihood = -8759.8391  
Iteration 2:   log pseudolikelihood =  -8758.866  
Iteration 3:   log pseudolikelihood = -8758.8655  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(26)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8758.8655               Pseudo R2         =     0.0262

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_pp_c_lag_all |   1.000025   .0000215     1.16   0.245     .9999828    1.000067
 p75_pp_c_lag_all |          1   1.14e-07     1.20   0.229     .9999999           1
        mine_time |   1.006763   .0062343     1.09   0.276     .9946178    1.019056
onsite_insp_hours |   .9999128   .0000375    -2.32   0.020     .9998393    .9999864
         longwall |   .7390315   .0547517    -4.08   0.000     .6391474    .8545251
                  |
            state |
               1  |   1.063394    .134159     0.49   0.626     .8304345    1.361704
               2  |   1.442574    .074867     7.06   0.000     1.303053    1.597033
               3  |   .7365175   .0874399    -2.58   0.010     .5836168    .9294762
               4  |   1.116304   .1094341     1.12   0.262     .9211645    1.352783
               5  |    .794687    .082543    -2.21   0.027     .6483105    .9741126
               6  |   .7952958   .0446904    -4.08   0.000     .7123556    .8878929
               7  |   1.180883   .2083698     0.94   0.346     .8356225    1.668797
               8  |   .5157757   .0405454    -8.42   0.000     .4421274    .6016921
               9  |   .7166916     .05593    -4.27   0.000     .6150427    .8351401
              10  |   .8666608   .1100825    -1.13   0.260     .6756632     1.11165
              11  |   1.372877   .3392119     1.28   0.200     .8458942    2.228166
              12  |   1.046326   .0822371     0.58   0.565     .8969448    1.220585
              13  |   1.707815   .3101757     2.95   0.003     1.196312    2.438019
              14  |   .5024925    .092753    -3.73   0.000     .3499532    .7215215
              15  |   .6925494   .0470605    -5.41   0.000     .6061909    .7912106
              17  |   .6958023    .052422    -4.81   0.000      .600283    .8065211
                  |
             time |
            2007  |   1.132012   .0464194     3.02   0.002     1.044592    1.226749
            2009  |   .8930555   .0350156    -2.88   0.004      .826997    .9643907
            2010  |   .8811052   .0423289    -2.63   0.008     .8019282    .9680996
            2011  |   .8092007   .0363086    -4.72   0.000     .7410766    .8835873
            2012  |   .7059072   .0364878    -6.74   0.000     .6378957      .78117
            2013  |   .6864349   .0402547    -6.42   0.000     .6119025    .7700457
            2014  |    .672081   .0380859    -7.01   0.000     .6014302    .7510312
            2015  |   .6358323   .0398172    -7.23   0.000     .5623911    .7188639
                  |
            _cons |   .0000691   4.45e-06  -148.79   0.000     .0000609    .0000784
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.290135   .0698083                     -1.426957   -1.153313
------------------+----------------------------------------------------------------
            alpha |   .2752336   .0192136                      .2400383    .3155894
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.4.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.PP.4.csv not fou
> nd)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.C.PP.4.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next"
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> */
. predict cpp4_yhat 
(option n assumed; predicted number of events)

. gen cpp4_res = dv - cpp4_yhat

. 
. summ dv cpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
   cpp4_yhat |      6,253     8.79504     11.7489   .0034381   91.37946

. /*
> pause "next"
> 
> scatter dv cpp4_yhat
> 
> pause "next"
> 
> scatter cpp4_res dv
> 
> pause "next"
> 
> scatter cpp4_res cpp4_yhat
> */
. pause "complete: C.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.1
. 
. eststo clear

. eststo: logit dv_indicator `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1766.8768  
Iteration 2:   log pseudolikelihood = -1732.4526  
Iteration 3:   log pseudolikelihood = -1731.3358  
Iteration 4:   log pseudolikelihood = -1731.3279  
Iteration 5:   log pseudolikelihood = -1731.3279  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(32)     =          .
Log pseudolikelihood = -1731.3279               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p48 |    1.24026   .1070715     2.49   0.013     1.047198    1.468916
              p75 |   .9991318   .0020675    -0.42   0.675     .9950878    1.003192
        mine_time |   1.020711   .0198962     1.05   0.293     .9824509    1.060462
onsite_insp_hours |   1.003962    .000524     7.58   0.000     1.002935    1.004989
         longwall |   .4475776   .2723241    -1.32   0.186     .1358199    1.474936
                  |
            state |
               1  |   1.148211   .8715435     0.18   0.856      .259371     5.08302
               2  |   .6827093    .094497    -2.76   0.006     .5204955    .8954775
               3  |   1.491608   .6516787     0.92   0.360     .6335307    3.511898
               4  |   4.693416     3.6162     2.01   0.045     1.036698    21.24838
               5  |   .9351006   .4728533    -0.13   0.894     .3470807    2.519337
               6  |   .4811459   .0689807    -5.10   0.000     .3632805    .6372525
               7  |   2.202972   2.174867     0.80   0.424     .3181755    15.25285
               8  |   .7719099    .105932    -1.89   0.059     .5898657    1.010136
               9  |   .3065996   .0925355    -3.92   0.000     .1696948    .5539552
              10  |   .6864915   .2892537    -0.89   0.372     .3005943    1.567796
              11  |   3.465359   2.999843     1.44   0.151     .6351729    18.90621
              12  |   .5066616   .1112102    -3.10   0.002     .3295206    .7790285
              13  |   1.859173   1.247325     0.92   0.355     .4991674    6.924582
              14  |   .4834508   .1690218    -2.08   0.038      .243646    .9592798
              15  |   .6339104   .1095575    -2.64   0.008      .451769    .8894864
              17  |          1  (empty)
                  |
             time |
            2000  |   1.019149   .1931377     0.10   0.920     .7029547    1.477569
            2002  |   .6822383   .1324797    -1.97   0.049     .4662797    .9982187
            2003  |   .9094442   .2076454    -0.42   0.678     .5813379    1.422733
            2004  |   .5302081   .1146264    -2.93   0.003     .3470755    .8099695
            2005  |   .4753565   .0991595    -3.57   0.000     .3158338    .7154516
            2006  |   .4945993   .1072518    -3.25   0.001     .3233509    .7565419
            2007  |   .3252975   .0701071    -5.21   0.000     .2132222    .4962825
            2008  |   .2289144   .0500399    -6.74   0.000     .1491431    .3513524
            2009  |   .2695604     .06689    -5.28   0.000     .1657429    .4384067
            2010  |   .2033872   .0498352    -6.50   0.000     .1258221    .3287685
            2011  |   .2432203   .0599095    -5.74   0.000     .1500838     .394154
            2012  |   .1665168   .0408321    -7.31   0.000     .1029751    .2692675
            2013  |   .2478549   .0723352    -4.78   0.000     .1398874    .4391534
            2014  |   .1538799   .0453257    -6.35   0.000      .086389    .2740977
            2015  |    .102542   .0319549    -7.31   0.000      .055673    .1888684
                  |
            _cons |   .0001222   .0000223   -49.27   0.000     .0000854    .0001749
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 20 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.1.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.V.1.csv not foun
> d)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.V.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6191) =      8329.26
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1949.0516  
Iteration 2:   log likelihood = -1756.8227  
Iteration 3:   log likelihood = -1743.2462  
Iteration 4:   log likelihood = -1728.6451  
Iteration 5:   log likelihood = -1718.9956  
Iteration 6:   log likelihood = -1718.8139  
Iteration 7:   log likelihood = -1718.8138  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2214.99
                                                Prob > chi2       =     0.0000
Log likelihood = -1718.8138                     Pseudo R2         =     0.3919

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9608533   .0402959    23.84   0.000     .8818747    1.039832
      _hatsq |   .0760744   .0169852     4.48   0.000      .042784    .1093647
       _cons |  -.1486937   .0568376    -2.62   0.009    -.2600933    -.037294
------------------------------------------------------------------------------
Note: 0 failures and 246 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5029           612  |       5641
     -     |       164           437  |        601
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.84%
Specificity                     Pr( -|~D)   41.66%
Positive predictive value       Pr( D| +)   89.15%
Negative predictive value       Pr(~D| -)   72.71%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.34%
False - rate for true D         Pr( -| D)    3.16%
False + rate for classified +   Pr(~D| +)   10.85%
False - rate for classified -   Pr( D| -)   27.29%
--------------------------------------------------
Correctly classified                        87.57%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv1_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv1_res = dv_indicator - bv1_yhat
(11 missing values generated)

. 
. summ dv_indicator bv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
    bv1_yhat |      6,242    .8319449    .2243639   .0022858          1

. /*
> pause "next"
> 
> scatter dv_indicator bv1_yhat
> 
> pause "next"
> 
> scatter bv1_res dv_indicator
> 
> pause "next"
> 
> scatter bv1_res bv1_yhat
> */
. pause "complete: B.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.2
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1767.1993  
Iteration 2:   log pseudolikelihood = -1732.6485  
Iteration 3:   log pseudolikelihood = -1731.5167  
Iteration 4:   log pseudolikelihood = -1731.5087  
Iteration 5:   log pseudolikelihood = -1731.5087  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(32)     =          .
Log pseudolikelihood = -1731.5087               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p48_1lag |    1.22384   .1028906     2.40   0.016     1.037917    1.443068
         p75_1lag |   1.000688   .0020363     0.34   0.735      .996705    1.004687
        mine_time |   1.021492    .019931     1.09   0.276     .9831651    1.061312
onsite_insp_hours |   1.003744   .0004851     7.73   0.000     1.002794    1.004695
         longwall |   .4393788   .2679911    -1.35   0.178     .1329426    1.452158
                  |
            state |
               1  |   1.141748   .8686583     0.17   0.862     .2570184    5.071969
               2  |   .6680954   .0928594    -2.90   0.004     .5087787    .8772996
               3  |   1.470697   .6371495     0.89   0.373     .6291545    3.437866
               4  |   4.747874   3.626049     2.04   0.041     1.062721    21.21189
               5  |   .9516511    .479442    -0.10   0.922     .3545212    2.554543
               6  |   .4809552   .0689351    -5.11   0.000     .3631635    .6369524
               7  |    2.16409   2.203064     0.76   0.448     .2942687      15.915
               8  |   .7881096   .1089841    -1.72   0.085     .6010046    1.033464
               9  |   .3028167   .0924533    -3.91   0.000     .1664556    .5508852
              10  |   .6924063   .2877039    -0.88   0.376      .306673    1.563315
              11  |   3.375072    2.91166     1.41   0.159     .6222359    18.30674
              12  |    .520869   .1141546    -2.98   0.003     .3389827    .8003491
              13  |   1.866381   1.255898     0.93   0.354     .4991395    6.978765
              14  |   .4890506   .1697496    -2.06   0.039      .247686    .9656197
              15  |   .6293255   .1087609    -2.68   0.007     .4485072    .8830417
              17  |          1  (empty)
                  |
             time |
            2000  |   1.026469   .1950997     0.14   0.891     .7072277    1.489816
            2002  |   .6860906   .1329409    -1.94   0.052     .4692969    1.003033
            2003  |    .916739   .2085957    -0.38   0.702     .5868978    1.431954
            2004  |   .5340524   .1152291    -2.91   0.004     .3498852    .8151588
            2005  |   .4830253   .1005279    -3.50   0.000     .3212304     .726312
            2006  |   .4974121   .1082026    -3.21   0.001     .3247533     .761867
            2007  |   .3246155   .0703215    -5.19   0.000     .2123114    .4963239
            2008  |   .2314149   .0506042    -6.69   0.000     .1507497    .3552433
            2009  |   .2683841   .0668372    -5.28   0.000     .1647318    .4372566
            2010  |    .202398   .0496195    -6.52   0.000     .1251778    .3272541
            2011  |   .2429852   .0597313    -5.76   0.000     .1500843     .393391
            2012  |   .1674128    .041039    -7.29   0.000     .1035448    .2706757
            2013  |   .2518827   .0735182    -4.72   0.000     .1421523    .4463162
            2014  |   .1568241   .0461447    -6.30   0.000      .088095    .2791737
            2015  |    .105875   .0328265    -7.24   0.000     .0576606    .1944053
                  |
            _cons |   .0001209   .0000222   -49.22   0.000     .0000844    .0001731
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 19 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.2.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.V.2.csv not foun
> d)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.V.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6229
           Pearson chi2(6193) =      6597.57
                  Prob > chi2 =         0.0002

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1948.5852  
Iteration 2:   log likelihood = -1757.6819  
Iteration 3:   log likelihood = -1743.9901  
Iteration 4:   log likelihood =  -1728.833  
Iteration 5:   log likelihood = -1718.6463  
Iteration 6:   log likelihood = -1718.4406  
Iteration 7:   log likelihood = -1718.4404  
Iteration 8:   log likelihood = -1718.4404  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2215.74
                                                Prob > chi2       =     0.0000
Log likelihood = -1718.4404                     Pseudo R2         =     0.3920

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9588042   .0401097    23.90   0.000     .8801907    1.037418
      _hatsq |   .0782626   .0169887     4.61   0.000     .0449655    .1115598
       _cons |  -.1515558   .0568686    -2.67   0.008    -.2630161   -.0400954
------------------------------------------------------------------------------
Note: 0 failures and 262 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5032           613  |       5645
     -     |       161           436  |        597
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.90%
Specificity                     Pr( -|~D)   41.56%
Positive predictive value       Pr( D| +)   89.14%
Negative predictive value       Pr(~D| -)   73.03%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.44%
False - rate for true D         Pr( -| D)    3.10%
False + rate for classified +   Pr(~D| +)   10.86%
False - rate for classified -   Pr( D| -)   26.97%
--------------------------------------------------
Correctly classified                        87.60%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv2_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv2_res = dv_indicator - bv2_yhat
(11 missing values generated)

. 
. summ dv_indicator bv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
    bv2_yhat |      6,242    .8319449    .2242768   .0022991          1

. /*
> pause "next"
> 
> scatter dv_indicator bv2_yhat
> 
> pause "next"
> 
> scatter bv2_res dv_indicator
> 
> pause "next"
> 
> scatter bv2_res bv2_yhat
> */
. pause "complete: B.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.3
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1766.0999  
Iteration 2:   log pseudolikelihood = -1731.6785  
Iteration 3:   log pseudolikelihood = -1730.5842  
Iteration 4:   log pseudolikelihood = -1730.5766  
Iteration 5:   log pseudolikelihood = -1730.5766  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(32)     =          .
Log pseudolikelihood = -1730.5766               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p48_c_4lag |   1.082766   .0307138     2.80   0.005     1.024211    1.144669
       p75_c_4lag |   .9997841    .000495    -0.44   0.663     .9988145    1.000755
        mine_time |   1.021368   .0200049     1.08   0.280     .9829018    1.061339
onsite_insp_hours |   1.003899   .0004865     8.03   0.000     1.002946    1.004853
         longwall |   .4408861   .2684929    -1.34   0.179     .1336465    1.454438
                  |
            state |
               1  |     1.1575   .8759031     0.19   0.847     .2626635    5.100844
               2  |   .6531489   .0912727    -3.05   0.002     .4966645    .8589369
               3  |   1.468882   .6326641     0.89   0.372     .6314872    3.416717
               4  |   4.717563   3.622681     2.02   0.043     1.047293     21.2504
               5  |   .9435688   .4772794    -0.11   0.909      .350119    2.542913
               6  |   .4828043   .0692035    -5.08   0.000     .3645548    .6394101
               7  |   2.203672   2.208367     0.79   0.430     .3091233    15.70949
               8  |   .8202459    .111303    -1.46   0.144     .6286957    1.070157
               9  |    .308224   .0932929    -3.89   0.000     .1703044    .5578367
              10  |   .6986669   .2932791    -0.85   0.393     .3068752    1.590665
              11  |   3.452265   2.988553     1.43   0.152     .6327567    18.83525
              12  |    .512457   .1117052    -3.07   0.002     .3342818    .7856011
              13  |   1.848473   1.243243     0.91   0.361     .4946676    6.907369
              14  |    .493104   .1719094    -2.03   0.043     .2489927    .9765409
              15  |     .63568   .1102699    -2.61   0.009     .4524625    .8930885
              17  |          1  (empty)
                  |
             time |
            2000  |   1.017988   .1947805     0.09   0.926     .6996401    1.481189
            2002  |   .6826176    .132176    -1.97   0.049     .4670447     .997692
            2003  |   .9019053   .2055845    -0.45   0.651     .5769445    1.409898
            2004  |   .5275976    .113767    -2.97   0.003     .3457453     .805099
            2005  |    .474528   .0987881    -3.58   0.000      .315542    .7136193
            2006  |   .4907259   .1067942    -3.27   0.001      .320329    .7517644
            2007  |   .3248725    .070522    -5.18   0.000     .2122939    .4971511
            2008  |   .2303216   .0505683    -6.69   0.000     .1497784    .3541769
            2009  |    .267616   .0666827    -5.29   0.000     .1642161    .4361225
            2010  |   .2022482   .0494354    -6.54   0.000     .1252639    .3265454
            2011  |    .243023   .0597818    -5.75   0.000     .1500577    .3935831
            2012  |    .166139   .0407845    -7.31   0.000     .1026869    .2687991
            2013  |   .2474496   .0721972    -4.79   0.000     .1396805     .438367
            2014  |   .1539761   .0453357    -6.35   0.000     .0864632    .2742049
            2015  |   .1030767   .0318501    -7.35   0.000     .0562528    .1888761
                  |
            _cons |    .000122   .0000223   -49.33   0.000     .0000853    .0001746
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 21 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.3.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.V.3.csv not foun
> d)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.V.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6190) =      7420.34
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood =  -1948.253  
Iteration 2:   log likelihood = -1756.4863  
Iteration 3:   log likelihood = -1742.8105  
Iteration 4:   log likelihood = -1728.4059  
Iteration 5:   log likelihood = -1717.9285  
Iteration 6:   log likelihood = -1717.6912  
Iteration 7:   log likelihood = -1717.6909  
Iteration 8:   log likelihood = -1717.6909  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2217.23
                                                Prob > chi2       =     0.0000
Log likelihood = -1717.6909                     Pseudo R2         =     0.3922

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9596482   .0401965    23.87   0.000     .8808645    1.038432
      _hatsq |   .0773723   .0169694     4.56   0.000     .0441129    .1106318
       _cons |  -.1505169   .0568151    -2.65   0.008    -.2618725   -.0391613
------------------------------------------------------------------------------
Note: 0 failures and 247 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5031           610  |       5641
     -     |       162           439  |        601
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.88%
Specificity                     Pr( -|~D)   41.85%
Positive predictive value       Pr( D| +)   89.19%
Negative predictive value       Pr(~D| -)   73.04%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.15%
False - rate for true D         Pr( -| D)    3.12%
False + rate for classified +   Pr(~D| +)   10.81%
False - rate for classified -   Pr( D| -)   26.96%
--------------------------------------------------
Correctly classified                        87.63%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv3_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv3_res = dv_indicator - bv3_yhat
(11 missing values generated)

. 
. summ dv_indicator bv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
    bv3_yhat |      6,242    .8319449    .2243737   .0022809          1

. /*
> pause "next"
> 
> scatter dv_indicator bv3_yhat
> 
> pause "next"
> 
> scatter bv3_res dv_indicator
> 
> pause "next"
> 
> scatter bv3_res bv3_yhat
> */
. pause "complete: B.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.4
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1765.8052  
Iteration 2:   log pseudolikelihood = -1729.0632  
Iteration 3:   log pseudolikelihood = -1727.2029  
Iteration 4:   log pseudolikelihood = -1727.1922  
Iteration 5:   log pseudolikelihood = -1727.1922  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(32)     =          .
Log pseudolikelihood = -1727.1922               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_c_lag_all |   1.027465   .0126723     2.20   0.028     1.002926    1.052605
    p75_c_lag_all |   1.000098   .0001086     0.90   0.368      .999885    1.000311
        mine_time |   1.002735   .0204849     0.13   0.894     .9633788      1.0437
onsite_insp_hours |   1.003693   .0003823     9.68   0.000     1.002943    1.004442
         longwall |   .3955147   .2627173    -1.40   0.163     .1075868    1.454005
                  |
            state |
               1  |   1.083212   .8278917     0.10   0.917     .2421842    4.844859
               2  |   .7522955   .1083203    -1.98   0.048     .5673185     .997585
               3  |   1.053689   .4844672     0.11   0.909     .4279028    2.594655
               4  |   4.591179   3.490032     2.01   0.045     1.034843     20.3692
               5  |   .9268063   .4751086    -0.15   0.882      .339342    2.531281
               6  |   .4612157   .0655859    -5.44   0.000     .3490288    .6094624
               7  |   2.053465   1.889183     0.78   0.434     .3383638    12.46209
               8  |   .8191183   .1088968    -1.50   0.133     .6312255     1.06294
               9  |   .2988337    .099264    -3.64   0.000      .155842    .5730261
              10  |   .6831685   .2785656    -0.93   0.350     .3072175    1.519182
              11  |    3.02061   2.600378     1.28   0.199     .5588737    16.32584
              12  |   .5197749   .1100619    -3.09   0.002     .3432212    .7871482
              13  |   1.877278   1.258249     0.94   0.347     .5046722    6.983093
              14  |    .504335   .1798146    -1.92   0.055     .2507457     1.01439
              15  |   .6124293   .1056571    -2.84   0.004     .4367225    .8588283
              17  |          1  (empty)
                  |
             time |
            2000  |   1.011378   .1909645     0.06   0.952     .6985425    1.464313
            2002  |   .6918021   .1334393    -1.91   0.056     .4740199    1.009642
            2003  |   .9103427   .2063425    -0.41   0.679     .5838048    1.419522
            2004  |   .5347774   .1150852    -2.91   0.004     .3507459    .8153676
            2005  |   .4872606   .1013134    -3.46   0.001     .3241722    .7323976
            2006  |   .5042799   .1088954    -3.17   0.002     .3302639    .7699849
            2007  |   .3292614   .0715158    -5.11   0.000     .2151094    .5039904
            2008  |   .2380533   .0520794    -6.56   0.000      .155044    .3655051
            2009  |   .2789947   .0693637    -5.13   0.000     .1713839    .4541736
            2010  |   .2049905   .0500946    -6.49   0.000     .1269758    .3309378
            2011  |   .2482227   .0610764    -5.66   0.000     .1532495    .4020534
            2012  |   .1702461   .0416258    -7.24   0.000     .1054279    .2749154
            2013  |   .2573635   .0749695    -4.66   0.000     .1454098    .4555125
            2014  |     .15406   .0449758    -6.41   0.000     .0869347    .2730152
            2015  |   .1072013   .0330074    -7.25   0.000     .0586292    .1960134
                  |
            _cons |   .0001307   .0000239   -48.98   0.000     .0000914    .0001869
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 35 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.4.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.V.4.csv not foun
> d)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.V.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6191) =      5984.24
                  Prob > chi2 =         0.9695

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1948.2082  
Iteration 2:   log likelihood = -1755.0788  
Iteration 3:   log likelihood = -1739.9467  
Iteration 4:   log likelihood = -1732.5929  
Iteration 5:   log likelihood = -1714.9822  
Iteration 6:   log likelihood = -1714.1647  
Iteration 7:   log likelihood = -1714.1623  
Iteration 8:   log likelihood = -1714.1623  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2224.29
                                                Prob > chi2       =     0.0000
Log likelihood = -1714.1623                     Pseudo R2         =     0.3935

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9625282   .0400628    24.03   0.000     .8840066     1.04105
      _hatsq |   .0777817   .0169803     4.58   0.000     .0445009    .1110626
       _cons |  -.1539163   .0570326    -2.70   0.007    -.2656981   -.0421345
------------------------------------------------------------------------------
Note: 0 failures and 307 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5024           604  |       5628
     -     |       169           445  |        614
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.75%
Specificity                     Pr( -|~D)   42.42%
Positive predictive value       Pr( D| +)   89.27%
Negative predictive value       Pr(~D| -)   72.48%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   57.58%
False - rate for true D         Pr( -| D)    3.25%
False + rate for classified +   Pr(~D| +)   10.73%
False - rate for classified -   Pr( D| -)   27.52%
--------------------------------------------------
Correctly classified                        87.62%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv4_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv4_res = dv_indicator - bv4_yhat
(11 missing values generated)

. 
. summ dv_indicator bv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
    bv4_yhat |      6,242    .8319449    .2245943   .0024896          1

. /*
> pause "next"
> 
> scatter dv_indicator bv4_yhat
> 
> pause "next"
> 
> scatter bv4_res dv_indicator
> 
> pause "next"
> 
> scatter bv4_res bv4_yhat
> */
. pause "complete: B.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.1
. 
. eststo clear

. eststo: logit dv_indicator `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1766.5806  
Iteration 2:   log pseudolikelihood = -1732.3262  
Iteration 3:   log pseudolikelihood = -1731.2106  
Iteration 4:   log pseudolikelihood = -1731.2029  
Iteration 5:   log pseudolikelihood = -1731.2029  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(32)     =          .
Log pseudolikelihood = -1731.2029               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_ss |   1.597346   .3309965     2.26   0.024     1.064183     2.39763
           p75_ss |   1.004388    .004521     0.97   0.331     .9955655    1.013288
        mine_time |   1.022337   .0199206     1.13   0.257     .9840295    1.062136
onsite_insp_hours |   1.003684   .0004405     8.38   0.000     1.002821    1.004548
         longwall |   .4329264   .2632282    -1.38   0.169     .1314819    1.425484
                  |
            state |
               1  |   1.129465   .8651281     0.16   0.874     .2517003     5.06829
               2  |   .6666745   .0916287    -2.95   0.003     .5092411     .872779
               3  |   1.485438     .63438     0.93   0.354     .6431843    3.430629
               4  |   4.727882   3.611211     2.03   0.042     1.058057    21.12634
               5  |   .9249648   .4652602    -0.16   0.877     .3451184    2.479033
               6  |   .4716077   .0677284    -5.23   0.000     .3559085    .6249185
               7  |   2.124813   2.162975     0.74   0.459     .2889557    15.62465
               8  |   .8330202   .1157058    -1.32   0.188     .6344895    1.093671
               9  |   .2982822   .0906606    -3.98   0.000     .1644035    .5411823
              10  |   .6766421   .2826984    -0.93   0.350     .2983529    1.534573
              11  |   3.213649   2.769519     1.35   0.176     .5935181    17.40055
              12  |   .5186851    .112845    -3.02   0.003     .3386231    .7944947
              13  |   1.867407   1.248453     0.93   0.350     .5036967    6.923233
              14  |   .4870218   .1682256    -2.08   0.037     .2474736    .9584467
              15  |   .6244277   .1079386    -2.72   0.006     .4449829    .8762357
              17  |          1  (empty)
                  |
             time |
            2000  |   1.009695   .1915721     0.05   0.959     .6961287    1.464505
            2002  |   .6889947   .1333114    -1.93   0.054     .4715412    1.006728
            2003  |   .9160528   .2084811    -0.39   0.700     .5864064    1.431009
            2004  |   .5336563   .1150019    -2.91   0.004     .3498077    .8141302
            2005  |   .4813669    .100244    -3.51   0.000     .3200477    .7239987
            2006  |   .4894242    .105734    -3.31   0.001     .3204748    .7474412
            2007  |    .323065    .069919    -5.22   0.000     .2113827    .4937537
            2008  |   .2313183   .0505707    -6.70   0.000     .1507026     .355058
            2009  |   .2735881    .068039    -5.21   0.000     .1680392    .4454345
            2010  |   .2038439   .0499071    -6.50   0.000     .1261531    .3293802
            2011  |   .2480574   .0608201    -5.69   0.000     .1534087    .4011017
            2012  |   .1747304   .0429874    -7.09   0.000     .1078834    .2829973
            2013  |   .2587076   .0758661    -4.61   0.000      .145611    .4596468
            2014  |   .1622301   .0476577    -6.19   0.000     .0912173    .2885263
            2015  |   .1097388   .0341511    -7.10   0.000     .0596298    .2019561
                  |
            _cons |   .0001213   .0000222   -49.31   0.000     .0000848    .0001736
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 18 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.1.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.SSV.1.csv not fo
> und)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.SSV.1.csv
> )

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6191) =      6359.99
                  Prob > chi2 =         0.0654

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1946.7573  
Iteration 2:   log likelihood = -1757.4189  
Iteration 3:   log likelihood = -1743.7885  
Iteration 4:   log likelihood = -1729.0406  
Iteration 5:   log likelihood = -1718.6029  
Iteration 6:   log likelihood = -1718.3676  
Iteration 7:   log likelihood = -1718.3673  
Iteration 8:   log likelihood = -1718.3673  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2215.88
                                                Prob > chi2       =     0.0000
Log likelihood = -1718.3673                     Pseudo R2         =     0.3920

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9604001   .0402831    23.84   0.000     .8814467    1.039354
      _hatsq |    .077441   .0170673     4.54   0.000     .0439898    .1108923
       _cons |  -.1509858   .0568664    -2.66   0.008    -.2624419   -.0395297
------------------------------------------------------------------------------
Note: 0 failures and 265 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5027           609  |       5636
     -     |       166           440  |        606
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.80%
Specificity                     Pr( -|~D)   41.94%
Positive predictive value       Pr( D| +)   89.19%
Negative predictive value       Pr(~D| -)   72.61%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.06%
False - rate for true D         Pr( -| D)    3.20%
False + rate for classified +   Pr(~D| +)   10.81%
False - rate for classified -   Pr( D| -)   27.39%
--------------------------------------------------
Correctly classified                        87.58%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv1_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv1_res = dv_indicator - bssv1_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
  bssv1_yhat |      6,242    .8319449    .2242336   .0023689          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv1_yhat
> 
> pause "next"
> 
> scatter bssv1_res dv_indicator
> 
> pause "next"
> 
> scatter bssv1_res bssv1_yhat
> */
. pause "complete: B.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.2
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1767.8595  
Iteration 2:   log pseudolikelihood = -1734.0009  
Iteration 3:   log pseudolikelihood =  -1732.895  
Iteration 4:   log pseudolikelihood = -1732.8873  
Iteration 5:   log pseudolikelihood = -1732.8873  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(32)     =          .
Log pseudolikelihood = -1732.8873               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_ss_1lag |   1.204969   .1995181     1.13   0.260     .8710326     1.66693
      p75_ss_1lag |   1.005606    .004604     1.22   0.222     .9966227     1.01467
        mine_time |   1.020308   .0198814     1.03   0.302     .9820762    1.060029
onsite_insp_hours |   1.003659   .0004302     8.52   0.000     1.002816    1.004503
         longwall |   .4386401    .267357    -1.35   0.176      .132828    1.448529
                  |
            state |
               1  |   1.128147   .8639006     0.16   0.875      .251502    5.060459
               2  |    .664483   .0922202    -2.95   0.003     .5062325    .8722034
               3  |   1.515855   .6378381     0.99   0.323     .6644937    3.457995
               4  |   4.720642   3.594884     2.04   0.042     1.061183    20.99964
               5  |   .9377463   .4715599    -0.13   0.898     .3499821    2.512609
               6  |   .4729767   .0677192    -5.23   0.000     .3572462    .6261983
               7  |   2.099874   2.164004     0.72   0.472     .2786094    15.82671
               8  |   .8337986   .1162077    -1.30   0.192     .6344947    1.095707
               9  |   .3027799   .0931654    -3.88   0.000     .1656579    .5534036
              10  |   .6769775   .2809325    -0.94   0.347     .3001526    1.526885
              11  |   3.180949   2.739158     1.34   0.179     .5882685    17.20037
              12  |   .5225942    .113489    -2.99   0.003     .3414395    .7998627
              13  |   1.858029   1.242259     0.93   0.354     .5011268    6.889016
              14  |   .4861627   .1675143    -2.09   0.036     .2474504    .9551581
              15  |   .6231406   .1074682    -2.74   0.006     .4444122    .8737478
              17  |          1  (empty)
                  |
             time |
            2000  |   1.030496   .1956704     0.16   0.874      .710265    1.495107
            2002  |   .6946923   .1342655    -1.88   0.059     .4756395    1.014629
            2003  |   .9235089   .2098377    -0.35   0.726     .5916065    1.441615
            2004  |   .5371183   .1157794    -2.88   0.004     .3520366    .8195058
            2005  |   .4879188   .1018216    -3.44   0.001     .3241262    .7344819
            2006  |   .5006177   .1084265    -3.19   0.001     .3274525     .765357
            2007  |   .3287512   .0714042    -5.12   0.000      .214777    .5032073
            2008  |    .237694   .0521239    -6.55   0.000      .154653    .3653239
            2009  |    .278363   .0695902    -5.12   0.000     .1705347    .4543706
            2010  |   .2057389   .0503996    -6.45   0.000     .1272913    .3325325
            2011  |   .2497229   .0612745    -5.65   0.000     .1543829    .4039406
            2012  |   .1757763   .0431623    -7.08   0.000      .108629    .2844295
            2013  |   .2632484   .0771707    -4.55   0.000     .1481965    .4676205
            2014  |   .1653413   .0485961    -6.12   0.000     .0929398    .2941447
            2015  |   .1123411   .0348907    -7.04   0.000     .0611187    .2064921
                  |
            _cons |   .0001206   .0000221   -49.22   0.000     .0000842    .0001727
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 18 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.2.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.SSV.2.csv not fo
> und)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.SSV.2.csv
> )

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6191) =      6416.09
                  Prob > chi2 =         0.0225

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1947.8013  
Iteration 2:   log likelihood = -1759.1362  
Iteration 3:   log likelihood = -1745.5619  
Iteration 4:   log likelihood = -1731.3596  
Iteration 5:   log likelihood = -1720.3557  
Iteration 6:   log likelihood = -1720.0926  
Iteration 7:   log likelihood = -1720.0926  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2212.43
                                                Prob > chi2       =     0.0000
Log likelihood = -1720.0926                     Pseudo R2         =     0.3914

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9607444   .0403058    23.84   0.000     .8817466    1.039742
      _hatsq |   .0773327   .0170859     4.53   0.000      .043845    .1108204
       _cons |  -.1511794   .0569101    -2.66   0.008    -.2627211   -.0396378
------------------------------------------------------------------------------
Note: 0 failures and 260 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5029           611  |       5640
     -     |       164           438  |        602
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.84%
Specificity                     Pr( -|~D)   41.75%
Positive predictive value       Pr( D| +)   89.17%
Negative predictive value       Pr(~D| -)   72.76%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.25%
False - rate for true D         Pr( -| D)    3.16%
False + rate for classified +   Pr(~D| +)   10.83%
False - rate for classified -   Pr( D| -)   27.24%
--------------------------------------------------
Correctly classified                        87.58%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv2_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv2_res = dv_indicator - bssv2_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
  bssv2_yhat |      6,242    .8319449    .2240686   .0023906          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv2_yhat
> 
> pause "next"
> 
> scatter bssv2_res dv_indicator
> 
> pause "next"
> 
> scatter bssv2_res bssv2_yhat
> */
. pause "complete: B.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.3
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood =  -1767.677  
Iteration 2:   log pseudolikelihood = -1733.8203  
Iteration 3:   log pseudolikelihood = -1732.7219  
Iteration 4:   log pseudolikelihood = -1732.7143  
Iteration 5:   log pseudolikelihood = -1732.7143  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(32)     =          .
Log pseudolikelihood = -1732.7143               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_ss_c_4lag |   1.120881   .0787346     1.62   0.104     .9767154    1.286325
    p75_ss_c_4lag |   1.000884    .001163     0.76   0.447     .9986072    1.003166
        mine_time |   1.019663    .019929     1.00   0.319     .9813417    1.059481
onsite_insp_hours |   1.003732   .0004379     8.54   0.000     1.002875    1.004591
         longwall |   .4331925   .2620274    -1.38   0.167     .1323763    1.417593
                  |
            state |
               1  |   1.129647   .8652581     0.16   0.874     .2517453    5.069023
               2  |   .6518152   .0920538    -3.03   0.002     .4942105    .8596803
               3  |   1.482558   .6241385     0.94   0.350     .6496305    3.383428
               4  |   4.669439    3.56476     2.02   0.044     1.045773    20.84932
               5  |   .9214912    .465524    -0.16   0.871     .3423548     2.48031
               6  |   .4737488   .0679373    -5.21   0.000     .3576701    .6274998
               7  |   2.113047   2.147871     0.74   0.462     .2881906    15.49311
               8  |   .8209859   .1135538    -1.43   0.154     .6260408    1.076636
               9  |   .2929808   .0884441    -4.07   0.000     .1621367     .529416
              10  |   .6783261   .2823158    -0.93   0.351     .3000356    1.533572
              11  |   3.236497   2.785502     1.36   0.172     .5990813    17.48496
              12  |   .5145334   .1115096    -3.07   0.002     .3364661    .7868391
              13  |   1.855547   1.239471     0.93   0.355     .5010547    6.871613
              14  |   .4855898   .1681588    -2.09   0.037     .2463202    .9572802
              15  |   .6251009   .1081448    -2.72   0.007     .4453373    .8774273
              17  |          1  (empty)
                  |
             time |
            2000  |   1.036593   .1975872     0.19   0.850     .7134429    1.506114
            2002  |   .6884879   .1332703    -1.93   0.054     .4711179    1.006151
            2003  |   .9149357   .2078936    -0.39   0.696     .5861096    1.428244
            2004  |   .5334516   .1147905    -2.92   0.003     .3498884     .813318
            2005  |   .4845104   .1008995    -3.48   0.001     .3221365    .7287293
            2006  |    .496196   .1074661    -3.24   0.001     .3245637     .758589
            2007  |   .3258282   .0706602    -5.17   0.000     .2130072    .4984057
            2008  |   .2338484   .0513121    -6.62   0.000     .1521108    .3595083
            2009  |   .2735201   .0682727    -5.19   0.000     .1676961    .4461239
            2010  |   .2042105   .0500112    -6.49   0.000     .1263626    .3300179
            2011  |   .2464342   .0604833    -5.71   0.000     .1523306     .398671
            2012  |   .1732811   .0425864    -7.13   0.000     .1070424    .2805088
            2013  |   .2565431   .0749364    -4.66   0.000     .1447184    .4547752
            2014  |   .1611809   .0473656    -6.21   0.000     .0906096    .2867164
            2015  |    .108819   .0337159    -7.16   0.000     .0592889    .1997269
                  |
            _cons |    .000123   .0000224   -49.33   0.000      .000086    .0001758
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 18 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.3.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.SSV.3.csv not fo
> und)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.SSV.3.csv
> )

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6190) =      6527.28
                  Prob > chi2 =         0.0014

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1948.3562  
Iteration 2:   log likelihood = -1758.9156  
Iteration 3:   log likelihood = -1745.2838  
Iteration 4:   log likelihood = -1731.3714  
Iteration 5:   log likelihood =  -1720.204  
Iteration 6:   log likelihood = -1719.9407  
Iteration 7:   log likelihood = -1719.9407  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2212.74
                                                Prob > chi2       =     0.0000
Log likelihood = -1719.9407                     Pseudo R2         =     0.3915

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |    .960485   .0402965    23.84   0.000     .8815054    1.039465
      _hatsq |   .0772027   .0170567     4.53   0.000     .0437723    .1106332
       _cons |  -.1506141   .0568759    -2.65   0.008    -.2620888   -.0391395
------------------------------------------------------------------------------
Note: 0 failures and 263 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5029           610  |       5639
     -     |       164           439  |        603
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.84%
Specificity                     Pr( -|~D)   41.85%
Positive predictive value       Pr( D| +)   89.18%
Negative predictive value       Pr(~D| -)   72.80%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.15%
False - rate for true D         Pr( -| D)    3.16%
False + rate for classified +   Pr(~D| +)   10.82%
False - rate for classified -   Pr( D| -)   27.20%
--------------------------------------------------
Correctly classified                        87.60%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv3_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv3_res = dv_indicator - bssv3_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
  bssv3_yhat |      6,242    .8319449    .2241023   .0023758          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv3_yhat
> 
> pause "next"
> 
> scatter bssv3_res dv_indicator
> 
> pause "next"
> 
> scatter bssv3_res bssv3_yhat
> */
. pause "complete: B.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.4
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1768.3955  
Iteration 2:   log pseudolikelihood = -1732.0042  
Iteration 3:   log pseudolikelihood = -1730.3308  
Iteration 4:   log pseudolikelihood = -1730.3215  
Iteration 5:   log pseudolikelihood = -1730.3215  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(32)     =          .
Log pseudolikelihood = -1730.3215               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_ss_c_lag_all |   1.023677    .027062     0.89   0.376     .9719871    1.078116
 p75_ss_c_lag_all |   1.000464   .0003308     1.40   0.160     .9998162    1.001113
        mine_time |   1.004262   .0205839     0.21   0.836     .9647179    1.045427
onsite_insp_hours |   1.003699   .0003833     9.67   0.000     1.002948     1.00445
         longwall |   .3869861   .2538318    -1.45   0.148      .106998    1.399636
                  |
            state |
               1  |    1.08692   .8429955     0.11   0.914     .2376954    4.970203
               2  |   .7411851   .1073323    -2.07   0.039     .5580366    .9844433
               3  |   1.325679    .562064     0.66   0.506     .5774895    3.043214
               4  |     4.5622   3.472669     1.99   0.046     1.026253    20.28123
               5  |   .9140196    .465204    -0.18   0.860     .3370728    2.478491
               6  |   .4625947   .0656616    -5.43   0.000      .350251    .6109729
               7  |   1.939951   1.676696     0.77   0.443      .356532     10.5556
               8  |   .8150227   .1091316    -1.53   0.127     .6268935    1.059609
               9  |   .3010496   .0984848    -3.67   0.000     .1585541    .5716085
              10  |   .6671989   .2717486    -0.99   0.320     .3003052     1.48234
              11  |   3.017642   2.599485     1.28   0.200     .5577221    16.32742
              12  |   .5171174   .1102177    -3.09   0.002     .3405377    .7852595
              13  |   1.889074   1.253939     0.96   0.338      .514321     6.93847
              14  |   .5043382   .1771092    -1.95   0.051     .2533985    1.003783
              15  |   .6179908    .106523    -2.79   0.005     .4408192    .8663703
              17  |          1  (empty)
                  |
             time |
            2000  |   1.011938   .1908011     0.06   0.950     .6992936    1.464361
            2002  |   .6915226   .1334229    -1.91   0.056      .473778    1.009341
            2003  |    .915075   .2075854    -0.39   0.696     .5866256    1.427422
            2004  |   .5370003   .1154286    -2.89   0.004     .3523775    .8183535
            2005  |    .490116   .1017863    -3.43   0.001     .3262294    .7363339
            2006  |   .5080732     .10987    -3.13   0.002     .3325488    .7762422
            2007  |   .3314489   .0717433    -5.10   0.000     .2168559    .5065965
            2008  |   .2406913    .052539    -6.52   0.000     .1569123    .3692017
            2009  |   .2830437   .0701994    -5.09   0.000     .1740771    .4602196
            2010  |   .2078297   .0507875    -6.43   0.000     .1287356    .3355185
            2011  |   .2516968   .0618239    -5.62   0.000     .1555244    .4073399
            2012  |    .175136   .0429327    -7.11   0.000      .108321    .2831641
            2013  |   .2610365   .0755096    -4.64   0.000     .1480729    .4601792
            2014  |   .1602843   .0465535    -6.30   0.000     .0907122    .2832152
            2015  |   .1109283   .0339199    -7.19   0.000     .0609201    .2019875
                  |
            _cons |   .0001297   .0000236   -49.22   0.000     .0000908    .0001852
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 42 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.4.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.SSV.4.csv not fo
> und)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.SSV.4.csv
> )

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6225
           Pearson chi2(6189) =      6014.62
                  Prob > chi2 =         0.9425

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1951.2009  
Iteration 2:   log likelihood =  -1756.653  
Iteration 3:   log likelihood = -1743.0158  
Iteration 4:   log likelihood = -1735.3286  
Iteration 5:   log likelihood = -1718.3199  
Iteration 6:   log likelihood = -1717.5996  
Iteration 7:   log likelihood = -1717.5978  
Iteration 8:   log likelihood = -1717.5978  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2217.42
                                                Prob > chi2       =     0.0000
Log likelihood = -1717.5978                     Pseudo R2         =     0.3923

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9620143   .0401965    23.93   0.000     .8832306    1.040798
      _hatsq |   .0769625    .017025     4.52   0.000      .043594     .110331
       _cons |  -.1515819   .0569861    -2.66   0.008    -.2632725   -.0398913
------------------------------------------------------------------------------
Note: 0 failures and 299 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5023           604  |       5627
     -     |       170           445  |        615
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.73%
Specificity                     Pr( -|~D)   42.42%
Positive predictive value       Pr( D| +)   89.27%
Negative predictive value       Pr(~D| -)   72.36%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   57.58%
False - rate for true D         Pr( -| D)    3.27%
False + rate for classified +   Pr(~D| +)   10.73%
False - rate for classified -   Pr( D| -)   27.64%
--------------------------------------------------
Correctly classified                        87.60%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv4_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv4_res = dv_indicator - bssv4_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
  bssv4_yhat |      6,242    .8319449    .2243548   .0025106          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv4_yhat
> 
> pause "next"
> 
> scatter bssv4_res dv_indicator
> 
> pause "next"
> 
> scatter bssv4_res bssv4_yhat
> */
. pause "complete: B.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.1
. 
. eststo clear

. eststo: logit dv_indicator `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: 7.state != 0 predicts success perfectly
      7.state dropped and 19 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 17.state != 0 predicts success perfectly
      17.state dropped and 9 obs not used

Iteration 0:   log pseudolikelihood = -1048.2677  
Iteration 1:   log pseudolikelihood = -936.65313  
Iteration 2:   log pseudolikelihood = -916.48136  
Iteration 3:   log pseudolikelihood = -915.80624  
Iteration 4:   log pseudolikelihood = -915.80287  
Iteration 5:   log pseudolikelihood = -915.80287  

Logistic regression                             Number of obs     =      3,296
                                                Wald chi2(24)     =          .
Log pseudolikelihood = -915.80287               Prob > chi2       =          .

                                    (Std. Err. adjusted for 722 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_pp |   1.004512    .001984     2.28   0.023     1.000631    1.008408
           p75_pp |   1.000013   .0000347     0.37   0.711     .9999448    1.000081
        mine_time |   1.025701   .0205338     1.27   0.205     .9862352    1.066747
onsite_insp_hours |   1.002888   .0005279     5.48   0.000     1.001854    1.003924
         longwall |    .293755   .1757903    -2.05   0.041     .0909087    .9492166
                  |
            state |
               1  |   1.202477   .4800541     0.46   0.644     .5498693    2.629628
               2  |   .8556161   .1628809    -0.82   0.413      .589167    1.242566
               3  |   1.050279   .5129353     0.10   0.920     .4032688     2.73536
               4  |   3.359455   4.136921     0.98   0.325     .3006609     37.5371
               5  |   .8595834   .4206661    -0.31   0.757     .3294002    2.243118
               6  |   .4361602   .0851059    -4.25   0.000     .2975467    .6393475
               7  |          1  (empty)
               8  |   .0938536   .0417432    -5.32   0.000     .0392521    .2244083
               9  |          1  (empty)
              10  |   .5004909    .241789    -1.43   0.152      .194168    1.290074
              11  |    1.92702   1.641011     0.77   0.441     .3630951    10.22709
              12  |    .478815   .1343228    -2.63   0.009     .2762986    .8297684
              13  |   1.395531   1.692754     0.27   0.784     .1294934    15.03944
              14  |   .4629564   .1199227    -2.97   0.003     .2786426    .7691881
              15  |   .3855505   .0851666    -4.31   0.000     .2500657    .5944405
              17  |          1  (empty)
                  |
             time |
            2007  |    1.35669   .2599794     1.59   0.111     .9318948    1.975124
            2009  |   1.174864   .2589517     0.73   0.465     .7627364    1.809677
            2010  |   .9138356   .1911313    -0.43   0.667     .6065085     1.37689
            2011  |   1.072997   .2371328     0.32   0.750     .6957968    1.654681
            2012  |   .7477461   .1586681    -1.37   0.171     .4933253    1.133378
            2013  |   1.090925   .2852425     0.33   0.739     .6534806    1.821199
            2014  |   .6962281   .1774337    -1.42   0.155     .4224962    1.147309
            2015  |    .495673   .1372007    -2.54   0.011      .288128    .8527174
                  |
            _cons |   .0000405   9.26e-06   -44.26   0.000     .0000259    .0000634
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 7 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.1.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.PP.1.csv not fou
> nd)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.PP.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3296
 number of covariate patterns =      3296
           Pearson chi2(3269) =      3234.79
                  Prob > chi2 =         0.6614

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1541.0869  
Iteration 1:   log likelihood = -1030.2002  
Iteration 2:   log likelihood = -934.92606  
Iteration 3:   log likelihood = -922.83903  
Iteration 4:   log likelihood = -912.10269  
Iteration 5:   log likelihood = -910.49309  
Iteration 6:   log likelihood = -910.48728  
Iteration 7:   log likelihood = -910.48728  

Logistic regression                             Number of obs     =      3,296
                                                LR chi2(2)        =    1261.20
                                                Prob > chi2       =     0.0000
Log likelihood = -910.48728                     Pseudo R2         =     0.4092

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9351328   .0527907    17.71   0.000      .831665    1.038601
      _hatsq |   .0678493   .0216461     3.13   0.002     .0254237    .1102749
       _cons |   -.103554   .0733994    -1.41   0.158    -.2474141    .0403062
------------------------------------------------------------------------------
Note: 0 failures and 119 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2600           316  |       2916
     -     |       111           269  |        380
-----------+--------------------------+-----------
   Total   |      2711           585  |       3296

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   95.91%
Specificity                     Pr( -|~D)   45.98%
Positive predictive value       Pr( D| +)   89.16%
Negative predictive value       Pr(~D| -)   70.79%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   54.02%
False - rate for true D         Pr( -| D)    4.09%
False + rate for classified +   Pr(~D| +)   10.84%
False - rate for classified -   Pr( D| -)   29.21%
--------------------------------------------------
Correctly classified                        87.04%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp1_yhat 
(option pr assumed; Pr(dv_indicator))
(51 missing values generated)

. gen bpp1_res = dv_indicator - bpp1_yhat
(51 missing values generated)

. 
. summ dv_indicator bpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
   bpp1_yhat |      6,202    .7694477     .252564   .0031735          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp1_yhat
> 
> pause "next"
> 
> scatter bpp1_res dv_indicator
> 
> pause "next"
> 
> scatter bpp1_res bpp1_yhat
> */
. pause "complete: B.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.2
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: 7.state != 0 predicts success perfectly
      7.state dropped and 19 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 17.state != 0 predicts success perfectly
      17.state dropped and 9 obs not used

Iteration 0:   log pseudolikelihood = -1048.2677  
Iteration 1:   log pseudolikelihood = -936.97787  
Iteration 2:   log pseudolikelihood = -916.87059  
Iteration 3:   log pseudolikelihood = -916.17673  
Iteration 4:   log pseudolikelihood = -916.17343  
Iteration 5:   log pseudolikelihood = -916.17343  

Logistic regression                             Number of obs     =      3,296
                                                Wald chi2(24)     =          .
Log pseudolikelihood = -916.17343               Prob > chi2       =          .

                                    (Std. Err. adjusted for 722 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_pp_1lag |   1.002984   .0019032     1.57   0.116      .999261    1.006721
      p75_pp_1lag |    1.00004   .0000342     1.17   0.243     .9999728    1.000107
        mine_time |   1.024103    .020525     1.19   0.235     .9846548    1.065132
onsite_insp_hours |   1.002672   .0004784     5.59   0.000     1.001735    1.003611
         longwall |   .2877986   .1716713    -2.09   0.037     .0894023    .9264642
                  |
            state |
               1  |    1.21181   .4813878     0.48   0.629     .5562852    2.639804
               2  |   .8655206   .1650378    -0.76   0.449      .595621    1.257722
               3  |   1.057318   .5075536     0.12   0.908     .4126636     2.70904
               4  |    3.39957   4.146231     1.00   0.316     .3113648    37.11748
               5  |     .88424     .42976    -0.25   0.800     .3410889    2.292307
               6  |   .4417675   .0866904    -4.16   0.000      .300717    .6489774
               7  |          1  (empty)
               8  |   .1064944   .0462743    -5.15   0.000     .0454422    .2495708
               9  |          1  (empty)
              10  |   .4995369   .2353441    -1.47   0.141     .1984018    1.257736
              11  |   1.871909    1.59071     0.74   0.461     .3539575     9.89962
              12  |    .504376   .1399274    -2.47   0.014      .292825    .8687615
              13  |   1.391522   1.701576     0.27   0.787     .1266562    15.28809
              14  |   .4763151   .1219272    -2.90   0.004     .2884055    .7866563
              15  |   .3822132   .0845142    -4.35   0.000     .2477934    .5895515
              17  |          1  (empty)
                  |
             time |
            2007  |   1.375183    .269116     1.63   0.104     .9370974    2.018069
            2009  |   1.151238    .253694     0.64   0.523     .7474618    1.773133
            2010  |   .8882287   .1855717    -0.57   0.570     .5897785    1.337706
            2011  |   1.050093   .2307572     0.22   0.824     .6826167    1.615395
            2012  |   .7351447   .1554696    -1.45   0.146     .4856902    1.112721
            2013  |   1.083518   .2822036     0.31   0.758     .6503386     1.80523
            2014  |   .6943521   .1753607    -1.44   0.149      .423259    1.139077
            2015  |   .5028816   .1379948    -2.51   0.012       .29369    .8610779
                  |
            _cons |   .0000412   9.39e-06   -44.33   0.000     .0000264    .0000644
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 3 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.2.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.PP.2.csv not fou
> nd)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.PP.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3296
 number of covariate patterns =      3296
           Pearson chi2(3269) =      2863.15
                  Prob > chi2 =         1.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1541.0869  
Iteration 1:   log likelihood =  -1027.276  
Iteration 2:   log likelihood = -934.54036  
Iteration 3:   log likelihood = -926.44763  
Iteration 4:   log likelihood = -916.04799  
Iteration 5:   log likelihood = -910.70356  
Iteration 6:   log likelihood = -910.58967  
Iteration 7:   log likelihood = -910.58955  
Iteration 8:   log likelihood = -910.58955  

Logistic regression                             Number of obs     =      3,296
                                                LR chi2(2)        =    1260.99
                                                Prob > chi2       =     0.0000
Log likelihood = -910.58955                     Pseudo R2         =     0.4091

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9321876   .0525427    17.74   0.000     .8292058    1.035169
      _hatsq |   .0699091   .0216586     3.23   0.001     .0274589    .1123593
       _cons |  -.1054289   .0734057    -1.44   0.151    -.2493015    .0384437
------------------------------------------------------------------------------
Note: 0 failures and 123 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2604           315  |       2919
     -     |       107           270  |        377
-----------+--------------------------+-----------
   Total   |      2711           585  |       3296

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.05%
Specificity                     Pr( -|~D)   46.15%
Positive predictive value       Pr( D| +)   89.21%
Negative predictive value       Pr(~D| -)   71.62%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   53.85%
False - rate for true D         Pr( -| D)    3.95%
False + rate for classified +   Pr(~D| +)   10.79%
False - rate for classified -   Pr( D| -)   28.38%
--------------------------------------------------
Correctly classified                        87.20%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp2_yhat 
(option pr assumed; Pr(dv_indicator))
(51 missing values generated)

. gen bpp2_res = dv_indicator - bpp2_yhat
(51 missing values generated)

. 
. summ dv_indicator bpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
   bpp2_yhat |      6,202     .768413    .2522427   .0033536          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp2_yhat
> 
> pause "next"
> 
> scatter bpp2_res dv_indicator
> 
> pause "next"
> 
> scatter bpp2_res bpp2_yhat
> */
. pause "complete: B.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.3
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: 7.state != 0 predicts success perfectly
      7.state dropped and 19 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 17.state != 0 predicts success perfectly
      17.state dropped and 9 obs not used

Iteration 0:   log pseudolikelihood = -1048.2677  
Iteration 1:   log pseudolikelihood = -936.36463  
Iteration 2:   log pseudolikelihood = -916.25044  
Iteration 3:   log pseudolikelihood = -915.56858  
Iteration 4:   log pseudolikelihood = -915.56529  
Iteration 5:   log pseudolikelihood = -915.56529  

Logistic regression                             Number of obs     =      3,296
                                                Wald chi2(24)     =          .
Log pseudolikelihood = -915.56529               Prob > chi2       =          .

                                    (Std. Err. adjusted for 722 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_pp_c_4lag |   1.001142   .0006201     1.84   0.065     .9999271    1.002358
    p75_pp_c_4lag |    1.00001   8.63e-06     1.13   0.258     .9999928    1.000027
        mine_time |   1.022187   .0204312     1.10   0.272     .9829172    1.063026
onsite_insp_hours |   1.002643    .000478     5.54   0.000     1.001707     1.00358
         longwall |   .2758469   .1609949    -2.21   0.027     .0878767    .8658892
                  |
            state |
               1  |   1.213468   .4813776     0.49   0.626     .5576484    2.640562
               2  |   .8842485    .168386    -0.65   0.518     .6088095    1.284302
               3  |   1.045983   .5015109     0.09   0.925     .4086997    2.676978
               4  |    3.39535   4.062903     1.02   0.307     .3253344    35.43555
               5  |   .8862383   .4273667    -0.25   0.802     .3444129    2.280455
               6  |   .4423068   .0867339    -4.16   0.000     .3011672    .6495903
               7  |          1  (empty)
               8  |   .1192789   .0505904    -5.01   0.000     .0519444    .2738977
               9  |          1  (empty)
              10  |    .499946   .2347273    -1.48   0.140     .1991955    1.254777
              11  |   1.870055   1.584071     0.74   0.460     .3554888    9.837462
              12  |   .5074433    .139469    -2.47   0.014     .2960995    .8696356
              13  |   1.342057   1.641789     0.24   0.810     .1220292    14.75972
              14  |   .4874502   .1223706    -2.86   0.004     .2980182    .7972927
              15  |   .3816351   .0849034    -4.33   0.000     .2467625    .5902246
              17  |          1  (empty)
                  |
             time |
            2007  |   1.385434   .2701163     1.67   0.094     .9454273    2.030222
            2009  |   1.148081   .2534082     0.63   0.532     .7448911    1.769508
            2010  |   .8841254   .1856236    -0.59   0.557      .585872    1.334213
            2011  |    1.04314   .2301081     0.19   0.848     .6769779    1.607351
            2012  |   .7305232   .1537676    -1.49   0.136     .4835762    1.103578
            2013  |   1.074226   .2789966     0.28   0.783     .6456883    1.787182
            2014  |   .6934474   .1737985    -1.46   0.144     .4243041    1.133313
            2015  |   .4982766   .1356309    -2.56   0.010     .2922628    .8495081
                  |
            _cons |   .0000422   9.60e-06   -44.27   0.000      .000027    .0000659
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 4 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.3.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.PP.3.csv not fou
> nd)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.PP.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3296
 number of covariate patterns =      3296
           Pearson chi2(3269) =      2905.20
                  Prob > chi2 =         1.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1541.0869  
Iteration 1:   log likelihood = -1026.7635  
Iteration 2:   log likelihood = -934.02803  
Iteration 3:   log likelihood =  -925.8756  
Iteration 4:   log likelihood =  -915.3751  
Iteration 5:   log likelihood = -909.98186  
Iteration 6:   log likelihood = -909.86792  
Iteration 7:   log likelihood =  -909.8678  
Iteration 8:   log likelihood =  -909.8678  

Logistic regression                             Number of obs     =      3,296
                                                LR chi2(2)        =    1262.44
                                                Prob > chi2       =     0.0000
Log likelihood =  -909.8678                     Pseudo R2         =     0.4096

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9322925   .0525436    17.74   0.000     .8293089    1.035276
      _hatsq |   .0705961   .0216679     3.26   0.001     .0281277    .1130644
       _cons |  -.1069484   .0733797    -1.46   0.145    -.2507699    .0368732
------------------------------------------------------------------------------
Note: 0 failures and 120 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2600           315  |       2915
     -     |       111           270  |        381
-----------+--------------------------+-----------
   Total   |      2711           585  |       3296

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   95.91%
Specificity                     Pr( -|~D)   46.15%
Positive predictive value       Pr( D| +)   89.19%
Negative predictive value       Pr(~D| -)   70.87%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   53.85%
False - rate for true D         Pr( -| D)    4.09%
False + rate for classified +   Pr(~D| +)   10.81%
False - rate for classified -   Pr( D| -)   29.13%
--------------------------------------------------
Correctly classified                        87.08%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp3_yhat 
(option pr assumed; Pr(dv_indicator))
(51 missing values generated)

. gen bpp3_res = dv_indicator - bpp3_yhat
(51 missing values generated)

. 
. summ dv_indicator bpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
   bpp3_yhat |      6,202    .7690696    .2516259   .0033914          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp3_yhat
> 
> pause "next"
> 
> scatter bpp3_res dv_indicator
> 
> pause "next"
> 
> scatter bpp3_res bpp3_yhat
> */
. pause "complete: B.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.4
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: 7.state != 0 predicts success perfectly
      7.state dropped and 19 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 17.state != 0 predicts success perfectly
      17.state dropped and 9 obs not used

Iteration 0:   log pseudolikelihood = -1048.2677  
Iteration 1:   log pseudolikelihood =  -935.8933  
Iteration 2:   log pseudolikelihood = -912.39001  
Iteration 3:   log pseudolikelihood = -911.12174  
Iteration 4:   log pseudolikelihood = -911.11669  
Iteration 5:   log pseudolikelihood = -911.11669  

Logistic regression                             Number of obs     =      3,296
                                                Wald chi2(24)     =          .
Log pseudolikelihood = -911.11669               Prob > chi2       =          .

                                    (Std. Err. adjusted for 722 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_pp_c_lag_all |   1.000388   .0003426     1.13   0.257     .9997173     1.00106
 p75_pp_c_lag_all |   1.000004   2.09e-06     1.80   0.071     .9999997    1.000008
        mine_time |   1.008841   .0202811     0.44   0.662     .9698634    1.049384
onsite_insp_hours |   1.002807   .0003843     7.31   0.000     1.002054     1.00356
         longwall |    .222434   .1522554    -2.20   0.028     .0581509     .850836
                  |
            state |
               1  |    1.14683   .4604871     0.34   0.733     .5220543    2.519314
               2  |   1.004799   .1953269     0.02   0.980     .6864532     1.47078
               3  |   .8120543   .4425992    -0.38   0.702      .279029    2.363311
               4  |   3.199905   3.832906     0.97   0.332     .3058807    33.47512
               5  |   .8708588   .4233731    -0.28   0.776      .335839     2.25821
               6  |   .4072592   .0786864    -4.65   0.000     .2788756    .5947456
               7  |          1  (empty)
               8  |   .1359416   .0636077    -4.26   0.000     .0543339    .3401209
               9  |          1  (empty)
              10  |   .4614205   .2075169    -1.72   0.085     .1911093    1.114068
              11  |   1.748124   1.473199     0.66   0.507      .335149    9.118143
              12  |   .4902468   .1294343    -2.70   0.007      .292201    .8225227
              13  |   1.450736   1.727383     0.31   0.755     .1406268    14.96611
              14  |   .5060042   .1389318    -2.48   0.013     .2954219    .8666936
              15  |   .3711037   .0805623    -4.57   0.000     .2424986    .5679123
              17  |          1  (empty)
                  |
             time |
            2007  |   1.331911    .253103     1.51   0.131     .9177434    1.932987
            2009  |   1.154464   .2520942     0.66   0.511     .7525027     1.77114
            2010  |   .8633126   .1809073    -0.70   0.483     .5725305     1.30178
            2011  |   1.007951   .2220711     0.04   0.971     .6544907      1.5523
            2012  |   .6839999   .1416041    -1.83   0.067     .4558661    1.026301
            2013  |   .9840677   .2566326    -0.06   0.951     .5902585    1.640619
            2014  |   .6009357    .151336    -2.02   0.043     .3668314    .9844406
            2015  |     .44135   .1209988    -2.98   0.003     .2578819    .7553449
                  |
            _cons |   .0000479   .0000109   -43.88   0.000     .0000307    .0000747
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 12 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.4.csv"', replace plain wide p eform
(note: file C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.PP.4.csv not fou
> nd)
(output written to C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/estout 10-22/Model.PS.Y.P.B.PP.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3296
 number of covariate patterns =      3296
           Pearson chi2(3269) =      2789.54
                  Prob > chi2 =         1.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1541.0869  
Iteration 1:   log likelihood = -1026.5647  
Iteration 2:   log likelihood = -928.64497  
Iteration 3:   log likelihood = -920.89062  
Iteration 4:   log likelihood = -914.37626  
Iteration 5:   log likelihood = -906.28826  
Iteration 6:   log likelihood = -906.00135  
Iteration 7:   log likelihood = -906.00081  
Iteration 8:   log likelihood = -906.00081  

Logistic regression                             Number of obs     =      3,296
                                                LR chi2(2)        =    1270.17
                                                Prob > chi2       =     0.0000
Log likelihood = -906.00081                     Pseudo R2         =     0.4121

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |    .942096   .0529105    17.81   0.000     .8383934    1.045799
      _hatsq |   .0665899   .0217774     3.06   0.002     .0239069     .109273
       _cons |  -.1051885   .0736683    -1.43   0.153    -.2495757    .0391987
------------------------------------------------------------------------------
Note: 0 failures and 192 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2604           314  |       2918
     -     |       107           271  |        378
-----------+--------------------------+-----------
   Total   |      2711           585  |       3296

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.05%
Specificity                     Pr( -|~D)   46.32%
Positive predictive value       Pr( D| +)   89.24%
Negative predictive value       Pr(~D| -)   71.69%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   53.68%
False - rate for true D         Pr( -| D)    3.95%
False + rate for classified +   Pr(~D| +)   10.76%
False - rate for classified -   Pr( D| -)   28.31%
--------------------------------------------------
Correctly classified                        87.23%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp4_yhat 
(option pr assumed; Pr(dv_indicator))
(51 missing values generated)

. gen bpp4_res = dv_indicator - bpp4_yhat
(51 missing values generated)

. 
. summ dv_indicator bpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
   bpp4_yhat |      6,202    .7742269    .2492592   .0034831          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp4_yhat
> 
> pause "next"
> 
> scatter bpp4_res dv_indicator
> 
> pause "next"
> 
> scatter bpp4_res bpp4_yhat
> */
. pause "complete: B.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. log close
      name:  <unnamed>
       log:  C:/Users/jbodson/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Summaries/all/PS/log 10-22/log_part_year.txt
  log type:  text
 closed on:  22 Oct 2016, 12:57:09
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
