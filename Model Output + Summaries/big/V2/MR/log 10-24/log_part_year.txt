-----------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Su
> mmaries/big/V2/MR/log 10-24/log_part_year.txt
  log type:  text
 opened on:  24 Oct 2016, 18:38:05
. }       

.         
. if "`mine_sample'" == "bad" | "`mine_sample'" == "big_bad" { 
.         // make directories 
.         capture mkdir "C:/Users/`fellow'/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model
>  Output + Summaries/`mine_sample'/`badness'/`version'/log `date'/`injury_type'/estout `date'/"
.         capture mkdir "C:/Users/`fellow'/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model
>  Output + Summaries/`mine_sample'/`badness'/`version'/log `date'/`injury_type'/log `date'/"
.         // make logs                    
.         local directory "C:/Users/`fellow'/Dropbox (Stanford Law School)/R-code/Injury-Classification/Mod
> el Output + Summaries/`mine_sample'/`badness'/`version'/`injury_type'/estout `date'/"
.         capture log close
.         log using "C:/Users/`fellow'/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Out
> put + Summaries/`mine_sample'/`badness'/`version'/`injury_type'/log `date'/log_`violation_level'_`log_tim
> e'.txt", text replace
. }

. 
. ********************************************************************************
. ********************************************************************************
. // DATA SET-UP
. 
. // format variables
. if "`injury_type'" == "MR" {
.         rename MR dv
.         rename MR_indicator dv_indicator
.         local injury_label "MR"
.         local relevant_parts "47 48 71 72 75 77"
. }

. 
. if "`injury_type'" == "PS" {
.         rename PS dv
.         rename PS_indicator dv_indicator
.         local injury_label "PS"
.         local relevant_parts "48 75"
. }

. 
. if "`violation_level'" == "part" {
.         local violation_level_label "P"
. }

. 
. if "`violation_level'" == "subpart" {
.         local violation_level_label "SP"
. }

. 
. // flag obs after or equal to 2007 to use in penlaty points analyses (assessments changed for the last ti
> me in 2007)
. gen sample_pp = quarter >= 2007 

. 
. // format time
. tostring quarter, replace
quarter was double now str7

. encode quarter, gen(quart)

. drop quarter year

. rename quart time

. local time_label "Q" // will be overwritten if unit_of_analysis is year_sum or year_avg

. 
. // collapse to quarter levels (sums)
. if "`unit_of_analysis'" == "year_sum" { // collapse to mine years - sums 
.         local time_label "Y"
.         
.         // count number of complete quarters per year
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
(1,805 real changes made)
.         gen marker = 1
.         bysort mineid year: egen num_quarts = sum(marker)
.                 /*tab num_quarts
>                          num_quarts |      Freq.     Percent        Cum.
>                         ------------+-----------------------------------
>                                           1 |      1,100        3.63        3.63
>                                           2 |      1,666        5.50        9.13
>                                           3 |      2,511        8.29       17.42
>                                           4 |     25,012       82.58      100.00
>                         ------------+-----------------------------------
>                                   Total |     30,289      100.00 - Sarah 9/21/2016 @ 10:54 PM */
.         drop if num_quarts < 4
(84 observations deleted)
.         
.         // collapse to the mine-year 
.         collapse (sum) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp union longwall, by(mi
> neid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_sum collapse"
. }

. // collapse to quarter levels (means)
. if "`unit_of_analysis'" == "year_avg" { // collapse on mine years - averages
.         local time_label "Y"
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
.         pause "collapsing to mine-year"
.         collapse (mean) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp union longwall, by(m
> ineid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_avg collapse"
. }

. // format depvars
. drop dv_indicator

. gen dv_binary = 0 if dv == 0
(545 missing values generated)

. replace dv_binary = 1 if dv != 0
(545 real changes made)

. rename dv_binary dv_indicator

.         
. gen lnhours = log(hours)

. pause "complete: data formatting"

. 
. // group variables
. local covariates "mine_time onsite_insp_hours"

. 
. if "`union_status'" == "on" {
.         local covariates "`covariates' union longwall"
. }

. 
. *** lag 0 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
p47 p48 p71 p72 p75 p77
. 
.         foreach var of varlist p*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
p47_ss p48_ss p71_ss p72_ss p75_ss p77_ss
. 
.         foreach var of varlist p*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
p47_pp p48_pp p71_pp p72_pp p75_pp p77_pp
.         
.         pause "complete: variable groups - part no lag"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
. 
.         foreach var of varlist sp*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
. 
.         foreach var of varlist sp*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
.         
.         pause "complete: variable groups - subpart no lag"
. }

. 
. *** lag 1 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
p47_1lag p48_1lag p71_1lag p72_1lag p75_1lag p77_1lag
. 
.         foreach var of varlist p*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
p47_ss_1lag p48_ss_1lag p71_ss_1lag p72_ss_1lag p75_ss_1lag p77_ss_1lag
. 
.         foreach var of varlist p*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
p47_pp_1lag p48_pp_1lag p71_pp_1lag p72_pp_1lag p75_pp_1lag p77_pp_1lag
.         
.         pause "complete: variable groups - part lag 1"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
. 
.         foreach var of varlist sp*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
. 
. 
.         foreach var of varlist sp*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
. 
.         pause "complete: variable groups - subpart lag 1"
. } 

. 
. *** lag 4 ***
. if "`violation_level'" == "part" {
.         
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
p47_c_4lag p48_c_4lag p71_c_4lag p72_c_4lag p75_c_4lag p77_c_4lag
. 
.         foreach var of varlist p*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
p47_ss_c_4lag p48_ss_c_4lag p71_ss_c_4lag p72_ss_c_4lag p75_ss_c_4lag p77_ss_c_4lag
. 
.         foreach var of varlist p*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
p47_pp_c_4lag p48_pp_c_4lag p71_pp_c_4lag p72_pp_c_4lag p75_pp_c_4lag p77_pp_c_4lag
. 
.         pause "complete: variable groups - part lag 4"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
. 
.         foreach var of varlist sp*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
. 
.         foreach var of varlist sp*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
. 
.         pause "complete: variable groups - subpart lag 4"
. }

. 
. *** lag all ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
p47_c_lag_all p48_c_lag_all p71_c_lag_all p72_c_lag_all p75_c_lag_all p77_c_lag_all
. 
.         foreach var of varlist p*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
p47_ss_c_lag_all p48_ss_c_lag_all p71_ss_c_lag_all p72_ss_c_lag_all p75_ss_c_lag_all p77_ss_c_lag_all
. 
.         foreach var of varlist p*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
p47_pp_c_lag_all p48_pp_c_lag_all p71_pp_c_lag_all p72_pp_c_lag_all p75_pp_c_lag_all p77_pp_c_lag_all
. 
.         pause "complete: variable groups - part lag all"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
.         
.         foreach var of varlist sp*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
.         
.         foreach var of varlist sp*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
. 
.         pause "complete: variable groups - subpart lag all"
. }

. 
. ********************************************************************************
. *******************************************************************************
. // DATA OVERVIEW
. 
. // outcome variables
. summ dv

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37

. 
. pause "next"

. 
. tab dv_indicator

dv_indicato |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         48        8.09        8.09
          1 |        545       91.91      100.00
------------+-----------------------------------
      Total |        593      100.00

.           
. pause "next"

. 
. if "`violation_level'" == "part" {
.         summ `count_vars' `ss_vars' `pp_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         p47 |        593    .0522766    .3058534          0          4
         p48 |        593    .7301855    1.338634          0         10
         p71 |        593    .0910624    .4253032          0          6
         p72 |        593    .1804384     .538537          0          4
         p75 |        593    175.7673    123.9061          2        841
-------------+---------------------------------------------------------
         p77 |        593    4.202361    5.028587          0         32
      p47_ss |        593     .010118    .1001628          0          1
      p48_ss |        593    .2158516    .6707839          0          7
      p71_ss |        593     .010118    .1001628          0          1
      p72_ss |        593    .0236088    .1626921          0          2
-------------+---------------------------------------------------------
      p75_ss |        593    45.61214    39.44948          0        252
      p77_ss |        593    .5059022    1.087575          0          8
      p47_pp |        593    3.349073    21.61326          0        293
      p48_pp |        593    35.65093    72.22109          0        499
      p71_pp |        593    4.785835    27.46613          0        422
-------------+---------------------------------------------------------
      p72_pp |        593    7.387858    24.96318          0        219
      p75_pp |        593    9782.764    9557.323          0      60818
      p77_pp |        593    178.8263    272.6051          0       2106
.         
.         pause "next"
.         
.         summ `count_lag_1_vars' `ss_lag_1_vars' `pp_lag_1_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    p47_1lag |        593    .0539629    .3027832          0          4
    p48_1lag |        593    .7301855    1.415902          0         13
    p71_1lag |        593    .0826307    .3510387          0          4
    p72_1lag |        593    .1804384    .5416645          0          4
    p75_1lag |        593     175.597    123.2863          6        926
-------------+---------------------------------------------------------
    p77_1lag |        593    4.202361     5.00974          0         37
 p47_ss_1lag |        593     .010118    .1001628          0          1
 p48_ss_1lag |        593    .2209106    .7095639          0          9
 p71_ss_1lag |        593     .010118    .1001628          0          1
 p72_ss_1lag |        593    .0236088    .1727631          0          2
-------------+---------------------------------------------------------
 p75_ss_1lag |        593    45.79427     39.1709          0        226
 p77_ss_1lag |        593    .5126476    1.085963          0          8
 p47_pp_1lag |        593    3.349073    21.29279          0        293
 p48_pp_1lag |        593    35.26307    76.24276          0        702
 p71_pp_1lag |        593    4.182125    21.31561          0        302
-------------+---------------------------------------------------------
 p72_pp_1lag |        593    7.387858    25.70909          0        219
 p75_pp_1lag |        593    9618.848     9539.13          0      71114
 p77_pp_1lag |        593    177.7538      274.77          0       2454
.         
.         pause "next"
.         
.         summ `count_lag_4_vars' `ss_lag_4_vars' `pp_lag_4_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  p47_c_4lag |        593    .2175379    .9906127          0         12
  p48_c_4lag |        593    2.885329    4.953534          0         43
  p71_c_4lag |        593    .3305228     1.19629          0          8
  p72_c_4lag |        593    .7200675    1.892165          0         18
  p75_c_4lag |        593    699.9578     480.044          0       3645
-------------+---------------------------------------------------------
  p77_c_4lag |        593    16.80607    18.69269          0        116
p47_ss_c_4~g |        593    .0404722    .2992916          0          3
p48_ss_c_4~g |        593    .8634064     2.33001          0         30
p71_ss_c_4~g |        593    .0370995    .3107962          0          4
p72_ss_c_4~g |        593    .0910624    .5651516          0          7
-------------+---------------------------------------------------------
p75_ss_c_4~g |        593    182.8297    150.8181          0        941
p77_ss_c_4~g |        593    2.053963    3.823441          0         24
p47_pp_c_4~g |        593    13.39629       68.84          0        879
p48_pp_c_4~g |        593    137.9511     269.213          0       2329
p71_pp_c_4~g |        593    16.63912    71.09799          0        604
-------------+---------------------------------------------------------
p72_pp_c_4~g |        593    29.35076    83.79015          0        689
p75_pp_c_4~g |        593    38040.37    37417.87          0     280327
p77_pp_c_4~g |        593    700.6695    1020.509          0       7737
.         
.         pause "next"
.         
.         summ `count_lag_all_vars' `ss_lag_all_vars' `pp_lag_all_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
p47_c_lag_~l |        593    1.080944    2.613024          0         20
p48_c_lag_~l |        593    22.10455    25.50462          0        108
p71_c_lag_~l |        593    2.480607    5.285438          0         36
p72_c_lag_~l |        593    3.676223    6.733317          0         36
p75_c_lag_~l |        593    5439.437    4640.351          0      27670
-------------+---------------------------------------------------------
p77_c_lag_~l |        593    142.9578     153.063          0        858
p47_ss_c_l~l |        593    .1838111    .9362849          0          8
p48_ss_c_l~l |        593     7.51602    11.25804          0         52
p71_ss_c_l~l |        593    .4030354    1.204352          0          6
p72_ss_c_l~l |        593    .6526138    1.990874          0         12
-------------+---------------------------------------------------------
p75_ss_c_l~l |        593    1531.661    1302.821          0       7503
p77_ss_c_l~l |        593    19.77572    24.58435          0        104
p47_pp_c_l~l |        593    49.48061    174.4687          0       1640
p48_pp_c_l~l |        593    792.3744    1158.918          0       5556
p71_pp_c_l~l |        593    87.50084    237.0735          0       1713
-------------+---------------------------------------------------------
p72_pp_c_l~l |        593    135.1282    287.1368          0       2116
p75_pp_c_l~l |        593    202183.3    236818.5          0    1515903
p77_pp_c_l~l |        593    3636.899    5435.003          0      33461
. }

. 
. pause "complete: data overview"

. 
. *******************************************************************************/
. /*******************************************************************************
> // MODEL LABEL KEY
> 
> Model X.Y.Z
>   X
>     C: response variable is count of injuries
>     B: response variable is binary of injuries
>   Y
>     V: predictors are number of violations
>     SSV: predictors are number of significant and substantial violations
>     PP: predictors are number of penalty points
>   Z
>     1: inj_t ~ viol_t
>     2: inj_t ~ viol_(t_-1)
>     3: inj_t ~ viol_(annual sum pre_t)
>     4: inj_t ~ viol_(sum since study period) 
> 
> *******************************************************************************/
. ********************************************************************************
. // NULL MODELS (V & SSV)
. 
. // count outcome (V & SSV)
. /*
> glm dv, family(poisson) link(log) vce(cl mineid) exposure(hours) eform
>         
> pause "next"    
>         
> quietly poisson dv, vce(cl mineid) exposure(hours) irr
> estat gof
> 
> pause "next"
>         
> glm dv, family(nbinomial) link(log) vce(cl mineid) exposure(hours) eform
> 
> pause "next"
> */
. 
. nbreg dv, vce(cl mineid) exposure(hours) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1718.6231  
Iteration 1:   log pseudolikelihood = -1718.6231  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1649.7017  
Iteration 1:   log pseudolikelihood = -1533.8155  
Iteration 2:   log pseudolikelihood = -1532.3284  
Iteration 3:   log pseudolikelihood = -1532.3223  
Iteration 4:   log pseudolikelihood = -1532.3223  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1532.3223  
Iteration 1:   log pseudolikelihood = -1532.3223  

Negative binomial regression                    Number of obs     =        593
                                                Wald chi2(0)      =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1532.3223               Pseudo R2         =     0.0000

                                (Std. Err. adjusted for 55 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   9.20e-06   5.04e-07  -211.87   0.000     8.27e-06    .0000102
   ln(hours) |          1  (exposure)
-------------+----------------------------------------------------------------
    /lnalpha |  -1.457181   .1557347                     -1.762416   -1.151947
-------------+----------------------------------------------------------------
       alpha |   .2328919   .0362693                      .1716298     .316021
------------------------------------------------------------------------------

. 
. pause "next"

. 
. predict c_null_yhat 
(option n assumed; predicted number of events)

. summ dv c_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
 c_null_yhat |        593     6.61528     4.11403   .1891053   25.92188

. 
. pause "complete: null model - count outcome"

. 
. // binary outcome (V & SSV)
. logit dv_indicator, vce(cl mineid) offset(lnhours) or

Iteration 0:   log pseudolikelihood = -120.58112  
Iteration 1:   log pseudolikelihood = -119.05502  
Iteration 2:   log pseudolikelihood = -119.05411  
Iteration 3:   log pseudolikelihood = -119.05411  

Logistic regression                             Number of obs     =        593
                                                Wald chi2(0)      =          .
Log pseudolikelihood = -119.05411               Prob > chi2       =          .

                                (Std. Err. adjusted for 55 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |    .000026   5.99e-06   -45.78   0.000     .0000165    .0000408
     lnhours |          1  (offset)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       593
 number of covariate patterns =         1
              Pearson chi2(0) =         0.00
                  Prob > chi2 =              .

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -166.67437  
Iteration 1:   log likelihood = -126.16089  
Iteration 2:   log likelihood = -112.67386  
Iteration 3:   log likelihood = -105.30099  
Iteration 4:   log likelihood = -105.29864  
Iteration 5:   log likelihood = -105.29864  

Logistic regression                             Number of obs     =        593
                                                LR chi2(2)        =     122.75
                                                Prob > chi2       =     0.0000
Log likelihood = -105.29864                     Pseudo R2         =     0.3682

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.887017   .7944381     2.38   0.018     .3299469    3.444087
      _hatsq |    .061293   .2225913     0.28   0.783    -.3749779    .4975639
       _cons |  -2.140792   .7273614    -2.94   0.003    -3.566394   -.7151902
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       544            43  |        587
     -     |         1             5  |          6
-----------+--------------------------+-----------
   Total   |       545            48  |        593

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.82%
Specificity                     Pr( -|~D)   10.42%
Positive predictive value       Pr( D| +)   92.67%
Negative predictive value       Pr(~D| -)   83.33%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   89.58%
False - rate for true D         Pr( -| D)    0.18%
False + rate for classified +   Pr(~D| +)    7.33%
False - rate for classified -   Pr( D| -)   16.67%
--------------------------------------------------
Correctly classified                        92.58%
--------------------------------------------------

. 
. pause "next"

. 
. predict b_null_yhat 
(option pr assumed; Pr(dv_indicator))

. summ dv_indicator b_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
 b_null_yhat |        593    .9190556    .0842809   .3480205   .9865175

. 
. pause "complete: null model - binary outcome"

. 
. *******************************************************************************/
. ********************************************************************************
. // NULL MODELS (PP)
. 
. // count outcome (PP)
. /*
> glm dv if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) eform
>         
> pause "next"    
>         
> quietly poisson dv if sample_pp == 1, vce(cl mineid) exposure(hours) irr
> estat gof
> 
> pause "next"
>         
> glm dv if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) eform
> 
> pause "next"
> */
. 
. nbreg dv if sample_pp == 1, vce(cl mineid) exposure(hours) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1088.0824  
Iteration 1:   log pseudolikelihood = -1088.0824  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1034.4246  
Iteration 1:   log pseudolikelihood = -965.67393  
Iteration 2:   log pseudolikelihood = -965.59649  
Iteration 3:   log pseudolikelihood = -965.59647  

Fitting full model:

Iteration 0:   log pseudolikelihood = -965.59647  
Iteration 1:   log pseudolikelihood = -965.59647  

Negative binomial regression                    Number of obs     =        383
                                                Wald chi2(0)      =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -965.59647               Pseudo R2         =     0.0000

                                (Std. Err. adjusted for 47 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   7.90e-06   5.22e-07  -177.79   0.000     6.94e-06    9.00e-06
   ln(hours) |          1  (exposure)
-------------+----------------------------------------------------------------
    /lnalpha |  -1.403963   .1760135                     -1.748943   -1.058983
-------------+----------------------------------------------------------------
       alpha |   .2456215   .0432327                      .1739576    .3468083
------------------------------------------------------------------------------

. 
. pause "next"

. 
. predict c_pp_null_yhat 
(option n assumed; predicted number of events)

. summ dv_indicator c_pp_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
c_pp_null_~t |        593    5.680284    3.532558   .1623774   22.25811

. 
. pause "complete: null model - count outcome"

. 
. // binary outcome (PP)
. logit dv_indicator if sample_pp == 1, vce(cl mineid) offset(lnhours) or

Iteration 0:   log pseudolikelihood = -89.634012  
Iteration 1:   log pseudolikelihood = -88.524454  
Iteration 2:   log pseudolikelihood = -88.523544  
Iteration 3:   log pseudolikelihood = -88.523544  

Logistic regression                             Number of obs     =        383
                                                Wald chi2(0)      =          .
Log pseudolikelihood = -88.523544               Prob > chi2       =          .

                                (Std. Err. adjusted for 47 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000205   4.57e-06   -48.51   0.000     .0000133    .0000317
     lnhours |          1  (offset)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       383
 number of covariate patterns =         1
              Pearson chi2(0) =         0.00
                  Prob > chi2 =              .

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -119.37502  
Iteration 1:   log likelihood = -95.305337  
Iteration 2:   log likelihood = -89.980891  
Iteration 3:   log likelihood =    -81.702  
Iteration 4:   log likelihood = -81.575057  
Iteration 5:   log likelihood = -81.574571  
Iteration 6:   log likelihood = -81.574571  

Logistic regression                             Number of obs     =        383
                                                LR chi2(2)        =      75.60
                                                Prob > chi2       =     0.0000
Log likelihood = -81.574571                     Pseudo R2         =     0.3167

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.088901   .7001295     1.56   0.120     -.283328    2.461129
      _hatsq |    .242923   .2224724     1.09   0.275    -.1931148    .6789608
       _cons |  -1.223318   .6009031    -2.04   0.042    -2.401066   -.0455696
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       346            30  |        376
     -     |         1             6  |          7
-----------+--------------------------+-----------
   Total   |       347            36  |        383

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.71%
Specificity                     Pr( -|~D)   16.67%
Positive predictive value       Pr( D| +)   92.02%
Negative predictive value       Pr(~D| -)   85.71%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   83.33%
False - rate for true D         Pr( -| D)    0.29%
False + rate for classified +   Pr(~D| +)    7.98%
False - rate for classified -   Pr( D| -)   14.29%
--------------------------------------------------
Correctly classified                        91.91%
--------------------------------------------------

. 
. pause "next"

. 
. predict b_pp_null_yhat 
(option pr assumed; Pr(dv_indicator))

. summ dv_indicator b_pp_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
b_pp_null_~t |        593    .9017581    .0947823   .2965818   .9829919

. 
. pause "complete: null model - binary outcome"

. 
. ********************************************************************************
. ********************************************************************************
. 
. if "`violation_level'" == "subpart" {
.         set matsize 11000, perm
.         set emptycells drop
. }

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.1
. 
. // poisson model
. /*
> glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) e
> xposure(hours) iter(50) eform
>         
> quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours)
>  iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid)
>  exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) i
> ter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1465.4085  
Iteration 1:   log pseudolikelihood = -1462.2152  
Iteration 2:   log pseudolikelihood = -1462.2056  
Iteration 3:   log pseudolikelihood = -1462.2056  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1649.7017  
Iteration 1:   log pseudolikelihood = -1533.8155  
Iteration 2:   log pseudolikelihood = -1532.3284  
Iteration 3:   log pseudolikelihood = -1532.3223  
Iteration 4:   log pseudolikelihood = -1532.3223  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1443.5559  
Iteration 1:   log pseudolikelihood =  -1419.796  
Iteration 2:   log pseudolikelihood = -1417.6972  
Iteration 3:   log pseudolikelihood = -1417.6864  
Iteration 4:   log pseudolikelihood = -1417.6864  

Negative binomial regression                    Number of obs     =        593
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1417.6864               Pseudo R2         =     0.0748

                                     (Std. Err. adjusted for 55 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p47 |   .8705836   .0901557    -1.34   0.181     .7106601    1.066495
              p48 |   1.008503   .0207761     0.41   0.681     .9685937    1.050057
              p71 |    .992183   .0413406    -0.19   0.851     .9143771    1.076609
              p72 |   .9608657   .0436395    -0.88   0.379     .8790302     1.05032
              p75 |   1.001143   .0003338     3.43   0.001     1.000489    1.001797
              p77 |   .9922241   .0060714    -1.28   0.202     .9803955    1.004196
        mine_time |   .8222297   .0723565    -2.22   0.026     .6919699    .9770104
onsite_insp_hours |   .9998745   .0000677    -1.85   0.064     .9997419    1.000007
                  |
            state |
               1  |   1.343674   .1685786     2.35   0.019     1.050755     1.71825
               3  |   .6635974   .1016893    -2.68   0.007      .491436    .8960707
               4  |   1.438204   .1720974     3.04   0.002     1.137535    1.818346
               5  |   1.235505   .1753343     1.49   0.136     .9355084    1.631703
               6  |   1.248104   .1623432     1.70   0.088     .9672386    1.610528
               9  |   1.011407   .1167523     0.10   0.922     .8066163    1.268192
              10  |    1.41745   .1488484     3.32   0.001     1.153777     1.74138
              12  |   .9938225   .1551352    -0.04   0.968     .7318747    1.349525
              14  |   .6135271   .1779845    -1.68   0.092     .3474559    1.083347
              15  |   .5032792   .1442813    -2.40   0.017     .2869356    .8827416
                  |
             time |
            2004  |   1.242685   .1512259     1.79   0.074     .9789844    1.577416
            2005  |   1.350005   .2417689     1.68   0.094     .9503774    1.917675
            2006  |   1.441877   .3662612     1.44   0.150     .8764127    2.372181
            2007  |   1.699241   .5791148     1.56   0.120     .8712824     3.31399
            2008  |   1.740219   .7581717     1.27   0.204     .7408932    4.087446
            2009  |   2.194149   1.112294     1.55   0.121     .8123835    5.926131
            2010  |   2.358596   1.373829     1.47   0.141     .7530916    7.386848
            2011  |   3.016129   2.028089     1.64   0.101     .8074017    11.26705
            2012  |   4.029307   3.090204     1.82   0.069     .8962244    18.11524
            2013  |   4.907888   4.074428     1.92   0.055     .9643719    24.97725
            2014  |    6.22414   5.816738     1.96   0.050     .9967664     38.8656
            2015  |   6.603244   6.954722     1.79   0.073     .8380078    52.03154
                  |
            _cons |   .0000139   1.37e-06  -113.39   0.000     .0000114    .0000168
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.330488    .225566                     -2.772589   -1.888387
------------------+----------------------------------------------------------------
            alpha |   .0972483   .0219359                         .0625    .1513158
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.1.csv"', replace 
> plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.V.1.csv)

. /* 
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) i
> ter(50) irr
> */
. predict cv1_yhat 
(option n assumed; predicted number of events)

. gen cv1_res = dv - cv1_yhat

. 
. summ dv cv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
    cv1_yhat |        593    6.510943    4.619439   .0844327   32.39659

. /*
> pause "next"
> 
> scatter dv cv1_yhat
> 
> pause "next"
> 
> scatter cv1_res dv
> 
> pause "next"
> 
> scatter cv1_res cv1_yhat
> */
. pause "complete: C.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.2
. 
. // poisson model
. /*
> glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl min
> eid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(
> hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl m
> ineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(ho
> urs) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1463.6808  
Iteration 1:   log pseudolikelihood = -1460.5654  
Iteration 2:   log pseudolikelihood = -1460.5573  
Iteration 3:   log pseudolikelihood = -1460.5573  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1649.7017  
Iteration 1:   log pseudolikelihood = -1533.8155  
Iteration 2:   log pseudolikelihood = -1532.3284  
Iteration 3:   log pseudolikelihood = -1532.3223  
Iteration 4:   log pseudolikelihood = -1532.3223  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1442.1807  
Iteration 1:   log pseudolikelihood = -1418.3851  
Iteration 2:   log pseudolikelihood = -1416.3474  
Iteration 3:   log pseudolikelihood = -1416.3371  
Iteration 4:   log pseudolikelihood = -1416.3371  

Negative binomial regression                    Number of obs     =        593
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1416.3371               Pseudo R2         =     0.0757

                                     (Std. Err. adjusted for 55 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p47_1lag |   .8221816   .0677625    -2.38   0.018     .6995415    .9663223
         p48_1lag |   1.012268   .0202578     0.61   0.542      .973332    1.052761
         p71_1lag |   .9226446   .0527063    -1.41   0.159     .8249152    1.031952
         p72_1lag |   .9778808   .0450803    -0.49   0.628     .8933991    1.070351
         p75_1lag |   1.001078   .0003135     3.44   0.001     1.000464    1.001692
         p77_1lag |   .9918742   .0058677    -1.38   0.168     .9804402    1.003442
        mine_time |   .8274397    .073052    -2.15   0.032     .6959636    .9837532
onsite_insp_hours |   .9998848    .000064    -1.80   0.072     .9997595     1.00001
                  |
            state |
               1  |   1.328074   .1640811     2.30   0.022     1.042456    1.691947
               3  |   .6520956   .0980419    -2.84   0.004     .4856619    .8755654
               4  |   1.420442   .1731487     2.88   0.004     1.118572    1.803778
               5  |    1.20474   .1672834     1.34   0.180     .9176994    1.581563
               6  |   1.232795   .1586918     1.63   0.104     .9578989     1.58658
               9  |   1.026208    .118978     0.22   0.823     .8176122    1.288022
              10  |   1.445178   .1551905     3.43   0.001     1.170887    1.783724
              12  |   .9854326   .1544504    -0.09   0.925     .7247948    1.339796
              14  |   .6001367   .1734631    -1.77   0.077     .3405803    1.057501
              15  |    .490026   .1406302    -2.49   0.013     .2792138    .8600059
                  |
             time |
            2004  |   1.252604   .1507374     1.87   0.061     .9894203    1.585794
            2005  |   1.315654   .2368272     1.52   0.128     .9245266    1.872251
            2006  |   1.413899   .3575509     1.37   0.171     .8613194    2.320987
            2007  |   1.661784   .5655216     1.49   0.136     .8529085    3.237777
            2008  |   1.662029   .7191738     1.17   0.240     .7117323    3.881152
            2009  |   2.086485   1.060002     1.45   0.148     .7708633     5.64746
            2010  |   2.272264   1.327662     1.40   0.160     .7229525      7.1418
            2011  |   2.863841   1.931968     1.56   0.119     .7633467    10.74424
            2012  |   3.698558   2.850385     1.70   0.090     .8166442    16.75066
            2013  |   4.512944   3.738547     1.82   0.069     .8898565    22.88758
            2014  |   5.707645   5.347996     1.86   0.063     .9096851    35.81152
            2015  |    6.14899   6.493953     1.72   0.085     .7759776    48.72574
                  |
            _cons |    .000014   1.37e-06  -113.63   0.000     .0000115    .0000169
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.337837   .2259905                      -2.78077   -1.894904
------------------+----------------------------------------------------------------
            alpha |   .0965362   .0218163                      .0619907    .1503328
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.2.csv"', replace 
> plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.V.2.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(ho
> urs) iter(50) irr
> */
. predict cv2_yhat 
(option n assumed; predicted number of events)

. gen cv2_res = dv - cv2_yhat

. 
. summ dv cv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
    cv2_yhat |        593    6.505143       4.585   .0812696   29.42939

. /*
> pause "next"
> 
> scatter dv cv2_yhat
> 
> pause "next"
> 
> scatter cv2_res dv
> 
> pause "next"
> 
> scatter cv2_res cv2_yhat
> */
. pause "complete: C.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.3
. 
. // poisson model
. /*
> glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl min
> eid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(
> hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl m
> ineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(ho
> urs) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1463.0024  
Iteration 1:   log pseudolikelihood = -1459.8486  
Iteration 2:   log pseudolikelihood = -1459.8402  
Iteration 3:   log pseudolikelihood = -1459.8402  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1649.7017  
Iteration 1:   log pseudolikelihood = -1533.8155  
Iteration 2:   log pseudolikelihood = -1532.3284  
Iteration 3:   log pseudolikelihood = -1532.3223  
Iteration 4:   log pseudolikelihood = -1532.3223  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1442.2156  
Iteration 1:   log pseudolikelihood = -1418.2492  
Iteration 2:   log pseudolikelihood = -1416.1168  
Iteration 3:   log pseudolikelihood = -1416.1052  
Iteration 4:   log pseudolikelihood = -1416.1052  

Negative binomial regression                    Number of obs     =        593
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1416.1052               Pseudo R2         =     0.0758

                                     (Std. Err. adjusted for 55 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p47_c_4lag |   .9361373   .0267917    -2.31   0.021     .8850722    .9901487
       p48_c_4lag |   1.004259   .0056382     0.76   0.449     .9932693    1.015371
       p71_c_4lag |    .974755   .0161847    -1.54   0.124     .9435442    1.006998
       p72_c_4lag |   .9911379   .0124588    -0.71   0.479     .9670174     1.01586
       p75_c_4lag |   1.000271   .0000846     3.21   0.001     1.000106    1.000437
       p77_c_4lag |   .9976201   .0020842    -1.14   0.254     .9935435    1.001713
        mine_time |   .8309561   .0743081    -2.07   0.038      .697364      .99014
onsite_insp_hours |   .9998922   .0000632    -1.71   0.088     .9997683    1.000016
                  |
            state |
               1  |   1.325352   .1630757     2.29   0.022      1.04135    1.686809
               3  |   .6594315   .1021697    -2.69   0.007     .4867297    .8934113
               4  |   1.420977   .1697072     2.94   0.003     1.124419    1.795751
               5  |   1.195475   .1691862     1.26   0.207     .9058924    1.577627
               6  |   1.225366   .1582787     1.57   0.116     .9513001     1.57839
               9  |   1.041062   .1221216     0.34   0.732     .8272302    1.310167
              10  |   1.448552   .1580896     3.40   0.001     1.169599    1.794035
              12  |   .9727295   .1539739    -0.17   0.861     .7132715    1.326567
              14  |   .6018628   .1730956    -1.77   0.077     .3425249    1.057555
              15  |   .4898527   .1419476    -2.46   0.014     .2775924    .8644173
                  |
             time |
            2004  |   1.246631   .1519598     1.81   0.071     .9817021    1.583056
            2005  |   1.300917   .2373905     1.44   0.149     .9097521    1.860272
            2006  |   1.391759     .35739     1.29   0.198     .8413636    2.302206
            2007  |   1.628959   .5583771     1.42   0.155     .8320202    3.189234
            2008  |   1.620694   .7134711     1.10   0.273     .6838806    3.840801
            2009  |   2.007101   1.034511     1.35   0.176     .7308668    5.511884
            2010  |   2.196747   1.306091     1.32   0.186     .6850031    7.044783
            2011  |   2.735417   1.881183     1.46   0.143     .7106252    10.52947
            2012  |   3.509148    2.74071     1.61   0.108     .7592724    16.21832
            2013  |   4.321178   3.648629     1.73   0.083     .8258127    22.61115
            2014  |   5.439716   5.195436     1.77   0.076     .8367571    35.36332
            2015  |   5.748445   6.154887     1.63   0.102     .7049608    46.87441
                  |
            _cons |    .000014   1.42e-06  -110.19   0.000     .0000115     .000017
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.343096   .2297965                     -2.793489   -1.892703
------------------+----------------------------------------------------------------
            alpha |   .0960298   .0220673                      .0612073     .150664
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.3.csv"', replace 
> plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.V.3.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(ho
> urs) iter(50) irr
> */
. predict cv3_yhat 
(option n assumed; predicted number of events)

. gen cv3_res = dv - cv3_yhat

. 
. summ dv cv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
    cv3_yhat |        593    6.506667     4.59499   .0817006   29.37437

. 
. pause "next"

. /*
> scatter dv cv3_yhat
> 
> pause "next"
> 
> scatter cv3_res dv
> 
> pause "next"
> 
> scatter cv3_res cv3_yhat
> */
. pause "complete: C.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.4
. 
. // poisson model
. /*
> glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl m
> ineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposur
> e(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl
>  mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(
> hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1458.7098  
Iteration 1:   log pseudolikelihood = -1454.8527  
Iteration 2:   log pseudolikelihood = -1454.8402  
Iteration 3:   log pseudolikelihood = -1454.8402  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1649.7017  
Iteration 1:   log pseudolikelihood = -1533.8155  
Iteration 2:   log pseudolikelihood = -1532.3284  
Iteration 3:   log pseudolikelihood = -1532.3223  
Iteration 4:   log pseudolikelihood = -1532.3223  

Fitting full model:

Iteration 0:   log pseudolikelihood =  -1443.754  
Iteration 1:   log pseudolikelihood = -1418.4493  
Iteration 2:   log pseudolikelihood = -1415.2584  
Iteration 3:   log pseudolikelihood =  -1415.229  
Iteration 4:   log pseudolikelihood =  -1415.229  

Negative binomial regression                    Number of obs     =        593
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood =  -1415.229               Pseudo R2         =     0.0764

                                     (Std. Err. adjusted for 55 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_c_lag_all |   1.000014   .0162007     0.00   0.999     .9687597    1.032276
    p48_c_lag_all |   1.004625   .0019372     2.39   0.017     1.000835    1.008429
    p71_c_lag_all |   .9862387   .0048348    -2.83   0.005      .976808    .9957605
    p72_c_lag_all |    .991022   .0065805    -1.36   0.174     .9782079    1.004004
    p75_c_lag_all |   1.000032   .0000126     2.57   0.010     1.000008    1.000057
    p77_c_lag_all |     .99937   .0005341    -1.18   0.238     .9983237    1.000417
        mine_time |   .8325499   .0831621    -1.83   0.067     .6845183    1.012594
onsite_insp_hours |   .9999745   .0000565    -0.45   0.652     .9998638    1.000085
                  |
            state |
               1  |   1.246377   .1338226     2.05   0.040     1.009849    1.538305
               3  |     .73248    .159876    -1.43   0.154     .4775368     1.12353
               4  |   1.439856     .17472     3.00   0.003     1.135088    1.826453
               5  |   .9917749   .1839796    -0.04   0.964     .6894625    1.426644
               6  |   1.237504    .166663     1.58   0.114     .9504072    1.611327
               9  |   1.223776   .1900749     1.30   0.194     .9025985     1.65924
              10  |   1.444579   .2030796     2.62   0.009     1.096677    1.902846
              12  |   .9236241   .1420358    -0.52   0.605     .6832768    1.248515
              14  |   .6319874   .1860556    -1.56   0.119     .3549088    1.125382
              15  |   .5009919   .1574425    -2.20   0.028     .2706018    .9275358
                  |
             time |
            2004  |   1.240285   .1455558     1.83   0.067     .9854337    1.561046
            2005  |   1.288281   .2447593     1.33   0.182     .8877515    1.869517
            2006  |    1.37723   .3848536     1.15   0.252     .7964279    2.381587
            2007  |   1.576707   .5793179     1.24   0.215     .7673621    3.239677
            2008  |   1.493064   .7000803     0.85   0.393     .5956074    3.742802
            2009  |   1.774571   .9790659     1.04   0.299     .6018226    5.232607
            2010  |   1.824426   1.165983     0.94   0.347     .5213472    6.384481
            2011  |   2.275271   1.691327     1.11   0.269     .5300186    9.767317
            2012  |   2.803419    2.35209     1.23   0.219     .5414067    14.51618
            2013  |   3.372319   3.040142     1.35   0.178     .5761975    19.73722
            2014  |   4.168168   4.288656     1.39   0.165     .5548025    31.31498
            2015  |   4.361679   5.019483     1.28   0.201      .457171    41.61297
                  |
            _cons |   .0000136   1.44e-06  -105.80   0.000      .000011    .0000167
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.386331   .2247396                     -2.826813    -1.94585
------------------+----------------------------------------------------------------
            alpha |   .0919665   .0206685                      .0592012    .1428658
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.4.csv"', replace 
> plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.V.4.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(
> hours) iter(50) irr
> */
. predict cv4_yhat 
(option n assumed; predicted number of events)

. gen cv4_res = dv - cv4_yhat

. 
. summ dv cv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
    cv4_yhat |        593    6.481629    4.427978   .0569857   27.85699

. /*
> pause "next"
> 
> scatter dv cv4_yhat
> 
> pause "next"
> 
> scatter cv4_res dv
> 
> pause "next"
> 
> scatter cv4_res cv4_yhat
> */
. pause "complete: C.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.1
. 
. // poisson model
. /*
> glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) expo
> sure(hours) iter(50) eform
>         
> quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours)
>  iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) ex
> posure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter
> (50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =  -1473.366  
Iteration 1:   log pseudolikelihood = -1469.5191  
Iteration 2:   log pseudolikelihood = -1469.5073  
Iteration 3:   log pseudolikelihood = -1469.5073  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1649.7017  
Iteration 1:   log pseudolikelihood = -1533.8155  
Iteration 2:   log pseudolikelihood = -1532.3284  
Iteration 3:   log pseudolikelihood = -1532.3223  
Iteration 4:   log pseudolikelihood = -1532.3223  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1443.8497  
Iteration 1:   log pseudolikelihood = -1421.4607  
Iteration 2:   log pseudolikelihood = -1419.6833  
Iteration 3:   log pseudolikelihood = -1419.6759  
Iteration 4:   log pseudolikelihood = -1419.6759  

Negative binomial regression                    Number of obs     =        593
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1419.6759               Pseudo R2         =     0.0735

                                     (Std. Err. adjusted for 55 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_ss |    .589382   .2421695    -1.29   0.198     .2634201    1.318696
           p48_ss |   .9572529   .0287101    -1.46   0.145      .902604    1.015211
           p71_ss |   .9340656   .0869331    -0.73   0.464     .7783168    1.120981
           p72_ss |   1.060397   .1246212     0.50   0.618      .842234    1.335072
           p75_ss |   1.002534   .0009237     2.75   0.006     1.000725    1.004346
           p77_ss |   1.011103   .0250314     0.45   0.656     .9632134    1.061373
        mine_time |   .8131998   .0710065    -2.37   0.018      .685287    .9649882
onsite_insp_hours |   .9999165   .0000598    -1.40   0.162     .9997993    1.000034
                  |
            state |
               1  |   1.250072   .1568406     1.78   0.075     .9775499    1.598569
               3  |   .6220586   .0884541    -3.34   0.001      .470754    .8219938
               4  |   1.493876   .2086929     2.87   0.004     1.136063    1.964384
               5  |   1.240418   .1846432     1.45   0.148     .9265355    1.660635
               6  |   1.228046    .158263     1.59   0.111     .9539316    1.580929
               9  |   .9577897   .1037776    -0.40   0.691     .7745358    1.184401
              10  |   1.429222   .1470508     3.47   0.001     1.168209    1.748552
              12  |   .9022443   .1315443    -0.71   0.480     .6779876    1.200678
              14  |   .5902461   .1694556    -1.84   0.066     .3362474    1.036113
              15  |    .423391   .1179803    -3.08   0.002     .2452163    .7310276
                  |
             time |
            2004  |   1.239125   .1395185     1.90   0.057     .9937443    1.545096
            2005  |   1.377869   .2489681     1.77   0.076     .9669491    1.963415
            2006  |    1.51424   .3776127     1.66   0.096     .9288099    2.468667
            2007  |   1.826373   .6245667     1.76   0.078     .9343366    3.570062
            2008  |   1.883153   .8113909     1.47   0.142     .8093376    4.381687
            2009  |   2.382432   1.191405     1.74   0.083     .8940308    6.348756
            2010  |    2.67207   1.564392     1.68   0.093     .8482086    8.417689
            2011  |   3.383961   2.251231     1.83   0.067     .9186509    12.46523
            2012  |   4.504085   3.435923     1.97   0.049     1.009882    20.08826
            2013  |   5.434973   4.434691     2.07   0.038     1.098134    26.89919
            2014  |   7.158481    6.61985     2.13   0.033     1.168603    43.85053
            2015  |   7.928316   8.327121     1.97   0.049     1.011959    62.11538
                  |
            _cons |    .000014   1.32e-06  -118.46   0.000     .0000117    .0000169
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.285854   .2166583                     -2.710496   -1.861211
------------------+----------------------------------------------------------------
            alpha |   .1016872   .0220314                      .0665038    .1554842
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.1.csv"', replac
> e plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.SSV.1.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter
> (50) irr
> */
. predict cssv1_yhat 
(option n assumed; predicted number of events)

. gen cssv1_res = dv - cssv1_yhat

. 
. summ dv cssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
  cssv1_yhat |        593    6.499225    4.509686   .0737625   29.96073

. /*
> pause "next"
> 
> scatter dv cssv1_yhat
> 
> pause "next"
> 
> scatter cssv1_res dv
> 
> pause "next"
> 
> scatter cssv1_res cssv1_yhat
> */
. pause "complete: C.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.2
. 
. // poisson model
. /*
> glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid
> ) exposure(hours) iter(50) eform
>         
> quietly poisson dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hou
> rs) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mine
> id) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours
> ) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1470.7038  
Iteration 1:   log pseudolikelihood = -1466.7748  
Iteration 2:   log pseudolikelihood = -1466.7623  
Iteration 3:   log pseudolikelihood = -1466.7623  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1649.7017  
Iteration 1:   log pseudolikelihood = -1533.8155  
Iteration 2:   log pseudolikelihood = -1532.3284  
Iteration 3:   log pseudolikelihood = -1532.3223  
Iteration 4:   log pseudolikelihood = -1532.3223  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1442.4989  
Iteration 1:   log pseudolikelihood =  -1419.401  
Iteration 2:   log pseudolikelihood = -1417.5099  
Iteration 3:   log pseudolikelihood = -1417.5018  
Iteration 4:   log pseudolikelihood = -1417.5018  

Negative binomial regression                    Number of obs     =        593
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1417.5018               Pseudo R2         =     0.0749

                                     (Std. Err. adjusted for 55 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_ss_1lag |   .6155411   .1704372    -1.75   0.080     .3577402    1.059123
      p48_ss_1lag |   .9595298   .0241572    -1.64   0.101     .9133317    1.008065
      p71_ss_1lag |   .7288796   .1381588    -1.67   0.095     .5027024    1.056819
      p72_ss_1lag |   1.175132   .1521238     1.25   0.213     .9117931    1.514526
      p75_ss_1lag |   1.002814   .0009739     2.89   0.004     1.000907    1.004724
      p77_ss_1lag |   1.005959   .0254155     0.24   0.814     .9573587    1.057026
        mine_time |   .8087703   .0719876    -2.38   0.017     .6792989    .9629184
onsite_insp_hours |   .9999129   .0000593    -1.47   0.142     .9997967    1.000029
                  |
            state |
               1  |   1.251519   .1571506     1.79   0.074     .9784843    1.600741
               3  |   .6214897    .085707    -3.45   0.001     .4742948    .8143658
               4  |   1.498382   .2164938     2.80   0.005     1.128851     1.98888
               5  |   1.259171    .191458     1.52   0.130     .9346715    1.696331
               6  |   1.235255   .1620703     1.61   0.107     .9551588    1.597488
               9  |    .953802   .1038249    -0.43   0.664     .7705517    1.180632
              10  |   1.422427   .1461032     3.43   0.001     1.163053    1.739643
              12  |    .921424   .1416495    -0.53   0.594     .6817188    1.245414
              14  |   .5886107    .173405    -1.80   0.072     .3304181    1.048558
              15  |    .418035   .1138091    -3.20   0.001     .2451743    .7127717
                  |
             time |
            2004  |   1.255516   .1400627     2.04   0.041     1.008937    1.562358
            2005  |    1.37194   .2499822     1.74   0.083     .9599249      1.9608
            2006  |   1.500871   .3850672     1.58   0.114     .9077303    2.481588
            2007  |   1.841601   .6381399     1.76   0.078     .9337759    3.632022
            2008  |   1.920528   .8454899     1.48   0.138     .8103812    4.551475
            2009  |    2.39813   1.219287     1.72   0.085     .8853079    6.496075
            2010  |   2.766369   1.654718     1.70   0.089     .8565639    8.934301
            2011  |    3.59024   2.437632     1.88   0.060     .9488358    13.58488
            2012  |   4.709334   3.663204     1.99   0.046     1.025282    21.63094
            2013  |   5.698343   4.719217     2.10   0.036     1.124102    28.88626
            2014  |   7.479819    7.07398     2.13   0.033     1.171855    47.74285
            2015  |   8.480964      9.071     2.00   0.046     1.042375    69.00276
                  |
            _cons |   .0000141   1.34e-06  -117.37   0.000     .0000117     .000017
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.298354   .2204379                     -2.730405   -1.866304
------------------+----------------------------------------------------------------
            alpha |    .100424   .0221372                      .0651929    .1546944
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.2.csv"', replac
> e plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.SSV.2.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours
> ) iter(50) irr
> */
. predict cssv2_yhat 
(option n assumed; predicted number of events)

. gen cssv2_res = dv - cssv2_yhat

. 
. summ dv cssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
  cssv2_yhat |        593    6.503872    4.554405   .0718849   34.20892

. /*
> pause "next"
> 
> scatter dv cssv2_yhat
> 
> pause "next"
> 
> scatter cssv2_res dv
> 
> pause "next"
> 
> scatter cssv2_res cssv2_yhat
> */
. pause "complete: C.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.3
. 
. // poisson model
. /*
> glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid
> ) exposure(hours) iter(50) eform
>         
> quietly poisson dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hou
> rs) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mine
> id) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours
> ) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =  -1471.247  
Iteration 1:   log pseudolikelihood = -1467.3558  
Iteration 2:   log pseudolikelihood = -1467.3436  
Iteration 3:   log pseudolikelihood = -1467.3436  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1649.7017  
Iteration 1:   log pseudolikelihood = -1533.8155  
Iteration 2:   log pseudolikelihood = -1532.3284  
Iteration 3:   log pseudolikelihood = -1532.3223  
Iteration 4:   log pseudolikelihood = -1532.3223  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1442.6827  
Iteration 1:   log pseudolikelihood =  -1419.585  
Iteration 2:   log pseudolikelihood = -1417.6457  
Iteration 3:   log pseudolikelihood = -1417.6371  
Iteration 4:   log pseudolikelihood = -1417.6371  

Negative binomial regression                    Number of obs     =        593
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1417.6371               Pseudo R2         =     0.0748

                                     (Std. Err. adjusted for 55 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_ss_c_4lag |   .7781301   .0754712    -2.59   0.010     .6434188    .9410455
    p48_ss_c_4lag |    .995615   .0088852    -0.49   0.622     .9783517    1.013183
    p71_ss_c_4lag |   .9659116   .0609916    -0.55   0.583     .8534716    1.093165
    p72_ss_c_4lag |   1.034381    .040461     0.86   0.387      .958043    1.116803
    p75_ss_c_4lag |   1.000654   .0002554     2.56   0.010     1.000154    1.001155
    p77_ss_c_4lag |   1.003968   .0085965     0.46   0.644     .9872595    1.020959
        mine_time |   .8134777   .0727498    -2.31   0.021     .6826879    .9693243
onsite_insp_hours |   .9999176   .0000586    -1.41   0.159     .9998028    1.000032
                  |
            state |
               1  |   1.232347   .1562299     1.65   0.099      .961219     1.57995
               3  |   .6184719   .0876157    -3.39   0.001     .4685271    .8164042
               4  |   1.493751   .2122366     2.82   0.005     1.130673     1.97342
               5  |   1.226366   .1863009     1.34   0.179     .9105665    1.651691
               6  |   1.230439    .159882     1.60   0.111     .9537966     1.58732
               9  |   .9469343    .103662    -0.50   0.618     .7640783    1.173551
              10  |    1.43193   .1443231     3.56   0.000     1.175249    1.744671
              12  |   .9014971   .1343698    -0.70   0.487     .6731179    1.207362
              14  |   .5911073   .1712485    -1.81   0.070     .3350167    1.042957
              15  |   .4153063   .1163977    -3.14   0.002     .2397743    .7193402
                  |
             time |
            2004  |   1.252361   .1458564     1.93   0.053      .996768    1.573493
            2005  |   1.359314   .2486745     1.68   0.093     .9497296    1.945538
            2006  |   1.487327   .3823804     1.54   0.123     .8986056     2.46175
            2007  |   1.803023    .626825     1.70   0.090     .9121768    3.563883
            2008  |   1.878228   .8358358     1.42   0.157     .7851498    4.493079
            2009  |   2.311055   1.187982     1.63   0.103     .8438322    6.329428
            2010  |   2.661046   1.601895     1.63   0.104     .8177992    8.658811
            2011  |   3.425989   2.344548     1.80   0.072     .8959278    13.10083
            2012  |   4.472068    3.49867     1.91   0.056     .9651189    20.72221
            2013  |   5.428721   4.541168     2.02   0.043     1.053563     27.9727
            2014  |   7.049153    6.70194     2.05   0.040     1.093609    45.43721
            2015  |   7.791549   8.372645     1.91   0.056     .9482863    64.01889
                  |
            _cons |    .000014   1.36e-06  -114.64   0.000     .0000115    .0000169
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.295069   .2168472                     -2.720081   -1.870056
------------------+----------------------------------------------------------------
            alpha |   .1007545   .0218483                      .0658694     .154115
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.3.csv"', replac
> e plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.SSV.3.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours
> ) iter(50) irr
> */
. predict cssv3_yhat 
(option n assumed; predicted number of events)

. gen cssv3_res = dv - cssv3_yhat

. 
. summ dv cssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
  cssv3_yhat |        593    6.505493    4.559241   .0720672   33.50047

. /*
> pause "next"
> 
> scatter dv cssv3_yhat
> 
> pause "next"
> 
> scatter cssv3_res dv
> 
> pause "next"
> 
> scatter cssv3_res cssv3_yhat
> */
. pause "complete: C.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.4
. 
. // poisson model
. /*
> glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mine
> id) exposure(hours) iter(50) eform
>         
> quietly poisson dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(h
> ours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mi
> neid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hou
> rs) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1468.5657  
Iteration 1:   log pseudolikelihood = -1464.8608  
Iteration 2:   log pseudolikelihood = -1464.8498  
Iteration 3:   log pseudolikelihood = -1464.8498  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1649.7017  
Iteration 1:   log pseudolikelihood = -1533.8155  
Iteration 2:   log pseudolikelihood = -1532.3284  
Iteration 3:   log pseudolikelihood = -1532.3223  
Iteration 4:   log pseudolikelihood = -1532.3223  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1441.4463  
Iteration 1:   log pseudolikelihood = -1417.9987  
Iteration 2:   log pseudolikelihood = -1416.1304  
Iteration 3:   log pseudolikelihood = -1416.1223  
Iteration 4:   log pseudolikelihood = -1416.1223  

Negative binomial regression                    Number of obs     =        593
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1416.1223               Pseudo R2         =     0.0758

                                     (Std. Err. adjusted for 55 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_ss_c_lag_all |   .9304515   .0223702    -3.00   0.003     .8876236    .9753457
 p48_ss_c_lag_all |   .9987188    .004116    -0.31   0.756     .9906841    1.006819
 p71_ss_c_lag_all |   .9764251   .0343175    -0.68   0.497     .9114283    1.046057
 p72_ss_c_lag_all |   1.040663   .0139844     2.97   0.003     1.013612    1.068436
 p75_ss_c_lag_all |   1.000092   .0000537     1.71   0.088     .9999865    1.000197
 p77_ss_c_lag_all |    1.00204   .0019014     1.07   0.283       .99832    1.005773
        mine_time |   .7327331   .0821165    -2.77   0.006     .5882375    .9127229
onsite_insp_hours |   .9999149   .0000575    -1.48   0.139     .9998022    1.000028
                  |
            state |
               1  |   1.211893    .157529     1.48   0.139     .9393341    1.563538
               3  |   .5414256   .0766824    -4.33   0.000     .4101877    .7146524
               4  |   1.435681    .183474     2.83   0.005     1.117579    1.844327
               5  |   1.224374   .2178063     1.14   0.255     .8639567    1.735146
               6  |   1.272527   .1735294     1.77   0.077     .9740745    1.662425
               9  |   .8654518   .1173208    -1.07   0.286     .6635198    1.128839
              10  |   1.561292   .2597191     2.68   0.007     1.126906    2.163119
              12  |   .9263088   .1570092    -0.45   0.652     .6644729    1.291321
              14  |   .5877935   .1656978    -1.89   0.059     .3382773    1.021355
              15  |   .3399491    .108492    -3.38   0.001     .1818695    .6354303
                  |
             time |
            2004  |   1.392792    .186559     2.47   0.013     1.071201    1.810928
            2005  |   1.651433   .3598842     2.30   0.021     1.077371    2.531377
            2006  |   1.965482   .6289527     2.11   0.035     1.049748    3.680043
            2007  |   2.559712   1.095896     2.20   0.028     1.106023    5.924044
            2008  |   2.891153   1.578137     1.94   0.052     .9918416    8.427518
            2009  |   3.889897   2.452953     2.15   0.031     1.130249    13.38759
            2010  |   4.576492   3.389684     2.05   0.040     1.071694    19.54316
            2011  |    6.52524   5.614513     2.18   0.029     1.208362    35.23675
            2012  |   9.383003   9.060488     2.32   0.020     1.413833    62.27098
            2013  |   12.43161   12.76153     2.46   0.014     1.662404    92.96478
            2014  |    17.7413   20.92352     2.44   0.015      1.75835    179.0052
            2015  |   20.89258   27.61179     2.30   0.021     1.566886    278.5778
                  |
            _cons |   .0000165   1.77e-06  -102.59   0.000     .0000134    .0000204
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.306352   .2091953                     -2.716367   -1.896336
------------------+----------------------------------------------------------------
            alpha |   .0996241   .0208409                      .0661145    .1501176
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.4.csv"', replac
> e plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.SSV.4.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hou
> rs) iter(50) irr
> */
. predict cssv4_yhat 
(option n assumed; predicted number of events)

. gen cssv4_res = dv - cssv4_yhat

. 
. summ dv cssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
  cssv4_yhat |        593    6.505716    4.547366   .0599543   26.58753

. /*
> pause "next"
> 
> scatter dv cssv4_yhat
> 
> pause "next"
> 
> scatter cssv4_res dv
> 
> pause "next"
> 
> scatter cssv4_res cssv4_yhat
> */
. pause "complete: C.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.1
. 
. // poisson model
. /*
> glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) v
> ce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) 
> exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log)
>  vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) ex
> posure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -927.91275  
Iteration 1:   log pseudolikelihood = -924.53437  
Iteration 2:   log pseudolikelihood = -924.51193  
Iteration 3:   log pseudolikelihood = -924.51192  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1034.4246  
Iteration 1:   log pseudolikelihood = -965.67393  
Iteration 2:   log pseudolikelihood = -965.59649  
Iteration 3:   log pseudolikelihood = -965.59647  

Fitting full model:

Iteration 0:   log pseudolikelihood = -911.60027  
Iteration 1:   log pseudolikelihood = -896.29317  
Iteration 2:   log pseudolikelihood = -894.79611  
Iteration 3:   log pseudolikelihood = -894.78683  
Iteration 4:   log pseudolikelihood = -894.78683  

Negative binomial regression                    Number of obs     =        383
                                                Wald chi2(25)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -894.78683               Pseudo R2         =     0.0733

                                     (Std. Err. adjusted for 47 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_pp |   .9970251   .0017053    -1.74   0.082     .9936883    1.000373
           p48_pp |   1.000374   .0004494     0.83   0.405     .9994934    1.001255
           p71_pp |   1.000276   .0006089     0.45   0.651     .9990831     1.00147
           p72_pp |   .9981732   .0010987    -1.66   0.097     .9960222    1.000329
           p75_pp |   1.000023   5.03e-06     4.49   0.000     1.000013    1.000032
           p77_pp |   .9999162   .0001495    -0.56   0.575     .9996233    1.000209
        mine_time |   .7319262   .0804776    -2.84   0.005     .5900312    .9079451
onsite_insp_hours |   .9998133   .0000626    -2.98   0.003     .9996906     .999936
                  |
            state |
               1  |   1.607736   .2848639     2.68   0.007     1.136047    2.275273
               3  |   .7497129   .1552313    -1.39   0.164     .4996317    1.124968
               4  |    1.37781   .1871178     2.36   0.018     1.055818    1.797999
               5  |   1.344077   .1516931     2.62   0.009     1.077351    1.676838
               6  |   1.272827   .1976585     1.55   0.120     .9388267    1.725652
               9  |   1.014646   .1338842     0.11   0.912     .7834244    1.314111
              10  |   1.501079   .1972866     3.09   0.002     1.160193    1.942124
              12  |   1.134882   .1987184     0.72   0.470     .8052017    1.599545
              14  |   .6224264   .1931873    -1.53   0.127     .3387614    1.143621
              15  |   .4420375   .0799412    -4.51   0.000     .3101143    .6300811
                  |
             time |
            2008  |   1.080829   .1695638     0.50   0.620     .7947265    1.469928
            2009  |   1.569332   .3599156     1.96   0.049     1.001147    2.459983
            2010  |   1.918083   .6249847     2.00   0.046     1.012776    3.632632
            2011  |   2.749866   1.170815     2.38   0.018     1.193697    6.334744
            2012  |   4.184787   2.247179     2.67   0.008     1.460793    11.98831
            2013  |   5.788103   3.698587     2.75   0.006     1.654322    20.25128
            2014  |   8.116398   6.031071     2.82   0.005      1.89173    34.82312
            2015  |   9.529543   8.323329     2.58   0.010     1.720333    52.78757
                  |
            _cons |   .0000409   .0000201   -20.55   0.000     .0000156    .0001073
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.264434   .2452193                     -2.745055   -1.783813
------------------+----------------------------------------------------------------
            alpha |   .1038888   .0254756                      .0642448    .1679964
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.1.csv"', replace
>  plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.PP.1.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) ex
> posure(hours) iter(50) irr
> */
. predict cpp1_yhat 
(option n assumed; predicted number of events)

. gen cpp1_res = dv - cpp1_yhat

. 
. summ dv cpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
   cpp1_yhat |        593    8.133032     6.88804   .0706426   50.89658

. /*
> pause "next"
> 
> scatter dv cpp1_yhat
> 
> pause "next"
> 
> scatter cpp1_res dv
> 
> pause "next"
> 
> scatter cpp1_res cpp1_yhat
> */
. pause "complete: C.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.2
. 
. // poisson model
. /*
> glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(
> log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mi
> neid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) lin
> k(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mine
> id) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -931.26079  
Iteration 1:   log pseudolikelihood = -927.84237  
Iteration 2:   log pseudolikelihood = -927.81795  
Iteration 3:   log pseudolikelihood = -927.81794  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1034.4246  
Iteration 1:   log pseudolikelihood = -965.67393  
Iteration 2:   log pseudolikelihood = -965.59649  
Iteration 3:   log pseudolikelihood = -965.59647  

Fitting full model:

Iteration 0:   log pseudolikelihood = -910.99177  
Iteration 1:   log pseudolikelihood = -896.04371  
Iteration 2:   log pseudolikelihood = -894.66572  
Iteration 3:   log pseudolikelihood = -894.65806  
Iteration 4:   log pseudolikelihood = -894.65806  

Negative binomial regression                    Number of obs     =        383
                                                Wald chi2(24)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -894.65806               Pseudo R2         =     0.0735

                                     (Std. Err. adjusted for 47 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_pp_1lag |   .9962423   .0012905    -2.91   0.004     .9937162    .9987749
      p48_pp_1lag |   1.000338   .0004609     0.73   0.463     .9994353    1.001242
      p71_pp_1lag |   .9993962    .000948    -0.64   0.524     .9975398    1.001256
      p72_pp_1lag |   .9982891    .001155    -1.48   0.139      .996028    1.000555
      p75_pp_1lag |   1.000022   4.98e-06     4.38   0.000     1.000012    1.000032
      p77_pp_1lag |   .9999376    .000131    -0.48   0.634     .9996808    1.000194
        mine_time |   .7337372   .0778647    -2.92   0.004     .5959508    .9033805
onsite_insp_hours |   .9998337   .0000602    -2.76   0.006     .9997158    .9999516
                  |
            state |
               1  |   1.572989   .2798916     2.55   0.011     1.109855    2.229386
               3  |   .7363668   .1479557    -1.52   0.128     .4966668     1.09175
               4  |   1.373086    .191527     2.27   0.023      1.04464    1.804799
               5  |   1.314641   .1472289     2.44   0.015     1.055553    1.637325
               6  |   1.251143   .1935362     1.45   0.147      .923925    1.694249
               9  |   1.041459   .1476264     0.29   0.774     .7888321     1.37499
              10  |   1.500397   .1976885     3.08   0.002     1.158921    1.942488
              12  |   1.097996   .1968641     0.52   0.602     .7726548    1.560329
              14  |   .6097313    .187024    -1.61   0.107     .3342319    1.112318
              15  |   .4170616    .072011    -5.06   0.000     .2973237    .5850202
                  |
             time |
            2008  |   .9936708   .1514015    -0.04   0.967     .7371375    1.339481
            2009  |    1.41431   .3157732     1.55   0.121     .9130549    2.190749
            2010  |    1.78723   .5654396     1.84   0.066     .9613451    3.322627
            2011  |   2.536328   1.038421     2.27   0.023     1.136861    5.658529
            2012  |   3.713216   1.930421     2.52   0.012     1.340383    10.28659
            2013  |   5.206006   3.177248     2.70   0.007     1.574029    17.21855
            2014  |   7.343684   5.275513     2.78   0.006     1.796523    30.01893
            2015  |   8.673674   7.345045     2.55   0.011     1.649636    45.60559
                  |
            _cons |   .0000432   .0000202   -21.48   0.000     .0000172     .000108
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.230744   .2361885                     -2.693665   -1.767823
------------------+----------------------------------------------------------------
            alpha |   .1074484   .0253781                      .0676326    .1707041
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.2.csv"', replace
>  plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.PP.2.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mine
> id) exposure(hours) iter(50) irr
> */
. predict cpp2_yhat 
(option n assumed; predicted number of events)

. gen cpp2_res = dv - cpp2_yhat

. 
. summ dv cpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
   cpp2_yhat |        593     8.41327    7.247711   .0654719   54.27106

. /*
> pause "next"
> 
> scatter dv cpp2_yhat
> 
> pause "next"
> 
> scatter cpp2_res dv
> 
> pause "next"
> 
> scatter cpp2_res cpp2_yhat
> */
. pause "complete: C.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.3
. 
. // poisson model
. /*
> glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(
> log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mi
> neid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) lin
> k(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */
. eststo clear

. eststo: nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mine
> id) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -928.61397  
Iteration 1:   log pseudolikelihood = -925.13617  
Iteration 2:   log pseudolikelihood = -925.11098  
Iteration 3:   log pseudolikelihood = -925.11097  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1034.4246  
Iteration 1:   log pseudolikelihood = -965.67393  
Iteration 2:   log pseudolikelihood = -965.59649  
Iteration 3:   log pseudolikelihood = -965.59647  

Fitting full model:

Iteration 0:   log pseudolikelihood = -910.49977  
Iteration 1:   log pseudolikelihood = -895.09789  
Iteration 2:   log pseudolikelihood =  -893.5547  
Iteration 3:   log pseudolikelihood = -893.54466  
Iteration 4:   log pseudolikelihood = -893.54466  

Negative binomial regression                    Number of obs     =        383
                                                Wald chi2(24)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -893.54466               Pseudo R2         =     0.0746

                                     (Std. Err. adjusted for 47 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_pp_c_4lag |   .9986146   .0004899    -2.83   0.005     .9976548    .9995752
    p48_pp_c_4lag |   1.000111   .0001193     0.93   0.353     .9998769    1.000345
    p71_pp_c_4lag |   .9995834   .0002788    -1.49   0.135     .9990372     1.00013
    p72_pp_c_4lag |   .9995042   .0003926    -1.26   0.207     .9987349    1.000274
    p75_pp_c_4lag |   1.000005   1.40e-06     3.80   0.000     1.000003    1.000008
    p77_pp_c_4lag |   .9999823   .0000402    -0.44   0.660     .9999036    1.000061
        mine_time |    .744318   .0783385    -2.81   0.005     .6055789    .9148425
onsite_insp_hours |    .999842   .0000577    -2.74   0.006      .999729     .999955
                  |
            state |
               1  |   1.541964   .2751232     2.43   0.015     1.086925    2.187504
               3  |   .7373166   .1453079    -1.55   0.122     .5010742     1.08494
               4  |   1.372467   .1937268     2.24   0.025     1.040766    1.809885
               5  |    1.28569   .1454596     2.22   0.026     1.029991    1.604867
               6  |   1.234291   .1944686     1.34   0.182      .906372    1.680848
               9  |   1.064021   .1562859     0.42   0.673     .7978541    1.418981
              10  |   1.486818    .190527     3.10   0.002     1.156595    1.911324
              12  |   1.070861   .1914837     0.38   0.702     .7542707    1.520333
              14  |   .6002525   .1831535    -1.67   0.094     .3300723    1.091589
              15  |   .4077657   .0704778    -5.19   0.000     .2905962    .5721784
                  |
             time |
            2008  |   .9706056    .148609    -0.19   0.846     .7189782    1.310297
            2009  |   1.352728   .3000328     1.36   0.173     .8758215    2.089323
            2010  |   1.694758   .5312326     1.68   0.092     .9168393    3.132724
            2011  |   2.352689    .953735     2.11   0.035     1.062927    5.207452
            2012  |   3.367243   1.732971     2.36   0.018     1.228001    9.233156
            2013  |   4.708698   2.841741     2.57   0.010     1.442757    15.36769
            2014  |   6.596935   4.729147     2.63   0.008     1.618606    26.88706
            2015  |   7.590235   6.352147     2.42   0.015     1.471967    39.13923
                  |
            _cons |   .0000414   .0000192   -21.73   0.000     .0000167     .000103
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.256598   .2440034                     -2.734836    -1.77836
------------------+----------------------------------------------------------------
            alpha |   .1047061   .0255486                      .0649047    .1689149
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.3.csv"', replace
>  plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.PP.3.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next" 
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mine
> id) exposure(hours) iter(50) irr
> */
. predict cpp3_yhat 
(option n assumed; predicted number of events)

. gen cpp3_res = dv - cpp3_yhat

. 
. summ dv cpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
   cpp3_yhat |        593     8.35266    7.109223   .0658856   53.07861

. /*
> pause "next"
> 
> scatter dv cpp3_yhat
> 
> pause "next"
> 
> scatter cpp3_res dv
> 
> pause "next"
> 
> scatter cpp3_res cpp3_yhat
> */
. pause "complete: C.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.4
. 
. // poisson model
. /*
> glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) lin
> k(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl 
> mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) l
> ink(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"
> */ 
. eststo clear

. eststo: nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mi
> neid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -948.08804  
Iteration 1:   log pseudolikelihood =  -944.7042  
Iteration 2:   log pseudolikelihood = -944.68295  
Iteration 3:   log pseudolikelihood = -944.68294  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1034.4246  
Iteration 1:   log pseudolikelihood = -965.67393  
Iteration 2:   log pseudolikelihood = -965.59649  
Iteration 3:   log pseudolikelihood = -965.59647  

Fitting full model:

Iteration 0:   log pseudolikelihood = -917.04344  
Iteration 1:   log pseudolikelihood = -903.65322  
Iteration 2:   log pseudolikelihood = -902.17581  
Iteration 3:   log pseudolikelihood = -902.16726  
Iteration 4:   log pseudolikelihood = -902.16726  

Negative binomial regression                    Number of obs     =        383
                                                Wald chi2(24)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -902.16726               Pseudo R2         =     0.0657

                                     (Std. Err. adjusted for 47 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_pp_c_lag_all |   .9997181    .000207    -1.36   0.173     .9993125    1.000124
 p48_pp_c_lag_all |   1.000045   .0000453     0.99   0.320     .9999563    1.000134
 p71_pp_c_lag_all |   .9998054   .0001474    -1.32   0.187     .9995166    1.000094
 p72_pp_c_lag_all |   .9998115   .0002023    -0.93   0.351     .9994151    1.000208
 p75_pp_c_lag_all |   1.000001   4.03e-07     1.76   0.079     .9999999    1.000001
 p77_pp_c_lag_all |   1.000003   .0000141     0.18   0.853     .9999749     1.00003
        mine_time |    .733537   .0921601    -2.47   0.014     .5734279    .9383508
onsite_insp_hours |   .9999299   .0000592    -1.18   0.236     .9998139    1.000046
                  |
            state |
               1  |   1.360088   .2543542     1.64   0.100     .9427165    1.962243
               3  |   .7378507   .1748328    -1.28   0.199      .463743    1.173977
               4  |   1.389386   .2180555     2.10   0.036     1.021485    1.889791
               5  |   1.000052   .1699319     0.00   1.000     .7167768     1.39528
               6  |   1.189299   .2064971     1.00   0.318     .8462476    1.671416
               9  |   1.204238   .2953811     0.76   0.449     .7446046    1.947597
              10  |   1.467878   .2226591     2.53   0.011     1.090368     1.97609
              12  |   .9220628    .188484    -0.40   0.691     .6176772    1.376447
              14  |   .6047396    .195416    -1.56   0.120     .3210041    1.139269
              15  |   .3475822   .0673159    -5.46   0.000      .237797    .5080528
                  |
             time |
            2008  |   1.073227   .1677452     0.45   0.651     .7900393    1.457921
            2009  |   1.408485   .3519018     1.37   0.170     .8631467     2.29837
            2010  |   1.621395   .5678472     1.38   0.168     .8161683    3.221053
            2011  |    2.25917   1.056366     1.74   0.081     .9035151    5.648882
            2012  |   3.098437    1.80896     1.94   0.053      .986702    9.729699
            2013  |   4.051745   2.761539     2.05   0.040     1.065346    15.40968
            2014  |   5.616981   4.602016     2.11   0.035     1.127483    27.98311
            2015  |   6.418899   6.247766     1.91   0.056     .9526924    43.24823
                  |
            _cons |   .0000452   .0000243   -18.57   0.000     .0000157    .0001298
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -2.092527   .2409961                     -2.564871   -1.620184
------------------+----------------------------------------------------------------
            alpha |   .1233749   .0297329                      .0769291    .1978624
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.4.csv"', replace
>  plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.C.PP.4.csv)

. /*
> est store nbin
> 
> pause "next"
> 
> // test for over-dispersion
> lrtest pois nbin, stats force 
> 
> pause "next"
> 
> // final model + diagnostics/assessment
> quietly nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mi
> neid) exposure(hours) iter(50) irr
> */
. predict cpp4_yhat 
(option n assumed; predicted number of events)

. gen cpp4_res = dv - cpp4_yhat

. 
. summ dv cpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        593    6.448567     5.51697          0         37
   cpp4_yhat |        593    8.778534    7.655436   .0393129   62.96907

. /*
> pause "next"
> 
> scatter dv cpp4_yhat
> 
> pause "next"
> 
> scatter cpp4_res dv
> 
> pause "next"
> 
> scatter cpp4_res cpp4_yhat
> */
. pause "complete: C.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.1
. 
. eststo clear

. eststo: logit dv_indicator `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(
> lnhours) iter(50) or

note: p71 != 0 predicts success perfectly
      p71 dropped and 38 obs not used

note: 1.state != 0 predicts success perfectly
      1.state dropped and 53 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 8 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 19 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 36 obs not used

Iteration 0:   log pseudolikelihood = -112.85999  
Iteration 1:   log pseudolikelihood = -89.107008  
Iteration 2:   log pseudolikelihood = -83.798705  
Iteration 3:   log pseudolikelihood = -83.667033  
Iteration 4:   log pseudolikelihood = -83.666608  
Iteration 5:   log pseudolikelihood = -83.666608  

Logistic regression                             Number of obs     =        439
                                                Wald chi2(25)     =     289.56
Log pseudolikelihood = -83.666608               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 43 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p47 |   .6804352   .4462847    -0.59   0.557      .188148    2.460787
              p48 |   1.205263    .211845     1.06   0.288     .8540223    1.700962
              p71 |          1  (omitted)
              p72 |   .6101564   .1864568    -1.62   0.106     .3352152    1.110603
              p75 |   1.006712   .0039833     1.69   0.091     .9989356     1.01455
              p77 |   1.007767   .0627349     0.12   0.901      .892014    1.138541
        mine_time |   .8539645   .6603238    -0.20   0.838     .1876085    3.887113
onsite_insp_hours |   1.000809     .00056     1.45   0.148     .9997123    1.001907
                  |
            state |
               1  |          1  (empty)
               3  |   .7137509   .8045805    -0.30   0.765     .0783473    6.502335
               4  |   1.429775   1.042124     0.49   0.624     .3426499    5.966024
               5  |   1.126876   .9824935     0.14   0.891     .2040497    6.223236
               6  |   .6883208   .4072451    -0.63   0.528     .2158626    2.194848
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .3524005   .2846839    -1.29   0.197     .0723436    1.716615
              15  |   .0705271   .0825187    -2.27   0.023     .0071191    .6986919
                  |
             time |
            2004  |   .2377018   .3100797    -1.10   0.271     .0184352    3.064904
            2005  |   .4249722   .7180466    -0.51   0.613     .0154933    11.65676
            2006  |   .3061684   .7248189    -0.50   0.617     .0029569    31.70177
            2007  |   .8255342   2.463318    -0.06   0.949     .0023814    286.1816
            2008  |   .3086355   1.203689    -0.30   0.763     .0001478     644.408
            2009  |   .0309369   .1375982    -0.78   0.435     5.07e-06    188.9604
            2010  |   .1258469   .6701719    -0.39   0.697     3.69e-06    4292.823
            2011  |   .1228079   .7487224    -0.34   0.731     7.94e-07    18999.56
            2012  |   .5089407    3.49507    -0.10   0.922     7.26e-07    356582.2
            2013  |   .7730524   5.764218    -0.03   0.972     3.48e-07     1718470
            2014  |   .2953839   2.435064    -0.15   0.882     2.84e-08     3072278
            2015  |   .1475661    1.34392    -0.21   0.834     2.61e-09     8338427
                  |
            _cons |   .0000864   .0000953    -8.48   0.000     9.95e-06    .0007506
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.1.csv"', replace 
> plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.V.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       439
 number of covariate patterns =       439
            Pearson chi2(413) =       424.05
                  Prob > chi2 =         0.3430

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -151.51294  
Iteration 1:   log likelihood = -92.499171  
Iteration 2:   log likelihood = -83.069664  
Iteration 3:   log likelihood = -82.601538  
Iteration 4:   log likelihood = -82.570541  
Iteration 5:   log likelihood = -82.570075  
Iteration 6:   log likelihood = -82.570075  

Logistic regression                             Number of obs     =        439
                                                LR chi2(2)        =     137.89
                                                Prob > chi2       =     0.0000
Log likelihood = -82.570075                     Pseudo R2         =     0.4550

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.389108   .2610498     5.32   0.000     .8774594    1.900756
      _hatsq |  -.0735632   .0473121    -1.55   0.120    -.1662931    .0191668
       _cons |  -.2790643   .3333918    -0.84   0.403    -.9325002    .3743716
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       389            27  |        416
     -     |         2            21  |         23
-----------+--------------------------+-----------
   Total   |       391            48  |        439

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.49%
Specificity                     Pr( -|~D)   43.75%
Positive predictive value       Pr( D| +)   93.51%
Negative predictive value       Pr(~D| -)   91.30%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   56.25%
False - rate for true D         Pr( -| D)    0.51%
False + rate for classified +   Pr(~D| +)    6.49%
False - rate for classified -   Pr( D| -)    8.70%
--------------------------------------------------
Correctly classified                        93.39%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv1_yhat 
(option pr assumed; Pr(dv_indicator))
(154 missing values generated)

. gen bv1_res = dv_indicator - bv1_yhat
(154 missing values generated)

. 
. summ dv_indicator bv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
    bv1_yhat |        439    .8906606    .1956468   .0017949   .9999989

. /*
> pause "next"
> 
> scatter dv_indicator bv1_yhat
> 
> pause "next"
> 
> scatter bv1_res dv_indicator
> 
> pause "next"
> 
> scatter bv1_res bv1_yhat
> */
. pause "complete: B.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.2
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) o
> ffset(lnhours) iter(50) or

note: 1.state != 0 predicts success perfectly
      1.state dropped and 56 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 13 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 26 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 41 obs not used

Iteration 0:   log pseudolikelihood = -113.92232  
Iteration 1:   log pseudolikelihood = -89.766571  
Iteration 2:   log pseudolikelihood = -84.563312  
Iteration 3:   log pseudolikelihood = -84.445997  
Iteration 4:   log pseudolikelihood = -84.445626  
Iteration 5:   log pseudolikelihood = -84.445626  

Logistic regression                             Number of obs     =        457
                                                Wald chi2(26)     =     444.73
Log pseudolikelihood = -84.445626               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 43 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p47_1lag |   .5246177   .2202753    -1.54   0.124     .2303787    1.194658
         p48_1lag |   1.230766   .2694735     0.95   0.343     .8013215    1.890359
         p71_1lag |   .9056725   1.833528    -0.05   0.961     .0171285    47.88759
         p72_1lag |   .6696179   .1823317    -1.47   0.141     .3926915    1.141833
         p75_1lag |   1.006712   .0043269     1.56   0.120     .9982667    1.015228
         p77_1lag |   .9796146   .0585525    -0.34   0.730     .8713209    1.101368
        mine_time |   .9164723   .6849926    -0.12   0.907      .211793    3.965766
onsite_insp_hours |   1.000865   .0006101     1.42   0.156     .9996697    1.002061
                  |
            state |
               1  |          1  (empty)
               3  |   .8111289   .8528342    -0.20   0.842     .1033053    6.368794
               4  |   1.374836   1.077972     0.41   0.685      .295697    6.392267
               5  |   1.116559   1.011211     0.12   0.903     .1892307    6.588273
               6  |   .6407088   .3958767    -0.72   0.471     .1908649    2.150776
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .3632537   .2976772    -1.24   0.217     .0728907     1.81029
              15  |   .0724751   .0828957    -2.29   0.022     .0077019    .6819895
                  |
             time |
            2004  |   .2303033   .2894797    -1.17   0.243     .0196057    2.705315
            2005  |   .3254217   .5246018    -0.70   0.486     .0138118    7.667277
            2006  |   .2565366   .5818031    -0.60   0.549     .0030109    21.85756
            2007  |   .6129738   1.787179    -0.17   0.867     .0020216    185.8641
            2008  |    .267965   1.004171    -0.35   0.725     .0001731     414.828
            2009  |    .021442   .0936513    -0.88   0.379     4.11e-06    111.9508
            2010  |   .0977648   .4948698    -0.46   0.646     4.80e-06    1989.893
            2011  |   .0708362   .4157407    -0.45   0.652     7.15e-07    7014.422
            2012  |   .2662196   1.766219    -0.20   0.842     6.00e-07    118164.9
            2013  |   .3525147   2.544263    -0.14   0.885     2.53e-07    490564.5
            2014  |   .1143845   .9042926    -0.27   0.784     2.13e-08    613386.7
            2015  |   .0669417   .5835154    -0.31   0.756     2.55e-09     1759659
                  |
            _cons |   .0000808   .0000917    -8.30   0.000     8.73e-06    .0007473
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.2.csv"', replace 
> plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.V.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       457
 number of covariate patterns =       457
            Pearson chi2(430) =       381.22
                  Prob > chi2 =         0.9562

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -153.55316  
Iteration 1:   log likelihood = -94.274058  
Iteration 2:   log likelihood = -84.124067  
Iteration 3:   log likelihood = -83.551586  
Iteration 4:   log likelihood = -83.495751  
Iteration 5:   log likelihood = -83.493976  
Iteration 6:   log likelihood = -83.493972  

Logistic regression                             Number of obs     =        457
                                                LR chi2(2)        =     140.12
                                                Prob > chi2       =     0.0000
Log likelihood = -83.493972                     Pseudo R2         =     0.4563

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.370435   .2797371     4.90   0.000       .82216    1.918709
      _hatsq |  -.0676248   .0544086    -1.24   0.214    -.1742636     .039014
       _cons |  -.2849001   .3435274    -0.83   0.407    -.9582015    .3884013
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       407            28  |        435
     -     |         2            20  |         22
-----------+--------------------------+-----------
   Total   |       409            48  |        457

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.51%
Specificity                     Pr( -|~D)   41.67%
Positive predictive value       Pr( D| +)   93.56%
Negative predictive value       Pr(~D| -)   90.91%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.33%
False - rate for true D         Pr( -| D)    0.49%
False + rate for classified +   Pr(~D| +)    6.44%
False - rate for classified -   Pr( D| -)    9.09%
--------------------------------------------------
Correctly classified                        93.44%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv2_yhat 
(option pr assumed; Pr(dv_indicator))
(136 missing values generated)

. gen bv2_res = dv_indicator - bv2_yhat
(136 missing values generated)

. 
. summ dv_indicator bv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
    bv2_yhat |        457    .8949672    .1924715   .0022386   .9999984

. /*
> pause "next"
> 
> scatter dv_indicator bv2_yhat
> 
> pause "next"
> 
> scatter bv2_res dv_indicator
> 
> pause "next"
> 
> scatter bv2_res bv2_yhat
> */
. pause "complete: B.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.3
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) o
> ffset(lnhours) iter(50) or

note: 1.state != 0 predicts success perfectly
      1.state dropped and 56 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 13 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 26 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 41 obs not used

Iteration 0:   log pseudolikelihood = -113.92232  
Iteration 1:   log pseudolikelihood = -90.024834  
Iteration 2:   log pseudolikelihood = -85.073922  
Iteration 3:   log pseudolikelihood =  -84.97922  
Iteration 4:   log pseudolikelihood = -84.978979  
Iteration 5:   log pseudolikelihood = -84.978979  

Logistic regression                             Number of obs     =        457
                                                Wald chi2(26)     =     383.68
Log pseudolikelihood = -84.978979               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 43 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p47_c_4lag |   .8230135   .1046172    -1.53   0.125     .6415148    1.055862
       p48_c_4lag |    1.07881   .0731449     1.12   0.263     .9445659    1.232133
       p71_c_4lag |    1.15751   .9068325     0.19   0.852     .2492669    5.375079
       p72_c_4lag |   .8900271    .072633    -1.43   0.153     .7584705    1.044402
       p75_c_4lag |   1.001058   .0011639     0.91   0.363     .9987792    1.003341
       p77_c_4lag |   .9943615   .0185918    -0.30   0.762     .9585819    1.031477
        mine_time |   .9514423   .7376577    -0.06   0.949     .2081813    4.348336
onsite_insp_hours |    1.00104   .0006715     1.55   0.121     .9997244    1.002356
                  |
            state |
               1  |          1  (empty)
               3  |   .7934216   .8676699    -0.21   0.832     .0930352     6.76645
               4  |   1.437738   1.164039     0.45   0.654     .2941163    7.028135
               5  |    1.10378   1.011537     0.11   0.914     .1831536    6.651954
               6  |   .6669344   .3963584    -0.68   0.496     .2080726    2.137722
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .3030439   .2629077    -1.38   0.169     .0553401    1.659476
              15  |   .0744119    .084821    -2.28   0.023     .0079684    .6948875
                  |
             time |
            2004  |   .2067438   .2627701    -1.24   0.215     .0171222    2.496344
            2005  |   .2925639   .4941785    -0.73   0.467     .0106765    8.016984
            2006  |    .242129   .5652153    -0.61   0.543     .0024948    23.49927
            2007  |   .5494836   1.644247    -0.20   0.841     .0015591     193.663
            2008  |   .2146362   .8333992    -0.40   0.692     .0001063    433.2989
            2009  |   .0165402   .0753836    -0.90   0.368     2.18e-06    125.3067
            2010  |   .0664586   .3483511    -0.52   0.605     2.30e-06    1924.107
            2011  |    .048504   .2942973    -0.50   0.618     3.32e-07    7086.426
            2012  |   .1729851   1.189724    -0.26   0.799     2.42e-07    123663.3
            2013  |   .2147634    1.60542    -0.21   0.837     9.31e-08    495382.7
            2014  |   .0732052   .5995597    -0.32   0.750     7.82e-09    685467.1
            2015  |   .0391536   .3547901    -0.36   0.721     7.58e-10     2022676
                  |
            _cons |   .0000844   .0001017    -7.78   0.000     7.95e-06    .0008962
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.3.csv"', replace 
> plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.V.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       457
 number of covariate patterns =       457
            Pearson chi2(430) =       379.86
                  Prob > chi2 =         0.9606

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -153.55316  
Iteration 1:   log likelihood =  -94.14122  
Iteration 2:   log likelihood = -84.665766  
Iteration 3:   log likelihood = -84.111587  
Iteration 4:   log likelihood = -84.059532  
Iteration 5:   log likelihood = -84.058475  
Iteration 6:   log likelihood = -84.058475  

Logistic regression                             Number of obs     =        457
                                                LR chi2(2)        =     138.99
                                                Prob > chi2       =     0.0000
Log likelihood = -84.058475                     Pseudo R2         =     0.4526

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.368488   .2905472     4.71   0.000     .7990261     1.93795
      _hatsq |  -.0671689   .0589285    -1.14   0.254    -.1826666    .0483289
       _cons |  -.2853756   .3449371    -0.83   0.408      -.96144    .3906887
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       406            28  |        434
     -     |         3            20  |         23
-----------+--------------------------+-----------
   Total   |       409            48  |        457

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.27%
Specificity                     Pr( -|~D)   41.67%
Positive predictive value       Pr( D| +)   93.55%
Negative predictive value       Pr(~D| -)   86.96%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.33%
False - rate for true D         Pr( -| D)    0.73%
False + rate for classified +   Pr(~D| +)    6.45%
False - rate for classified -   Pr( D| -)   13.04%
--------------------------------------------------
Correctly classified                        93.22%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv3_yhat 
(option pr assumed; Pr(dv_indicator))
(136 missing values generated)

. gen bv3_res = dv_indicator - bv3_yhat
(136 missing values generated)

. 
. summ dv_indicator bv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
    bv3_yhat |        457    .8949672    .1917103   .0027723    .999998

. /*
> pause "next"
> 
> scatter dv_indicator bv3_yhat
> 
> pause "next"
> 
> scatter bv3_res dv_indicator
> 
> pause "next"
> 
> scatter bv3_res bv3_yhat
> */
. pause "complete: B.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.4
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid)
>  offset(lnhours) iter(50) or

note: 1.state != 0 predicts success perfectly
      1.state dropped and 56 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 13 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 26 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 41 obs not used

Iteration 0:   log pseudolikelihood = -113.92232  
Iteration 1:   log pseudolikelihood = -89.498282  
Iteration 2:   log pseudolikelihood = -83.610177  
Iteration 3:   log pseudolikelihood = -83.418172  
Iteration 4:   log pseudolikelihood = -83.417194  
Iteration 5:   log pseudolikelihood = -83.417194  

Logistic regression                             Number of obs     =        457
                                                Wald chi2(26)     =     421.68
Log pseudolikelihood = -83.417194               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 43 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_c_lag_all |   .8987407   .0558365    -1.72   0.086     .7957038     1.01512
    p48_c_lag_all |   1.035928   .0165027     2.22   0.027     1.004083    1.068783
    p71_c_lag_all |   .9197764     .14425    -0.53   0.594     .6763741     1.25077
    p72_c_lag_all |   .9713784   .0364835    -0.77   0.439     .9024404    1.045582
    p75_c_lag_all |   1.000048   .0000706     0.68   0.495     .9999098    1.000187
    p77_c_lag_all |   .9982011   .0021063    -0.85   0.394     .9940813    1.002338
        mine_time |   1.659135    1.63715     0.51   0.608     .2398607    11.47636
onsite_insp_hours |   1.001436   .0005746     2.50   0.012      1.00031    1.002563
                  |
            state |
               1  |          1  (empty)
               3  |   .5368343   .5422452    -0.62   0.538     .0741411    3.887061
               4  |   1.659276   2.256551     0.37   0.710     .1154298    23.85172
               5  |   .3583126   .2788957    -1.32   0.187     .0779331    1.647412
               6  |   .4804522   .3357564    -1.05   0.294     .1221241    1.890162
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .2013428   .1605485    -2.01   0.044     .0421888    .9608924
              15  |   .0565673   .0638251    -2.55   0.011     .0061966    .5163916
                  |
             time |
            2004  |   .1153154   .1677133    -1.49   0.137     .0066667    1.994638
            2005  |   .0771247   .1560925    -1.27   0.205     .0014603    4.073228
            2006  |   .0386229   .1125674    -1.12   0.264     .0001276    11.68673
            2007  |   .0521006   .1910929    -0.81   0.421     .0000393    69.00071
            2008  |   .0104199   .0507339    -0.94   0.349     7.47e-07    145.3122
            2009  |   .0005613   .0032118    -1.31   0.191     7.57e-09    41.64027
            2010  |   .0010725    .007346    -1.00   0.318     1.58e-09    725.8437
            2011  |   .0004733   .0036731    -0.99   0.324     1.17e-10     1909.03
            2012  |   .0008209   .0072191    -0.81   0.419     2.69e-11     25090.3
            2013  |   .0007029   .0068789    -0.74   0.458     3.28e-12    150449.2
            2014  |   .0000932   .0009738    -0.89   0.375     1.18e-13    73291.25
            2015  |    .000035   .0004105    -0.87   0.382     3.63e-15    337286.7
                  |
            _cons |   .0000636   .0000905    -6.79   0.000     3.92e-06     .001033
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.4.csv"', replace 
> plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.V.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       457
 number of covariate patterns =       457
            Pearson chi2(430) =       367.50
                  Prob > chi2 =         0.9868

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -153.55316  
Iteration 1:   log likelihood = -92.254199  
Iteration 2:   log likelihood = -82.973517  
Iteration 3:   log likelihood = -82.457045  
Iteration 4:   log likelihood = -82.412379  
Iteration 5:   log likelihood = -82.411812  
Iteration 6:   log likelihood = -82.411812  

Logistic regression                             Number of obs     =        457
                                                LR chi2(2)        =     142.28
                                                Prob > chi2       =     0.0000
Log likelihood = -82.411812                     Pseudo R2         =     0.4633

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.386784   .2844003     4.88   0.000     .8293702    1.944199
      _hatsq |  -.0735581    .054758    -1.34   0.179    -.1808819    .0337656
       _cons |  -.2690764   .3339631    -0.81   0.420     -.923632    .3854793
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       407            26  |        433
     -     |         2            22  |         24
-----------+--------------------------+-----------
   Total   |       409            48  |        457

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.51%
Specificity                     Pr( -|~D)   45.83%
Positive predictive value       Pr( D| +)   94.00%
Negative predictive value       Pr(~D| -)   91.67%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   54.17%
False - rate for true D         Pr( -| D)    0.49%
False + rate for classified +   Pr(~D| +)    6.00%
False - rate for classified -   Pr( D| -)    8.33%
--------------------------------------------------
Correctly classified                        93.87%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv4_yhat 
(option pr assumed; Pr(dv_indicator))
(136 missing values generated)

. gen bv4_res = dv_indicator - bv4_yhat
(136 missing values generated)

. 
. summ dv_indicator bv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
    bv4_yhat |        457    .8949672    .1939245   .0026247   .9999965

. /*
> pause "next"
> 
> scatter dv_indicator bv4_yhat
> 
> pause "next"
> 
> scatter bv4_res dv_indicator
> 
> pause "next"
> 
> scatter bv4_res bv4_yhat
> */
. pause "complete: B.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.1
. 
. eststo clear

. eststo: logit dv_indicator `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnh
> ours) iter(50) or

note: p71_ss != 0 predicts success perfectly
      p71_ss dropped and 6 obs not used

note: 1.state != 0 predicts success perfectly
      1.state dropped and 55 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 13 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 26 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 39 obs not used

Iteration 0:   log pseudolikelihood = -113.75926  
Iteration 1:   log pseudolikelihood = -91.343753  
Iteration 2:   log pseudolikelihood = -86.288921  
Iteration 3:   log pseudolikelihood = -86.071845  
Iteration 4:   log pseudolikelihood = -86.070543  
Iteration 5:   log pseudolikelihood = -86.070543  

Logistic regression                             Number of obs     =        454
                                                Wald chi2(25)     =     310.60
Log pseudolikelihood = -86.070543               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 43 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_ss |   .4783787   1.143649    -0.31   0.758     .0044139    51.84655
           p48_ss |   .9247888   .2953011    -0.24   0.807     .4945829    1.729203
           p71_ss |          1  (omitted)
           p72_ss |   .6810806   .4082135    -0.64   0.522     .2103881    2.204834
           p75_ss |   1.022874   .0152129     1.52   0.128     .9934879     1.05313
           p77_ss |   .7760872   .2033433    -0.97   0.333     .4643939    1.296984
        mine_time |   .8610167   .6114976    -0.21   0.833      .214035    3.463685
onsite_insp_hours |   1.001025   .0004793     2.14   0.032     1.000086    1.001965
                  |
            state |
               1  |          1  (empty)
               3  |   .7669561   .7499637    -0.27   0.786     .1128308    5.213305
               4  |   1.374051   1.091958     0.40   0.689     .2894363    6.523076
               5  |   1.201582   1.076817     0.20   0.838     .2074607    6.959389
               6  |   .6187588   .3989494    -0.74   0.457     .1748649    2.189475
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .3788221   .3081268    -1.19   0.233     .0769279    1.865464
              15  |   .0651191   .0729487    -2.44   0.015     .0072471    .5851323
                  |
             time |
            2004  |    .224044   .2773046    -1.21   0.227     .0198053    2.534461
            2005  |   .3231456   .5111341    -0.71   0.475     .0145551    7.174347
            2006  |   .2452966   .5362655    -0.64   0.520     .0033791    17.80663
            2007  |   .8011345    2.18107    -0.08   0.935     .0038577    166.3727
            2008  |   .3037134   1.095293    -0.33   0.741     .0002587    356.6016
            2009  |   .0393158   .1615915    -0.79   0.431     .0000125    123.9026
            2010  |   .1640867   .7976129    -0.37   0.710      .000012    2252.671
            2011  |   .1237659   .6943137    -0.37   0.710     2.08e-06    7374.841
            2012  |   .4762648   3.018847    -0.12   0.907     1.92e-06    118376.7
            2013  |   .6379047   4.425261    -0.06   0.948     7.94e-07    512503.3
            2014  |   .2024543   1.506769    -0.21   0.830     9.36e-08    437933.6
            2015  |   .1379664   1.153941    -0.24   0.813     1.05e-08     1816187
                  |
            _cons |   .0000901   .0001001    -8.38   0.000     .0000102     .000796
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.1.csv"', replac
> e plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.SSV.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       454
 number of covariate patterns =       454
            Pearson chi2(428) =       496.40
                  Prob > chi2 =         0.0123

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood =  -153.2191  
Iteration 1:   log likelihood = -94.206167  
Iteration 2:   log likelihood = -85.055322  
Iteration 3:   log likelihood = -84.575109  
Iteration 4:   log likelihood = -84.557888  
Iteration 5:   log likelihood = -84.557745  
Iteration 6:   log likelihood = -84.557745  

Logistic regression                             Number of obs     =        454
                                                LR chi2(2)        =     137.32
                                                Prob > chi2       =     0.0000
Log likelihood = -84.557745                     Pseudo R2         =     0.4481

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.483146   .2764602     5.36   0.000      .941294    2.024998
      _hatsq |  -.0893939   .0468459    -1.91   0.056    -.1812102    .0024224
       _cons |  -.3709222   .3513942    -1.06   0.291    -1.059642    .3177978
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       404            28  |        432
     -     |         2            20  |         22
-----------+--------------------------+-----------
   Total   |       406            48  |        454

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.51%
Specificity                     Pr( -|~D)   41.67%
Positive predictive value       Pr( D| +)   93.52%
Negative predictive value       Pr(~D| -)   90.91%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.33%
False - rate for true D         Pr( -| D)    0.49%
False + rate for classified +   Pr(~D| +)    6.48%
False - rate for classified -   Pr( D| -)    9.09%
--------------------------------------------------
Correctly classified                        93.39%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv1_yhat 
(option pr assumed; Pr(dv_indicator))
(139 missing values generated)

. gen bssv1_res = dv_indicator - bssv1_yhat
(139 missing values generated)

. 
. summ dv_indicator bssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
  bssv1_yhat |        454    .8942731    .1886434   .0037265   .9999963

. /*
> pause "next"
> 
> scatter dv_indicator bssv1_yhat
> 
> pause "next"
> 
> scatter bssv1_res dv_indicator
> 
> pause "next"
> 
> scatter bssv1_res bssv1_yhat
> */
. pause "complete: B.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.2
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offs
> et(lnhours) iter(50) or

note: 1.state != 0 predicts success perfectly
      1.state dropped and 56 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 13 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 26 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 41 obs not used

Iteration 0:   log pseudolikelihood = -113.92232  
Iteration 1:   log pseudolikelihood = -92.852688  
Iteration 2:   log pseudolikelihood = -85.527487  
Iteration 3:   log pseudolikelihood = -84.475468  
Iteration 4:   log pseudolikelihood = -83.284614  
Iteration 5:   log pseudolikelihood = -83.233264  
Iteration 6:   log pseudolikelihood = -83.233054  
Iteration 7:   log pseudolikelihood = -83.233054  

Logistic regression                             Number of obs     =        457
                                                Wald chi2(26)     =     716.90
Log pseudolikelihood = -83.233054               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 43 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_ss_1lag |   .8544303   1.172652    -0.11   0.909     .0580037    12.58629
      p48_ss_1lag |   1.467757   .7451786     0.76   0.450     .5426251    3.970162
      p71_ss_1lag |   .0544515   .0649038    -2.44   0.015     .0052652    .5631247
      p72_ss_1lag |   .7155359   .3617446    -0.66   0.508      .265644     1.92736
      p75_ss_1lag |   1.028003   .0139274     2.04   0.041     1.001065    1.055666
      p77_ss_1lag |   .7273495    .149246    -1.55   0.121     .4865011    1.087433
        mine_time |   .9404176   .7077986    -0.08   0.935     .2151146    4.111228
onsite_insp_hours |    1.00111   .0004777     2.32   0.020     1.000174    1.002047
                  |
            state |
               1  |          1  (empty)
               3  |   .8182288   .8485438    -0.19   0.847     .1071856    6.246158
               4  |   1.651142   1.539922     0.54   0.591     .2654112    10.27188
               5  |   1.073745   1.033976     0.07   0.941     .1626398     7.08885
               6  |    .552443   .3836277    -0.85   0.393     .1416432    2.154662
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |    .330721   .2762611    -1.32   0.185     .0643321    1.700184
              15  |   .0515456   .0566972    -2.70   0.007     .0059693    .4451061
                  |
             time |
            2004  |   .2067621   .2696667    -1.21   0.227     .0160436    2.664644
            2005  |   .2502345   .4135872    -0.84   0.402     .0098058    6.385748
            2006  |    .177143   .4120349    -0.74   0.457     .0018554      16.913
            2007  |   .4520372   1.286247    -0.28   0.780     .0017105    119.4596
            2008  |   .1711766   .6604677    -0.46   0.647      .000089     329.397
            2009  |   .0194928   .0852538    -0.90   0.368     3.69e-06    102.9649
            2010  |   .0728749   .3777944    -0.51   0.613     2.82e-06    1885.099
            2011  |   .0562924   .3351545    -0.48   0.629     4.81e-07    6581.767
            2012  |   .1869819   1.254216    -0.25   0.803     3.65e-07    95805.31
            2013  |   .2217242   1.620201    -0.21   0.837     1.34e-07    367942.4
            2014  |   .0620369   .4919341    -0.35   0.726     1.10e-08    348674.5
            2015  |   .0364659   .3235194    -0.37   0.709     1.02e-09     1298967
                  |
            _cons |   .0000835    .000101    -7.77   0.000     7.80e-06    .0008933
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.2.csv"', replac
> e plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.SSV.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       457
 number of covariate patterns =       457
            Pearson chi2(430) =       466.16
                  Prob > chi2 =         0.1107

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -153.55316  
Iteration 1:   log likelihood = -92.984772  
Iteration 2:   log likelihood = -82.427763  
Iteration 3:   log likelihood = -81.853596  
Iteration 4:   log likelihood = -81.814778  
Iteration 5:   log likelihood = -81.814354  
Iteration 6:   log likelihood = -81.814354  

Logistic regression                             Number of obs     =        457
                                                LR chi2(2)        =     143.48
                                                Prob > chi2       =     0.0000
Log likelihood = -81.814354                     Pseudo R2         =     0.4672

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.451372   .2645556     5.49   0.000     .9328524    1.969891
      _hatsq |  -.0812641   .0415827    -1.95   0.051    -.1627646    .0002365
       _cons |  -.3450049   .3457459    -1.00   0.318    -1.022654    .3326446
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       407            28  |        435
     -     |         2            20  |         22
-----------+--------------------------+-----------
   Total   |       409            48  |        457

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.51%
Specificity                     Pr( -|~D)   41.67%
Positive predictive value       Pr( D| +)   93.56%
Negative predictive value       Pr(~D| -)   90.91%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.33%
False - rate for true D         Pr( -| D)    0.49%
False + rate for classified +   Pr(~D| +)    6.44%
False - rate for classified -   Pr( D| -)    9.09%
--------------------------------------------------
Correctly classified                        93.44%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv2_yhat 
(option pr assumed; Pr(dv_indicator))
(136 missing values generated)

. gen bssv2_res = dv_indicator - bssv2_yhat
(136 missing values generated)

. 
. summ dv_indicator bssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
  bssv2_yhat |        457    .8949672    .1924724   .0027446   .9999979

. /*
> pause "next"
> 
> scatter dv_indicator bssv2_yhat
> 
> pause "next"
> 
> scatter bssv2_res dv_indicator
> 
> pause "next"
> 
> scatter bssv2_res bssv2_yhat
> */
. pause "complete: B.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.3
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offs
> et(lnhours) iter(50) or

note: 1.state != 0 predicts success perfectly
      1.state dropped and 56 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 13 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 26 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 41 obs not used

Iteration 0:   log pseudolikelihood = -113.92232  
Iteration 1:   log pseudolikelihood = -92.314879  
Iteration 2:   log pseudolikelihood = -85.738768  
Iteration 3:   log pseudolikelihood = -84.955782  
Iteration 4:   log pseudolikelihood = -84.850559  
Iteration 5:   log pseudolikelihood = -84.850344  
Iteration 6:   log pseudolikelihood = -84.850344  

Logistic regression                             Number of obs     =        457
                                                Wald chi2(26)     =     359.49
Log pseudolikelihood = -84.850344               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 43 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_ss_c_4lag |   1.106432   .5495575     0.20   0.839     .4179635    2.928943
    p48_ss_c_4lag |    1.14166    .169287     0.89   0.372      .853728    1.526702
    p71_ss_c_4lag |   .4197364   .1735931    -2.10   0.036     .1866121    .9440905
    p72_ss_c_4lag |   1.222244   .3261672     0.75   0.452     .7244478    2.062097
    p75_ss_c_4lag |   1.003901   .0037304     1.05   0.295     .9966161    1.011239
    p77_ss_c_4lag |   .9279402   .0612081    -1.13   0.257     .8154056    1.056006
        mine_time |   .8107376   .6579821    -0.26   0.796     .1652184    3.978344
onsite_insp_hours |   1.001263    .000529     2.39   0.017     1.000227    1.002301
                  |
            state |
               1  |          1  (empty)
               3  |     .61278   .6834496    -0.44   0.661     .0688553    5.453458
               4  |   1.242346   1.192908     0.23   0.821     .1891969    8.157763
               5  |   .9569486   .9463619    -0.04   0.965     .1377539    6.647729
               6  |   .5117194   .3619092    -0.95   0.343      .127946    2.046619
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .2397041    .220342    -1.55   0.120     .0395576    1.452517
              15  |   .0425918   .0483539    -2.78   0.005     .0046022    .3941698
                  |
             time |
            2004  |   .2605031   .3468409    -1.01   0.312     .0191646    3.540997
            2005  |   .2656862   .4497744    -0.78   0.434     .0096247    7.334149
            2006  |   .2749324   .6691284    -0.53   0.596     .0023312    32.42455
            2007  |    .899922    2.78455    -0.03   0.973     .0020913    387.2605
            2008  |   .3344659   1.378412    -0.27   0.790     .0001038    1077.339
            2009  |   .0456415   .2140982    -0.66   0.510     4.64e-06    448.9823
            2010  |   .1824437   1.003046    -0.31   0.757     3.81e-06    8727.622
            2011  |   .1505576   .9581202    -0.30   0.766     5.77e-07    39317.87
            2012  |   .6067979   4.354519    -0.07   0.945     4.73e-07    778858.6
            2013  |   .8202973   6.419086    -0.03   0.980     1.79e-07     3757444
            2014  |   .2795703   2.367451    -0.15   0.880     1.73e-08     4514561
            2015  |   .1847813   1.748179    -0.18   0.858     1.64e-09    2.09e+07
                  |
            _cons |   .0001213   .0001546    -7.08   0.000     9.99e-06    .0014741
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.3.csv"', replac
> e plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.SSV.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       457
 number of covariate patterns =       457
            Pearson chi2(430) =       511.45
                  Prob > chi2 =         0.0041

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -153.55316  
Iteration 1:   log likelihood = -93.052481  
Iteration 2:   log likelihood = -83.912729  
Iteration 3:   log likelihood = -83.484427  
Iteration 4:   log likelihood = -83.460578  
Iteration 5:   log likelihood = -83.460184  
Iteration 6:   log likelihood = -83.460184  

Logistic regression                             Number of obs     =        457
                                                LR chi2(2)        =     140.19
                                                Prob > chi2       =     0.0000
Log likelihood = -83.460184                     Pseudo R2         =     0.4565

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.469535   .2791133     5.27   0.000     .9224827    2.016587
      _hatsq |  -.0856956   .0470558    -1.82   0.069    -.1779232     .006532
       _cons |  -.3623396    .352364    -1.03   0.304     -1.05296    .3282811
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       408            27  |        435
     -     |         1            21  |         22
-----------+--------------------------+-----------
   Total   |       409            48  |        457

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.76%
Specificity                     Pr( -|~D)   43.75%
Positive predictive value       Pr( D| +)   93.79%
Negative predictive value       Pr(~D| -)   95.45%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   56.25%
False - rate for true D         Pr( -| D)    0.24%
False + rate for classified +   Pr(~D| +)    6.21%
False - rate for classified -   Pr( D| -)    4.55%
--------------------------------------------------
Correctly classified                        93.87%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv3_yhat 
(option pr assumed; Pr(dv_indicator))
(136 missing values generated)

. gen bssv3_res = dv_indicator - bssv3_yhat
(136 missing values generated)

. 
. summ dv_indicator bssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
  bssv3_yhat |        457    .8949672    .1904107    .002665    .999997

. /*
> pause "next"
> 
> scatter dv_indicator bssv3_yhat
> 
> pause "next"
> 
> scatter bssv3_res dv_indicator
> 
> pause "next"
> 
> scatter bssv3_res bssv3_yhat
> */
. pause "complete: B.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.4
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) of
> fset(lnhours) iter(50) or

note: 1.state != 0 predicts success perfectly
      1.state dropped and 56 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 13 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 26 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 41 obs not used

Iteration 0:   log pseudolikelihood = -113.92232  
Iteration 1:   log pseudolikelihood = -90.925638  
Iteration 2:   log pseudolikelihood = -86.642997  
Iteration 3:   log pseudolikelihood = -86.543753  
Iteration 4:   log pseudolikelihood = -86.543655  
Iteration 5:   log pseudolikelihood = -86.543655  

Logistic regression                             Number of obs     =        457
                                                Wald chi2(26)     =     772.51
Log pseudolikelihood = -86.543655               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 43 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_ss_c_lag_all |   .8431981   .2124197    -0.68   0.498     .5146283    1.381547
 p48_ss_c_lag_all |   1.011102   .0340422     0.33   0.743     .9465342    1.080074
 p71_ss_c_lag_all |   .8094929   .3442426    -0.50   0.619     .3517496    1.862913
 p72_ss_c_lag_all |   1.051308   .1334919     0.39   0.694     .8196845    1.348382
 p75_ss_c_lag_all |   1.000329   .0002365     1.39   0.164     .9998656    1.000793
 p77_ss_c_lag_all |   1.001573   .0144389     0.11   0.913     .9736691    1.030276
        mine_time |   .7154249   .6395231    -0.37   0.708     .1240707    4.125331
onsite_insp_hours |   1.001149   .0004724     2.43   0.015     1.000224    1.002076
                  |
            state |
               1  |          1  (empty)
               3  |   .4504373   .4826901    -0.74   0.457     .0551422    3.679466
               4  |   1.237246   1.404457     0.19   0.851     .1337262     11.4471
               5  |   .7445568   .8333485    -0.26   0.792     .0830208    6.677424
               6  |   .5164456   .4082056    -0.84   0.403     .1097042    2.431228
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .2892843   .2703642    -1.33   0.184     .0463228    1.806571
              15  |   .0377705   .0422461    -2.93   0.003     .0042178    .3382329
                  |
             time |
            2004  |   .2469376   .3278424    -1.05   0.292     .0183022    3.331733
            2005  |   .3226449   .5834869    -0.63   0.532      .009319    11.17068
            2006  |   .4215484   1.093219    -0.33   0.739     .0026145    67.96801
            2007  |   1.203868   3.967129     0.06   0.955     .0018862    768.3513
            2008  |   .6269644    2.75326    -0.11   0.915     .0001146    3429.421
            2009  |   .0874774   .4498509    -0.47   0.636     3.67e-06    2085.378
            2010  |   .3529202   2.135096    -0.17   0.863     2.50e-06    49804.95
            2011  |   .3480731   2.431839    -0.15   0.880     3.93e-07    308072.9
            2012  |   1.308062   10.30561     0.03   0.973     2.57e-07     6650402
            2013  |   2.102768    18.0252     0.09   0.931     1.06e-07    4.16e+07
            2014  |   .8080581   7.523211    -0.02   0.982     9.61e-09    6.80e+07
            2015  |   .6960537   7.270281    -0.03   0.972     8.95e-10    5.41e+08
                  |
            _cons |   .0001744   .0002344    -6.44   0.000     .0000125    .0024308
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.4.csv"', replac
> e plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.SSV.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       457
 number of covariate patterns =       457
            Pearson chi2(430) =       429.62
                  Prob > chi2 =         0.4961

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -153.55316  
Iteration 1:   log likelihood = -93.332156  
Iteration 2:   log likelihood = -85.785887  
Iteration 3:   log likelihood = -85.406158  
Iteration 4:   log likelihood = -85.383914  
Iteration 5:   log likelihood = -85.383821  
Iteration 6:   log likelihood = -85.383821  

Logistic regression                             Number of obs     =        457
                                                LR chi2(2)        =     136.34
                                                Prob > chi2       =     0.0000
Log likelihood = -85.383821                     Pseudo R2         =     0.4439

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.445545   .3131758     4.62   0.000     .8317319    2.059358
      _hatsq |  -.0821783   .0638165    -1.29   0.198    -.2072563    .0428997
       _cons |  -.3471822   .3542788    -0.98   0.327    -1.041556    .3471915
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       407            27  |        434
     -     |         2            21  |         23
-----------+--------------------------+-----------
   Total   |       409            48  |        457

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.51%
Specificity                     Pr( -|~D)   43.75%
Positive predictive value       Pr( D| +)   93.78%
Negative predictive value       Pr(~D| -)   91.30%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   56.25%
False - rate for true D         Pr( -| D)    0.49%
False + rate for classified +   Pr(~D| +)    6.22%
False - rate for classified -   Pr( D| -)    8.70%
--------------------------------------------------
Correctly classified                        93.65%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv4_yhat 
(option pr assumed; Pr(dv_indicator))
(136 missing values generated)

. gen bssv4_res = dv_indicator - bssv4_yhat
(136 missing values generated)

. 
. summ dv_indicator bssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
  bssv4_yhat |        457    .8949672    .1884061   .0035572   .9999819

. /*
> pause "next"
> 
> scatter dv_indicator bssv4_yhat
> 
> pause "next"
> 
> scatter bssv4_res dv_indicator
> 
> pause "next"
> 
> scatter bssv4_res bssv4_yhat
> */
. pause "complete: B.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.1
. 
. eststo clear

. eststo: logit dv_indicator `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl 
> mineid) offset(lnhours) iter(50) or

note: p71_pp != 0 predicts success perfectly
      p71_pp dropped and 27 obs not used

note: 1.state != 0 predicts success perfectly
      1.state dropped and 35 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 9 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 4 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 14 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 24 obs not used

Iteration 0:   log pseudolikelihood =  -83.14752  
Iteration 1:   log pseudolikelihood = -67.160258  
Iteration 2:   log pseudolikelihood = -63.941393  
Iteration 3:   log pseudolikelihood = -63.856862  
Iteration 4:   log pseudolikelihood = -63.856652  
Iteration 5:   log pseudolikelihood = -63.856652  

Logistic regression                             Number of obs     =        270
                                                Wald chi2(20)     =     326.87
Log pseudolikelihood = -63.856652               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 36 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_pp |   .9931462   .0105548    -0.65   0.518     .9726731     1.01405
           p48_pp |   1.001212   .0035069     0.35   0.729     .9943626    1.008109
           p71_pp |          1  (omitted)
           p72_pp |   .9919899   .0059584    -1.34   0.181     .9803802    1.003737
           p75_pp |   1.000101   .0000611     1.65   0.098     .9999814    1.000221
           p77_pp |   .9994569   .0011085    -0.49   0.624     .9972866    1.001632
        mine_time |    .152023   .1033224    -2.77   0.006     .0401227     .576008
onsite_insp_hours |   1.000636   .0004496     1.42   0.157     .9997555    1.001518
                  |
            state |
               1  |          1  (empty)
               3  |   .4393072   .4319141    -0.84   0.403     .0639575    3.017484
               4  |   .5390775   .4286503    -0.78   0.437     .1134525    2.561466
               5  |          1  (empty)
               6  |    .599473    .398762    -0.77   0.442      .162765    2.207895
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .5778257   .5459855    -0.58   0.562     .0906775    3.682089
              15  |   .1520936   .1797826    -1.59   0.111      .014995    1.542679
                  |
             time |
            2008  |   2.553363   4.008602     0.60   0.550     .1177025    55.39105
            2009  |   1.561134   2.839329     0.24   0.807     .0441883    55.15341
            2010  |   35.03807   88.75227     1.40   0.160     .2445829    5019.427
            2011  |    203.748   619.5253     1.75   0.080      .525887    78939.52
            2012  |   4353.483   15646.39     2.33   0.020     3.798603     4989416
            2013  |   36908.47   151832.3     2.56   0.011     11.62772    1.17e+08
            2014  |   102421.3   512727.4     2.30   0.021     5.613352    1.87e+09
            2015  |   261970.7    1465485     2.23   0.026     4.534871    1.51e+10
                  |
            _cons |   .3725164     1.2873    -0.29   0.775     .0004262    325.5606
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.1.csv"', replace
>  plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.PP.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       270
 number of covariate patterns =       270
            Pearson chi2(249) =       186.52
                  Prob > chi2 =         0.9988

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -106.02211  
Iteration 1:   log likelihood = -68.914244  
Iteration 2:   log likelihood = -64.393128  
Iteration 3:   log likelihood = -63.828346  
Iteration 4:   log likelihood = -63.694381  
Iteration 5:   log likelihood = -63.692085  
Iteration 6:   log likelihood = -63.692083  

Logistic regression                             Number of obs     =        270
                                                LR chi2(2)        =      84.66
                                                Prob > chi2       =     0.0000
Log likelihood = -63.692083                     Pseudo R2         =     0.3993

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.149763   .2950463     3.90   0.000     .5714829    1.728043
      _hatsq |  -.0210625    .078343    -0.27   0.788    -.1746119     .132487
       _cons |  -.1277104   .3405226    -0.38   0.708    -.7951224    .5397016
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       232            22  |        254
     -     |         2            14  |         16
-----------+--------------------------+-----------
   Total   |       234            36  |        270

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.15%
Specificity                     Pr( -|~D)   38.89%
Positive predictive value       Pr( D| +)   91.34%
Negative predictive value       Pr(~D| -)   87.50%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   61.11%
False - rate for true D         Pr( -| D)    0.85%
False + rate for classified +   Pr(~D| +)    8.66%
False - rate for classified -   Pr( D| -)   12.50%
--------------------------------------------------
Correctly classified                        91.11%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp1_yhat 
(option pr assumed; Pr(dv_indicator))
(167 missing values generated)

. gen bpp1_res = dv_indicator - bpp1_yhat
(167 missing values generated)

. 
. summ dv_indicator bpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
   bpp1_yhat |        426     .913638    .1746491   .0049835   .9999971

. /*
> pause "next"
> 
> scatter dv_indicator bpp1_yhat
> 
> pause "next"
> 
> scatter bpp1_res dv_indicator
> 
> pause "next"
> 
> scatter bpp1_res bpp1_yhat
> */
. pause "complete: B.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.2
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, v
> ce(cl mineid) offset(lnhours) iter(50) or

note: 1.state != 0 predicts success perfectly
      1.state dropped and 36 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 9 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 18 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 27 obs not used

Iteration 0:   log pseudolikelihood = -84.235067  
Iteration 1:   log pseudolikelihood = -67.662755  
Iteration 2:   log pseudolikelihood = -64.646543  
Iteration 3:   log pseudolikelihood = -64.582082  
Iteration 4:   log pseudolikelihood = -64.581966  
Iteration 5:   log pseudolikelihood = -64.581966  

Logistic regression                             Number of obs     =        284
                                                Wald chi2(21)     =     526.13
Log pseudolikelihood = -64.581966               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 36 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_pp_1lag |   .9917445   .0054466    -1.51   0.131     .9811266    1.002477
      p48_pp_1lag |   1.001221   .0029866     0.41   0.682     .9953845    1.007092
      p71_pp_1lag |   1.006677   .0221763     0.30   0.763     .9641376    1.051094
      p72_pp_1lag |   .9933243   .0058371    -1.14   0.254     .9819494    1.004831
      p75_pp_1lag |   1.000098   .0000696     1.41   0.158     .9999619    1.000235
      p77_pp_1lag |    .998998   .0007577    -1.32   0.186      .997514    1.000484
        mine_time |   .1615502   .1016306    -2.90   0.004     .0470783    .5543638
onsite_insp_hours |   1.000763   .0005143     1.49   0.138      .999756    1.001772
                  |
            state |
               1  |          1  (empty)
               3  |   .5274559   .4735302    -0.71   0.476      .090784    3.064524
               4  |   .5245974   .4398027    -0.77   0.442     .1014404    2.712948
               5  |          1  (empty)
               6  |    .550793   .3961459    -0.83   0.407      .134518     2.25526
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |    .595708   .5871225    -0.53   0.599     .0863177    4.111186
              15  |   .1575595   .1847029    -1.58   0.115     .0158345    1.567784
                  |
             time |
            2008  |   2.490691    3.52117     0.65   0.519     .1559368    39.78239
            2009  |   1.333278   2.261354     0.17   0.865     .0479966     37.0366
            2010  |   30.22024   68.37135     1.51   0.132     .3585164    2547.339
            2011  |   150.4204   406.9189     1.85   0.064     .7492505    30198.58
            2012  |   2840.619   9464.576     2.39   0.017     4.143041     1947631
            2013  |   21369.44   80858.25     2.63   0.008     12.85269    3.55e+07
            2014  |    46770.1   213337.1     2.36   0.018     6.127723    3.57e+08
            2015  |   147858.4   758473.3     2.32   0.020     6.359391    3.44e+09
                  |
            _cons |   .2894042   .9313009    -0.39   0.700     .0005276    158.7327
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.2.csv"', replace
>  plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.PP.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       284
 number of covariate patterns =       284
            Pearson chi2(262) =       197.30
                  Prob > chi2 =         0.9989

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -107.97167  
Iteration 1:   log likelihood = -69.752787  
Iteration 2:   log likelihood = -64.824995  
Iteration 3:   log likelihood = -64.400242  
Iteration 4:   log likelihood =  -64.30418  
Iteration 5:   log likelihood = -64.300771  
Iteration 6:   log likelihood = -64.300766  

Logistic regression                             Number of obs     =        284
                                                LR chi2(2)        =      87.34
                                                Prob > chi2       =     0.0000
Log likelihood = -64.300766                     Pseudo R2         =     0.4045

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.219584   .3158339     3.86   0.000      .600561    1.838607
      _hatsq |  -.0427241   .0738685    -0.58   0.563    -.1875038    .1020555
       _cons |  -.1531926    .360417    -0.43   0.671    -.8595969    .5532118
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       247            22  |        269
     -     |         1            14  |         15
-----------+--------------------------+-----------
   Total   |       248            36  |        284

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.60%
Specificity                     Pr( -|~D)   38.89%
Positive predictive value       Pr( D| +)   91.82%
Negative predictive value       Pr(~D| -)   93.33%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   61.11%
False - rate for true D         Pr( -| D)    0.40%
False + rate for classified +   Pr(~D| +)    8.18%
False - rate for classified -   Pr( D| -)    6.67%
--------------------------------------------------
Correctly classified                        91.90%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp2_yhat 
(option pr assumed; Pr(dv_indicator))
(152 missing values generated)

. gen bpp2_res = dv_indicator - bpp2_yhat
(152 missing values generated)

. 
. summ dv_indicator bpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
   bpp2_yhat |        441    .9166215    .1719511   .0059592   .9999967

. /*
> pause "next"
> 
> scatter dv_indicator bpp2_yhat
> 
> pause "next"
> 
> scatter bpp2_res dv_indicator
> 
> pause "next"
> 
> scatter bpp2_res bpp2_yhat
> */
. pause "complete: B.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.3
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, v
> ce(cl mineid) offset(lnhours) iter(50) or

note: 1.state != 0 predicts success perfectly
      1.state dropped and 36 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 9 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 18 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 27 obs not used

Iteration 0:   log pseudolikelihood = -84.235067  
Iteration 1:   log pseudolikelihood = -67.831593  
Iteration 2:   log pseudolikelihood = -64.673941  
Iteration 3:   log pseudolikelihood = -64.595495  
Iteration 4:   log pseudolikelihood = -64.595329  
Iteration 5:   log pseudolikelihood = -64.595329  

Logistic regression                             Number of obs     =        284
                                                Wald chi2(21)     =     448.04
Log pseudolikelihood = -64.595329               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 36 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_pp_c_4lag |   .9968275   .0018794    -1.69   0.092     .9931508    1.000518
    p48_pp_c_4lag |    1.00042   .0010139     0.41   0.679     .9984348    1.002409
    p71_pp_c_4lag |   1.004928   .0092927     0.53   0.595     .9868783    1.023307
    p72_pp_c_4lag |   .9972784   .0016577    -1.64   0.101     .9940346    1.000533
    p75_pp_c_4lag |   1.000018    .000018     1.00   0.318     .9999827    1.000053
    p77_pp_c_4lag |   .9997556   .0002911    -0.84   0.401     .9991853    1.000326
        mine_time |   .1654887   .1060843    -2.81   0.005     .0471105    .5813257
onsite_insp_hours |   1.000908   .0005913     1.54   0.125     .9997495    1.002068
                  |
            state |
               1  |          1  (empty)
               3  |   .5542241   .5651085    -0.58   0.563      .075122    4.088874
               4  |   .5208601   .4413686    -0.77   0.441     .0989524    2.741673
               5  |          1  (empty)
               6  |   .5463812   .3763171    -0.88   0.380     .1416561    2.107445
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .5143243   .5217893    -0.66   0.512     .0704176    3.756584
              15  |   .1466568   .1750283    -1.61   0.108     .0141394    1.521153
                  |
             time |
            2008  |   2.706973   4.038696     0.67   0.504     .1453868    50.40142
            2009  |   1.362542   2.446939     0.17   0.863     .0403375    46.02471
            2010  |   28.00556   65.49502     1.42   0.154     .2861458     2740.95
            2011  |   135.3882   381.3762     1.74   0.081     .5417805    33832.82
            2012  |   2479.798   8553.168     2.27   0.023      2.87411     2139583
            2013  |   17586.67   68968.97     2.49   0.013     8.073459    3.83e+07
            2014  |   46638.56   221198.6     2.27   0.023      4.28196    5.08e+08
            2015  |   118116.5     627815     2.20   0.028     3.531724    3.95e+09
                  |
            _cons |   .2729646   .8830537    -0.40   0.688     .0004813    154.8049
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.3.csv"', replace
>  plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.PP.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       284
 number of covariate patterns =       284
            Pearson chi2(262) =       193.09
                  Prob > chi2 =         0.9995

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -107.97167  
Iteration 1:   log likelihood = -69.387443  
Iteration 2:   log likelihood =  -64.97865  
Iteration 3:   log likelihood = -64.456021  
Iteration 4:   log likelihood = -64.379636  
Iteration 5:   log likelihood = -64.378497  
Iteration 6:   log likelihood = -64.378497  

Logistic regression                             Number of obs     =        284
                                                LR chi2(2)        =      87.19
                                                Prob > chi2       =     0.0000
Log likelihood = -64.378497                     Pseudo R2         =     0.4037

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.190631   .3151753     3.78   0.000     .5728985    1.808363
      _hatsq |  -.0342832   .0761822    -0.45   0.653    -.1835975    .1150311
       _cons |  -.1437345   .3583684    -0.40   0.688    -.8461237    .5586547
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       246            23  |        269
     -     |         2            13  |         15
-----------+--------------------------+-----------
   Total   |       248            36  |        284

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.19%
Specificity                     Pr( -|~D)   36.11%
Positive predictive value       Pr( D| +)   91.45%
Negative predictive value       Pr(~D| -)   86.67%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   63.89%
False - rate for true D         Pr( -| D)    0.81%
False + rate for classified +   Pr(~D| +)    8.55%
False - rate for classified -   Pr( D| -)   13.33%
--------------------------------------------------
Correctly classified                        91.20%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp3_yhat 
(option pr assumed; Pr(dv_indicator))
(152 missing values generated)

. gen bpp3_res = dv_indicator - bpp3_yhat
(152 missing values generated)

. 
. summ dv_indicator bpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
   bpp3_yhat |        441     .916608    .1721926   .0066132   .9999968

. /*
> pause "next"
> 
> scatter dv_indicator bpp3_yhat
> 
> pause "next"
> 
> scatter bpp3_res dv_indicator
> 
> pause "next"
> 
> scatter bpp3_res bpp3_yhat
> */
. pause "complete: B.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.4
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1,
>  vce(cl mineid) offset(lnhours) iter(50) or

note: 1.state != 0 predicts success perfectly
      1.state dropped and 36 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 9 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 10.state != 0 predicts success perfectly
      10.state dropped and 18 obs not used

note: 12.state != 0 predicts success perfectly
      12.state dropped and 27 obs not used

Iteration 0:   log pseudolikelihood = -84.235067  
Iteration 1:   log pseudolikelihood = -66.674026  
Iteration 2:   log pseudolikelihood = -62.890612  
Iteration 3:   log pseudolikelihood = -62.733033  
Iteration 4:   log pseudolikelihood = -62.732059  
Iteration 5:   log pseudolikelihood = -62.732059  

Logistic regression                             Number of obs     =        284
                                                Wald chi2(21)     =     206.46
Log pseudolikelihood = -62.732059               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 36 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_pp_c_lag_all |   .9981073   .0010009    -1.89   0.059     .9961475    1.000071
 p48_pp_c_lag_all |   1.000215   .0004133     0.52   0.602     .9994057    1.001026
 p71_pp_c_lag_all |   .9976321   .0025169    -0.94   0.347     .9927112    1.002577
 p72_pp_c_lag_all |   .9994364   .0010753    -0.52   0.600      .997331    1.001546
 p75_pp_c_lag_all |   1.000007   3.51e-06     1.86   0.062     .9999997    1.000013
 p77_pp_c_lag_all |   .9998946   .0000888    -1.19   0.235     .9997207    1.000069
        mine_time |    .110017   .0681136    -3.56   0.000     .0326938    .3702157
onsite_insp_hours |   1.000781   .0005073     1.54   0.124     .9997872    1.001776
                  |
            state |
               1  |          1  (empty)
               3  |   .5602754   .5080996    -0.64   0.523     .0947258    3.313865
               4  |   .2435164   .1979502    -1.74   0.082     .0494996    1.197995
               5  |          1  (empty)
               6  |   .2076027   .1699412    -1.92   0.055     .0417301    1.032801
               9  |          1  (empty)
              10  |          1  (empty)
              12  |          1  (empty)
              14  |   .3970456   .3760744    -0.98   0.329     .0620294    2.541459
              15  |   .0685819   .0760062    -2.42   0.016     .0078138    .6019457
                  |
             time |
            2008  |   4.539985   6.754181     1.02   0.309     .2458744    83.82924
            2009  |   3.570255   6.142002     0.74   0.459     .1225618    104.0024
            2010  |   88.60912    197.782     2.01   0.045     1.115667    7037.564
            2011  |   542.5796   1499.886     2.28   0.023     2.406775    122318.3
            2012  |   12800.92   41005.88     2.95   0.003      24.0183     6822450
            2013  |   137298.9   533251.2     3.05   0.002     67.87498    2.78e+08
            2014  |   381746.5    1678166     2.92   0.003     69.16315    2.11e+09
            2015  |    1952112    9360984     3.02   0.003     161.7073    2.36e+10
                  |
            _cons |   3.996408     11.361     0.49   0.626      .015201    1050.672
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.4.csv"', replace
>  plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Outpu
> t + Summaries/big/V2/MR/estout 10-24/Model.MR.Y.P.B.PP.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       284
 number of covariate patterns =       284
            Pearson chi2(262) =       176.86
                  Prob > chi2 =         1.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -107.97167  
Iteration 1:   log likelihood = -68.654441  
Iteration 2:   log likelihood = -63.015947  
Iteration 3:   log likelihood = -62.604229  
Iteration 4:   log likelihood = -62.475252  
Iteration 5:   log likelihood = -62.459188  
Iteration 6:   log likelihood = -62.459136  
Iteration 7:   log likelihood = -62.459136  

Logistic regression                             Number of obs     =        284
                                                LR chi2(2)        =      91.03
                                                Prob > chi2       =     0.0000
Log likelihood = -62.459136                     Pseudo R2         =     0.4215

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |    1.22151   .3266783     3.74   0.000     .5812321    1.861787
      _hatsq |  -.0384172   .0771247    -0.50   0.618    -.1895789    .1127445
       _cons |  -.1676968   .3599733    -0.47   0.641    -.8732315    .5378378
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       245            22  |        267
     -     |         3            14  |         17
-----------+--------------------------+-----------
   Total   |       248            36  |        284

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.79%
Specificity                     Pr( -|~D)   38.89%
Positive predictive value       Pr( D| +)   91.76%
Negative predictive value       Pr(~D| -)   82.35%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   61.11%
False - rate for true D         Pr( -| D)    1.21%
False + rate for classified +   Pr(~D| +)    8.24%
False - rate for classified -   Pr( D| -)   17.65%
--------------------------------------------------
Correctly classified                        91.20%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp4_yhat 
(option pr assumed; Pr(dv_indicator))
(152 missing values generated)

. gen bpp4_res = dv_indicator - bpp4_yhat
(152 missing values generated)

. 
. summ dv_indicator bpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        593    .9190556    .2729799          0          1
   bpp4_yhat |        441    .9171875    .1741608   .0071248   .9999996

. /*
> pause "next"
> 
> scatter dv_indicator bpp4_yhat
> 
> pause "next"
> 
> scatter bpp4_res dv_indicator
> 
> pause "next"
> 
> scatter bpp4_res bpp4_yhat
> */
. pause "complete: B.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. log close
      name:  <unnamed>
       log:  C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/Model Output + Su
> mmaries/big/V2/MR/log 10-24/log_part_year.txt
  log type:  text
 closed on:  24 Oct 2016, 18:40:45
-----------------------------------------------------------------------------------------------------------
