--------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Log Files\PS_log_part_year.txt
  log type:  text
 opened on:  12 Oct 2016, 17:15:27

. * log using "C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Log Files\PS_log_part_quarter.txt", text
. * log using "C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Log Files\PS_log_subpart_year.txt", text
. * log using "C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Log Files\PS_log_subpart_quarter.txt", text
. 
. * local injury_type "MR"
. local injury_type "PS"

. 
. local unit_of_analysis "year_sum"

. * local unit_of_analysis "year_avg"
. * local unit_of_analysis "quarter"
. 
. local violation_level "part"

. * local violation_level "subpart"
. 
. ********************************************************************************
. ********************************************************************************
. // DATA SET-UP
. 
. // read data 
. if "`injury_type'" == "MR" {
.         use "X:\Projects\Mining\NIOSH\analysis\data\5_prediction-ready\MR_prediction_data.dta", clear
. }

. 
. if "`injury_type'" == "PS" {
.         use "X:\Projects\Mining\NIOSH\analysis\data\5_prediction-ready\PS_prediction_data.dta", clear
(Written by R.              )
. }

. 
. // format variables
. if "`injury_type'" == "MR" {
.         rename MR dv
.         rename MR_indicator dv_indicator
.         local injury_label "MR"
.         local relevant_parts "47 48 71 72 75 77"
. }

. 
. if "`injury_type'" == "PS" {
.         rename PS dv
.         rename PS_indicator dv_indicator
.         local injury_label "PS"
.         local relevant_parts "48 75"
. }

. 
. if "`violation_level'" == "part" {
.         local violation_level_label "P"
. }

. 
. if "`violation_level'" == "subpart" {
.         local violation_level_label "SP"
. }

. 
. * recast int p* sp* total_violations total_mine_act_violations num_good_faith num_no_terminations num_insp total_injuries dv dv_indicator
. 
. gen sample_pp = quarter >= 2007 // flag obs after or equal to 2007 to use in penlaty points analyses (assessments changed for the last time in 2007)

. 
. tostring quarter, replace
quarter was double now str7

. encode quarter, gen(quart)

. drop quarter

. rename quart time

. 
. local time_label "Q" // will be overwritten if unit_of_analysis is year_sum or year_avg

. 
. if "`unit_of_analysis'" == "year_sum" { // collapse to mine years - sums 
.         local time_label "Y"
.         
.         // count number of complete quarters per year
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
(22,385 real changes made)
.         gen marker = 1
.         bysort mineid year: egen num_quarts = sum(marker)
.                 /*tab num_quarts
>                          num_quarts |      Freq.     Percent        Cum.
>                         ------------+-----------------------------------
>                                           1 |      1,100        3.63        3.63
>                                           2 |      1,666        5.50        9.13
>                                           3 |      2,511        8.29       17.42
>                                           4 |     25,012       82.58      100.00
>                         ------------+-----------------------------------
>                                   Total |     30,289      100.00 - Sarah 9/21/2016 @ 10:54 PM */
.         drop if num_quarts < 4
(5,277 observations deleted)
.         
.         // collapse to the mine-year 
.         collapse (sum) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp, by(mineid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_sum collapse"
. }

. 
. if "`unit_of_analysis'" == "year_avg" { // collapse on mine years - averages
.         local time_label "Y"
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
.         pause "collapsing to mine-year"
.         collapse (mean) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp, by(mineid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_avg collapse"
. }

. 
. drop dv_indicator

. gen dv_binary = 0 if dv == 0
(5,204 missing values generated)

. replace dv_binary = 1 if dv != 0
(5,204 real changes made)

. rename dv_binary dv_indicator

.         
. gen lnhours = log(hours)

. 
. pause "complete: data formatting"

. 
. // group variables
. local covariates "mine_time onsite_insp_hours"

. 
. *** lag 0 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
p48 p75
. 
.         foreach var of varlist p*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
p48_ss p75_ss
. 
.         foreach var of varlist p*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
p48_pp p75_pp
.         
.         pause "complete: variable groups - part no lag"
. }

. 
. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
. 
.         foreach var of varlist sp*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
. 
.         foreach var of varlist sp*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
.         
.         pause "complete: variable groups - subpart no lag"
. }

. 
. 
. *** lag 1 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
p48_1lag p75_1lag
. 
.         foreach var of varlist p*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
p48_ss_1lag p75_ss_1lag
. 
.         foreach var of varlist p*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
p48_pp_1lag p75_pp_1lag
.         
.         pause "complete: variable groups - part lag 1"
. }

. 
. 
. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
. 
.         foreach var of varlist sp*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
. 
. 
.         foreach var of varlist sp*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
. 
.         pause "complete: variable groups - subpart lag 1"
. } 

. 
. *** lag 4 ***
. if "`violation_level'" == "part" {
.         
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
p48_c_4lag p75_c_4lag
. 
.         foreach var of varlist p*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
p48_ss_c_4lag p75_ss_c_4lag
. 
.         foreach var of varlist p*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
p48_pp_c_4lag p75_pp_c_4lag
. 
.         pause "complete: variable groups - part lag 4"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
. 
.         foreach var of varlist sp*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
. 
.         foreach var of varlist sp*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
. 
.         pause "complete: variable groups - subpart lag 4"
. }

. 
. *** lag all ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
p48_c_lag_all p75_c_lag_all
. 
.         foreach var of varlist p*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
p48_ss_c_lag_all p75_ss_c_lag_all
. 
.         foreach var of varlist p*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
p48_pp_c_lag_all p75_pp_c_lag_all
. 
.         pause "complete: variable groups - part lag all"
. }

. 
. *** subpart lag all ***
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
.         
.         foreach var of varlist sp*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
.         
.         foreach var of varlist sp*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
. 
.         pause "complete: variable groups - subpart lag all"
. }

. 
. ********************************************************************************
. *******************************************************************************
. // DATA OVERVIEW
. 
. // outcome variables
. summ dv

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200

. 
. pause "next"

. 
. tab dv_indicator

dv_indicato |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,049       16.78       16.78
          1 |      5,204       83.22      100.00
------------+-----------------------------------
      Total |      6,253      100.00

.           
. pause "next"

. 
. if "`violation_level'" == "part" {
.         summ `count_vars' `ss_vars' `pp_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         p48 |      6,253     .318727    1.248145          0         69
         p75 |      6,253    86.81753    106.1219          0       1177
      p48_ss |      6,253    .0702063    .3739304          0          7
      p75_ss |      6,253    26.72909    34.58116          0        321
      p48_pp |      6,253    13.45146    66.03334          0       3787
-------------+---------------------------------------------------------
      p75_pp |      6,253    4560.291    7477.474          0      83190
.         
.         pause "next"
.         
.         summ `count_lag_1_vars' `ss_lag_1_vars' `pp_lag_1_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    p48_1lag |      6,253    .3144091    1.259505          0         69
    p75_1lag |      6,253    84.70494    105.5627          0       1231
 p48_ss_1lag |      6,253    .0705261    .3831667          0          9
 p75_ss_1lag |      6,253    26.06701    34.26183          0        298
 p48_pp_1lag |      6,253    13.25172    66.63073          0       3787
-------------+---------------------------------------------------------
 p75_pp_1lag |      6,253    4429.851    7438.808          0      95414
.         
.         pause "next"
.         
.         summ `count_lag_4_vars' `ss_lag_4_vars' `pp_lag_4_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  p48_c_4lag |      6,253    1.159923    3.899655          0        143
  p75_c_4lag |      6,253    318.6472     418.753          0       4860
p48_ss_c_4~g |      6,253    .2534783    1.196286          0         30
p75_ss_c_4~g |      6,253    97.46905    133.7162          0       1222
p48_pp_c_4~g |      6,253    49.52407    207.2291          0       7851
-------------+---------------------------------------------------------
p75_pp_c_4~g |      6,253    16979.21    29254.98          0     378581
.         
.         pause "next"
.         
.         summ `count_lag_all_vars' `ss_lag_all_vars' `pp_lag_all_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
p48_c_lag_~l |      6,253    4.830641    13.17843          0        288
p75_c_lag_~l |      6,253    1402.214    3242.545          0      38328
p48_ss_c_l~l |      6,253    1.384296    4.759533          0         52
p75_ss_c_l~l |      6,253    448.1796    1035.258          0      13253
p48_pp_c_l~l |      6,253    170.4297    577.2885          0      15716
-------------+---------------------------------------------------------
p75_pp_c_l~l |      6,253    58941.83    157916.8          0    2148250
. }

. 
. pause "complete: data overview"

. 
. *******************************************************************************/
. /*******************************************************************************
> // MODEL LABEL KEY
> 
> Model X.Y.Z
>   X
>     C: response variable is count of injuries
>     B: response variable is binary of injuries
>   Y
>     V: predictors are number of violations
>     SSV: predictors are number of significant and substantial violations
>     PP: predictors are number of penalty points
>   Z
>     1: inj_t ~ viol_t
>     2: inj_t ~ viol_(t_-1)
>     3: inj_t ~ viol_(annual sum pre_t)
>     4: inj_t ~ viol_(sum since study period) 
> 
> *******************************************************************************/
. ********************************************************************************
. // NULL MODELS (V & SSV)
. 
. // count outcome (V & SSV)
. glm dv, family(poisson) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -29170.718  
Iteration 1:   log pseudolikelihood = -24984.625  
Iteration 2:   log pseudolikelihood = -24975.695  
Iteration 3:   log pseudolikelihood = -24975.694  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,252
                                                  Scale parameter =          1
Deviance         =  30423.40786                   (1/df) Deviance =   4.866188
Pearson          =  41826.77991                   (1/df) Pearson  =   6.690144

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   7.988708
Log pseudolikelihood = -24975.69403               BIC             =  -24224.18

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000546   1.61e-06  -332.98   0.000     .0000515    .0000578
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

.         
. pause "next"    

.         
. quietly poisson dv, vce(cl mineid) exposure(hours) irr

. estat gof

         Deviance goodness-of-fit =  30423.41
         Prob > chi2(6252)        =    0.0000

         Pearson goodness-of-fit  =  41826.78
         Prob > chi2(6252)        =    0.0000

. 
. pause "next"

.         
. glm dv, family(nbinomial) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -17880.161  
Iteration 1:   log pseudolikelihood =  -17813.89  
Iteration 2:   log pseudolikelihood = -17813.656  
Iteration 3:   log pseudolikelihood = -17813.656  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,252
                                                  Scale parameter =          1
Deviance         =  4539.341074                   (1/df) Deviance =   .7260622
Pearson          =  7269.431098                   (1/df) Pearson  =   1.162737

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.697955
Log pseudolikelihood = -17813.65573               BIC             =  -50108.24

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000646   1.45e-06  -430.42   0.000     .0000618    .0000675
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. nbreg dv, vce(cl mineid) exposure(hours) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -24975.694  
Iteration 1:   log pseudolikelihood = -24975.694  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -17389.648  
Iteration 1:   log pseudolikelihood = -17389.648  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(0)      =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -17389.648               Pseudo R2         =     0.0000

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000636   1.41e-06  -437.06   0.000     .0000609    .0000664
   ln(hours) |          1  (exposure)
-------------+----------------------------------------------------------------
    /lnalpha |  -.7806193   .0564603                     -.8912795   -.6699592
-------------+----------------------------------------------------------------
       alpha |   .4581222   .0258657                      .4101306    .5117295
------------------------------------------------------------------------------

. 
. pause "next"

. 
. predict c_null_yhat 
(option n assumed; predicted number of events)

. summ dv_indicator c_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
 c_null_yhat |      6,253    11.62161    17.26537   .0040684   179.0143

. 
. pause "complete: null model - count outcome"

. 
. // binary outcome (V & SSV)
. logit dv_indicator, vce(cl mineid) offset(lnhours) or

Iteration 0:   log pseudolikelihood = -1978.0504  
Iteration 1:   log pseudolikelihood = -1893.3905  
Iteration 2:   log pseudolikelihood = -1893.3681  
Iteration 3:   log pseudolikelihood = -1893.3681  

Logistic regression                             Number of obs     =      6,253
                                                Wald chi2(0)      =          .
Log pseudolikelihood = -1893.3681               Prob > chi2       =          .

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000987   5.20e-06  -174.94   0.000      .000089    .0001094
     lnhours |          1  (offset)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6253
 number of covariate patterns =         1
              Pearson chi2(0) =         0.00
                  Prob > chi2 =              .

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2828.3302  
Iteration 1:   log likelihood = -1965.1216  
Iteration 2:   log likelihood = -1826.6339  
Iteration 3:   log likelihood = -1780.1485  
Iteration 4:   log likelihood = -1778.5091  
Iteration 5:   log likelihood = -1778.5084  
Iteration 6:   log likelihood = -1778.5084  

Logistic regression                             Number of obs     =      6,253
                                                LR chi2(2)        =    2099.64
                                                Prob > chi2       =     0.0000
Log likelihood = -1778.5084                     Pseudo R2         =     0.3712

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.102418   .0515933    21.37   0.000     1.001297    1.203539
      _hatsq |   .2453823   .0240955    10.18   0.000     .1981559    .2926087
       _cons |  -.6749075   .0655041   -10.30   0.000    -.8032932   -.5465217
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5115           747  |       5862
     -     |        89           302  |        391
-----------+--------------------------+-----------
   Total   |      5204          1049  |       6253

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.29%
Specificity                     Pr( -|~D)   28.79%
Positive predictive value       Pr( D| +)   87.26%
Negative predictive value       Pr(~D| -)   77.24%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   71.21%
False - rate for true D         Pr( -| D)    1.71%
False + rate for classified +   Pr(~D| +)   12.74%
False - rate for classified -   Pr( D| -)   22.76%
--------------------------------------------------
Correctly classified                        86.63%
--------------------------------------------------

. 
. pause "next"

. 
. predict b_null_yhat 
(option pr assumed; Pr(dv_indicator))

. summ dv_indicator b_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
 b_null_yhat |      6,253    .8322405     .176821   .0062748   .9964138

. 
. pause "complete: null model - binary outcome"

. 
. *******************************************************************************/
. ********************************************************************************
. // NULL MODELS (PP)
. 
. // count outcome (PP)
. glm dv if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -13706.608  
Iteration 1:   log pseudolikelihood = -11785.197  
Iteration 2:   log pseudolikelihood = -11782.286  
Iteration 3:   log pseudolikelihood = -11782.286  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,332
                                                  Scale parameter =          1
Deviance         =   13256.2139                   (1/df) Deviance =   3.978456
Pearson          =  16673.23866                   (1/df) Pearson  =   5.003973

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   7.070679
Log pseudolikelihood = -11782.28623               BIC             =  -13771.73

                               (Std. Err. adjusted for 727 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000441   1.27e-06  -348.77   0.000     .0000417    .0000466
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

.         
. pause "next"    

.         
. quietly poisson dv if sample_pp == 1, vce(cl mineid) exposure(hours) irr

. estat gof

         Deviance goodness-of-fit =  13256.21
         Prob > chi2(3332)        =    0.0000

         Pearson goodness-of-fit  =  16673.24
         Prob > chi2(3332)        =    0.0000

. 
. pause "next"

.         
. glm dv if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -9367.2456  
Iteration 1:   log pseudolikelihood =  -9316.904  
Iteration 2:   log pseudolikelihood = -9316.6425  
Iteration 3:   log pseudolikelihood = -9316.6425  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,332
                                                  Scale parameter =          1
Deviance         =  2228.321357                   (1/df) Deviance =   .6687639
Pearson          =  2922.921368                   (1/df) Pearson  =   .8772273

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.591145
Log pseudolikelihood = -9316.642482               BIC             =  -24799.62

                               (Std. Err. adjusted for 727 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000506   1.31e-06  -382.97   0.000     .0000481    .0000532
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. nbreg dv if sample_pp == 1, vce(cl mineid) exposure(hours) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -11782.286  
Iteration 1:   log pseudolikelihood = -11782.286  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8994.0816  
Iteration 1:   log pseudolikelihood = -8994.0816  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(0)      =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8994.0816               Pseudo R2         =     0.0000

                               (Std. Err. adjusted for 727 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000496   1.21e-06  -404.98   0.000     .0000473     .000052
   ln(hours) |          1  (exposure)
-------------+----------------------------------------------------------------
    /lnalpha |  -.9956402   .0717213                     -1.136211    -.855069
-------------+----------------------------------------------------------------
       alpha |   .3694868   .0265001                       .321033    .4252538
------------------------------------------------------------------------------

. 
. pause "next"

. 
. predict c_pp_null_yhat 
(option n assumed; predicted number of events)

. summ dv_indicator c_pp_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
c_pp_null_~t |      6,253    9.068361     13.4722   .0031746   139.6851

. 
. pause "complete: null model - count outcome"

. 
. // binary outcome (PP)
. logit dv_indicator if sample_pp == 1, vce(cl mineid) offset(lnhours) or

Iteration 0:   log pseudolikelihood = -1052.7165  
Iteration 1:   log pseudolikelihood = -1006.7469  
Iteration 2:   log pseudolikelihood = -1006.7273  
Iteration 3:   log pseudolikelihood = -1006.7273  

Logistic regression                             Number of obs     =      3,333
                                                Wald chi2(0)      =          .
Log pseudolikelihood = -1006.7273               Prob > chi2       =          .

                               (Std. Err. adjusted for 727 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000784   5.25e-06  -141.08   0.000     .0000687    .0000894
     lnhours |          1  (offset)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3333
 number of covariate patterns =         1
              Pearson chi2(0) =         0.00
                  Prob > chi2 =              .

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1548.2719  
Iteration 1:   log likelihood = -1045.9495  
Iteration 2:   log likelihood = -957.81057  
Iteration 3:   log likelihood = -932.47829  
Iteration 4:   log likelihood = -931.63263  
Iteration 5:   log likelihood = -931.62985  
Iteration 6:   log likelihood = -931.62985  

Logistic regression                             Number of obs     =      3,333
                                                LR chi2(2)        =    1233.28
                                                Prob > chi2       =     0.0000
Log likelihood = -931.62985                     Pseudo R2         =     0.3983

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |    1.14455   .0639224    17.91   0.000     1.019264    1.269835
      _hatsq |   .2588853   .0289098     8.95   0.000     .2022232    .3155474
       _cons |   -.713419   .0867457    -8.22   0.000    -.8834374   -.5434005
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2693           409  |       3102
     -     |        55           176  |        231
-----------+--------------------------+-----------
   Total   |      2748           585  |       3333

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.00%
Specificity                     Pr( -|~D)   30.09%
Positive predictive value       Pr( D| +)   86.81%
Negative predictive value       Pr(~D| -)   76.19%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   69.91%
False - rate for true D         Pr( -| D)    2.00%
False + rate for classified +   Pr(~D| +)   13.19%
False - rate for classified -   Pr( D| -)   23.81%
--------------------------------------------------
Correctly classified                        86.08%
--------------------------------------------------

. 
. pause "next"

. 
. predict b_pp_null_yhat 
(option pr assumed; Pr(dv_indicator))

. summ dv_indicator b_pp_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
b_pp_null_~t |      6,253    .8058796    .1892077   .0049906   .9954894

. 
. pause "complete: null model - binary outcome"

. 
. ********************************************************************************
. ********************************************************************************
. 
. if "`violation_level'" == "subpart" {
.         set matsize 11000, perm
.         set emptycells drop
. }

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.1
. 
. // poisson model
. glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -23305.529  
Iteration 1:   log pseudolikelihood = -20915.269  
Iteration 2:   log pseudolikelihood = -20906.022  
Iteration 3:   log pseudolikelihood = -20906.017  
Iteration 4:   log pseudolikelihood = -20906.017  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  22284.05388                   (1/df) Deviance =   3.582069
Pearson          =  27548.48668                   (1/df) Pearson  =   4.428305

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.696951
Log pseudolikelihood = -20906.01704               BIC             =  -32092.57

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p48 |   1.009109   .0051756     1.77   0.077     .9990158    1.019304
              p75 |   1.000457   .0002118     2.16   0.031     1.000042    1.000872
        mine_time |   1.008093   .0064829     1.25   0.210     .9954668     1.02088
onsite_insp_hours |   .9997809   .0000447    -4.90   0.000     .9996933    .9998685
                  |
            state |
               1  |    .947569   .0881069    -0.58   0.562     .7897041    1.136992
               2  |   1.630038   .0845861     9.42   0.000     1.472404    1.804547
               3  |   .6415412   .0670505    -4.25   0.000     .5227108     .787386
               4  |   1.217957   .0989653     2.43   0.015     1.038646    1.428225
               5  |   1.073159   .1287701     0.59   0.556     .8482559    1.357691
               6  |   .9874734   .0562328    -0.22   0.825     .8831873    1.104074
               7  |   1.127944    .169016     0.80   0.422     .8408915    1.512988
               8  |    .512213   .0211871   -16.17   0.000     .4723258    .5554686
               9  |   .6494469   .0282278    -9.93   0.000     .5964125    .7071973
              10  |   .9017947   .0541435    -1.72   0.085     .8016813     1.01441
              11  |    1.71647   .3268479     2.84   0.005     1.181821    2.492992
              12  |    1.04317   .0980959     0.45   0.653     .8675832    1.254293
              13  |   1.559772   .1602669     4.33   0.000     1.275264    1.907754
              14  |   .4253002   .0646403    -5.63   0.000     .3157357    .5728852
              15  |    .811601   .0607563    -2.79   0.005     .7008446    .9398605
              17  |   .6677067   .0244069   -11.05   0.000     .6215434    .7172987
                  |
             time |
            2000  |   1.048759   .0425061     1.17   0.240     .9686721    1.135468
            2002  |   .9677909   .0358654    -0.88   0.377     .8999881    1.040702
            2003  |    .842883   .0325508    -4.43   0.000     .7814394    .9091579
            2004  |   .8134616    .035603    -4.72   0.000     .7465903    .8863226
            2005  |   .7632803   .0384558    -5.36   0.000     .6915101    .8424993
            2006  |    .722647   .0389086    -6.03   0.000     .6502734    .8030755
            2007  |   .7303626   .0426599    -5.38   0.000     .6513591    .8189484
            2008  |   .7015722    .041501    -5.99   0.000       .62477    .7878155
            2009  |    .620809   .0377185    -7.85   0.000     .5511141    .6993175
            2010  |   .6071847   .0403835    -7.50   0.000     .5329763    .6917255
            2011  |   .5538191   .0351355    -9.31   0.000     .4890642    .6271479
            2012  |    .495845   .0340021   -10.23   0.000     .4334865    .5671739
            2013  |   .4763667   .0373801    -9.45   0.000     .4084589    .5555644
            2014  |   .4983225      .0424    -8.19   0.000     .4217797     .588756
            2015  |   .4725519   .0417156    -8.49   0.000      .397473    .5618124
                  |
            _cons |   .0000938   5.21e-06  -166.87   0.000     .0000841    .0001045
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  22284.05
         Prob > chi2(6221)        =    0.0000

         Pearson goodness-of-fit  =  27548.49
         Prob > chi2(6221)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -17733.343  
Iteration 1:   log pseudolikelihood = -17509.999  
Iteration 2:   log pseudolikelihood = -17504.893  
Iteration 3:   log pseudolikelihood = -17504.882  
Iteration 4:   log pseudolikelihood = -17504.882  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  3921.793655                   (1/df) Deviance =   .6304121
Pearson          =  5306.812754                   (1/df) Pearson  =   .8530482

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =    5.60911
Log pseudolikelihood = -17504.88202               BIC             =  -50454.83

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p48 |   1.010844   .0084395     1.29   0.196     .9944373    1.027521
              p75 |   1.000956   .0002246     4.26   0.000     1.000516    1.001396
        mine_time |   1.011294   .0061679     1.84   0.066     .9992767    1.023455
onsite_insp_hours |    .999743   .0000452    -5.68   0.000     .9996544    .9998317
                  |
            state |
               1  |   .8067441   .1003013    -1.73   0.084     .6322767    1.029353
               2  |   1.083118   .0523265     1.65   0.098      .985266    1.190689
               3  |   .6499181   .0843848    -3.32   0.001     .5038943    .8382583
               4  |   .9964459   .0663858    -0.05   0.957     .8744691    1.135437
               5  |   .8475417   .0776994    -1.80   0.071     .7081515    1.014369
               6  |    .770805   .0384731    -5.22   0.000       .69897    .8500225
               7  |   1.080369   .2290083     0.36   0.715     .7130847    1.636829
               8  |   .4893104   .0190476   -18.36   0.000     .4533665     .528104
               9  |   .5387187   .0240499   -13.86   0.000     .4935852    .5879793
              10  |   .7776526   .0843039    -2.32   0.020      .628794    .9617515
              11  |   1.500311    .271853     2.24   0.025      1.05183    2.140017
              12  |   1.024512   .0789965     0.31   0.753     .8808134    1.191654
              13  |   1.558071   .1797506     3.84   0.000     1.242757    1.953386
              14  |   .4180001   .0742251    -4.91   0.000     .2951392    .5920056
              15  |   .7087755    .040565    -6.01   0.000     .6335666    .7929122
              17  |   .5938912    .021905   -14.13   0.000     .5524733    .6384142
                  |
             time |
            2000  |   1.013049   .0585631     0.22   0.823     .9045311    1.134586
            2002  |   .9055134    .051028    -1.76   0.078     .8108256    1.011259
            2003  |   .8472029   .0626707    -2.24   0.025     .7328598    .9793861
            2004  |   .7677538   .0488713    -4.15   0.000     .6777021    .8697714
            2005  |   .6898896   .0442608    -5.79   0.000     .6083726    .7823293
            2006  |   .6762643   .0450091    -5.88   0.000     .5935596    .7704928
            2007  |   .6586186   .0472292    -5.82   0.000     .5722618     .758007
            2008  |   .5956115   .0438181    -7.04   0.000     .5156341    .6879938
            2009  |   .5426144   .0411166    -8.07   0.000     .4677259    .6294934
            2010  |   .5400142   .0408415    -8.15   0.000     .4656166    .6262993
            2011  |   .5078208   .0375511    -9.16   0.000     .4393068    .5870203
            2012  |    .455308   .0378914    -9.45   0.000     .3867826    .5359738
            2013  |   .4570717   .0400423    -8.94   0.000     .3849585    .5426937
            2014  |    .433866   .0369551    -9.80   0.000     .3671584    .5126935
            2015  |   .4098404   .0360192   -10.15   0.000     .3449898    .4868816
                  |
            _cons |   .0001129   8.02e-06  -128.02   0.000     .0000983    .0001298
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -23536.065  
Iteration 1:   log pseudolikelihood = -20936.382  
Iteration 2:   log pseudolikelihood = -20906.031  
Iteration 3:   log pseudolikelihood = -20906.017  
Iteration 4:   log pseudolikelihood = -20906.017  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16875.038  
Iteration 1:   log pseudolikelihood = -16743.541  
Iteration 2:   log pseudolikelihood = -16731.799  
Iteration 3:   log pseudolikelihood = -16731.766  
Iteration 4:   log pseudolikelihood = -16731.766  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(31)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16731.766               Pseudo R2         =     0.0378

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p48 |   1.008367    .006573     1.28   0.201     .9955661    1.021333
              p75 |   1.000915    .000214     4.28   0.000     1.000496    1.001335
        mine_time |   1.008735   .0056671     1.55   0.122     .9976886    1.019904
onsite_insp_hours |   .9997513   .0000449    -5.54   0.000     .9996634    .9998393
                  |
            state |
               1  |    .831358   .0943753    -1.63   0.104     .6655186    1.038523
               2  |   1.224714   .0564912     4.39   0.000      1.11885    1.340594
               3  |   .6419097     .08288    -3.43   0.001     .4983922    .8267546
               4  |   1.012233   .0632655     0.19   0.846      .895529    1.144146
               5  |   .8757347   .0812951    -1.43   0.153     .7300539    1.050486
               6  |   .7994684   .0379068    -4.72   0.000     .7285201    .8773261
               7  |   1.065574   .2068823     0.33   0.744     .7283196    1.558997
               8  |   .4922659   .0179828   -19.40   0.000     .4582524    .5288041
               9  |   .5689781   .0235635   -13.62   0.000     .5246192    .6170878
              10  |   .7967066   .0712604    -2.54   0.011      .668596    .9493647
              11  |   1.535713   .2717011     2.42   0.015      1.08571    2.172232
              12  |   1.088622   .0776835     1.19   0.234     .9465332     1.25204
              13  |   1.527596   .1632239     3.97   0.000      1.23896    1.883473
              14  |   .4165058   .0736487    -4.95   0.000     .2945149    .5890266
              15  |   .7353131   .0399077    -5.67   0.000     .6611119    .8178424
              17  |   .6141739   .0211959   -14.13   0.000     .5740046    .6571543
                  |
             time |
            2000  |   1.031327   .0490655     0.65   0.517     .9395082     1.13212
            2002  |   .9312197   .0424567    -1.56   0.118     .8516158    1.018265
            2003  |    .842037   .0476622    -3.04   0.002     .7536163     .940832
            2004  |   .7907151    .041133    -4.51   0.000     .7140695    .8755876
            2005  |   .7156965   .0395276    -6.06   0.000     .6422696    .7975178
            2006  |   .7002225    .039917    -6.25   0.000      .626199    .7829963
            2007  |    .689264   .0429859    -5.97   0.000     .6099588    .7788802
            2008  |    .618408   .0391484    -7.59   0.000     .5462477    .7001008
            2009  |   .5562739   .0363609    -8.97   0.000      .489384    .6323064
            2010  |   .5570978   .0376007    -8.67   0.000     .4880682    .6358904
            2011  |   .5198996   .0338614   -10.04   0.000     .4575938     .590689
            2012  |   .4603344   .0328455   -10.87   0.000     .4002571    .5294292
            2013  |   .4496525   .0336159   -10.69   0.000     .3883662    .5206101
            2014  |    .443309   .0340334   -10.60   0.000     .3813807    .5152931
            2015  |   .4279795   .0342816   -10.60   0.000     .3657976    .5007317
                  |
            _cons |   .0001084   6.53e-06  -151.57   0.000     .0000964     .000122
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.177031   .0605738                     -1.295753   -1.058308
------------------+----------------------------------------------------------------
            alpha |   .3081924   .0186684                      .2736916    .3470424
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.V.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.V.1.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =   8348.50
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -24975.69  -20906.02      32    41876.03   42091.74
        nbin |      6,253 -17389.65  -16731.77      33    33529.53   33751.98
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv1_yhat 
(option n assumed; predicted number of events)

. gen cv1_res = dv - cv1_yhat

. 
. summ dv cv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
    cv1_yhat |      6,253    10.64579    15.89942   .0035381   156.3208

. /*
> pause "next"
> 
> scatter dv cv1_yhat
> 
> pause "next"
> 
> scatter cv1_res dv
> 
> pause "next"
> 
> scatter cv1_res cv1_yhat
> */
. pause "complete: C.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.2
. 
. // poisson model
. glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -23315.663  
Iteration 1:   log pseudolikelihood = -20932.579  
Iteration 2:   log pseudolikelihood = -20923.301  
Iteration 3:   log pseudolikelihood = -20923.297  
Iteration 4:   log pseudolikelihood = -20923.297  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  22318.61292                   (1/df) Deviance =   3.587625
Pearson          =  27606.40094                   (1/df) Pearson  =   4.437615

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.702478
Log pseudolikelihood = -20923.29656               BIC             =  -32058.01

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p48_1lag |   1.006702   .0049345     1.36   0.173     .9970773    1.016421
         p75_1lag |    1.00042   .0002077     2.02   0.043     1.000013    1.000827
        mine_time |   1.007405   .0065767     1.13   0.258     .9945974    1.020378
onsite_insp_hours |     .99979   .0000436    -4.82   0.000     .9997047    .9998754
                  |
            state |
               1  |   .9472757   .0873699    -0.59   0.557     .7906197    1.134972
               2  |   1.632944   .0855214     9.36   0.000     1.473641    1.809468
               3  |   .6417236    .066962    -4.25   0.000     .5230312    .7873511
               4  |   1.221083    .099205     2.46   0.014     1.041336    1.431858
               5  |   1.073848   .1295357     0.59   0.555     .8477434    1.360258
               6  |    .984612    .055856    -0.27   0.785      .881003    1.100406
               7  |   1.125034   .1680322     0.79   0.430     .8395223    1.507644
               8  |   .5092331   .0210173   -16.35   0.000     .4696621    .5521381
               9  |   .6493849   .0283123    -9.90   0.000     .5961986     .707316
              10  |   .9013526   .0546572    -1.71   0.087     .8003475    1.015105
              11  |   1.715999   .3253357     2.85   0.004     1.183417    2.488262
              12  |   1.034615   .0973929     0.36   0.718     .8603025    1.244245
              13  |   1.553861   .1602707     4.27   0.000     1.269452    1.901989
              14  |   .4239217   .0644446    -5.65   0.000     .3146923    .5710646
              15  |   .8094994   .0611222    -2.80   0.005     .6981449    .9386149
              17  |   .6669428   .0244355   -11.06   0.000     .6207293    .7165969
                  |
             time |
            2000  |   1.058128   .0425082     1.41   0.160     .9780086     1.14481
            2002  |   .9623111   .0364276    -1.01   0.310     .8934985    1.036423
            2003  |   .8428736   .0331234    -4.35   0.000     .7803901      .91036
            2004  |   .8153876   .0356706    -4.67   0.000     .7483878    .8883855
            2005  |   .7622335   .0391158    -5.29   0.000     .6892974    .8428872
            2006  |   .7236762   .0388332    -6.03   0.000     .6514303    .8039344
            2007  |   .7360181   .0426378    -5.29   0.000     .6570192    .8245156
            2008  |    .700215   .0417938    -5.97   0.000     .6229105    .7871131
            2009  |   .6180512   .0378596    -7.86   0.000     .5481291    .6968929
            2010  |   .6051613   .0406217    -7.48   0.000     .5305593     .690253
            2011  |   .5528916   .0350956    -9.34   0.000     .4882123    .6261397
            2012  |   .4930318   .0339404   -10.27   0.000     .4308023    .5642503
            2013  |   .4740508   .0372248    -9.51   0.000     .4064287     .552924
            2014  |   .4998345    .042911    -8.08   0.000     .4224255    .5914286
            2015  |   .4695533   .0418522    -8.48   0.000     .3942899    .5591832
                  |
            _cons |   .0000943   5.31e-06  -164.59   0.000     .0000845    .0001053
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  22318.61
         Prob > chi2(6221)        =    0.0000

         Pearson goodness-of-fit  =   27606.4
         Prob > chi2(6221)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -17735.121  
Iteration 1:   log pseudolikelihood = -17511.531  
Iteration 2:   log pseudolikelihood = -17506.398  
Iteration 3:   log pseudolikelihood = -17506.387  
Iteration 4:   log pseudolikelihood = -17506.387  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  3924.804417                   (1/df) Deviance =   .6308961
Pearson          =  5309.385858                   (1/df) Pearson  =   .8534618

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.609591
Log pseudolikelihood =  -17506.3874               BIC             =  -50451.82

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p48_1lag |   1.004746   .0057121     0.83   0.405     .9936127    1.016004
         p75_1lag |   1.000896    .000215     4.17   0.000     1.000475    1.001318
        mine_time |   1.010274   .0061949     1.67   0.096     .9982044    1.022489
onsite_insp_hours |   .9997586   .0000441    -5.48   0.000     .9996722    .9998449
                  |
            state |
               1  |   .8056636   .0998003    -1.74   0.081     .6319933    1.027058
               2  |   1.087321   .0525646     1.73   0.083     .9890265    1.195385
               3  |   .6526044   .0849205    -3.28   0.001      .505693    .8421959
               4  |   .9996044   .0662954    -0.01   0.995     .8777586    1.138364
               5  |     .85162   .0790966    -1.73   0.084     .7098851    1.021653
               6  |   .7697643   .0384083    -5.24   0.000     .6980491    .8488472
               7  |   1.077758   .2286259     0.35   0.724     .7111401    1.633381
               8  |    .485653   .0188617   -18.60   0.000     .4500568    .5240647
               9  |    .539306   .0240709   -13.83   0.000     .4941326    .5886092
              10  |   .7761977    .083643    -2.35   0.019     .6284156    .9587331
              11  |   1.499803   .2692096     2.26   0.024     1.054985    2.132171
              12  |   1.018169   .0785037     0.23   0.815      .875366    1.184268
              13  |   1.551996   .1793594     3.80   0.000     1.237427    1.946531
              14  |   .4163269   .0739326    -4.93   0.000     .2939515    .5896488
              15  |   .7081854   .0405853    -6.02   0.000     .6329445    .7923706
              17  |   .5946386   .0219526   -14.08   0.000      .553132    .6392598
                  |
             time |
            2000  |   1.021806    .059357     0.37   0.710     .9118466    1.145025
            2002  |   .8999074   .0509667    -1.86   0.063     .8053592    1.005556
            2003  |   .8448878   .0627656    -2.27   0.023     .7304062     .977313
            2004  |   .7669808   .0491715    -4.14   0.000     .6764155     .869672
            2005  |   .6888405   .0445463    -5.76   0.000     .6068379    .7819241
            2006  |   .6778283   .0453618    -5.81   0.000     .5945049    .7728301
            2007  |    .663306   .0475348    -5.73   0.000     .5763866     .763333
            2008  |   .5961453   .0440139    -7.01   0.000     .5158306    .6889649
            2009  |   .5407977   .0411431    -8.08   0.000     .4658827    .6277592
            2010  |   .5400325   .0411775    -8.08   0.000     .4650672    .6270816
            2011  |   .5072413   .0377156    -9.13   0.000     .4384541    .5868202
            2012  |   .4525838   .0378181    -9.49   0.000     .3842132     .533121
            2013  |   .4544488   .0399839    -8.96   0.000     .3824665    .5399784
            2014  |   .4346899   .0372886    -9.71   0.000     .3674192    .5142773
            2015  |   .4056737   .0358344   -10.21   0.000     .3411832    .4823541
                  |
            _cons |   .0001138   8.14e-06  -126.97   0.000     .0000989    .0001309
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -23226.396  
Iteration 1:   log pseudolikelihood =  -20951.61  
Iteration 2:   log pseudolikelihood =  -20923.32  
Iteration 3:   log pseudolikelihood = -20923.297  
Iteration 4:   log pseudolikelihood = -20923.297  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood =  -16876.95  
Iteration 1:   log pseudolikelihood = -16747.086  
Iteration 2:   log pseudolikelihood = -16735.814  
Iteration 3:   log pseudolikelihood = -16735.784  
Iteration 4:   log pseudolikelihood = -16735.784  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(31)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16735.784               Pseudo R2         =     0.0376

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p48_1lag |   1.003634   .0046736     0.78   0.436     .9945158    1.012836
         p75_1lag |   1.000851   .0002048     4.16   0.000      1.00045    1.001253
        mine_time |   1.007751   .0056972     1.37   0.172     .9966464     1.01898
onsite_insp_hours |   .9997666   .0000438    -5.33   0.000     .9996808    .9998524
                  |
            state |
               1  |   .8303162    .093747    -1.65   0.100     .6654853    1.035973
               2  |   1.228652   .0566571     4.47   0.000     1.122477    1.344871
               3  |   .6438024   .0832542    -3.41   0.001     .4996642    .8295202
               4  |   1.015863   .0630241     0.25   0.800     .8995526    1.147212
               5  |   .8797707   .0828062    -1.36   0.174     .7315639    1.058003
               6  |   .7980057   .0378201    -4.76   0.000     .7272182    .8756837
               7  |   1.062848   .2064012     0.31   0.754     .7263919    1.555147
               8  |   .4881281   .0177719   -19.70   0.000     .4545095    .5242333
               9  |   .5694127   .0235744   -13.60   0.000     .5250326    .6175441
              10  |   .7961218   .0712138    -2.55   0.011     .6680958    .9486812
              11  |   1.535957    .269262     2.45   0.014     1.089328    2.165706
              12  |   1.080957   .0773204     1.09   0.276     .9395553    1.243639
              13  |   1.521649   .1631724     3.91   0.000     1.233209    1.877553
              14  |   .4149015   .0734012    -4.97   0.000     .2933303    .5868581
              15  |   .7344955   .0399371    -5.68   0.000     .6602468    .8170939
              17  |   .6139797   .0212122   -14.12   0.000     .5737809    .6569949
                  |
             time |
            2000  |   1.040844    .049755     0.84   0.402     .9477548    1.143076
            2002  |   .9255567   .0425385    -1.68   0.092     .8458277    1.012801
            2003  |   .8399514   .0478772    -3.06   0.002     .7511657    .9392314
            2004  |   .7899998   .0414552    -4.49   0.000     .7127878    .8755758
            2005  |   .7145887    .039816    -6.03   0.000     .6406609    .7970473
            2006  |   .7019668   .0402744    -6.17   0.000     .6273069    .7855124
            2007  |   .6947685   .0432683    -5.85   0.000     .6149355    .7849658
            2008  |   .6190428    .039355    -7.54   0.000     .5465205    .7011888
            2009  |   .5543276   .0364403    -8.98   0.000     .4873156    .6305546
            2010  |   .5567466   .0379069    -8.60   0.000     .4871944    .6362282
            2011  |   .5194042   .0340234   -10.00   0.000     .4568229    .5905587
            2012  |   .4578018   .0328522   -10.89   0.000     .3977358    .5269391
            2013  |   .4470435   .0335788   -10.72   0.000     .3858455    .5179479
            2014  |   .4445657   .0344086   -10.47   0.000     .3819921    .5173894
            2015  |   .4233066   .0340842   -10.68   0.000     .3615074    .4956702
                  |
            _cons |   .0001092   6.65e-06  -149.93   0.000      .000097    .0001231
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.174225   .0604173                     -1.292641   -1.055809
------------------+----------------------------------------------------------------
            alpha |   .3090585   .0186725                      .2745449    .3479108
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.V.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.V.2.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =   8375.03
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -24975.69   -20923.3      32    41910.59    42126.3
        nbin |      6,253 -17389.65  -16735.78      33    33537.57   33760.01
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv2_yhat 
(option n assumed; predicted number of events)

. gen cv2_res = dv - cv2_yhat

. 
. summ dv cv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
    cv2_yhat |      6,253    10.62723    15.74789     .00354   147.1036

. /*
> pause "next"
> 
> scatter dv cv2_yhat
> 
> pause "next"
> 
> scatter cv2_res dv
> 
> pause "next"
> 
> scatter cv2_res cv2_yhat
> */
. pause "complete: C.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.3
. 
. // poisson model
. glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -23327.994  
Iteration 1:   log pseudolikelihood = -20952.169  
Iteration 2:   log pseudolikelihood = -20942.839  
Iteration 3:   log pseudolikelihood = -20942.834  
Iteration 4:   log pseudolikelihood = -20942.834  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  22357.68789                   (1/df) Deviance =   3.593906
Pearson          =  27661.68479                   (1/df) Pearson  =   4.446501

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.708727
Log pseudolikelihood = -20942.83404               BIC             =  -32018.93

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p48_c_4lag |   1.002312   .0019534     1.19   0.236     .9984912    1.006148
       p75_c_4lag |   1.000086   .0000499     1.73   0.084     .9999884    1.000184
        mine_time |   1.007009   .0066613     1.06   0.291     .9940375     1.02015
onsite_insp_hours |   .9998025   .0000432    -4.57   0.000     .9997178    .9998872
                  |
            state |
               1  |   .9483976   .0872613    -0.58   0.565     .7919031    1.135818
               2  |   1.638669   .0867534     9.33   0.000      1.47716    1.817837
               3  |   .6416376   .0669878    -4.25   0.000     .5229056    .7873291
               4  |   1.225243    .099379     2.50   0.012     1.045157    1.436359
               5  |   1.072775   .1289128     0.58   0.559     .8476598    1.357674
               6  |   .9817235   .0555204    -0.33   0.744     .8787197    1.096801
               7  |   1.125295   .1674157     0.79   0.428     .8406764    1.506273
               8  |   .5060109   .0207673   -16.60   0.000     .4669018    .5483959
               9  |   .6480692   .0282606    -9.95   0.000     .5949805    .7058948
              10  |   .9014646   .0553128    -1.69   0.091     .7993187    1.016664
              11  |   1.720141   .3254036     2.87   0.004     1.187244     2.49223
              12  |   1.023453   .0973682     0.24   0.807     .8493507    1.233243
              13  |   1.545979   .1593132     4.23   0.000     1.263244    1.891995
              14  |   .4211313     .06414    -5.68   0.000     .3124468    .5676217
              15  |   .8065459   .0612504    -2.83   0.005     .6950042     .935989
              17  |   .6631385   .0238992   -11.40   0.000     .6179129    .7116741
                  |
             time |
            2000  |   1.076043   .0451138     1.75   0.080      .991157    1.168199
            2002  |   .9603448   .0364581    -1.07   0.286     .8914819    1.034527
            2003  |   .8419907   .0332619    -4.35   0.000     .7792584     .909773
            2004  |   .8151854   .0356276    -4.68   0.000     .7482638    .8880921
            2005  |   .7617128   .0393491    -5.27   0.000     .6883658    .8428752
            2006  |   .7260485   .0390488    -5.95   0.000       .65341    .8067621
            2007  |   .7342848   .0426162    -5.32   0.000      .655334     .822747
            2008  |   .7017917   .0417643    -5.95   0.000     .6245287    .7886131
            2009  |   .6169186   .0382194    -7.80   0.000     .5463793    .6965648
            2010  |     .60431   .0406755    -7.48   0.000     .5296223    .6895301
            2011  |   .5500578   .0352518    -9.33   0.000     .4851288    .6236768
            2012  |   .4902897   .0340421   -10.27   0.000     .4279091     .561764
            2013  |   .4727326   .0375772    -9.43   0.000      .404533    .5524297
            2014  |   .4961598   .0429694    -8.09   0.000     .4187011     .587948
            2015  |   .4665219   .0418326    -8.50   0.000     .3913322    .5561585
                  |
            _cons |   .0000948   5.37e-06  -163.69   0.000     .0000849     .000106
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  22357.69
         Prob > chi2(6221)        =    0.0000

         Pearson goodness-of-fit  =  27661.68
         Prob > chi2(6221)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood =  -17736.93  
Iteration 1:   log pseudolikelihood = -17512.793  
Iteration 2:   log pseudolikelihood = -17507.638  
Iteration 3:   log pseudolikelihood = -17507.627  
Iteration 4:   log pseudolikelihood = -17507.627  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  3927.283352                   (1/df) Deviance =   .6312945
Pearson          =  5307.218731                   (1/df) Pearson  =   .8531134

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.609988
Log pseudolikelihood = -17507.62687               BIC             =  -50449.34

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p48_c_4lag |   1.002813   .0025542     1.10   0.270     .9978197    1.007832
       p75_c_4lag |   1.000206   .0000555     3.72   0.000     1.000098    1.000315
        mine_time |   1.009501   .0062375     1.53   0.126     .9973499    1.021801
onsite_insp_hours |   .9997699   .0000445    -5.17   0.000     .9996826    .9998571
                  |
            state |
               1  |   .8066529   .1000453    -1.73   0.083     .6325811    1.028625
               2  |   1.092175     .05285     1.82   0.068     .9933515     1.20083
               3  |   .6536758   .0847885    -3.28   0.001     .5069356    .8428922
               4  |   1.005205   .0664624     0.08   0.937     .8830285    1.144286
               5  |   .8530909   .0794236    -1.71   0.088     .7108003    1.023866
               6  |    .769666   .0384086    -5.25   0.000     .6979508      .84875
               7  |     1.0777   .2275967     0.35   0.723     .7124183    1.630276
               8  |   .4851147   .0188911   -18.58   0.000     .4494666    .5235901
               9  |    .538978   .0240452   -13.85   0.000     .4938519    .5882275
              10  |   .7769826   .0833721    -2.35   0.019     .6296154    .9588423
              11  |    1.51677   .2730939     2.31   0.021     1.065764     2.15863
              12  |   1.013056    .078163     0.17   0.866     .8708798    1.178442
              13  |   1.549283   .1791225     3.79   0.000     1.235145    1.943317
              14  |    .416472   .0744049    -4.90   0.000     .2934365    .5910953
              15  |   .7075368   .0406267    -6.03   0.000     .6322271    .7918172
              17  |   .5909481   .0216645   -14.35   0.000     .5499761    .6349725
                  |
             time |
            2000  |   1.040411   .0606625     0.68   0.497     .9280566    1.166367
            2002  |   .8969354   .0507166    -1.92   0.054     .8028428    1.002056
            2003  |    .842744   .0626234    -2.30   0.021     .7285239    .9748718
            2004  |   .7657497   .0491344    -4.16   0.000     .6752574    .8683689
            2005  |   .6872697   .0445208    -5.79   0.000     .6053229    .7803103
            2006  |   .6790756    .045567    -5.77   0.000     .5953896    .7745243
            2007  |   .6634748   .0476008    -5.72   0.000     .5764415    .7636487
            2008  |   .5986508   .0441974    -6.95   0.000     .5180011    .6918572
            2009  |   .5406606   .0411408    -8.08   0.000      .465751    .6276183
            2010  |   .5394978   .0410846    -8.10   0.000     .4646947    .6263421
            2011  |   .5051653   .0376213    -9.17   0.000     .4365578    .5845548
            2012  |   .4510648   .0377405    -9.52   0.000     .3828415    .5314456
            2013  |   .4526239   .0399253    -8.99   0.000     .3807626    .5380476
            2014  |   .4331032   .0372896    -9.72   0.000     .3658509    .5127181
            2015  |   .4035434   .0357354   -10.25   0.000     .3392446    .4800291
                  |
            _cons |   .0001145   8.21e-06  -126.57   0.000     .0000995    .0001318
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22862.196  
Iteration 1:   log pseudolikelihood = -20967.944  
Iteration 2:   log pseudolikelihood = -20942.844  
Iteration 3:   log pseudolikelihood = -20942.834  
Iteration 4:   log pseudolikelihood = -20942.834  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16878.952  
Iteration 1:   log pseudolikelihood = -16750.544  
Iteration 2:   log pseudolikelihood = -16739.598  
Iteration 3:   log pseudolikelihood = -16739.569  
Iteration 4:   log pseudolikelihood = -16739.569  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(31)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16739.569               Pseudo R2         =     0.0374

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p48_c_4lag |   1.001977    .002044     0.97   0.333     .9979788    1.005991
       p75_c_4lag |   1.000196   .0000527     3.71   0.000     1.000092    1.000299
        mine_time |   1.007006   .0057439     1.22   0.221     .9958107    1.018327
onsite_insp_hours |   .9997785   .0000441    -5.02   0.000     .9996921    .9998649
                  |
            state |
               1  |   .8311519   .0938742    -1.64   0.102     .6661035    1.037096
               2  |   1.234734   .0570541     4.56   0.000     1.127824    1.351778
               3  |     .64517   .0832586    -3.40   0.001      .500988    .8308469
               4  |   1.021373   .0632203     0.34   0.733     .9046842    1.153112
               5  |    .881252   .0832611    -1.34   0.181     .7322817    1.060528
               6  |   .7973156   .0378317    -4.77   0.000     .7265102    .8750217
               7  |   1.062596   .2054811     0.31   0.754     .7273878    1.552282
               8  |   .4868713   .0178392   -19.64   0.000      .453133    .5231217
               9  |   .5689643   .0235923   -13.60   0.000     .5245534    .6171353
              10  |   .7970599   .0711534    -2.54   0.011     .6691204     .949462
              11  |   1.551576    .273456     2.49   0.013     1.098383    2.191756
              12  |   1.074496   .0771422     1.00   0.317     .9334558    1.236846
              13  |   1.518469   .1630485     3.89   0.000     1.230287    1.874154
              14  |    .414519   .0737917    -4.95   0.000     .2924258    .5875885
              15  |   .7333769   .0399951    -5.69   0.000      .659032    .8161087
              17  |   .6105008   .0209942   -14.35   0.000      .570709    .6530671
                  |
             time |
            2000  |    1.06054   .0510476     1.22   0.222     .9650629    1.165463
            2002  |   .9222531   .0424076    -1.76   0.078     .8427711    1.009231
            2003  |   .8379868   .0479227    -3.09   0.002     .7491327    .9373798
            2004  |   .7884283   .0414655    -4.52   0.000     .7112057    .8740356
            2005  |   .7129587   .0398739    -6.05   0.000     .6389383    .7955543
            2006  |    .703381   .0405476    -6.10   0.000     .6282344    .7875163
            2007  |   .6946806   .0433942    -5.83   0.000     .6146299    .7851573
            2008  |   .6216302   .0395014    -7.48   0.000     .5488361    .7040792
            2009  |   .5542274   .0365119    -8.96   0.000     .4870929    .6306149
            2010  |   .5561662    .037853    -8.62   0.000     .4867112    .6355326
            2011  |   .5171223    .033989   -10.03   0.000     .4546175    .5882208
            2012  |   .4561018   .0328433   -10.90   0.000     .3960663    .5252374
            2013  |   .4453978   .0336434   -10.71   0.000     .3841069    .5164688
            2014  |   .4427952   .0344782   -10.46   0.000      .380123    .5158004
            2015  |   .4208987   .0340504   -10.70   0.000     .3591832    .4932182
                  |
            _cons |     .00011   6.74e-06  -148.76   0.000     .0000975     .000124
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.171286   .0603117                     -1.289495   -1.053077
------------------+----------------------------------------------------------------
            alpha |   .3099681   .0186947                      .2754099    .3488626
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.V.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.V.3.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =   8406.53
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -24975.69  -20942.83      32    41949.67   42165.37
        nbin |      6,253 -17389.65  -16739.57      33    33545.14   33767.58
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv3_yhat 
(option n assumed; predicted number of events)

. gen cv3_res = dv - cv3_yhat

. 
. summ dv cv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
    cv3_yhat |      6,253    10.61109    15.63275   .0035451   144.4476

. 
. pause "next"

. /*
> scatter dv cv3_yhat
> 
> pause "next"
> 
> scatter cv3_res dv
> 
> pause "next"
> 
> scatter cv3_res cv3_yhat
> */
. pause "complete: C.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.4
. 
. // poisson model
. glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -23359.587  
Iteration 1:   log pseudolikelihood = -20989.988  
Iteration 2:   log pseudolikelihood =  -20980.46  
Iteration 3:   log pseudolikelihood = -20980.455  
Iteration 4:   log pseudolikelihood = -20980.455  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  22432.93067                   (1/df) Deviance =   3.606001
Pearson          =  27735.31791                   (1/df) Pearson  =   4.458338

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =    6.72076
Log pseudolikelihood = -20980.45544               BIC             =  -31943.69

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_c_lag_all |   1.000439   .0010463     0.42   0.675       .99839    1.002491
    p75_c_lag_all |    .999995   6.31e-06    -0.79   0.431     .9999827    1.000007
        mine_time |   1.010898   .0065948     1.66   0.097      .998055    1.023907
onsite_insp_hours |   .9998681   .0000474    -2.78   0.005     .9997751    .9999611
                  |
            state |
               1  |   .9534848   .0860562    -0.53   0.598     .7988939     1.13799
               2  |   1.598375    .078804     9.51   0.000      1.45115    1.760537
               3  |   .6376342   .0661782    -4.34   0.000     .5202689    .7814754
               4  |   1.245961   .1098067     2.50   0.013     1.048306    1.480884
               5  |   1.070862   .1346084     0.54   0.586      .837022    1.370032
               6  |   .9644486   .0531708    -0.66   0.511     .8656686      1.0745
               7  |   1.120888    .167466     0.76   0.445     .8363513    1.502228
               8  |   .4753009   .0199553   -17.72   0.000     .4377552    .5160667
               9  |    .633081   .0262878   -11.01   0.000     .5835987    .6867589
              10  |   .8993007   .0610726    -1.56   0.118     .7872249    1.027332
              11  |   1.717756   .3142816     2.96   0.003     1.200122    2.458657
              12  |   .9601683    .094233    -0.41   0.679     .7921522    1.163821
              13  |   1.522745   .1581781     4.05   0.000     1.242244    1.866583
              14  |   .4036136   .0622929    -5.88   0.000     .2982586    .5461834
              15  |   .7940056   .0623293    -2.94   0.003     .6807761    .9260678
              17  |    .644616   .0248982   -11.37   0.000     .5976178    .6953103
                  |
             time |
            2000  |   1.043415   .0425604     1.04   0.297     .9632456    1.130257
            2002  |   .9567124   .0362969    -1.17   0.243     .8881524    1.030565
            2003  |   .8385228   .0331071    -4.46   0.000     .7760812    .9059882
            2004  |    .809171     .03498    -4.90   0.000     .7434356    .8807188
            2005  |    .753645   .0384841    -5.54   0.000     .6818692    .8329761
            2006  |   .7254375   .0386331    -6.03   0.000     .6535358    .8052498
            2007  |   .7316125   .0422016    -5.42   0.000     .6534032     .819183
            2008  |   .6887021   .0423117    -6.07   0.000     .6105711     .776831
            2009  |   .6069449   .0391134    -7.75   0.000     .5349279    .6886575
            2010  |   .5910038   .0412279    -7.54   0.000     .5154792    .6775937
            2011  |   .5365017    .036102    -9.25   0.000     .4702107    .6121386
            2012  |   .4739624   .0342026   -10.35   0.000     .4114514    .5459707
            2013  |   .4565246   .0365489    -9.79   0.000     .3902275    .5340851
            2014  |   .4761115   .0428452    -8.25   0.000     .3991252    .5679476
            2015  |   .4477509   .0422527    -8.51   0.000     .3721445    .5387179
                  |
            _cons |   .0000958   5.60e-06  -158.43   0.000     .0000855    .0001075
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  22432.93
         Prob > chi2(6221)        =    0.0000

         Pearson goodness-of-fit  =  27735.32
         Prob > chi2(6221)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -17750.819  
Iteration 1:   log pseudolikelihood = -17519.942  
Iteration 2:   log pseudolikelihood = -17514.352  
Iteration 3:   log pseudolikelihood = -17514.339  
Iteration 4:   log pseudolikelihood = -17514.339  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  3940.707472                   (1/df) Deviance =   .6334524
Pearson          =  5301.428848                   (1/df) Pearson  =   .8521827

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.612135
Log pseudolikelihood = -17514.33893               BIC             =  -50435.91

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_c_lag_all |   1.000345   .0011197     0.31   0.758     .9981533    1.002542
    p75_c_lag_all |   .9999974   6.52e-06    -0.41   0.685     .9999846     1.00001
        mine_time |     1.0125   .0066514     1.89   0.059     .9995468    1.025621
onsite_insp_hours |   .9998915   .0000425    -2.55   0.011     .9998082    .9999747
                  |
            state |
               1  |   .8222163   .1032643    -1.56   0.119     .6428083    1.051697
               2  |   1.079325    .053121     1.55   0.121     .9800738    1.188627
               3  |   .6626072   .0850686    -3.21   0.001     .5151989    .8521919
               4  |   1.037831   .0712782     0.54   0.589     .9071224    1.187373
               5  |    .858391   .0846161    -1.55   0.121     .7075836     1.04134
               6  |   .7613902   .0379185    -5.47   0.000     .6905832    .8394571
               7  |   1.086578    .226405     0.40   0.690     .7222707    1.634638
               8  |   .4597132   .0176988   -20.19   0.000     .4263006    .4957446
               9  |   .5291246   .0232828   -14.47   0.000     .4854036    .5767837
              10  |   .7784752   .0845166    -2.31   0.021     .6292635    .9630682
              11  |    1.53288    .273181     2.40   0.017     1.080966    2.173724
              12  |   .9613829   .0742886    -0.51   0.610     .8262696     1.11859
              13  |   1.531952   .1809726     3.61   0.000     1.215321    1.931076
              14  |   .4043601   .0752422    -4.87   0.000     .2807884    .5823143
              15  |   .7062537   .0408533    -6.01   0.000     .6305549    .7910402
              17  |   .5715042   .0216811   -14.75   0.000     .5305514    .6156182
                  |
             time |
            2000  |   1.009033   .0587781     0.15   0.877     .9001628     1.13107
            2002  |   .8934624     .05018    -2.01   0.045     .8003312    .9974308
            2003  |   .8352689   .0619769    -2.43   0.015     .7222163    .9660184
            2004  |   .7555849   .0485765    -4.36   0.000     .6661308    .8570517
            2005  |   .6764389   .0440841    -6.00   0.000     .5953263     .768603
            2006  |   .6732773   .0453873    -5.87   0.000     .5899461    .7683792
            2007  |   .6596874   .0478176    -5.74   0.000     .5723196    .7603924
            2008  |   .5937608   .0444668    -6.96   0.000      .512702    .6876351
            2009  |   .5397111   .0415166    -8.02   0.000     .4641772    .6275364
            2010  |   .5335497   .0409482    -8.19   0.000     .4590373    .6201571
            2011  |   .4971887   .0375641    -9.25   0.000     .4287561    .5765435
            2012  |   .4401829   .0374828    -9.64   0.000     .3725212    .5201341
            2013  |   .4383184   .0391545    -9.23   0.000     .3679194    .5221877
            2014  |   .4148091    .036117   -10.11   0.000     .3497317     .491996
            2015  |   .3866195   .0345901   -10.62   0.000     .3244355    .4607222
                  |
            _cons |    .000116   8.46e-06  -124.33   0.000     .0001006    .0001338
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22034.576  
Iteration 1:   log pseudolikelihood = -20987.464  
Iteration 2:   log pseudolikelihood = -20980.459  
Iteration 3:   log pseudolikelihood = -20980.455  
Iteration 4:   log pseudolikelihood = -20980.455  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16886.094  
Iteration 1:   log pseudolikelihood = -16764.832  
Iteration 2:   log pseudolikelihood = -16755.756  
Iteration 3:   log pseudolikelihood = -16755.736  
Iteration 4:   log pseudolikelihood = -16755.736  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(31)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16755.736               Pseudo R2         =     0.0365

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_c_lag_all |   1.000193   .0010067     0.19   0.848     .9982221    1.002168
    p75_c_lag_all |   .9999955   5.82e-06    -0.78   0.435      .999984    1.000007
        mine_time |   1.011179   .0061983     1.81   0.070      .999103      1.0234
onsite_insp_hours |   .9999004   .0000411    -2.43   0.015       .99982    .9999809
                  |
            state |
               1  |   .8512287   .0966092    -1.42   0.156     .6814597    1.063292
               2  |   1.209253    .057146     4.02   0.000      1.10228    1.326608
               3  |   .6543649   .0834414    -3.33   0.001     .5096581    .8401581
               4  |   1.056402   .0695734     0.83   0.405     .9284751    1.201956
               5  |   .8878258   .0892068    -1.18   0.236     .7291231    1.081072
               6  |   .7874518   .0370833    -5.07   0.000     .7180234    .8635936
               7  |   1.071568   .2059342     0.36   0.719      .735251    1.561723
               8  |   .4545616   .0169893   -21.09   0.000     .4224535      .48911
               9  |   .5569751   .0227863   -14.31   0.000     .5140582    .6034748
              10  |   .8010384   .0725547    -2.45   0.014     .6707413    .9566469
              11  |   1.569239   .2722884     2.60   0.009     1.116842    2.204887
              12  |   1.012354   .0745939     0.17   0.868     .8762197     1.16964
              13  |   1.497998   .1646743     3.68   0.000     1.207645    1.858162
              14  |     .39856   .0739451    -4.96   0.000     .2770574    .5733474
              15  |   .7305873   .0403143    -5.69   0.000     .6556956     .814033
              17  |   .5902451   .0212009   -14.68   0.000      .550121    .6332958
                  |
             time |
            2000  |   1.027434   .0495714     0.56   0.575     .9347278    1.129334
            2002  |   .9176463   .0421051    -1.87   0.061     .8387238    1.003995
            2003  |   .8300172    .047567    -3.25   0.001     .7418329    .9286844
            2004  |   .7763464   .0410736    -4.79   0.000     .6998769    .8611711
            2005  |   .6996993   .0395673    -6.31   0.000     .6262919    .7817107
            2006  |   .6957431   .0403455    -6.26   0.000     .6209956    .7794877
            2007  |    .688681   .0435679    -5.90   0.000     .6083712    .7795923
            2008  |   .6133627   .0397031    -7.55   0.000     .5402799    .6963312
            2009  |   .5506904   .0367645    -8.94   0.000     .4831486    .6276742
            2010  |   .5465011   .0374344    -8.82   0.000     .4778431    .6250242
            2011  |   .5058901   .0338606   -10.18   0.000     .4436934    .5768056
            2012  |   .4419127   .0324337   -11.13   0.000     .3827045     .510281
            2013  |    .429197   .0329184   -11.03   0.000     .3692934    .4988177
            2014  |   .4212441   .0332957   -10.94   0.000     .3607894    .4918287
            2015  |   .4009056   .0329714   -11.11   0.000     .3412222    .4710282
                  |
            _cons |   .0001112   6.98e-06  -145.05   0.000     .0000983    .0001258
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.161865   .0600365                     -1.279535   -1.044196
------------------+----------------------------------------------------------------
            alpha |    .312902   .0187855                      .2781667    .3519747
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.V.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.V.4.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =   8449.44
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -24975.69  -20980.46      32    42024.91   42240.62
        nbin |      6,253 -17389.65  -16755.74      33    33577.47   33799.92
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv4_yhat 
(option n assumed; predicted number of events)

. gen cv4_res = dv - cv4_yhat

. 
. summ dv cv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
    cv4_yhat |      6,253    10.51009    14.97346   .0034721   128.9332

. /*
> pause "next"
> 
> scatter dv cv4_yhat
> 
> pause "next"
> 
> scatter cv4_res dv
> 
> pause "next"
> 
> scatter cv4_res cv4_yhat
> */
. pause "complete: C.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.1
. 
. // poisson model
. glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -23355.848  
Iteration 1:   log pseudolikelihood = -20943.545  
Iteration 2:   log pseudolikelihood = -20933.959  
Iteration 3:   log pseudolikelihood = -20933.954  
Iteration 4:   log pseudolikelihood = -20933.954  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  22339.92834                   (1/df) Deviance =   3.591051
Pearson          =  27593.10784                   (1/df) Pearson  =   4.435478

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.705887
Log pseudolikelihood = -20933.95427               BIC             =  -32036.69

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_ss |   1.005955   .0218027     0.27   0.784     .9641179    1.049609
           p75_ss |   1.001043   .0005204     2.01   0.045     1.000024    1.002064
        mine_time |   1.007804   .0065486     1.20   0.232     .9950506    1.020721
onsite_insp_hours |   .9998075   .0000408    -4.72   0.000     .9997276    .9998873
                  |
            state |
               1  |   .9451555   .0884239    -0.60   0.547     .7868089     1.13537
               2  |   1.618774   .0852474     9.15   0.000     1.460026    1.794783
               3  |   .6595496   .0676088    -4.06   0.000     .5395018      .80631
               4  |   1.253742   .1081315     2.62   0.009     1.058752    1.484642
               5  |   1.092358   .1343878     0.72   0.473     .8583131    1.390223
               6  |   .9839307   .0546378    -0.29   0.770     .8824643    1.097064
               7  |   1.124443   .1669332     0.79   0.430     .8405608      1.5042
               8  |   .5072793   .0197908   -17.40   0.000     .4699359    .5475902
               9  |   .6522667   .0278332   -10.01   0.000     .5999335     .709165
              10  |   .8843109   .0551127    -1.97   0.049     .7826286    .9992042
              11  |    1.71047   .3313568     2.77   0.006     1.170088    2.500417
              12  |   1.016081   .0931928     0.17   0.862      .848903    1.216183
              13  |   1.547578   .1582038     4.27   0.000     1.266593    1.890898
              14  |   .4245911   .0644041    -5.65   0.000     .3153961    .5715911
              15  |   .8061095   .0623537    -2.79   0.005     .6927115    .9380709
              17  |   .6736223   .0241526   -11.02   0.000     .6279091    .7226634
                  |
             time |
            2000  |   1.050126   .0421178     1.22   0.223     .9707374    1.136006
            2002  |   .9686002   .0357731    -0.86   0.388     .9009638    1.041314
            2003  |   .8442923   .0328301    -4.35   0.000     .7823373    .9111535
            2004  |   .8084112   .0356732    -4.82   0.000     .7414312    .8814422
            2005  |   .7622664   .0384557    -5.38   0.000     .6905011    .8414904
            2006  |    .724466   .0390863    -5.97   0.000     .6517696    .8052708
            2007  |   .7411324   .0422594    -5.25   0.000     .6627661    .8287648
            2008  |   .7096592   .0415659    -5.86   0.000     .6326938    .7959872
            2009  |   .6283243   .0375491    -7.78   0.000     .5588761    .7064025
            2010  |   .6118739   .0409059    -7.35   0.000     .5367304    .6975378
            2011  |   .5583769   .0357651    -9.10   0.000     .4925001    .6330653
            2012  |   .4997546   .0344606   -10.06   0.000     .4365783    .5720729
            2013  |   .4818924   .0381785    -9.21   0.000     .4125842    .5628434
            2014  |   .5055702   .0434088    -7.94   0.000     .4272642    .5982277
            2015  |   .4786193   .0427008    -8.26   0.000     .4018361    .5700743
                  |
            _cons |   .0000935   5.03e-06  -172.44   0.000     .0000842    .0001039
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  22284.05
         Prob > chi2(6221)        =    0.0000

         Pearson goodness-of-fit  =  27548.49
         Prob > chi2(6221)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -17728.496  
Iteration 1:   log pseudolikelihood = -17505.323  
Iteration 2:   log pseudolikelihood = -17500.321  
Iteration 3:   log pseudolikelihood = -17500.312  
Iteration 4:   log pseudolikelihood = -17500.312  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  3912.653311                   (1/df) Deviance =   .6289428
Pearson          =  5288.208941                   (1/df) Pearson  =   .8500577

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.607648
Log pseudolikelihood = -17500.31185               BIC             =  -50463.97

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_ss |   1.007662   .0233153     0.33   0.742     .9629851    1.054411
           p75_ss |   1.003017   .0006148     4.91   0.000     1.001813    1.004223
        mine_time |    1.01094   .0061509     1.79   0.074     .9989562    1.023068
onsite_insp_hours |   .9997595   .0000408    -5.90   0.000     .9996796    .9998394
                  |
            state |
               1  |   .7973523   .0986548    -1.83   0.067      .625652    1.016173
               2  |   1.075023    .051944     1.50   0.134     .9778863    1.181808
               3  |   .6857901   .0848543    -3.05   0.002      .538109    .8740015
               4  |   1.043137   .0698662     0.63   0.528     .9148087    1.189466
               5  |    .875329   .0802153    -1.45   0.146     .7314204    1.047552
               6  |   .7708536   .0382346    -5.25   0.000     .6994425    .8495555
               7  |   1.079084    .226597     0.36   0.717     .7150086    1.628543
               8  |   .5043957   .0198287   -17.41   0.000     .4669917    .5447956
               9  |   .5507337   .0245488   -13.38   0.000     .5046609    .6010128
              10  |    .759972   .0840838    -2.48   0.013      .611815    .9440067
              11  |   1.489965   .2774909     2.14   0.032     1.034304    2.146365
              12  |   1.024786   .0784544     0.32   0.749     .8819984    1.190689
              13  |   1.553279   .1775333     3.85   0.000      1.24154    1.943293
              14  |   .4203938   .0731423    -4.98   0.000     .2989234     .591225
              15  |   .7072742   .0403656    -6.07   0.000     .6324235     .790984
              17  |   .6236975   .0242244   -12.15   0.000     .5779806    .6730304
                  |
             time |
            2000  |   1.017587   .0585196     0.30   0.762     .9091184    1.138997
            2002  |   .9133641   .0515905    -1.60   0.109     .8176447    1.020289
            2003  |   .8542678   .0631307    -2.13   0.033     .7390774    .9874114
            2004  |   .7671181   .0485856    -4.19   0.000     .6775654    .8685069
            2005  |   .6910389   .0441108    -5.79   0.000     .6097729    .7831353
            2006  |   .6752788   .0447747    -5.92   0.000      .592985    .7689932
            2007  |   .6659044    .047342    -5.72   0.000     .5792904    .7654687
            2008  |   .6076881   .0443237    -6.83   0.000     .5267391    .7010772
            2009  |   .5595702   .0418138    -7.77   0.000     .4833355    .6478292
            2010  |   .5476992   .0410999    -8.02   0.000     .4727887    .6344788
            2011  |   .5169968   .0380156    -8.97   0.000     .4476078    .5971427
            2012  |    .468642   .0388321    -9.15   0.000     .3983914    .5512802
            2013  |   .4749018   .0416006    -8.50   0.000     .3999817    .5638552
            2014  |    .452677   .0385252    -9.31   0.000     .3831305    .5348478
            2015  |   .4277013   .0377926    -9.61   0.000     .3596885    .5085745
                  |
            _cons |   .0001107   7.77e-06  -129.81   0.000     .0000965     .000127
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22360.885  
Iteration 1:   log pseudolikelihood = -20945.786  
Iteration 2:   log pseudolikelihood = -20933.965  
Iteration 3:   log pseudolikelihood = -20933.954  
Iteration 4:   log pseudolikelihood = -20933.954  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16874.773  
Iteration 1:   log pseudolikelihood = -16738.173  
Iteration 2:   log pseudolikelihood = -16724.123  
Iteration 3:   log pseudolikelihood = -16724.074  
Iteration 4:   log pseudolikelihood = -16724.074  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(31)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16724.074               Pseudo R2         =     0.0383

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_ss |    1.00499   .0227264     0.22   0.826     .9614199    1.050535
           p75_ss |   1.002716    .000586     4.64   0.000     1.001568    1.003865
        mine_time |   1.008406    .005653     1.49   0.135     .9973865    1.019546
onsite_insp_hours |   .9997731   .0000403    -5.63   0.000     .9996941    .9998522
                  |
            state |
               1  |   .8232795    .092893    -1.72   0.085      .659939    1.027048
               2  |   1.214848   .0562373     4.20   0.000     1.109477    1.330226
               3  |   .6775486   .0833827    -3.16   0.002     .5323376    .8623703
               4  |   1.060094   .0668353     0.93   0.355     .9368692    1.199526
               5  |   .9043151   .0836591    -1.09   0.277     .7543524     1.08409
               6  |    .799841    .037534    -4.76   0.000     .7295574    .8768956
               7  |   1.065583   .2045923     0.33   0.741     .7314018    1.552452
               8  |   .5035738   .0183425   -18.83   0.000     .4688765    .5408388
               9  |    .580431   .0238237   -13.25   0.000     .5355662    .6290541
              10  |   .7774117   .0710963    -2.75   0.006     .6498401     .930027
              11  |   1.527289   .2789884     2.32   0.020      1.06766    2.184788
              12  |   1.084082   .0773891     1.13   0.258     .9425348    1.246885
              13  |    1.52093   .1609806     3.96   0.000      1.23599    1.871558
              14  |   .4190755    .072882    -5.00   0.000     .2980291    .5892859
              15  |   .7336703   .0398671    -5.70   0.000     .6595492    .8161212
              17  |   .6401942    .023005   -12.41   0.000     .5966564     .686909
                  |
             time |
            2000  |   1.034785   .0487705     0.73   0.468     .9434784    1.134927
            2002  |   .9377107   .0426973    -1.41   0.158     .8576511    1.025244
            2003  |   .8475885   .0478139    -2.93   0.003     .7588699     .946679
            2004  |   .7892453   .0407964    -4.58   0.000     .7132028    .8733956
            2005  |   .7159859   .0392623    -6.09   0.000     .6430243    .7972261
            2006  |    .699049   .0397112    -6.30   0.000      .625393    .7813799
            2007  |   .6970248   .0429356    -5.86   0.000      .617754    .7864678
            2008  |   .6311503   .0394227    -7.37   0.000     .5584255    .7133461
            2009  |   .5736101   .0366797    -8.69   0.000     .5060417    .6502003
            2010  |   .5656241   .0377729    -8.53   0.000      .496231     .644721
            2011  |   .5292134   .0342044    -9.85   0.000     .4662464    .6006842
            2012  |   .4730474    .033448   -10.59   0.000     .4118304     .543364
            2013  |   .4657655    .034765   -10.24   0.000      .402377    .5391399
            2014  |   .4614097   .0352939   -10.11   0.000     .3971707     .536039
            2015  |   .4453578    .035809   -10.06   0.000     .3804243    .5213747
                  |
            _cons |   .0001065   6.28e-06  -154.99   0.000     .0000949    .0001196
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.178748   .0601869                     -1.296712   -1.060783
------------------+----------------------------------------------------------------
            alpha |   .3076638   .0185173                      .2734294    .3461845
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.SSV.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.SSV.1.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =   8363.89
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -24975.69  -20906.02      32    41876.03   42091.74
        nbin |      6,253 -17389.65  -16724.07      33    33514.15   33736.59
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv1_yhat 
(option n assumed; predicted number of events)

. gen cssv1_res = dv - cssv1_yhat

. 
. summ dv cssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
  cssv1_yhat |      6,253    10.67511    16.03453   .0035951   172.7317

. /*
> pause "next"
> 
> scatter dv cssv1_yhat
> 
> pause "next"
> 
> scatter cssv1_res dv
> 
> pause "next"
> 
> scatter cssv1_res cssv1_yhat
> */
. pause "complete: C.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.2
. 
. // poisson model
. glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -23355.128  
Iteration 1:   log pseudolikelihood = -20950.077  
Iteration 2:   log pseudolikelihood = -20940.577  
Iteration 3:   log pseudolikelihood = -20940.572  
Iteration 4:   log pseudolikelihood = -20940.572  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  22353.16361                   (1/df) Deviance =   3.593179
Pearson          =  27618.24598                   (1/df) Pearson  =   4.439519

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.708003
Log pseudolikelihood = -20940.57191               BIC             =  -32023.46

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_ss_1lag |   .9983437   .0201619    -0.08   0.935     .9595989    1.038653
      p75_ss_1lag |   1.001002   .0005152     1.95   0.052     .9999928    1.002012
        mine_time |   1.007301   .0066121     1.11   0.268     .9944248    1.020345
onsite_insp_hours |   .9998118   .0000398    -4.73   0.000     .9997338    .9998898
                  |
            state |
               1  |   .9470053   .0877927    -0.59   0.557      .789662      1.1357
               2  |   1.626678    .086167     9.19   0.000     1.466265    1.804641
               3  |   .6586571   .0675214    -4.07   0.000     .5387651    .8052288
               4  |   1.255333   .1090836     2.62   0.009     1.058749    1.488419
               5  |   1.093336   .1352196     0.72   0.471     .8579866    1.393244
               6  |   .9830199   .0546311    -0.31   0.758     .8815704    1.096144
               7  |   1.123332   .1664903     0.78   0.433     .8401383    1.501986
               8  |   .5065797   .0201084   -17.13   0.000      .468662    .5475651
               9  |   .6534043   .0282683    -9.84   0.000     .6002833     .711226
              10  |    .887345   .0554288    -1.91   0.056     .7850936    1.002914
              11  |   1.712488   .3309056     2.78   0.005     1.172598    2.500956
              12  |   1.012466   .0932225     0.13   0.893     .8452916    1.212704
              13  |   1.544374   .1583912     4.24   0.000     1.263145    1.888217
              14  |   .4239472   .0643037    -5.66   0.000     .3149218     .570717
              15  |   .8051859   .0627709    -2.78   0.005     .6910953    .9381113
              17  |    .675046   .0248942   -10.66   0.000     .6279759    .7256442
                  |
             time |
            2000  |   1.057156   .0420845     1.40   0.163     .9778077    1.142943
            2002  |   .9638128   .0363547    -0.98   0.328      .895129    1.037767
            2003  |    .843259   .0331061    -4.34   0.000     .7808059    .9107074
            2004  |   .8112388   .0355357    -4.78   0.000     .7444962    .8839647
            2005  |   .7596352   .0393335    -5.31   0.000     .6863258    .8407751
            2006  |   .7264973   .0387755    -5.99   0.000     .6543387    .8066134
            2007  |   .7410255   .0426795    -5.20   0.000     .6619238      .82958
            2008  |   .7087021   .0415883    -5.87   0.000     .6317035    .7950862
            2009  |   .6255791   .0376742    -7.79   0.000     .5559303    .7039536
            2010  |   .6095631   .0407645    -7.40   0.000     .5346808    .6949326
            2011  |   .5571548   .0355582    -9.16   0.000     .4916448    .6313939
            2012  |   .4967488   .0342642   -10.14   0.000     .4339338    .5686567
            2013  |   .4796707   .0378392    -9.31   0.000     .4109562    .5598748
            2014  |   .5042795   .0433099    -7.97   0.000     .4261536     .596728
            2015  |   .4760718    .042534    -8.31   0.000     .3995978    .5671812
                  |
            _cons |    .000094   5.17e-06  -168.58   0.000     .0000844    .0001047
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  22353.16
         Prob > chi2(6221)        =    0.0000

         Pearson goodness-of-fit  =  27618.25
         Prob > chi2(6221)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -17730.179  
Iteration 1:   log pseudolikelihood = -17506.828  
Iteration 2:   log pseudolikelihood = -17501.793  
Iteration 3:   log pseudolikelihood = -17501.783  
Iteration 4:   log pseudolikelihood = -17501.783  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  3915.596225                   (1/df) Deviance =   .6294159
Pearson          =  5294.990645                   (1/df) Pearson  =   .8511478

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.608119
Log pseudolikelihood =  -17501.7833               BIC             =  -50461.02

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_ss_1lag |    .985938   .0207184    -0.67   0.500     .9461556    1.027393
      p75_ss_1lag |     1.0029   .0006079     4.78   0.000     1.001709    1.004092
        mine_time |   1.009884   .0061743     1.61   0.108     .9978553    1.022058
onsite_insp_hours |   .9997704     .00004    -5.74   0.000      .999692    .9998488
                  |
            state |
               1  |   .8008287   .0985224    -1.81   0.071     .6292454    1.019199
               2  |   1.086682     .05261     1.72   0.086     .9883096    1.194847
               3  |   .6866032   .0853868    -3.02   0.002     .5380832    .8761173
               4  |   1.046559   .0700821     0.68   0.497      .917833    1.193339
               5  |   .8797541   .0816652    -1.38   0.168     .7334095      1.0553
               6  |   .7719759   .0382782    -5.22   0.000     .7004823    .8507664
               7  |   1.077525   .2266036     0.36   0.723      .713542    1.627178
               8  |   .5021591   .0197794   -17.49   0.000     .4648507    .5424617
               9  |   .5533584   .0247469   -13.23   0.000     .5069204    .6040506
              10  |   .7612682   .0834586    -2.49   0.013     .6140725    .9437474
              11  |    1.49229   .2756127     2.17   0.030     1.039068      2.1432
              12  |   1.021075   .0782443     0.27   0.785     .8786793    1.186546
              13  |   1.545544   .1767643     3.81   0.000     1.235177    1.933898
              14  |    .419083   .0726326    -5.02   0.000      .298384    .5886057
              15  |   .7077723   .0404129    -6.05   0.000     .6328358    .7915822
              17  |   .6258338   .0244141   -12.01   0.000     .5797665    .6755615
                  |
             time |
            2000  |   1.028974   .0594176     0.49   0.621     .9188656    1.152276
            2002  |   .9072523   .0514701    -1.72   0.086      .811779    1.013954
            2003  |   .8513042   .0629669    -2.18   0.030     .7364198    .9841109
            2004  |   .7678334    .048977    -4.14   0.000     .6775982    .8700852
            2005  |   .6897008   .0443359    -5.78   0.000     .6080554     .782309
            2006  |   .6780628   .0450823    -5.84   0.000     .5952181    .7724382
            2007  |   .6682925    .047636    -5.65   0.000     .5811561    .7684939
            2008  |   .6071728   .0443685    -6.83   0.000     .5261526     .700669
            2009  |   .5563572   .0418092    -7.80   0.000     .4801617    .6446439
            2010  |   .5489652   .0414022    -7.95   0.000     .4735308    .6364163
            2011  |   .5156769   .0381105    -8.96   0.000     .4461394    .5960529
            2012  |   .4638276   .0385601    -9.24   0.000     .3940872    .5459097
            2013  |   .4709194   .0413299    -8.58   0.000     .3964984    .5593088
            2014  |   .4510292   .0385606    -9.31   0.000     .3814445    .5333078
            2015  |   .4237723   .0375558    -9.69   0.000     .3562025    .5041598
                  |
            _cons |   .0001114   7.87e-06  -128.95   0.000      .000097     .000128
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22240.503  
Iteration 1:   log pseudolikelihood = -20949.468  
Iteration 2:   log pseudolikelihood = -20940.579  
Iteration 3:   log pseudolikelihood = -20940.572  
Iteration 4:   log pseudolikelihood = -20940.572  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16875.925  
Iteration 1:   log pseudolikelihood = -16740.981  
Iteration 2:   log pseudolikelihood = -16727.457  
Iteration 3:   log pseudolikelihood = -16727.411  
Iteration 4:   log pseudolikelihood = -16727.411  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(31)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16727.411               Pseudo R2         =     0.0381

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_ss_1lag |   .9843814   .0198318    -0.78   0.435     .9462692    1.024029
      p75_ss_1lag |    1.00261   .0005778     4.52   0.000     1.001478    1.003743
        mine_time |    1.00743   .0056813     1.31   0.189     .9963557    1.018627
onsite_insp_hours |   .9997831   .0000396    -5.48   0.000     .9997056    .9998607
                  |
            state |
               1  |   .8266722   .0924708    -1.70   0.089     .6639246    1.029314
               2  |    1.22734    .056824     4.42   0.000     1.120871    1.343923
               3  |    .677621   .0837708    -3.15   0.002     .5318109    .8634089
               4  |   1.063393   .0671189     0.97   0.330     .9396538    1.203427
               5  |   .9084422   .0853305    -1.02   0.307     .7556895    1.092072
               6  |   .8004143   .0375565    -4.74   0.000     .7300882    .8775145
               7  |   1.063759    .204368     0.32   0.748     .7299808    1.550154
               8  |   .5014423   .0183233   -18.89   0.000     .4667853    .5386725
               9  |   .5829214   .0240181   -13.10   0.000     .5376975     .631949
              10  |   .7795811   .0710269    -2.73   0.006     .6520924    .9319947
              11  |   1.530435   .2775033     2.35   0.019     1.072686    2.183522
              12  |   1.079739   .0772953     1.07   0.284     .9383905    1.242378
              13  |   1.514307    .160556     3.91   0.000     1.230168    1.864076
              14  |   .4179348   .0724888    -5.03   0.000     .2974895    .5871451
              15  |   .7338622   .0398719    -5.70   0.000     .6597319    .8163222
              17  |   .6423076   .0231864   -12.26   0.000     .5984334    .6893984
                  |
             time |
            2000  |   1.046476   .0494568     0.96   0.336     .9538962    1.148041
            2002  |   .9318153   .0427157    -1.54   0.123      .851745    1.019413
            2003  |   .8451627   .0477891    -2.98   0.003     .7565015     .944215
            2004  |   .7900172   .0411546    -4.52   0.000     .7133368    .8749404
            2005  |   .7145685   .0394851    -6.08   0.000     .6412226    .7963041
            2006  |   .7020497   .0399515    -6.22   0.000     .6279551    .7848869
            2007  |   .6995619   .0432291    -5.78   0.000     .6197643    .7896339
            2008  |   .6307268   .0394325    -7.37   0.000      .557988    .7129477
            2009  |   .5701324   .0367258    -8.72   0.000     .5025098     .646855
            2010  |    .566296   .0379474    -8.49   0.000     .4965976    .6457766
            2011  |   .5281081   .0342677    -9.84   0.000       .46504    .5997293
            2012  |   .4685878   .0332591   -10.68   0.000     .4077321    .5385264
            2013  |   .4618818    .034492   -10.34   0.000     .3989933    .5346828
            2014  |    .459802   .0352707   -10.13   0.000     .3956183    .5343985
            2015  |   .4412067   .0355153   -10.17   0.000     .3768114    .5166069
                  |
            _cons |   .0001072   6.37e-06  -153.83   0.000     .0000954    .0001204
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.176785   .0600221                     -1.294427   -1.059144
------------------+----------------------------------------------------------------
            alpha |   .3082681   .0185029                       .274055    .3467525
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.SSV.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.SSV.2.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =   8426.32
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -24975.69  -20940.57      32    41945.14   42160.85
        nbin |      6,253 -17389.65  -16727.41      33    33520.82   33743.27
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv2_yhat 
(option n assumed; predicted number of events)

. gen cssv2_res = dv - cssv2_yhat

. 
. summ dv cssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
  cssv2_yhat |      6,253    10.65929    15.90749   .0035857   166.6452

. /*
> pause "next"
> 
> scatter dv cssv2_yhat
> 
> pause "next"
> 
> scatter cssv2_res dv
> 
> pause "next"
> 
> scatter cssv2_res cssv2_yhat
> */
. pause "complete: C.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.3
. 
. // poisson model
. glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -23367.996  
Iteration 1:   log pseudolikelihood = -20969.804  
Iteration 2:   log pseudolikelihood = -20960.301  
Iteration 3:   log pseudolikelihood = -20960.296  
Iteration 4:   log pseudolikelihood = -20960.296  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  22392.61155                   (1/df) Deviance =    3.59952
Pearson          =  27671.93237                   (1/df) Pearson  =   4.448149

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.714312
Log pseudolikelihood = -20960.29588               BIC             =  -31984.01

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_ss_c_4lag |    1.00289   .0078604     0.37   0.713     .9876021    1.018415
    p75_ss_c_4lag |   1.000188   .0001281     1.47   0.142      .999937    1.000439
        mine_time |   1.007064   .0066784     1.06   0.288     .9940591    1.020239
onsite_insp_hours |    .999823   .0000401    -4.41   0.000     .9997443    .9999017
                  |
            state |
               1  |   .9448855   .0881576    -0.61   0.543     .7869774    1.134478
               2  |   1.626819   .0862437     9.18   0.000      1.46627    1.804948
               3  |   .6541537   .0673349    -4.12   0.000     .5346405    .8003827
               4  |   1.249526   .1052895     2.64   0.008     1.059302    1.473909
               5  |   1.085995   .1336557     0.67   0.503      .853235    1.382251
               6  |   .9787352    .054136    -0.39   0.698     .8781798    1.090805
               7  |   1.123091   .1657389     0.79   0.432     .8410078    1.499789
               8  |   .5017333   .0195516   -17.70   0.000     .4648397     .541555
               9  |   .6488642   .0280534   -10.00   0.000     .5961456    .7062447
              10  |   .8872813   .0573195    -1.85   0.064     .7817585    1.007048
              11  |   1.714689   .3273047     2.82   0.005     1.179521    2.492672
              12  |   1.003502    .093248     0.04   0.970     .8364164    1.203966
              13  |   1.538273    .158242     4.19   0.000     1.257391    1.881899
              14  |    .420287   .0640525    -5.69   0.000     .3117606    .5665921
              15  |   .8026984    .062647    -2.82   0.005     .6888425    .9353731
              17  |   .6655576   .0249881   -10.84   0.000     .6183405    .7163803
                  |
             time |
            2000  |   1.067694   .0448994     1.56   0.119     .9832221    1.159424
            2002  |   .9602432   .0365848    -1.06   0.287     .8911501    1.034693
            2003  |     .84176   .0333969    -4.34   0.000     .7787836    .9098291
            2004  |    .811154   .0356577    -4.76   0.000     .7441923    .8841409
            2005  |   .7585979   .0394308    -5.32   0.000     .6851212    .8399547
            2006  |   .7257077   .0390794    -5.95   0.000      .653017      .80649
            2007  |   .7376285   .0427576    -5.25   0.000     .6584105    .8263779
            2008  |   .7063379   .0417995    -5.87   0.000      .628985    .7932037
            2009  |   .6218981   .0380501    -7.76   0.000     .5516194    .7011307
            2010  |   .6073266   .0409896    -7.39   0.000     .5320753    .6932207
            2011  |   .5521078    .035737    -9.18   0.000     .4863255    .6267881
            2012  |   .4922317    .034456   -10.13   0.000      .429127    .5646162
            2013  |   .4757832   .0380433    -9.29   0.000     .4067687     .556507
            2014  |   .4994291   .0436579    -7.94   0.000     .4207901    .5927645
            2015  |   .4702576   .0424124    -8.37   0.000     .3940634    .5611844
                  |
            _cons |   .0000948   5.25e-06  -167.15   0.000     .0000851    .0001057
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  22392.61
         Prob > chi2(6221)        =    0.0000

         Pearson goodness-of-fit  =  27671.93
         Prob > chi2(6221)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -17732.757  
Iteration 1:   log pseudolikelihood = -17509.015  
Iteration 2:   log pseudolikelihood = -17503.951  
Iteration 3:   log pseudolikelihood = -17503.941  
Iteration 4:   log pseudolikelihood = -17503.941  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  3919.912218                   (1/df) Deviance =   .6301097
Pearson          =  5291.819633                   (1/df) Pearson  =   .8506381

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.608809
Log pseudolikelihood =  -17503.9413               BIC             =  -50456.71

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_ss_c_4lag |    1.00266   .0080925     0.33   0.742      .986924    1.018647
    p75_ss_c_4lag |   1.000692   .0001634     4.24   0.000     1.000372    1.001013
        mine_time |   1.008985   .0062131     1.45   0.146     .9968803    1.021236
onsite_insp_hours |   .9997777   .0000403    -5.52   0.000     .9996987    .9998567
                  |
            state |
               1  |   .7956141   .0990475    -1.84   0.066     .6233539    1.015477
               2  |   1.086219   .0528508     1.70   0.089     .9874193    1.194905
               3  |   .6843972   .0850421    -3.05   0.002     .5364624    .8731266
               4  |   1.044511   .0692437     0.66   0.511     .9172432    1.189438
               5  |   .8773369   .0820044    -1.40   0.161     .7304742    1.053727
               6  |   .7710608   .0381637    -5.25   0.000     .6997749    .8496087
               7  |    1.07605    .225559     0.35   0.727      .713519    1.622778
               8  |   .4999319   .0196755   -17.62   0.000     .4628184    .5400215
               9  |   .5502896   .0247036   -13.31   0.000     .5039404    .6009018
              10  |   .7600177   .0822955    -2.53   0.011     .6146879    .9397076
              11  |   1.510611   .2794059     2.23   0.026     1.051266    2.170664
              12  |   1.016648   .0778676     0.22   0.829     .8749336    1.181317
              13  |   1.544713   .1767264     3.80   0.000     1.234424    1.932998
              14  |   .4196198   .0733498    -4.97   0.000     .2978965    .5910804
              15  |   .7071188   .0404427    -6.06   0.000     .6321339    .7909985
              17  |   .6174595   .0242946   -12.25   0.000     .5716326    .6669602
                  |
             time |
            2000  |   1.051335   .0609855     0.86   0.388     .9383503    1.177924
            2002  |    .900608   .0510288    -1.85   0.065     .8059468    1.006388
            2003  |   .8479739   .0627668    -2.23   0.026     .7334606    .9803658
            2004  |   .7666373   .0490531    -4.15   0.000     .6762792    .8690681
            2005  |   .6873063   .0443254    -5.81   0.000     .6056965    .7799118
            2006  |   .6788536   .0453397    -5.80   0.000       .59556    .7737964
            2007  |   .6657837   .0474743    -5.70   0.000     .5789451    .7656475
            2008  |   .6070727   .0444936    -6.81   0.000     .5258409    .7008531
            2009  |   .5533642   .0416715    -7.86   0.000     .4774311    .6413742
            2010  |   .5491823    .041468    -7.94   0.000     .4736347    .6367802
            2011  |   .5121249   .0378887    -9.05   0.000     .4429974    .5920393
            2012  |   .4612624   .0383857    -9.30   0.000      .391843    .5429802
            2013  |   .4684727   .0411603    -8.63   0.000     .3943638     .556508
            2014  |   .4494631    .038559    -9.32   0.000     .3799009    .5317626
            2015  |   .4207084   .0373213    -9.76   0.000     .3535661    .5006011
                  |
            _cons |   .0001125   7.94e-06  -128.80   0.000      .000098    .0001292
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -22213.106  
Iteration 1:   log pseudolikelihood = -20968.374  
Iteration 2:   log pseudolikelihood = -20960.302  
Iteration 3:   log pseudolikelihood = -20960.296  
Iteration 4:   log pseudolikelihood = -20960.296  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood = -16879.254  
Iteration 1:   log pseudolikelihood = -16745.992  
Iteration 2:   log pseudolikelihood = -16733.085  
Iteration 3:   log pseudolikelihood = -16733.043  
Iteration 4:   log pseudolikelihood = -16733.043  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(31)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16733.043               Pseudo R2         =     0.0378

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_ss_c_4lag |   1.001283   .0077619     0.17   0.869      .986185    1.016612
    p75_ss_c_4lag |   1.000617   .0001548     3.99   0.000     1.000314     1.00092
        mine_time |   1.006634   .0057237     1.16   0.245     .9954777    1.017915
onsite_insp_hours |    .999791   .0000398    -5.25   0.000      .999713     .999869
                  |
            state |
               1  |   .8215983   .0930704    -1.73   0.083     .6580149    1.025849
               2  |   1.227899    .057221     4.41   0.000     1.120717    1.345331
               3  |   .6754888   .0835914    -3.17   0.002     .5300079    .8609024
               4  |   1.061458    .066217     0.96   0.339      .939295    1.199508
               5  |   .9061301   .0857237    -1.04   0.297     .7527718    1.090731
               6  |   .7989542   .0374536    -4.79   0.000     .7288178      .87584
               7  |   1.062739   .2035107     0.32   0.751      .730171     1.54678
               8  |   .4989116   .0183034   -18.95   0.000      .464297    .5361069
               9  |   .5799013   .0240573   -13.13   0.000     .5346158    .6290228
              10  |   .7793142   .0706164    -2.75   0.006     .6525026    .9307711
              11  |   1.546714   .2808999     2.40   0.016     1.083484    2.207991
              12  |   1.074677   .0769582     1.01   0.315     .9339483     1.23661
              13  |   1.513654    .160784     3.90   0.000     1.229165    1.863989
              14  |    .417757   .0731171    -4.99   0.000     .2964449    .5887129
              15  |   .7328433   .0399171    -5.71   0.000     .6586387    .8154081
              17  |   .6341356   .0232466   -12.43   0.000     .5901714    .6813747
                  |
             time |
            2000  |   1.068945   .0509232     1.40   0.162      .973655     1.17356
            2002  |   .9252968   .0425045    -1.69   0.091     .8456297    1.012469
            2003  |   .8420029   .0478303    -3.03   0.002     .7532875    .9411663
            2004  |   .7884658   .0413017    -4.54   0.000     .7115329     .873717
            2005  |   .7120759   .0396007    -6.11   0.000     .6385403      .79408
            2006  |   .7026072   .0402745    -6.16   0.000     .6279434    .7861487
            2007  |    .696947    .043223    -5.82   0.000     .6171778    .7870263
            2008  |   .6304068   .0395703    -7.35   0.000     .5574313    .7129357
            2009  |   .5670974   .0367501    -8.75   0.000     .4994552    .6439004
            2010  |   .5661135   .0380521    -8.46   0.000     .4962365      .64583
            2011  |     .52422   .0341409    -9.92   0.000     .4613997    .5955934
            2012  |   .4656958   .0331996   -10.72   0.000     .4049673    .5355312
            2013  |   .4593266   .0344642   -10.37   0.000       .39651    .5320948
            2014  |   .4577829   .0353652   -10.11   0.000     .3934608    .5326202
            2015  |   .4375228   .0353284   -10.24   0.000     .3734816    .5125453
                  |
            _cons |   .0001082   6.47e-06  -152.75   0.000     .0000963    .0001217
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.172917   .0599022                     -1.290323   -1.055511
------------------+----------------------------------------------------------------
            alpha |   .3094629   .0185375                      .2751818    .3480146
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.SSV.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.SSV.3.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =   8454.51
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -24975.69   -20960.3      32    41984.59    42200.3
        nbin |      6,253 -17389.65  -16733.04      33    33532.09   33754.53
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv3_yhat 
(option n assumed; predicted number of events)

. gen cssv3_res = dv - cssv3_yhat

. 
. summ dv cssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
  cssv3_yhat |      6,253    10.64847    15.82427   .0035971    154.829

. /*
> pause "next"
> 
> scatter dv cssv3_yhat
> 
> pause "next"
> 
> scatter cssv3_res dv
> 
> pause "next"
> 
> scatter cssv3_res cssv3_yhat
> */
. pause "complete: C.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.4
. 
. // poisson model
. glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -23342.174  
Iteration 1:   log pseudolikelihood = -20975.559  
Iteration 2:   log pseudolikelihood = -20966.368  
Iteration 3:   log pseudolikelihood = -20966.363  
Iteration 4:   log pseudolikelihood = -20966.363  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  22404.74648                   (1/df) Deviance =    3.60147
Pearson          =  27694.83604                   (1/df) Pearson  =    4.45183

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.716252
Log pseudolikelihood = -20966.36334               BIC             =  -31971.87

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_ss_c_lag_all |    1.00242   .0027588     0.88   0.380     .9970271    1.007841
 p75_ss_c_lag_all |   .9999705   .0000219    -1.35   0.178     .9999275    1.000013
        mine_time |   1.013138   .0066954     1.98   0.048       1.0001    1.026346
onsite_insp_hours |   .9998791   .0000459    -2.63   0.008     .9997893     .999969
                  |
            state |
               1  |   .9461189   .0879156    -0.60   0.551     .7885878    1.135119
               2  |   1.574509   .0761467     9.39   0.000      1.43212    1.731056
               3  |    .626827   .0660112    -4.44   0.000     .5099265    .7705269
               4  |   1.221107   .0998363     2.44   0.015     1.040304    1.433332
               5  |   1.055446   .1327398     0.43   0.668     .8248663    1.350482
               6  |   .9586473   .0513641    -0.79   0.431     .8630813    1.064795
               7  |   1.117168   .1691976     0.73   0.464     .8302373    1.503263
               8  |   .4656469   .0192786   -18.46   0.000     .4293541    .5050076
               9  |   .6197136    .026651   -11.13   0.000     .5696194    .6742132
              10  |   .8880504   .0718253    -1.47   0.142     .7578663    1.040597
              11  |   1.719035   .3096187     3.01   0.003     1.207739    2.446787
              12  |   .9558461   .0907375    -0.48   0.634     .7935683    1.151308
              13  |   1.521678   .1571482     4.07   0.000     1.242844    1.863069
              14  |   .3989596   .0619061    -5.92   0.000     .2943397    .5407654
              15  |   .7928564    .061065    -3.01   0.003     .6817668    .9220473
              17  |   .6155979   .0373828    -7.99   0.000     .5465213    .6934053
                  |
             time |
            2000  |   1.043712   .0427509     1.04   0.296     .9631965    1.130957
            2002  |   .9558991   .0362581    -1.19   0.234     .8874118    1.029672
            2003  |   .8380755   .0332234    -4.46   0.000     .7754243    .9057888
            2004  |   .8077985   .0348434    -4.95   0.000     .7423137    .8790601
            2005  |   .7513836   .0381203    -5.63   0.000     .6802638    .8299388
            2006  |   .7232891   .0384476    -6.09   0.000     .6517258    .8027104
            2007  |   .7286504   .0420208    -5.49   0.000     .6507751    .8158445
            2008  |   .6820297   .0416347    -6.27   0.000       .60512    .7687146
            2009  |   .6013343   .0386687    -7.91   0.000     .5301266    .6821069
            2010  |    .585536   .0408598    -7.67   0.000     .5106874    .6713546
            2011  |   .5316915   .0358851    -9.36   0.000     .4658114    .6068892
            2012  |   .4693844   .0342274   -10.37   0.000     .4068734    .5414995
            2013  |   .4527341   .0368083    -9.75   0.000     .3860456     .530943
            2014  |   .4709306    .042998    -8.25   0.000     .3937663    .5632163
            2015  |   .4427256   .0426349    -8.46   0.000     .3665752     .534695
                  |
            _cons |   .0000956   5.55e-06  -159.36   0.000     .0000853    .0001071
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  22404.75
         Prob > chi2(6221)        =    0.0000

         Pearson goodness-of-fit  =  27694.84
         Prob > chi2(6221)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -17749.932  
Iteration 1:   log pseudolikelihood =  -17520.05  
Iteration 2:   log pseudolikelihood = -17514.401  
Iteration 3:   log pseudolikelihood = -17514.387  
Iteration 4:   log pseudolikelihood = -17514.387  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,221
                                                  Scale parameter =          1
Deviance         =  3940.803868                   (1/df) Deviance =   .6334679
Pearson          =  5298.425295                   (1/df) Pearson  =   .8516999

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =    5.61215
Log pseudolikelihood = -17514.38712               BIC             =  -50435.82

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_ss_c_lag_all |   .9998767   .0037747    -0.03   0.974     .9925058    1.007302
 p75_ss_c_lag_all |   .9999964    .000024    -0.15   0.881     .9999494    1.000043
        mine_time |   1.012348   .0067671     1.84   0.066      .999171    1.025698
onsite_insp_hours |   .9998893    .000041    -2.70   0.007     .9998089    .9999698
                  |
            state |
               1  |   .8215924   .1037984    -1.56   0.120     .6413827    1.052436
               2  |   1.079379   .0536611     1.54   0.124     .9791668    1.189847
               3  |   .6632087   .0855161    -3.18   0.001     .5151026    .8538993
               4  |   1.036219   .0722417     0.51   0.610     .9038754     1.18794
               5  |   .8592958   .0859828    -1.52   0.130     .7062685     1.04548
               6  |   .7611002   .0378028    -5.50   0.000     .6905003    .8389186
               7  |   1.084913   .2257318     0.39   0.695     .7215897    1.631172
               8  |   .4599657   .0176665   -20.22   0.000     .4266112     .495928
               9  |   .5286698   .0247315   -13.63   0.000     .4823527    .5794345
              10  |   .7802188   .0887778    -2.18   0.029     .6242546    .9751492
              11  |   1.532907   .2731132     2.40   0.017     1.081085    2.173561
              12  |   .9618018   .0742557    -0.50   0.614     .8267397    1.118929
              13  |   1.531599   .1807427     3.61   0.000     1.215334    1.930166
              14  |   .4047785   .0752121    -4.87   0.000     .2812259    .5826122
              15  |   .7062156   .0408588    -6.01   0.000     .6305075    .7910144
              17  |   .5742922    .036161    -8.81   0.000     .5076168    .6497254
                  |
             time |
            2000  |   1.008922    .058764     0.15   0.879     .9000771    1.130928
            2002  |   .8935249    .050189    -2.00   0.045     .8003775    .9975126
            2003  |   .8354149   .0619807    -2.42   0.015     .7223544    .9661713
            2004  |   .7558935   .0485301    -4.36   0.000     .6665173    .8572544
            2005  |   .6769578    .044047    -6.00   0.000     .5959053    .7690346
            2006  |   .6738371    .045384    -5.86   0.000     .5905071    .7689263
            2007  |   .6603178   .0477612    -5.74   0.000     .5730402    .7608884
            2008  |   .5946133   .0444067    -6.96   0.000     .5136478    .6883412
            2009  |   .5404223    .041496    -8.01   0.000     .4649157    .6281919
            2010  |   .5343245   .0409609    -8.18   0.000     .4597827    .6209512
            2011  |   .4978192   .0376204    -9.23   0.000     .4292853    .5772942
            2012  |   .4407348   .0376234    -9.60   0.000     .3728331     .521003
            2013  |   .4388858   .0393812    -9.18   0.000     .3681064    .5232748
            2014  |   .4152565   .0363384   -10.04   0.000     .3498075     .492951
            2015  |   .3869788    .034823   -10.55   0.000      .324407    .4616194
                  |
            _cons |   .0001161   8.45e-06  -124.53   0.000     .0001007    .0001339
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -21940.977  
Iteration 1:   log pseudolikelihood = -20972.054  
Iteration 2:   log pseudolikelihood = -20966.366  
Iteration 3:   log pseudolikelihood = -20966.363  
Iteration 4:   log pseudolikelihood = -20966.363  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -17884.199  
Iteration 1:   log pseudolikelihood = -17442.363  
Iteration 2:   log pseudolikelihood = -17390.126  
Iteration 3:   log pseudolikelihood = -17389.648  
Iteration 4:   log pseudolikelihood = -17389.648  

Fitting full model:

Iteration 0:   log pseudolikelihood =  -16884.89  
Iteration 1:   log pseudolikelihood = -16764.552  
Iteration 2:   log pseudolikelihood = -16755.661  
Iteration 3:   log pseudolikelihood = -16755.642  
Iteration 4:   log pseudolikelihood = -16755.642  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(31)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -16755.642               Pseudo R2         =     0.0365

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_ss_c_lag_all |   1.001013    .003464     0.29   0.770     .9942463    1.007825
 p75_ss_c_lag_all |   .9999842   .0000214    -0.74   0.461     .9999424    1.000026
        mine_time |   1.011254   .0063115     1.79   0.073     .9989586      1.0237
onsite_insp_hours |   .9999006   .0000394    -2.52   0.012     .9998234    .9999778
                  |
            state |
               1  |   .8482085    .097924    -1.43   0.154     .6764459    1.063585
               2  |     1.2079   .0576787     3.96   0.000     1.099981    1.326408
               3  |   .6499511   .0837286    -3.34   0.001     .5049244    .8366329
               4  |   1.047329   .0683331     0.71   0.478     .9216081      1.1902
               5  |   .8832998   .0890961    -1.23   0.219     .7248526    1.076382
               6  |   .7868676   .0368888    -5.11   0.000     .7177891     .862594
               7  |   1.071049   .2060842     0.36   0.721     .7345589    1.561679
               8  |    .454094   .0168068   -21.33   0.000     .4223198    .4882588
               9  |   .5526931   .0244337   -13.41   0.000     .5068199    .6027183
              10  |   .7995077   .0776138    -2.30   0.021     .6609835    .9670629
              11  |   1.569703   .2716207     2.61   0.009     1.118217    2.203479
              12  |   1.012007   .0742447     0.16   0.871     .8764682    1.168506
              13  |   1.497471   .1645585     3.67   0.000     1.207311    1.857367
              14  |    .398277    .073787    -4.97   0.000     .2770045    .5726424
              15  |   .7307902   .0402628    -5.69   0.000     .6559879    .8141222
              17  |   .5807172   .0348276    -9.06   0.000     .5163156    .6531518
                  |
             time |
            2000  |   1.027147   .0495864     0.55   0.579     .9344155    1.129081
            2002  |    .917671   .0420935    -1.87   0.061     .8387692    1.003995
            2003  |   .8300837   .0475415    -3.25   0.001     .7419435    .9286945
            2004  |   .7764387   .0409751    -4.79   0.000     .7001428    .8610487
            2005  |   .6999066    .039467    -6.33   0.000     .6266741     .781697
            2006  |   .6958967   .0403073    -6.26   0.000     .6212151    .7795564
            2007  |   .6888276   .0434607    -5.91   0.000     .6087025    .7794998
            2008  |   .6131655   .0394724    -7.60   0.000     .5404826    .6956225
            2009  |   .5503229   .0365882    -8.98   0.000     .4830872    .6269165
            2010  |   .5460881   .0372993    -8.86   0.000     .4776649    .6243125
            2011  |   .5054356   .0338019   -10.20   0.000     .4433434    .5762242
            2012  |   .4414012   .0325192   -11.10   0.000     .3820528     .509969
            2013  |   .4286765   .0330429   -10.99   0.000     .3685685    .4985874
            2014  |   .4205275   .0333716   -10.92   0.000     .3599532    .4912954
            2015  |   .4000711   .0330835   -11.08   0.000     .3402106    .4704642
                  |
            _cons |   .0001113   6.98e-06  -145.12   0.000     .0000984    .0001259
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.162308   .0600785                      -1.28006   -1.044556
------------------+----------------------------------------------------------------
            alpha |   .3127636   .0187904                      .2780208     .351848
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.SSV.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.SSV.4.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =   8421.44
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -24975.69  -20966.36      32    41996.73   42212.43
        nbin |      6,253 -17389.65  -16755.64      33    33577.28   33799.73
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv4_yhat 
(option n assumed; predicted number of events)

. gen cssv4_res = dv - cssv4_yhat

. 
. summ dv cssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
  cssv4_yhat |      6,253    10.50684    14.95971   .0034718   128.3153

. /*
> pause "next"
> 
> scatter dv cssv4_yhat
> 
> pause "next"
> 
> scatter cssv4_res dv
> 
> pause "next"
> 
> scatter cssv4_res cssv4_yhat
> */
. pause "complete: C.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.1
. 
. // poisson model
. glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -11581.525  
Iteration 1:   log pseudolikelihood = -10446.199  
Iteration 2:   log pseudolikelihood = -10443.667  
Iteration 3:   log pseudolikelihood = -10443.666  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,308
                                                  Scale parameter =          1
Deviance         =  10578.97444                   (1/df) Deviance =   3.197997
Pearson          =   12454.5927                   (1/df) Pearson  =   3.764992

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.281828
Log pseudolikelihood =  -10443.6665               BIC             =  -16254.29

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_pp |   1.000217   .0001042     2.08   0.038     1.000013    1.000421
           p75_pp |    1.00001   2.35e-06     4.38   0.000     1.000006    1.000015
        mine_time |   .9998652   .0063147    -0.02   0.983     .9875649    1.012319
onsite_insp_hours |   .9997599   .0000399    -6.02   0.000     .9996818     .999838
                  |
            state |
               1  |    1.17408   .1252114     1.50   0.132     .9526206    1.447022
               2  |   1.926653   .0944306    13.38   0.000     1.750184    2.120914
               3  |    .645806   .0602668    -4.69   0.000     .5378581     .775419
               4  |    1.13958   .0757497     1.97   0.049     1.000378    1.298152
               5  |   .9378333   .0878384    -0.69   0.493      .780551    1.126808
               6  |   1.024185   .0611892     0.40   0.689     .9110116    1.151417
               7  |   1.236921    .172731     1.52   0.128     .9407518     1.62633
               8  |   .5070363   .0203611   -16.91   0.000     .4686593    .5485559
               9  |     .66625   .0300037    -9.02   0.000     .6099644    .7277296
              10  |   .9613227   .0663659    -0.57   0.568     .8396642    1.100608
              11  |   1.494338   .4246164     1.41   0.157      .856209    2.608062
              12  |   1.220289    .110638     2.20   0.028     1.021617    1.457596
              13  |   1.699509   .2976267     3.03   0.002     1.205749    2.395467
              14  |   .4750668    .092279    -3.83   0.000     .3246487    .6951775
              15  |   .7658729   .0680979    -3.00   0.003     .6433862    .9116783
              17  |   .6421195   .0227428   -12.51   0.000     .5990565    .6882781
                  |
             time |
            2007  |   1.076108    .043245     1.83   0.068     .9946019    1.164294
            2009  |    .892002   .0288313    -3.54   0.000     .8372463    .9503387
            2010  |   .8883415    .037517    -2.80   0.005     .8177705    .9650025
            2011  |   .8136012   .0314508    -5.34   0.000     .7542361     .877639
            2012  |   .7349938   .0326516    -6.93   0.000     .6737047    .8018585
            2013  |   .7121216   .0422619    -5.72   0.000     .6339258    .7999631
            2014  |   .7449283   .0438007    -5.01   0.000     .6638425    .8359185
            2015  |   .7162214   .0462615    -5.17   0.000     .6310551    .8128816
                  |
            _cons |    .000064   3.77e-06  -163.69   0.000      .000057    .0000718
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  10578.97
         Prob > chi2(3305)        =    0.0000

         Pearson goodness-of-fit  =  12454.59
         Prob > chi2(3305)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood =  -9349.964  
Iteration 1:   log pseudolikelihood = -9221.0727  
Iteration 2:   log pseudolikelihood = -9218.8369  
Iteration 3:   log pseudolikelihood = -9218.8339  
Iteration 4:   log pseudolikelihood = -9218.8339  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,308
                                                  Scale parameter =          1
Deviance         =  2032.704172                   (1/df) Deviance =   .6144813
Pearson          =  2541.912594                   (1/df) Pearson  =   .7684137

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.546855
Log pseudolikelihood = -9218.833889               BIC             =  -24800.56

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_pp |    1.00023   .0001601     1.44   0.150     .9999166    1.000544
           p75_pp |   1.000012   2.70e-06     4.56   0.000     1.000007    1.000018
        mine_time |   1.009883   .0065676     1.51   0.130     .9970926    1.022838
onsite_insp_hours |   .9997349   .0000414    -6.40   0.000     .9996537    .9998161
                  |
            state |
               1  |   .9809017   .1286111    -0.15   0.883     .7586126    1.268326
               2  |   1.319773   .0744867     4.92   0.000     1.181566    1.474145
               3  |   .6528474   .0933796    -2.98   0.003     .4932426    .8640975
               4  |   1.042171   .0855822     0.50   0.615     .8872353    1.224162
               5  |   .8459294   .0906913    -1.56   0.119     .6856107    1.043736
               6  |   .8308046   .0519015    -2.97   0.003     .7350607    .9390194
               7  |   1.244236   .2399216     1.13   0.257     .8526461     1.81567
               8  |   .4058165   .0202868   -18.04   0.000     .3679409    .4475909
               9  |   .5677448   .0311916   -10.30   0.000     .5097868     .632292
              10  |   .8110723   .1242655    -1.37   0.172     .6006836    1.095149
              11  |   1.355888   .3500769     1.18   0.238     .8174326    2.249032
              12  |   1.077899    .097192     0.83   0.405     .9032895    1.286261
              13  |   1.849188   .3438493     3.31   0.001      1.28441    2.662311
              14  |   .4635209   .0885836    -4.02   0.000     .3187102    .6741284
              15  |   .6750935   .0503614    -5.27   0.000     .5832638    .7813809
              17  |   .5695136   .0249184   -12.87   0.000     .5227099     .620508
                  |
             time |
            2007  |   1.119292   .0508334     2.48   0.013     1.023966    1.223492
            2009  |   .9117121   .0438063    -1.92   0.054     .8297722    1.001744
            2010  |   .9150707   .0483099    -1.68   0.093     .8251191    1.014829
            2011  |   .8521308   .0447427    -3.05   0.002     .7687981    .9444961
            2012  |   .7656352   .0473026    -4.32   0.000      .678317    .8641935
            2013  |   .7721277   .0544384    -3.67   0.000     .6724742    .8865487
            2014  |   .7339138   .0474267    -4.79   0.000     .6466049    .8330117
            2015  |   .6955827   .0479943    -5.26   0.000     .6075989    .7963071
                  |
            _cons |   .0000665   4.63e-06  -138.28   0.000      .000058    .0000762
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -10760.802  
Iteration 1:   log pseudolikelihood = -10444.514  
Iteration 2:   log pseudolikelihood = -10443.667  
Iteration 3:   log pseudolikelihood = -10443.666  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8800.4556  
Iteration 1:   log pseudolikelihood = -8756.5696  
Iteration 2:   log pseudolikelihood =   -8754.68  
Iteration 3:   log pseudolikelihood = -8754.6782  
Iteration 4:   log pseudolikelihood = -8754.6782  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(24)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8754.6782               Pseudo R2         =     0.0266

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_pp |   1.000191   .0001259     1.52   0.128     .9999448    1.000438
           p75_pp |   1.000013   2.56e-06     4.98   0.000     1.000008    1.000018
        mine_time |   1.005267   .0058986     0.90   0.371     .9937722    1.016895
onsite_insp_hours |    .999745   .0000406    -6.27   0.000     .9996654    .9998247
                  |
            state |
               1  |   1.029608   .1244684     0.24   0.809     .8124021    1.304887
               2  |   1.483921   .0778344     7.52   0.000     1.338948    1.644591
               3  |   .6445463   .0857956    -3.30   0.001      .496536    .8366765
               4  |    1.05026   .0783535     0.66   0.511     .9073897    1.215625
               5  |   .8597681   .0884757    -1.47   0.142     .7027278    1.051902
               6  |   .8593247   .0481347    -2.71   0.007     .7699767    .9590406
               7  |   1.209279   .2178615     1.05   0.292     .8495235    1.721382
               8  |   .4402049   .0206868   -17.46   0.000     .4014708    .4826761
               9  |   .6018209   .0298076   -10.25   0.000     .5461452    .6631723
              10  |   .8404698   .1029886    -1.42   0.156     .6610259    1.068626
              11  |   1.390847   .3613256     1.27   0.204     .8358865    2.314256
              12  |   1.166001   .0979442     1.83   0.068     .9890034    1.374674
              13  |   1.768786   .3087584     3.27   0.001     1.256291    2.490352
              14  |   .4689855   .0945395    -3.76   0.000     .3159161    .6962209
              15  |   .7118653   .0490168    -4.94   0.000     .6219949    .8147209
              17  |   .5921442    .023654   -13.12   0.000     .5475516    .6403685
                  |
             time |
            2007  |   1.133166   .0464906     3.05   0.002     1.045613    1.228049
            2009  |   .8986079    .035606    -2.70   0.007     .8314625    .9711757
            2010  |    .908798   .0431594    -2.01   0.044     .8280246    .9974508
            2011  |   .8430324   .0378665    -3.80   0.000     .7719884    .9206143
            2012  |   .7480102   .0385554    -5.63   0.000     .6761347    .8275263
            2013  |   .7340633   .0429066    -5.29   0.000     .6546061    .8231651
            2014  |   .7270005   .0415699    -5.58   0.000     .6499245    .8132171
            2015  |   .7060178    .044144    -5.57   0.000     .6245885    .7980633
                  |
            _cons |   .0000661   4.03e-06  -157.64   0.000     .0000586    .0000745
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.302352   .0744369                     -1.448246   -1.156459
------------------+----------------------------------------------------------------
            alpha |   .2718915   .0202388                      .2349821    .3145983
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.PP.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.PP.1.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(2)  =  -3377.98
(Assumption: nbin nested in pois)                     Prob > chi2 =    1.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        nbin |      3,333 -8994.082  -8754.678      26    17561.36   17720.26
        pois |      3,333 -11782.29  -10443.67      28    20943.33   21114.46
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp1_yhat 
(option n assumed; predicted number of events)

. gen cpp1_res = dv - cpp1_yhat

. 
. summ dv cpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
   cpp1_yhat |      6,253    8.815198    12.51065   .0035059   136.1375

. /*
> pause "next"
> 
> scatter dv cpp1_yhat
> 
> pause "next"
> 
> scatter cpp1_res dv
> 
> pause "next"
> 
> scatter cpp1_res cpp1_yhat
> */
. pause "complete: C.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.2
. 
. // poisson model
. glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -11600.377  
Iteration 1:   log pseudolikelihood =   -10464.5  
Iteration 2:   log pseudolikelihood = -10461.908  
Iteration 3:   log pseudolikelihood = -10461.907  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,308
                                                  Scale parameter =          1
Deviance         =  10615.45624                   (1/df) Deviance =   3.209025
Pearson          =  12495.73522                   (1/df) Pearson  =   3.777429

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.292774
Log pseudolikelihood =  -10461.9074               BIC             =  -16217.81

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_pp_1lag |   1.000188   .0000936     2.00   0.045     1.000004    1.000371
      p75_pp_1lag |    1.00001   2.18e-06     4.40   0.000     1.000005    1.000014
        mine_time |   .9991471   .0063556    -0.13   0.893     .9867676    1.011682
onsite_insp_hours |    .999773    .000038    -5.97   0.000     .9996984    .9998475
                  |
            state |
               1  |     1.1621   .1226665     1.42   0.155     .9449178    1.429199
               2  |   1.917273   .0946355    13.19   0.000     1.740481    2.112024
               3  |   .6437402   .0600105    -4.72   0.000     .5362413    .7727891
               4  |   1.141325   .0748467     2.02   0.044     1.003664    1.297867
               5  |   .9362921   .0864484    -0.71   0.476     .7813029    1.122027
               6  |   1.016974   .0608753     0.28   0.779     .9043938    1.143568
               7  |   1.228629   .1712241     1.48   0.140     .9349654    1.614529
               8  |   .5018863   .0200425   -17.26   0.000     .4641017    .5427471
               9  |   .6636781   .0301588    -9.02   0.000     .6071239    .7255005
              10  |   .9567713   .0664747    -0.64   0.525      .834965    1.096347
              11  |   1.489005   .4179887     1.42   0.156     .8589138    2.581325
              12  |   1.196635    .108639     1.98   0.048     1.001575    1.429683
              13  |   1.690861   .2980749     2.98   0.003     1.196887    2.388706
              14  |   .4701973   .0912864    -3.89   0.000     .3213837    .6879177
              15  |   .7619923    .069018    -3.00   0.003     .6380466    .9100155
              17  |   .6386469   .0226361   -12.65   0.000     .5957869    .6845902
                  |
             time |
            2007  |   1.122676   .0476577     2.73   0.006     1.033049    1.220079
            2009  |   .8897909   .0283125    -3.67   0.000     .8359945    .9470492
            2010  |   .8853737   .0376315    -2.86   0.004     .8146059    .9622894
            2011  |    .815876   .0312025    -5.32   0.000      .756956    .8793822
            2012  |   .7308574   .0326689    -7.01   0.000     .6695522    .7977758
            2013  |   .7087654   .0421833    -5.78   0.000     .6307277    .7964586
            2014  |   .7511404   .0454298    -4.73   0.000     .6671745    .8456736
            2015  |   .7111856   .0467646    -5.18   0.000     .6251891     .809011
                  |
            _cons |   .0000642   3.84e-06  -161.34   0.000     .0000571    .0000722
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  10615.46
         Prob > chi2(3307)        =    0.0000

         Pearson goodness-of-fit  =  12495.74
         Prob > chi2(3307)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9350.8426  
Iteration 1:   log pseudolikelihood = -9221.6773  
Iteration 2:   log pseudolikelihood = -9219.4416  
Iteration 3:   log pseudolikelihood = -9219.4386  
Iteration 4:   log pseudolikelihood = -9219.4386  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,308
                                                  Scale parameter =          1
Deviance         =  2033.913573                   (1/df) Deviance =   .6148469
Pearson          =  2537.273911                   (1/df) Pearson  =   .7670115

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.547218
Log pseudolikelihood =  -9219.43859               BIC             =  -24799.35

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_pp_1lag |   1.000142   .0001153     1.24   0.217     .9999165    1.000368
      p75_pp_1lag |   1.000012   2.63e-06     4.54   0.000     1.000007    1.000017
        mine_time |   1.009054   .0066011     1.38   0.168     .9961982    1.022075
onsite_insp_hours |   .9997462   .0000406    -6.25   0.000     .9996667    .9998258
                  |
            state |
               1  |   .9760923   .1279279    -0.18   0.854      .754973    1.261974
               2  |   1.319192   .0743118     4.92   0.000     1.181296    1.473185
               3  |   .6531928   .0939215    -2.96   0.003     .4927749    .8658332
               4  |   1.043714    .086228     0.52   0.605     .8876841    1.227171
               5  |   .8458806    .089424    -1.58   0.113     .6875789    1.040628
               6  |   .8286327    .051781    -3.01   0.003     .7331127    .9365984
               7  |    1.23932   .2401591     1.11   0.268     .8476861     1.81189
               8  |   .4025694   .0200826   -18.24   0.000     .3650713    .4439191
               9  |   .5680915   .0312321   -10.29   0.000     .5100604    .6327251
              10  |    .807376   .1234615    -1.40   0.162     .5982913     1.08953
              11  |   1.348798   .3423926     1.18   0.239     .8201046    2.218322
              12  |   1.070604   .0960612     0.76   0.447     .8979539    1.276451
              13  |   1.843772   .3426727     3.29   0.001     1.280879    2.654035
              14  |   .4612369   .0879437    -4.06   0.000     .3174139    .6702273
              15  |   .6736991     .05024    -5.30   0.000     .5820886    .7797275
              17  |   .5689805   .0246267   -13.03   0.000     .5227036    .6193545
                  |
             time |
            2007  |   1.142618   .0527377     2.89   0.004     1.043791    1.250801
            2009  |    .907606    .043618    -2.02   0.044      .826019    .9972514
            2010  |   .9138756   .0485105    -1.70   0.090     .8235756    1.014077
            2011  |   .8516163   .0446125    -3.07   0.002     .7685166    .9437017
            2012  |   .7604776   .0468391    -4.45   0.000     .6739993    .8580517
            2013  |    .766911   .0540894    -3.76   0.000     .6678987    .8806013
            2014  |   .7341775   .0474086    -4.79   0.000     .6468979    .8332329
            2015  |   .6882705   .0470426    -5.47   0.000     .6019777    .7869334
                  |
            _cons |    .000067   4.63e-06  -139.04   0.000     .0000585    .0000767
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -10763.297  
Iteration 1:   log pseudolikelihood = -10462.661  
Iteration 2:   log pseudolikelihood = -10461.908  
Iteration 3:   log pseudolikelihood = -10461.907  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8801.7231  
Iteration 1:   log pseudolikelihood = -8758.8135  
Iteration 2:   log pseudolikelihood =  -8757.013  
Iteration 3:   log pseudolikelihood = -8757.0114  
Iteration 4:   log pseudolikelihood = -8757.0114  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(24)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8757.0114               Pseudo R2         =     0.0264

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_pp_1lag |   1.000127   .0000923     1.37   0.170     .9999457    1.000308
      p75_pp_1lag |   1.000012   2.47e-06     4.89   0.000     1.000007    1.000017
        mine_time |   1.004468   .0059314     0.75   0.450     .9929095     1.01616
onsite_insp_hours |   .9997583   .0000397    -6.08   0.000     .9996804    .9998361
                  |
            state |
               1  |   1.022986   .1236039     0.19   0.851     .8072758    1.296336
               2  |   1.481146   .0773558     7.52   0.000     1.337033    1.640792
               3  |   .6438855   .0861067    -3.29   0.001     .4954246    .8368346
               4  |   1.052342   .0789276     0.68   0.496     .9084797    1.218986
               5  |   .8594388   .0869811    -1.50   0.134     .7048027    1.048003
               6  |   .8559582   .0479696    -2.78   0.006      .766919    .9553347
               7  |   1.203595   .2178325     1.02   0.306     .8441621     1.71607
               8  |   .4358126   .0204194   -17.73   0.000     .3975738    .4777291
               9  |   .6010443   .0297901   -10.27   0.000     .5454031    .6623619
              10  |   .8376371   .1031202    -1.44   0.150     .6580604    1.066218
              11  |   1.384585   .3534392     1.27   0.202     .8395289    2.283513
              12  |   1.154428   .0966942     1.71   0.086     .9796499    1.360389
              13  |   1.763841   .3083997     3.25   0.001     1.252076    2.484782
              14  |    .465962   .0938475    -3.79   0.000     .3139883    .6914925
              15  |    .710134   .0489405    -4.97   0.000     .6204087    .8128358
              17  |   .5901351   .0233733   -13.32   0.000     .5460573    .6377709
                  |
             time |
            2007  |   1.160234     .04842     3.56   0.000     1.069111    1.259125
            2009  |   .8939623   .0354259    -2.83   0.005     .8271568    .9661634
            2010  |   .9064427   .0433058    -2.06   0.040     .8254177    .9954214
            2011  |   .8423666   .0377679    -3.83   0.000     .7715021    .9197403
            2012  |   .7426604   .0382623    -5.77   0.000     .6713298    .8215701
            2013  |   .7281948   .0425255    -5.43   0.000     .6494394    .8165006
            2014  |   .7276331   .0416466    -5.56   0.000     .6504191    .8140135
            2015  |   .6968711   .0430959    -5.84   0.000      .617323    .7866697
                  |
            _cons |   .0000666   4.04e-06  -158.41   0.000     .0000591     .000075
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.298074   .0739512                     -1.443016   -1.153132
------------------+----------------------------------------------------------------
            alpha |   .2730572   .0201929                      .2362144    .3156465
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.PP.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.PP.2.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(0)  =  -3409.79
(Assumption: nbin nested in pois)                     Prob > chi2 =         .

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        nbin |      3,333 -8994.082  -8757.011      26    17566.02   17724.93
        pois |      3,333 -11782.29  -10461.91      26    20975.81   21134.72
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp2_yhat 
(option n assumed; predicted number of events)

. gen cpp2_res = dv - cpp2_yhat

. 
. summ dv cpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
   cpp2_yhat |      6,253    8.841773    12.50142   .0035033    135.635

. /*
> pause "next"
> 
> scatter dv cpp2_yhat
> 
> pause "next"
> 
> scatter cpp2_res dv
> 
> pause "next"
> 
> scatter cpp2_res cpp2_yhat
> */
. pause "complete: C.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.3
. 
. // poisson model
. glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -11615.822  
Iteration 1:   log pseudolikelihood = -10478.635  
Iteration 2:   log pseudolikelihood = -10476.052  
Iteration 3:   log pseudolikelihood = -10476.052  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,308
                                                  Scale parameter =          1
Deviance         =  10643.74517                   (1/df) Deviance =   3.217577
Pearson          =  12523.13482                   (1/df) Pearson  =   3.785712

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.301261
Log pseudolikelihood = -10476.05186               BIC             =  -16189.52

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_pp_c_4lag |   1.000064   .0000361     1.78   0.075     .9999934    1.000135
    p75_pp_c_4lag |   1.000002   5.66e-07     4.04   0.000     1.000001    1.000003
        mine_time |    .998767   .0063926    -0.19   0.847     .9863161    1.011375
onsite_insp_hours |    .999779   .0000381    -5.80   0.000     .9997043    .9998537
                  |
            state |
               1  |   1.154125   .1226381     1.35   0.177     .9371376    1.421353
               2  |    1.92338   .0947326    13.28   0.000     1.746388     2.11831
               3  |   .6429951   .0598358    -4.75   0.000     .5357924    .7716472
               4  |   1.143904   .0746346     2.06   0.039      1.00659     1.29995
               5  |   .9350191   .0859543    -0.73   0.465     .7808567    1.119617
               6  |   1.014976    .060653     0.25   0.804     .9027964    1.141096
               7  |   1.227343   .1708604     1.47   0.141     .9342624    1.612364
               8  |   .5003601   .0199933   -17.33   0.000     .4626691    .5411216
               9  |   .6602219   .0299072    -9.17   0.000     .6041317    .7215199
              10  |   .9557139   .0666398    -0.65   0.516     .8336342    1.095671
              11  |   1.490734    .416538     1.43   0.153     .8621028    2.577753
              12  |   1.184982   .1088324     1.85   0.065     .9897716    1.418694
              13  |   1.688349   .2971459     2.98   0.003     1.195783    2.383811
              14  |   .4680667   .0909126    -3.91   0.000     .3198738     .684915
              15  |   .7604033   .0690339    -3.02   0.003     .6364538    .9084919
              17  |   .6338766   .0221738   -13.03   0.000      .591873     .678861
                  |
             time |
            2007  |   1.121045   .0474259     2.70   0.007     1.031842    1.217961
            2009  |   .8818512    .028366    -3.91   0.000     .8279712    .9392374
            2010  |   .8767022   .0370629    -3.11   0.002     .8069883    .9524385
            2011  |   .8064102    .030803    -5.63   0.000      .748242    .8691005
            2012  |    .722985   .0318867    -7.35   0.000     .6631133    .7882625
            2013  |   .7041156   .0412776    -5.98   0.000     .6276878    .7898493
            2014  |   .7412436   .0444683    -4.99   0.000     .6590162    .8337307
            2015  |   .7020216   .0454262    -5.47   0.000     .6184025    .7969475
                  |
            _cons |    .000065   3.87e-06  -162.03   0.000     .0000579    .0000731
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  10643.75
         Prob > chi2(3306)        =    0.0000

         Pearson goodness-of-fit  =  12523.13
         Prob > chi2(3306)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9351.5927  
Iteration 1:   log pseudolikelihood = -9221.9092  
Iteration 2:   log pseudolikelihood = -9219.6625  
Iteration 3:   log pseudolikelihood = -9219.6594  
Iteration 4:   log pseudolikelihood = -9219.6594  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,308
                                                  Scale parameter =          1
Deviance         =  2034.355277                   (1/df) Deviance =   .6149804
Pearson          =  2535.870098                   (1/df) Pearson  =   .7665871

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =    5.54735
Log pseudolikelihood = -9219.659442               BIC             =  -24798.91

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_pp_c_4lag |   1.000075   .0000518     1.44   0.150     .9999731    1.000176
    p75_pp_c_4lag |   1.000003   7.03e-07     4.11   0.000     1.000002    1.000004
        mine_time |   1.008574   .0066464     1.30   0.195     .9956314    1.021685
onsite_insp_hours |   .9997501   .0000413    -6.05   0.000     .9996692     .999831
                  |
            state |
               1  |   .9724537    .128208    -0.21   0.832     .7510118    1.259189
               2  |   1.326353   .0749505     5.00   0.000     1.187296    1.481697
               3  |   .6531469   .0937927    -2.97   0.003      .492921     .865455
               4  |   1.047954   .0862638     0.57   0.569     .8918143    1.231431
               5  |   .8463762   .0893905    -1.58   0.114     .6881187    1.041031
               6  |   .8291681   .0516648    -3.01   0.003      .733846     .936872
               7  |   1.239696   .2395417     1.11   0.266      .848869    1.810463
               8  |   .4036606   .0202636   -18.07   0.000      .365836     .445396
               9  |   .5660785   .0311936   -10.33   0.000      .508126    .6306405
              10  |   .8081096   .1232212    -1.40   0.162     .5993469    1.089588
              11  |    1.35235   .3406986     1.20   0.231     .8253638    2.215812
              12  |   1.068614   .0959914     0.74   0.460     .8961061    1.274332
              13  |   1.841679   .3421487     3.29   0.001     1.279608    2.650641
              14  |   .4613026   .0880403    -4.05   0.000     .3173459     .670562
              15  |   .6745634   .0502745    -5.28   0.000     .5828859      .78066
              17  |   .5652433   .0245294   -13.15   0.000     .5191544    .6154239
                  |
             time |
            2007  |    1.14336   .0529699     2.89   0.004     1.044115    1.252039
            2009  |   .9032854   .0435346    -2.11   0.035     .8218652    .9927717
            2010  |   .9078111   .0481017    -1.83   0.068     .8182638    1.007158
            2011  |   .8447695   .0440274    -3.24   0.001     .7627384    .9356229
            2012  |   .7551149   .0463087    -4.58   0.000     .6695941    .8515584
            2013  |   .7609058   .0535171    -3.89   0.000     .6629228    .8733711
            2014  |   .7291974   .0469211    -4.91   0.000     .6427965    .8272119
            2015  |   .6823651   .0463246    -5.63   0.000     .5973518    .7794771
                  |
            _cons |   .0000675   4.65e-06  -139.55   0.000      .000059    .0000772
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =  -10758.11  
Iteration 1:   log pseudolikelihood = -10476.686  
Iteration 2:   log pseudolikelihood = -10476.052  
Iteration 3:   log pseudolikelihood = -10476.052  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8802.4091  
Iteration 1:   log pseudolikelihood = -8760.0821  
Iteration 2:   log pseudolikelihood = -8758.3282  
Iteration 3:   log pseudolikelihood = -8758.3267  
Iteration 4:   log pseudolikelihood = -8758.3267  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(24)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8758.3267               Pseudo R2         =     0.0262

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_pp_c_4lag |    1.00006   .0000416     1.44   0.149     .9999785    1.000141
    p75_pp_c_4lag |   1.000003   6.64e-07     4.43   0.000     1.000002    1.000004
        mine_time |   1.003956   .0059774     0.66   0.507     .9923089     1.01574
onsite_insp_hours |   .9997626   .0000403    -5.88   0.000     .9996835    .9998417
                  |
            state |
               1  |   1.018365   .1237546     0.15   0.881     .8025329    1.292242
               2  |   1.489214   .0780503     7.60   0.000     1.343833    1.650323
               3  |   .6437464    .086031    -3.30   0.001     .4954038    .8365085
               4  |   1.056303   .0791543     0.73   0.465     .9120183    1.223414
               5  |   .8596069   .0866815    -1.50   0.134     .7054495    1.047451
               6  |   .8558527   .0478573    -2.78   0.005     .7670114    .9549843
               7  |    1.20341   .2173356     1.03   0.305     .8446691    1.714511
               8  |   .4362688   .0205922   -17.57   0.000     .3977195    .4785546
               9  |    .599156   .0298358   -10.29   0.000      .543442    .6605818
              10  |   .8380132   .1030978    -1.44   0.151     .6584617    1.066525
              11  |   1.387948   .3519176     1.29   0.196     .8444018    2.281379
              12  |   1.150844   .0967803     1.67   0.095      .975966    1.357058
              13  |   1.763241   .3079529     3.25   0.001     1.252126    2.482993
              14  |   .4656572   .0938969    -3.79   0.000     .3136367    .6913624
              15  |   .7104383   .0489373    -4.96   0.000     .6207157    .8131299
              17  |   .5866744   .0233031   -13.43   0.000     .5427338    .6341725
                  |
             time |
            2007  |   1.160709   .0486679     3.55   0.000     1.069136    1.260125
            2009  |   .8892505   .0354233    -2.95   0.003     .8224632    .9614612
            2010  |   .8997847   .0429829    -2.21   0.027     .8193634    .9880995
            2011  |    .834875   .0372361    -4.05   0.000     .7649924    .9111414
            2012  |   .7367786   .0377465    -5.96   0.000     .6663899    .8146022
            2013  |   .7223681   .0420335    -5.59   0.000     .6445081    .8096339
            2014  |   .7221029   .0411971    -5.71   0.000     .6457087    .8075352
            2015  |   .6901364   .0423563    -6.04   0.000     .6119183    .7783526
                  |
            _cons |   .0000672   4.06e-06  -158.99   0.000     .0000597    .0000757
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.295171   .0733803                     -1.438994   -1.151348
------------------+----------------------------------------------------------------
            alpha |    .273851   .0200953                      .2371662    .3162101
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.PP.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.PP.3.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =  -3435.45
(Assumption: nbin nested in pois)                     Prob > chi2 =    1.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        nbin |      3,333 -8994.082  -8758.327      26    17568.65   17727.56
        pois |      3,333 -11782.29  -10476.05      27     21006.1   21171.12
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp3_yhat 
(option n assumed; predicted number of events)

. gen cpp3_res = dv - cpp3_yhat

. 
. summ dv cpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
   cpp3_yhat |      6,253    8.872062    12.53048   .0035049    136.448

. /*
> pause "next"
> 
> scatter dv cpp3_yhat
> 
> pause "next"
> 
> scatter cpp3_res dv
> 
> pause "next"
> 
> scatter cpp3_res cpp3_yhat
> */
. pause "complete: C.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.4
. 
. // poisson model
. glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -11729.078  
Iteration 1:   log pseudolikelihood = -10574.662  
Iteration 2:   log pseudolikelihood = -10571.746  
Iteration 3:   log pseudolikelihood = -10571.745  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,308
                                                  Scale parameter =          1
Deviance         =  10835.13191                   (1/df) Deviance =   3.275433
Pearson          =  12708.63577                   (1/df) Pearson  =   3.841788

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   6.358683
Log pseudolikelihood = -10571.74523               BIC             =  -15998.13

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_pp_c_lag_all |   1.000019   .0000127     1.49   0.137      .999994    1.000044
 p75_pp_c_lag_all |          1   1.06e-07     0.25   0.802     .9999998           1
        mine_time |   1.001023   .0067164     0.15   0.879     .9879452    1.014274
onsite_insp_hours |   .9998624   .0000389    -3.53   0.000      .999786    .9999387
                  |
            state |
               1  |   1.062533   .1151576     0.56   0.576     .8591895    1.314001
               2  |   1.855124   .0947173    12.10   0.000     1.678468    2.050373
               3  |   .6171634   .0574986    -5.18   0.000     .5141587    .7408038
               4  |   1.169631   .0837556     2.19   0.029     1.016472    1.345867
               5  |   .9116085   .0853899    -0.99   0.323     .7587116    1.095317
               6  |    .974113   .0569741    -0.45   0.654     .8686085    1.092432
               7  |   1.208652   .1630563     1.40   0.160     .9278289    1.574472
               8  |     .45675   .0217432   -16.46   0.000     .4160617    .5014173
               9  |   .6186752    .029158   -10.19   0.000     .5640866    .6785466
              10  |   .9142522   .0661539    -1.24   0.215     .7933675    1.053556
              11  |   1.470895   .4040307     1.40   0.160     .8585596    2.519955
              12  |   1.012295   .1047042     0.12   0.906     .8265428    1.239793
              13  |   1.619393    .294507     2.65   0.008     1.133837    2.312885
              14  |   .4309499   .0854651    -4.24   0.000     .2921583    .6356753
              15  |   .7388553   .0707469    -3.16   0.002     .6124282    .8913815
              17  |   .5897392   .0230469   -13.51   0.000     .5462546    .6366853
                  |
             time |
            2007  |   1.061758   .0409794     1.55   0.121     .9844027    1.145192
            2009  |   .8822696   .0298289    -3.70   0.000      .825701    .9427136
            2010  |   .8597146   .0376885    -3.45   0.001      .788931     .936849
            2011  |   .7816385   .0311631    -6.18   0.000     .7228853    .8451668
            2012  |   .6918037   .0310746    -8.20   0.000     .6335027    .7554702
            2013  |   .6677103   .0368995    -7.31   0.000     .5991677     .744094
            2014  |   .6974246   .0397918    -6.32   0.000     .6236367    .7799429
            2015  |   .6574605   .0424778    -6.49   0.000     .5792613    .7462164
                  |
            _cons |    .000069   4.62e-06  -143.04   0.000     .0000605    .0000786
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  10835.13
         Prob > chi2(3307)        =    0.0000

         Pearson goodness-of-fit  =  12708.64
         Prob > chi2(3307)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9358.4887  
Iteration 1:   log pseudolikelihood = -9227.4011  
Iteration 2:   log pseudolikelihood = -9224.9924  
Iteration 3:   log pseudolikelihood = -9224.9885  
Iteration 4:   log pseudolikelihood = -9224.9885  

Generalized linear models                         No. of obs      =      3,333
Optimization     : ML                             Residual df     =      3,308
                                                  Scale parameter =          1
Deviance         =  2045.013396                   (1/df) Deviance =   .6182024
Pearson          =  2509.154439                   (1/df) Pearson  =    .758511

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   5.550548
Log pseudolikelihood = -9224.988501               BIC             =  -24788.25

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_pp_c_lag_all |   1.000018   .0000212     0.86   0.391     .9999767     1.00006
 p75_pp_c_lag_all |          1   1.25e-07     0.70   0.486     .9999998           1
        mine_time |   1.009966   .0068884     1.45   0.146     .9965548    1.023558
onsite_insp_hours |   .9998461   .0000426    -3.61   0.000     .9997625    .9999297
                  |
            state |
               1  |   .9233805   .1268258    -0.58   0.562     .7054539    1.208628
               2  |   1.306913   .0726046     4.82   0.000     1.172085    1.457252
               3  |   .6354138   .0892415    -3.23   0.001     .4825126    .8367673
               4  |    1.06424   .0901039     0.74   0.462     .9015146    1.256339
               5  |   .8344804   .0892663    -1.69   0.091     .6766455    1.029132
               6  |   .8097279   .0501572    -3.41   0.001     .7171547    .9142508
               7  |   1.235279   .2290269     1.14   0.254     .8589112    1.776569
               8  |   .3763643   .0183637   -20.03   0.000     .3420395    .4141337
               9  |   .5342996   .0289874   -11.55   0.000     .4804017    .5942445
              10  |   .7928357   .1222211    -1.51   0.132     .5860904    1.072511
              11  |   1.350725   .3418739     1.19   0.235     .8224785    2.218245
              12  |   .9859305   .0851531    -0.16   0.870     .8323951    1.167785
              13  |   1.820091   .3434654     3.17   0.002     1.257375    2.634642
              14  |   .4435717   .0889467    -4.05   0.000     .2994178    .6571281
              15  |   .6706381   .0501243    -5.35   0.000     .5792532    .7764403
              17  |   .5307917   .0275754   -12.19   0.000     .4794055     .587686
                  |
             time |
            2007  |   1.100243    .049254     2.13   0.033      1.00782     1.20114
            2009  |    .908536   .0431528    -2.02   0.043     .8277755    .9971758
            2010  |   .9010813   .0473612    -1.98   0.048     .8128762    .9988574
            2011  |   .8323815   .0431511    -3.54   0.000     .7519616     .921402
            2012  |   .7373374   .0447861    -5.02   0.000      .654582    .8305551
            2013  |   .7350642   .0513398    -4.41   0.000     .6410235    .8429011
            2014  |   .6960581   .0444119    -5.68   0.000     .6142352    .7887806
            2015  |   .6490398   .0444397    -6.31   0.000     .5675311    .7422548
                  |
            _cons |   .0000701   5.14e-06  -130.38   0.000     .0000607     .000081
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -10889.902  
Iteration 1:   log pseudolikelihood = -10572.649  
Iteration 2:   log pseudolikelihood = -10571.745  
Iteration 3:   log pseudolikelihood = -10571.745  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9341.1227  
Iteration 1:   log pseudolikelihood = -9025.1857  
Iteration 2:   log pseudolikelihood = -8994.5067  
Iteration 3:   log pseudolikelihood = -8994.0816  
Iteration 4:   log pseudolikelihood = -8994.0816  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8814.3595  
Iteration 1:   log pseudolikelihood = -8776.8777  
Iteration 2:   log pseudolikelihood = -8775.5468  
Iteration 3:   log pseudolikelihood = -8775.5459  

Negative binomial regression                    Number of obs     =      3,333
                                                Wald chi2(25)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8775.5459               Pseudo R2         =     0.0243

                                    (Std. Err. adjusted for 727 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_pp_c_lag_all |   1.000017   .0000169     0.98   0.327     .9999835     1.00005
 p75_pp_c_lag_all |          1   1.07e-07     0.25   0.802     .9999998           1
        mine_time |   1.006905   .0063411     1.09   0.275     .9945533    1.019411
onsite_insp_hours |   .9998688   .0000398    -3.29   0.001     .9997907    .9999469
                  |
            state |
               1  |   .9618261   .1225231    -0.31   0.760     .7493168    1.234604
               2  |   1.443321   .0751836     7.04   0.000     1.303236    1.598463
               3  |   .6244814    .081719    -3.60   0.000     .4832057     .807062
               4  |   1.076335   .0843824     0.94   0.348     .9230288    1.255105
               5  |   .8480777   .0872764    -1.60   0.109     .6931668    1.037609
               6  |   .8317962   .0460041    -3.33   0.001     .7463449     .927031
               7  |   1.200484   .2098455     1.05   0.296     .8522477    1.691014
               8  |   .3981373   .0184887   -19.83   0.000     .3635004    .4360748
               9  |   .5598285   .0275435   -11.79   0.000     .5083653    .6165013
              10  |   .8192471   .1022737    -1.60   0.110     .6414343    1.046352
              11  |   1.384753    .350471     1.29   0.198      .843217    2.274078
              12  |   1.037446   .0863247     0.44   0.659      .881329    1.221218
              13  |   1.731154   .3119129     3.05   0.002       1.2161    2.464348
              14  |   .4373676   .0930924    -3.89   0.000     .2881846    .6637772
              15  |   .7031719   .0490958    -5.04   0.000     .6132397    .8062929
              17  |   .5480147   .0250773   -13.14   0.000     .5010038    .5994368
                  |
             time |
            2007  |   1.113561   .0453865     2.64   0.008     1.028065    1.206166
            2009  |   .8966981   .0354605    -2.76   0.006      .829822    .9689637
            2010  |    .892702   .0424002    -2.39   0.017     .8133499    .9797959
            2011  |   .8224728   .0368466    -4.36   0.000     .7533346    .8979564
            2012  |   .7187811   .0369055    -6.43   0.000     .6499682    .7948793
            2013  |   .6985168   .0407233    -6.15   0.000     .6230917    .7830719
            2014  |   .6883702   .0391517    -6.57   0.000     .6157566    .7695467
            2015  |   .6557577   .0410075    -6.75   0.000     .5801147    .7412641
                  |
            _cons |   .0000695   4.58e-06  -145.29   0.000     .0000611    .0000791
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.268567   .0708654                     -1.407461   -1.129674
------------------+----------------------------------------------------------------
            alpha |   .2812343   .0199298                       .244764    .3231387
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.PP.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.C.PP.4.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =   3592.40
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      3,333 -11782.29  -10571.75      26    21195.49   21354.39
        nbin |      3,333 -8994.082  -8775.546      27    17605.09   17770.11
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp4_yhat 
(option n assumed; predicted number of events)

. gen cpp4_res = dv - cpp4_yhat

. 
. summ dv cpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    9.976651    14.85334          0        200
   cpp4_yhat |      6,253    9.131631    12.81179   .0035157    103.744

. /*
> pause "next"
> 
> scatter dv cpp4_yhat
> 
> pause "next"
> 
> scatter cpp4_res dv
> 
> pause "next"
> 
> scatter cpp4_res cpp4_yhat
> */
. pause "complete: C.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.1
. 
. eststo clear

. eststo: logit dv_indicator `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1770.6162  
Iteration 2:   log pseudolikelihood =  -1733.014  
Iteration 3:   log pseudolikelihood = -1732.0074  
Iteration 4:   log pseudolikelihood = -1732.0052  
Iteration 5:   log pseudolikelihood = -1732.0052  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(31)     =          .
Log pseudolikelihood = -1732.0052               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p48 |   1.240739   .1070959     2.50   0.012      1.04763    1.469443
              p75 |   .9990789   .0020722    -0.44   0.657     .9950257    1.003149
        mine_time |   1.020092   .0198784     1.02   0.307     .9818653    1.059806
onsite_insp_hours |   1.003918   .0005334     7.36   0.000     1.002873    1.004964
                  |
            state |
               1  |   1.141599   .8641593     0.17   0.861     .2589268    5.033267
               2  |   .6843988   .0945843    -2.74   0.006     .5220026    .8973169
               3  |    1.40528   .6270823     0.76   0.446     .5860418    3.369745
               4  |   4.652848   3.593095     1.99   0.046     1.024214    21.13718
               5  |   .9347103   .4711762    -0.13   0.893     .3480138    2.510484
               6  |    .484185   .0693593    -5.06   0.000     .3656596    .6411293
               7  |   2.220233   2.184252     0.81   0.418      .322843    15.26882
               8  |   .7637005   .1049968    -1.96   0.050     .5833057    .9998847
               9  |   .2221626   .0301525   -11.08   0.000     .1702721    .2898666
              10  |   .6857034   .2885864    -0.90   0.370     .3005371    1.564496
              11  |   3.459796   2.998778     1.43   0.152     .6328075      18.916
              12  |   .5083678   .1115713    -3.08   0.002     .3306474    .7816115
              13  |    1.86184   1.244363     0.93   0.352     .5023894    6.899921
              14  |   .4217289   .1764979    -2.06   0.039     .1856935    .9577893
              15  |   .6361504   .1097841    -2.62   0.009     .4535897    .8921882
              17  |          1  (empty)
                  |
             time |
            2000  |   1.017647   .1924622     0.09   0.926     .7024477    1.474282
            2002  |   .6817898   .1323532    -1.97   0.048      .466026    .9974495
            2003  |   .9094765   .2076398    -0.42   0.678     .5813748    1.422744
            2004  |   .5299326   .1146396    -2.94   0.003     .3468018    .8097668
            2005  |   .4769348   .0997371    -3.54   0.000     .3165591    .7185603
            2006  |   .4965122   .1080066    -3.22   0.001     .3241661    .7604879
            2007  |   .3267232     .07057    -5.18   0.000     .2139569    .4989233
            2008  |    .231093   .0507809    -6.67   0.000     .1502249    .3554936
            2009  |    .271952   .0678053    -5.22   0.000     .1668259    .4433236
            2010  |   .2048644   .0503071    -6.46   0.000     .1266027    .3315051
            2011  |    .246345   .0609631    -5.66   0.000     .1516689    .4001206
            2012  |   .1687586   .0416254    -7.21   0.000     .1040667    .2736656
            2013  |    .250723   .0734821    -4.72   0.000     .1411638    .4453127
            2014  |    .155999    .045894    -6.32   0.000     .0876402    .2776773
            2015  |   .1044549   .0328242    -7.19   0.000     .0564215    .1933805
                  |
            _cons |   .0001229   .0000224   -49.38   0.000      .000086    .0001757
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 26 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.V.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.V.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6192) =     11440.74
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1952.8292  
Iteration 2:   log likelihood = -1758.1209  
Iteration 3:   log likelihood = -1743.7855  
Iteration 4:   log likelihood = -1734.6815  
Iteration 5:   log likelihood = -1721.0809  
Iteration 6:   log likelihood = -1720.7174  
Iteration 7:   log likelihood = -1720.7171  
Iteration 8:   log likelihood = -1720.7171  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2211.18
                                                Prob > chi2       =     0.0000
Log likelihood = -1720.7171                     Pseudo R2         =     0.3912

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9659032   .0408584    23.64   0.000     .8858222    1.045984
      _hatsq |   .0718777   .0171681     4.19   0.000     .0382289    .1055266
       _cons |  -.1428585   .0568017    -2.52   0.012    -.2541878   -.0315293
------------------------------------------------------------------------------
Note: 0 failures and 267 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5029           611  |       5640
     -     |       164           438  |        602
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.84%
Specificity                     Pr( -|~D)   41.75%
Positive predictive value       Pr( D| +)   89.17%
Negative predictive value       Pr(~D| -)   72.76%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.25%
False - rate for true D         Pr( -| D)    3.16%
False + rate for classified +   Pr(~D| +)   10.83%
False - rate for classified -   Pr( D| -)   27.24%
--------------------------------------------------
Correctly classified                        87.58%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv1_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv1_res = dv_indicator - bv1_yhat
(11 missing values generated)

. 
. summ dv_indicator bv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
    bv1_yhat |      6,242    .8319449    .2242413   .0023225          1

. /*
> pause "next"
> 
> scatter dv_indicator bv1_yhat
> 
> pause "next"
> 
> scatter bv1_res dv_indicator
> 
> pause "next"
> 
> scatter bv1_res bv1_yhat
> */
. pause "complete: B.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.2
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1771.0341  
Iteration 2:   log pseudolikelihood = -1733.2358  
Iteration 3:   log pseudolikelihood = -1732.2152  
Iteration 4:   log pseudolikelihood =  -1732.213  
Iteration 5:   log pseudolikelihood =  -1732.213  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(31)     =          .
Log pseudolikelihood =  -1732.213               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p48_1lag |   1.224222    .102897     2.41   0.016     1.038284     1.44346
         p75_1lag |   1.000642   .0020421     0.31   0.753     .9966479    1.004653
        mine_time |   1.020887   .0199171     1.06   0.289      .982587     1.06068
onsite_insp_hours |   1.003698   .0004931     7.51   0.000     1.002732    1.004665
                  |
            state |
               1  |   1.135382   .8612738     0.17   0.867     .2567089    5.021613
               2  |   .6697116   .0929464    -2.89   0.004      .510215    .8790678
               3  |   1.384565   .6120437     0.74   0.462     .5821588    3.292949
               4  |    4.70757   3.602472     2.02   0.043     1.050544      21.095
               5  |   .9511105   .4775622    -0.10   0.920     .3554955    2.544649
               6  |   .4840326   .0693254    -5.07   0.000     .3655624    .6408961
               7  |   2.181003   2.212591     0.77   0.442     .2986253     15.9289
               8  |   .7790911   .1079691    -1.80   0.072     .5937805    1.022235
               9  |   .2177242   .0294748   -11.26   0.000     .1669836    .2838831
              10  |   .6916588   .2870673    -0.89   0.374     .3066251    1.560185
              11  |   3.368744   2.909751     1.41   0.160      .619788     18.3102
              12  |   .5227596    .114539    -2.96   0.003     .3402513    .8031639
              13  |    1.86906   1.252806     0.93   0.351     .5024284    6.953001
              14  |   .4252828    .177739    -2.05   0.041     .1874709    .9647652
              15  |   .6315264   .1089856    -2.66   0.008     .4502932    .8857019
              17  |          1  (empty)
                  |
             time |
            2000  |   1.024601   .1942847     0.13   0.898     .7065614    1.485797
            2002  |   .6857142   .1328294    -1.95   0.051     .4690912    1.002372
            2003  |   .9167628   .2085889    -0.38   0.702     .5869283    1.431953
            2004  |   .5336894   .1152147    -2.91   0.004     .3495653    .8147959
            2005  |   .4846621   .1011139    -3.47   0.001     .3219993    .7294964
            2006  |   .4993612   .1089591    -3.18   0.001     .3256006    .7658512
            2007  |   .3260218   .0707932    -5.16   0.000     .2130171    .4989749
            2008  |   .2336317   .0513481    -6.62   0.000     .1518633    .3594271
            2009  |   .2707779    .067755    -5.22   0.000     .1658146    .4421848
            2010  |   .2038621   .0500867    -6.47   0.000     .1259521    .3299648
            2011  |   .2462042    .060794    -5.68   0.000     .1517442    .3994649
            2012  |   .1697455   .0418366    -7.20   0.000     .1047141    .2751637
            2013  |   .2548954   .0746959    -4.66   0.000      .143523    .4526916
            2014  |   .1590487   .0467244    -6.26   0.000     .0894271    .2828727
            2015  |   .1079259   .0337213    -7.13   0.000     .0585017    .1991052
                  |
            _cons |   .0001215   .0000222   -49.32   0.000     .0000849    .0001739
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 23 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.V.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.V.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6229
           Pearson chi2(6194) =      8309.01
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1952.4287  
Iteration 2:   log likelihood = -1759.0708  
Iteration 3:   log likelihood = -1744.6229  
Iteration 4:   log likelihood = -1735.3048  
Iteration 5:   log likelihood =  -1720.785  
Iteration 6:   log likelihood = -1720.3651  
Iteration 7:   log likelihood = -1720.3647  
Iteration 8:   log likelihood = -1720.3647  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2211.89
                                                Prob > chi2       =     0.0000
Log likelihood = -1720.3647                     Pseudo R2         =     0.3913

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9635617   .0406498    23.70   0.000     .8838895    1.043234
      _hatsq |   .0742461   .0171733     4.32   0.000      .040587    .1079052
       _cons |  -.1458621   .0568347    -2.57   0.010     -.257256   -.0344681
------------------------------------------------------------------------------
Note: 0 failures and 279 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5032           612  |       5644
     -     |       161           437  |        598
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.90%
Specificity                     Pr( -|~D)   41.66%
Positive predictive value       Pr( D| +)   89.16%
Negative predictive value       Pr(~D| -)   73.08%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.34%
False - rate for true D         Pr( -| D)    3.10%
False + rate for classified +   Pr(~D| +)   10.84%
False - rate for classified -   Pr( D| -)   26.92%
--------------------------------------------------
Correctly classified                        87.62%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv2_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv2_res = dv_indicator - bv2_yhat
(11 missing values generated)

. 
. summ dv_indicator bv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
    bv2_yhat |      6,242    .8319449    .2241503   .0023371          1

. /*
> pause "next"
> 
> scatter dv_indicator bv2_yhat
> 
> pause "next"
> 
> scatter bv2_res dv_indicator
> 
> pause "next"
> 
> scatter bv2_res bv2_yhat
> */
. pause "complete: B.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.3
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1769.8392  
Iteration 2:   log pseudolikelihood = -1732.2703  
Iteration 3:   log pseudolikelihood = -1731.2776  
Iteration 4:   log pseudolikelihood = -1731.2755  
Iteration 5:   log pseudolikelihood = -1731.2755  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(31)     =          .
Log pseudolikelihood = -1731.2755               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p48_c_4lag |   1.082715   .0306773     2.80   0.005     1.024228    1.144543
       p75_c_4lag |   .9997671    .000496    -0.47   0.639     .9987954     1.00074
        mine_time |   1.020834   .0200038     1.05   0.293     .9823707    1.060803
onsite_insp_hours |   1.003856   .0004954     7.80   0.000     1.002886    1.004828
                  |
            state |
               1  |   1.150623   .8681667     0.19   0.852     .2622319    5.048713
               2  |   .6545842   .0913711    -3.04   0.002     .4979082    .8605611
               3  |   1.381743   .6066717     0.74   0.461      .584382    3.267067
               4  |    4.67586   3.600758     2.00   0.045     1.033649    21.15191
               5  |   .9429124   .4754665    -0.12   0.907     .3509541    2.533333
               6  |   .4858716    .069593    -5.04   0.000     .3669451    .6433419
               7  |   2.222535   2.218741     0.80   0.424     .3141232    15.72524
               8  |   .8117621    .110335    -1.53   0.125      .621918    1.059557
               9  |   .2222199   .0305069   -10.96   0.000     .1697961    .2908292
              10  |   .6978904   .2926673    -0.86   0.391     .3067802    1.587622
              11  |   3.447024   2.988169     1.43   0.153     .6303059    18.85112
              12  |   .5141054   .1120396    -3.05   0.002      .335389    .7880531
              13  |   1.851158   1.240365     0.92   0.358     .4978487    6.883184
              14  |   .4288182   .1797544    -2.02   0.043     .1885653    .9751796
              15  |   .6380078   .1105095    -2.59   0.009     .4543485    .8959069
              17  |          1  (empty)
                  |
             time |
            2000  |   1.015632   .1937873     0.08   0.935     .6987524    1.476215
            2002  |   .6822887   .1320724    -1.97   0.048     .4668731    .9970973
            2003  |   .9018618   .2055655    -0.45   0.650     .5769281    1.409802
            2004  |   .5272212   .1137544    -2.97   0.003     .3454107    .8047296
            2005  |   .4760977   .0993624    -3.56   0.000     .3162633    .7167098
            2006  |   .4925294   .1075091    -3.24   0.001     .3210941    .7554959
            2007  |    .326134   .0709509    -5.15   0.000     .2129198    .4995467
            2008  |   .2324838   .0513051    -6.61   0.000     .1508507    .3582927
            2009  |   .2699892   .0676024    -5.23   0.000     .1652778    .4410403
            2010  |   .2038039   .0499169    -6.49   0.000     .1261045    .3293776
            2011  |   .2462311   .0608376    -5.67   0.000     .1517163     .399626
            2012  |    .168443   .0415848    -7.21   0.000      .103827    .2732724
            2013  |   .2503405   .0733351    -4.73   0.000     .1409869     .444512
            2014  |   .1560723   .0458904    -6.32   0.000      .087709    .2777201
            2015  |   .1050053   .0327028    -7.24   0.000     .0570313    .1933343
                  |
            _cons |   .0001227   .0000224   -49.42   0.000     .0000858    .0001753
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 25 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.V.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.V.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6191) =      9774.53
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1952.1293  
Iteration 2:   log likelihood = -1757.8942  
Iteration 3:   log likelihood =   -1743.32  
Iteration 4:   log likelihood = -1734.4473  
Iteration 5:   log likelihood = -1720.0521  
Iteration 6:   log likelihood = -1719.6305  
Iteration 7:   log likelihood = -1719.6301  
Iteration 8:   log likelihood = -1719.6301  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2213.36
                                                Prob > chi2       =     0.0000
Log likelihood = -1719.6301                     Pseudo R2         =     0.3916

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9646016   .0407539    23.67   0.000     .8847254    1.044478
      _hatsq |   .0732284   .0171552     4.27   0.000     .0396049     .106852
       _cons |   -.144697   .0567802    -2.55   0.011    -.2559841   -.0334099
------------------------------------------------------------------------------
Note: 0 failures and 267 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5031           609  |       5640
     -     |       162           440  |        602
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.88%
Specificity                     Pr( -|~D)   41.94%
Positive predictive value       Pr( D| +)   89.20%
Negative predictive value       Pr(~D| -)   73.09%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.06%
False - rate for true D         Pr( -| D)    3.12%
False + rate for classified +   Pr(~D| +)   10.80%
False - rate for classified -   Pr( D| -)   26.91%
--------------------------------------------------
Correctly classified                        87.65%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv3_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv3_res = dv_indicator - bv3_yhat
(11 missing values generated)

. 
. summ dv_indicator bv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
    bv3_yhat |      6,242    .8319449     .224249   .0023176          1

. /*
> pause "next"
> 
> scatter dv_indicator bv3_yhat
> 
> pause "next"
> 
> scatter bv3_res dv_indicator
> 
> pause "next"
> 
> scatter bv3_res bv3_yhat
> */
. pause "complete: B.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.4
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1769.8829  
Iteration 2:   log pseudolikelihood = -1729.9075  
Iteration 3:   log pseudolikelihood = -1728.0568  
Iteration 4:   log pseudolikelihood = -1728.0521  
Iteration 5:   log pseudolikelihood = -1728.0521  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(31)     =          .
Log pseudolikelihood = -1728.0521               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_c_lag_all |   1.027889   .0126765     2.23   0.026     1.003342    1.053037
    p75_c_lag_all |   1.000091   .0001086     0.84   0.399     .9998787    1.000304
        mine_time |   1.002607   .0204598     0.13   0.898     .9632977     1.04352
onsite_insp_hours |   1.003642    .000388     9.40   0.000     1.002882    1.004403
                  |
            state |
               1  |   1.078896   .8208498     0.10   0.920     .2428653    4.792851
               2  |    .752389   .1081897    -1.98   0.048     .5676022    .9973345
               3  |   .9702679   .4517174    -0.06   0.948      .389589    2.416443
               4  |   4.554071   3.468335     1.99   0.047     1.023607    20.26126
               5  |   .9261847   .4734562    -0.15   0.881     .3400729    2.522453
               6  |   .4644149   .0660606    -5.39   0.000     .3514204    .6137411
               7  |   2.079931   1.921961     0.79   0.428     .3400136    12.72336
               8  |   .8065408   .1074747    -1.61   0.107     .6211557    1.047254
               9  |   .2068027   .0294347   -11.07   0.000     .1564597    .2733441
              10  |   .6835275    .278576    -0.93   0.351     .3074987    1.519388
              11  |   3.016326   2.599751     1.28   0.200     .5569721    16.33515
              12  |   .5215509   .1103805    -3.08   0.002     .3444682    .7896673
              13  |   1.879214   1.254581     0.94   0.345     .5078159    6.954184
              14  |   .4315122   .1874364    -1.93   0.053     .1841856    1.010952
              15  |   .6145334   .1059079    -2.83   0.005     .4383798    .8614706
              17  |          1  (empty)
                  |
             time |
            2000  |   1.009843   .1903211     0.05   0.959     .6979608    1.461088
            2002  |   .6914115   .1333511    -1.91   0.056     .4737695    1.009035
            2003  |   .9103933   .2063705    -0.41   0.679     .5838164    1.419652
            2004  |   .5338581   .1149033    -2.92   0.004     .3501225    .8140136
            2005  |   .4888767    .101887    -3.43   0.001     .3249377     .735527
            2006  |   .5062226   .1096514    -3.14   0.002     .3311046    .7739588
            2007  |   .3305437   .0719506    -5.09   0.000     .2157471    .5064225
            2008  |   .2402691   .0528263    -6.49   0.000     .1561529    .3696968
            2009  |   .2811262   .0702372    -5.08   0.000     .1722801    .4587409
            2010  |   .2067191   .0505877    -6.44   0.000     .1279608    .3339523
            2011  |   .2515021   .0621632    -5.58   0.000     .1549359    .4082548
            2012  |   .1727621   .0425101    -7.14   0.000     .1066597    .2798314
            2013  |   .2607078   .0762514    -4.60   0.000     .1469589    .4625005
            2014  |   .1566005   .0455903    -6.37   0.000      .088509     .277076
            2015  |   .1093134   .0339036    -7.14   0.000     .0595214    .2007583
                  |
            _cons |   .0001312   .0000239   -49.05   0.000     .0000918    .0001876
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 46 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.V.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.V.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6192) =      7427.28
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1953.4486  
Iteration 2:   log likelihood = -1755.6865  
Iteration 3:   log likelihood =  -1738.851  
Iteration 4:   log likelihood = -1728.2673  
Iteration 5:   log likelihood = -1716.5851  
Iteration 6:   log likelihood = -1716.3998  
Iteration 7:   log likelihood = -1716.3996  
Iteration 8:   log likelihood = -1716.3996  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2219.82
                                                Prob > chi2       =     0.0000
Log likelihood = -1716.3996                     Pseudo R2         =     0.3927

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9678894   .0406864    23.79   0.000     .8881454    1.047633
      _hatsq |   .0731459    .017191     4.25   0.000     .0394522    .1068397
       _cons |  -.1472652   .0569902    -2.58   0.010    -.2589639   -.0355664
------------------------------------------------------------------------------
Note: 0 failures and 322 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5023           604  |       5627
     -     |       170           445  |        615
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.73%
Specificity                     Pr( -|~D)   42.42%
Positive predictive value       Pr( D| +)   89.27%
Negative predictive value       Pr(~D| -)   72.36%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   57.58%
False - rate for true D         Pr( -| D)    3.27%
False + rate for classified +   Pr(~D| +)   10.73%
False - rate for classified -   Pr( D| -)   27.64%
--------------------------------------------------
Correctly classified                        87.60%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv4_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv4_res = dv_indicator - bv4_yhat
(11 missing values generated)

. 
. summ dv_indicator bv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
    bv4_yhat |      6,242    .8319449    .2244524   .0025314          1

. /*
> pause "next"
> 
> scatter dv_indicator bv4_yhat
> 
> pause "next"
> 
> scatter bv4_res dv_indicator
> 
> pause "next"
> 
> scatter bv4_res bv4_yhat
> */
. pause "complete: B.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.1
. 
. eststo clear

. eststo: logit dv_indicator `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1770.5794  
Iteration 2:   log pseudolikelihood = -1732.9439  
Iteration 3:   log pseudolikelihood =  -1731.934  
Iteration 4:   log pseudolikelihood = -1731.9318  
Iteration 5:   log pseudolikelihood = -1731.9318  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(31)     =          .
Log pseudolikelihood = -1731.9318               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_ss |   1.591619   .3288566     2.25   0.024     1.061612     2.38623
           p75_ss |   1.004391   .0045313     0.97   0.331     .9955491    1.013312
        mine_time |   1.021711   .0199033     1.10   0.270     .9834362    1.061475
onsite_insp_hours |    1.00363   .0004486     8.11   0.000     1.002751     1.00451
                  |
            state |
               1  |   1.123287   .8577514     0.15   0.879     .2514816    5.017361
               2  |   .6682771   .0916991    -2.94   0.003     .5106896    .8744925
               3  |   1.393011   .6065407     0.76   0.446     .5933721    3.270259
               4  |    4.68726   3.587147     2.02   0.044     1.045916    21.00589
               5  |   .9251766   .4637526    -0.16   0.877     .3463799    2.471136
               6  |    .474692   .0680998    -5.19   0.000      .358342    .6288197
               7  |   2.140244   2.173109     0.75   0.454      .292544    15.65797
               8  |   .8240103   .1145552    -1.39   0.164     .6274762    1.082102
               9  |   .2143875   .0293924   -11.23   0.000     .1638703    .2804779
              10  |   .6762635   .2821319    -0.94   0.348     .2985391    1.531901
              11  |   3.204469   2.764658     1.35   0.177     .5907191    17.38325
              12  |   .5210702   .1132834    -3.00   0.003     .3402831    .7979065
              13  |   1.870055   1.245282     0.94   0.347     .5070297    6.897238
              14  |   .4232851   .1771524    -2.05   0.040      .186376    .9613381
              15  |   .6264819   .1081415    -2.71   0.007     .4466595    .8786997
              17  |          1  (empty)
                  |
             time |
            2000  |   1.008321   .1909547     0.04   0.965     .6956636    1.461499
            2002  |   .6888162   .1332568    -1.93   0.054     .4714459     1.00641
            2003  |   .9164394   .2085747    -0.38   0.701     .5866468     1.43163
            2004  |   .5334594   .1150487    -2.91   0.004     .3495641    .8140966
            2005  |   .4832934   .1009138    -3.48   0.000     .3209787    .7276885
            2006  |   .4916855   .1065702    -3.28   0.001     .3215097    .7519358
            2007  |    .324678   .0704422    -5.18   0.000      .212215    .4967406
            2008  |   .2336927   .0513654    -6.61   0.000      .151898    .3595325
            2009  |   .2762282   .0690527    -5.15   0.000     .1692315    .4508738
            2010  |   .2053725   .0503947    -6.45   0.000     .1269617    .3322093
            2011  |   .2514648   .0619557    -5.60   0.000     .1551524    .4075638
            2012  |   .1773101   .0438871    -6.99   0.000     .1091559     .288018
            2013  |   .2620911   .0772026    -4.55   0.000      .147136    .4668588
            2014  |   .1647413   .0483279    -6.15   0.000     .0927037    .2927575
            2015  |   .1120367   .0351591    -6.98   0.000     .0605673    .2072444
                  |
            _cons |   .0001219   .0000222   -49.43   0.000     .0000853    .0001743
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 19 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.SSV.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.SSV.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6192) =      7954.65
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood =  -1950.591  
Iteration 2:   log likelihood = -1758.7915  
Iteration 3:   log likelihood = -1744.3754  
Iteration 4:   log likelihood = -1735.1584  
Iteration 5:   log likelihood = -1720.7477  
Iteration 6:   log likelihood = -1720.3257  
Iteration 7:   log likelihood = -1720.3253  
Iteration 8:   log likelihood = -1720.3253  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2211.97
                                                Prob > chi2       =     0.0000
Log likelihood = -1720.3253                     Pseudo R2         =     0.3913

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9653881   .0408407    23.64   0.000     .8853418    1.045434
      _hatsq |   .0733117   .0172581     4.25   0.000     .0394865    .1071369
       _cons |  -.1452126   .0568347    -2.56   0.011    -.2566065   -.0338187
------------------------------------------------------------------------------
Note: 0 failures and 284 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5028           609  |       5637
     -     |       165           440  |        605
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.82%
Specificity                     Pr( -|~D)   41.94%
Positive predictive value       Pr( D| +)   89.20%
Negative predictive value       Pr(~D| -)   72.73%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.06%
False - rate for true D         Pr( -| D)    3.18%
False + rate for classified +   Pr(~D| +)   10.80%
False - rate for classified -   Pr( D| -)   27.27%
--------------------------------------------------
Correctly classified                        87.60%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv1_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv1_res = dv_indicator - bssv1_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
  bssv1_yhat |      6,242    .8319449    .2240986   .0024099          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv1_yhat
> 
> pause "next"
> 
> scatter bssv1_res dv_indicator
> 
> pause "next"
> 
> scatter bssv1_res bssv1_yhat
> */
. pause "complete: B.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.2
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1771.8503  
Iteration 2:   log pseudolikelihood = -1734.5872  
Iteration 3:   log pseudolikelihood = -1733.5963  
Iteration 4:   log pseudolikelihood = -1733.5942  
Iteration 5:   log pseudolikelihood = -1733.5942  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(31)     =          .
Log pseudolikelihood = -1733.5942               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_ss_1lag |   1.201064   .1980842     1.11   0.267     .8693261    1.659395
      p75_ss_1lag |    1.00562   .0046153     1.22   0.222     .9966149    1.014707
        mine_time |   1.019686   .0198666     1.00   0.317     .9814824    1.059377
onsite_insp_hours |   1.003606   .0004365     8.28   0.000     1.002751    1.004462
                  |
            state |
               1  |   1.121546   .8563406     0.15   0.881     .2511275    5.008873
               2  |   .6662749   .0923071    -2.93   0.003     .5078391    .8741394
               3  |   1.425272   .6104232     0.83   0.408     .6156592    3.299552
               4  |   4.681222   3.571219     2.02   0.043     1.049525    20.87976
               5  |   .9379418   .4700244    -0.13   0.898     .3512522    2.504567
               6  |   .4759687    .068088    -5.19   0.000     .3595943     .630005
               7  |   2.114535    2.17372     0.73   0.466     .2819609    15.85773
               8  |   .8248606   .1152044    -1.38   0.168     .6273316    1.084586
               9  |     .21725   .0297442   -11.15   0.000     .1661193    .2841187
              10  |   .6766194   .2804261    -0.94   0.346      .300305    1.524496
              11  |   3.171819   2.734293     1.34   0.181     .5854944     17.1828
              12  |   .5249547   .1139036    -2.97   0.003     .3431072    .8031818
              13  |   1.860486   1.239098     0.93   0.351     .5043353    6.863306
              14  |   .4226057   .1762723    -2.06   0.039     .1865917    .9571465
              15  |   .6250872   .1076647    -2.73   0.006     .4459951    .8760948
              17  |          1  (empty)
                  |
             time |
            2000  |   1.028939   .1949474     0.15   0.880     .7097691    1.491633
            2002  |   .6944577   .1341827    -1.89   0.059     .4755292    1.014179
            2003  |    .923697   .2098642    -0.35   0.727     .5917473    1.441859
            2004  |   .5368649    .115795    -2.88   0.004     .3517804    .8193292
            2005  |   .4897834   .1024674    -3.41   0.001     .3250308    .7380464
            2006  |   .5028172   .1092377    -3.16   0.002     .3284623    .7697235
            2007  |   .3303284   .0719179    -5.09   0.000     .2155884    .5061351
            2008  |   .2400713   .0529085    -6.47   0.000     .1558644    .3697716
            2009  |   .2808601   .0705487    -5.06   0.000     .1716637    .4595171
            2010  |   .2072164   .0508688    -6.41   0.000     .1280754    .3352607
            2011  |   .2530651   .0623777    -5.57   0.000     .1561064    .4102456
            2012  |    .178294   .0440166    -6.98   0.000     .1098993    .2892534
            2013  |   .2665999     .07846    -4.49   0.000      .149745    .4746434
            2014  |   .1678455   .0492335    -6.08   0.000      .094456    .2982564
            2015  |    .114649   .0358738    -6.92   0.000      .062091    .2116959
                  |
            _cons |   .0001212   .0000222   -49.34   0.000     .0000847    .0001734
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 20 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.SSV.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.SSV.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6192) =      7960.67
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood =  -1951.544  
Iteration 2:   log likelihood =  -1760.536  
Iteration 3:   log likelihood =   -1746.09  
Iteration 4:   log likelihood = -1737.1345  
Iteration 5:   log likelihood = -1722.4592  
Iteration 6:   log likelihood = -1722.0072  
Iteration 7:   log likelihood = -1722.0066  
Iteration 8:   log likelihood = -1722.0066  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2208.60
                                                Prob > chi2       =     0.0000
Log likelihood = -1722.0066                     Pseudo R2         =     0.3907

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9656765   .0408548    23.64   0.000     .8856026     1.04575
      _hatsq |   .0732659   .0172745     4.24   0.000     .0394084    .1071233
       _cons |  -.1455175   .0568806    -2.56   0.011    -.2570015   -.0340336
------------------------------------------------------------------------------
Note: 0 failures and 289 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5029           611  |       5640
     -     |       164           438  |        602
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.84%
Specificity                     Pr( -|~D)   41.75%
Positive predictive value       Pr( D| +)   89.17%
Negative predictive value       Pr(~D| -)   72.76%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.25%
False - rate for true D         Pr( -| D)    3.16%
False + rate for classified +   Pr(~D| +)   10.83%
False - rate for classified -   Pr( D| -)   27.24%
--------------------------------------------------
Correctly classified                        87.58%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv2_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv2_res = dv_indicator - bssv2_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
  bssv2_yhat |      6,242    .8319449    .2239364   .0024314          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv2_yhat
> 
> pause "next"
> 
> scatter bssv2_res dv_indicator
> 
> pause "next"
> 
> scatter bssv2_res bssv2_yhat
> */
. pause "complete: B.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.3
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1771.6792  
Iteration 2:   log pseudolikelihood =  -1734.433  
Iteration 3:   log pseudolikelihood = -1733.4447  
Iteration 4:   log pseudolikelihood = -1733.4425  
Iteration 5:   log pseudolikelihood = -1733.4425  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(31)     =          .
Log pseudolikelihood = -1733.4425               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_ss_c_4lag |   1.119522   .0784537     1.61   0.107     .9758485    1.284349
    p75_ss_c_4lag |    1.00088   .0011664     0.75   0.450     .9985964    1.003169
        mine_time |   1.019044   .0199168     0.97   0.334     .9807463    1.058838
onsite_insp_hours |    1.00368   .0004446     8.29   0.000     1.002809    1.004552
                  |
            state |
               1  |   1.123052      .8577     0.15   0.879     .2513729    5.017432
               2  |   .6536847   .0921669    -3.02   0.003     .4958524    .8617559
               3  |   1.390999   .5962246     0.77   0.441     .6004489    3.222388
               4  |   4.629443    3.54118     2.00   0.045     1.033767    20.73169
               5  |   .9216137   .4639655    -0.16   0.871     .3435823    2.472105
               6  |   .4768375   .0683167    -5.17   0.000      .360096     .631426
               7  |    2.12849   2.157968     0.75   0.456     .2917976    15.52608
               8  |   .8120071   .1124807    -1.50   0.133     .6189418    1.065295
               9  |   .2103235   .0286738   -11.44   0.000     .1610059    .2747475
              10  |   .6779925   .2818061    -0.93   0.350     .3002097    1.531175
              11  |   3.228108   2.781385     1.36   0.174     .5964039    17.47253
              12  |   .5168246   .1119138    -3.05   0.002     .3380827     .790066
              13  |   1.858347   1.236482     0.93   0.352     .5043891    6.846802
              14  |   .4220341   .1768032    -2.06   0.039     .1856747     .959273
              15  |   .6271755     .10836    -2.70   0.007      .447016    .8799441
              17  |          1  (empty)
                  |
             time |
            2000  |   1.034797   .1967547     0.18   0.857     .7128676    1.502108
            2002  |   .6882057   .1331802    -1.93   0.053     .4709723    1.005637
            2003  |   .9151268   .2079221    -0.39   0.696     .5862507    1.428497
            2004  |   .5331805   .1148092    -2.92   0.003     .3496116     .813135
            2005  |   .4863375   .1015326    -3.45   0.001     .3230222    .7322224
            2006  |   .4983779   .1082692    -3.21   0.001     .3255675    .7629156
            2007  |   .3273663   .0711583    -5.14   0.000      .213802     .501252
            2008  |   .2362009   .0520861    -6.54   0.000     .1533126    .3639028
            2009  |   .2761137    .069252    -5.13   0.000     .1688878    .4514166
            2010  |   .2057116   .0504829    -6.44   0.000     .1271654    .3327735
            2011  |   .2497614   .0615754    -5.63   0.000     .1540539     .404928
            2012  |   .1757751   .0434351    -7.04   0.000     .1082979    .2852953
            2013  |   .2597848   .0761876    -4.60   0.000     .1462111    .4615802
            2014  |   .1635919    .047987    -6.17   0.000     .0920611    .2907017
            2015  |   .1110403   .0346682    -7.04   0.000     .0602178     .204756
                  |
            _cons |   .0001236   .0000225   -49.43   0.000     .0000865    .0001766
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 21 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.SSV.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.SSV.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6191) =      8198.20
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1952.2101  
Iteration 2:   log likelihood = -1760.4198  
Iteration 3:   log likelihood = -1745.7935  
Iteration 4:   log likelihood = -1737.1258  
Iteration 5:   log likelihood = -1722.3624  
Iteration 6:   log likelihood = -1721.8973  
Iteration 7:   log likelihood = -1721.8968  
Iteration 8:   log likelihood = -1721.8968  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2208.82
                                                Prob > chi2       =     0.0000
Log likelihood = -1721.8968                     Pseudo R2         =     0.3908

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9654842   .0408544    23.63   0.000      .885411    1.045557
      _hatsq |   .0730702   .0172475     4.24   0.000     .0392656    .1068748
       _cons |  -.1448422   .0568455    -2.55   0.011    -.2562572   -.0334271
------------------------------------------------------------------------------
Note: 0 failures and 285 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5028           610  |       5638
     -     |       165           439  |        604
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.82%
Specificity                     Pr( -|~D)   41.85%
Positive predictive value       Pr( D| +)   89.18%
Negative predictive value       Pr(~D| -)   72.68%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   58.15%
False - rate for true D         Pr( -| D)    3.18%
False + rate for classified +   Pr(~D| +)   10.82%
False - rate for classified -   Pr( D| -)   27.32%
--------------------------------------------------
Correctly classified                        87.58%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv3_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv3_res = dv_indicator - bssv3_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
  bssv3_yhat |      6,242    .8319449     .223968   .0024162          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv3_yhat
> 
> pause "next"
> 
> scatter bssv3_res dv_indicator
> 
> pause "next"
> 
> scatter bssv3_res bssv3_yhat
> */
. pause "complete: B.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.4
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -1977.2679  
Iteration 1:   log pseudolikelihood = -1772.6722  
Iteration 2:   log pseudolikelihood = -1732.8688  
Iteration 3:   log pseudolikelihood = -1731.2248  
Iteration 4:   log pseudolikelihood = -1731.2204  
Iteration 5:   log pseudolikelihood = -1731.2204  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(31)     =          .
Log pseudolikelihood = -1731.2204               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_ss_c_lag_all |   1.023817   .0271689     0.89   0.375     .9719282    1.078476
 p75_ss_c_lag_all |   1.000452   .0003324     1.36   0.174     .9998005    1.001104
        mine_time |   1.004082   .0205589     0.20   0.842     .9645855    1.045197
onsite_insp_hours |   1.003645   .0003894     9.38   0.000     1.002882    1.004408
                  |
            state |
               1  |   1.080782   .8353895     0.10   0.920     .2375763    4.916698
               2  |   .7412941   .1072011    -2.07   0.038     .5583356    .9842053
               3  |   1.227568   .5295008     0.48   0.635     .5270926    2.858933
               4  |   4.520215   3.447948     1.98   0.048     1.013622    20.15775
               5  |   .9135889   .4635336    -0.18   0.859     .3379646    2.469622
               6  |   .4659246   .0661416    -5.38   0.000     .3527613    .6153898
               7  |   1.959962   1.696152     0.78   0.437     .3594325    10.68754
               8  |   .8021137   .1076047    -1.64   0.100     .6166604     1.04334
               9  |   .2062046   .0280518   -11.61   0.000     .1579436     .269212
              10  |   .6673327    .271583    -0.99   0.320     .3005597    1.481679
              11  |   3.013371   2.598842     1.28   0.201      .555834    16.33654
              12  |   .5189669   .1105477    -3.08   0.002     .3418386    .7878767
              13  |   1.891257   1.250248     0.96   0.335     .5176652    6.909588
              14  |   .4296701   .1845193    -1.97   0.049      .185179    .9969621
              15  |   .6201863   .1067846    -2.77   0.006     .4425487     .869127
              17  |          1  (empty)
                  |
             time |
            2000  |    1.01027   .1900921     0.05   0.957     .6986757    1.460829
            2002  |    .691112   .1333165    -1.92   0.055     .4735331    1.008664
            2003  |   .9152432   .2076306    -0.39   0.696     .5867246    1.427706
            2004  |   .5362715   .1153074    -2.90   0.004     .3518536    .8173489
            2005  |   .4919648   .1024102    -3.41   0.001     .3271472    .7398181
            2006  |   .5102974   .1106909    -3.10   0.002     .3335688    .7806588
            2007  |   .3329313   .0722166    -5.07   0.000     .2176303    .5093191
            2008  |   .2431288   .0533278    -6.45   0.000     .1581737    .3737134
            2009  |   .2853791   .0711122    -5.03   0.000     .1751118    .4650812
            2010  |   .2097595   .0513027    -6.39   0.000     .1298781    .3387721
            2011  |   .2551894   .0629443    -5.54   0.000     .1573648    .4138258
            2012  |   .1777755   .0438257    -7.01   0.000     .1096557    .2882122
            2013  |   .2644522    .076782    -4.58   0.000     .1496946    .4671843
            2014  |   .1628885   .0471758    -6.27   0.000     .0923348    .2873529
            2015  |   .1132042   .0348588    -7.07   0.000     .0619089    .2070007
                  |
            _cons |   .0001303   .0000237   -49.28   0.000     .0000913     .000186
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 47 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.SSV.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.SSV.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6225
           Pearson chi2(6190) =      7513.00
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -2826.3083  
Iteration 1:   log likelihood = -1956.8853  
Iteration 2:   log likelihood = -1757.4251  
Iteration 3:   log likelihood = -1741.5364  
Iteration 4:   log likelihood = -1728.5043  
Iteration 5:   log likelihood = -1719.9675  
Iteration 6:   log likelihood = -1719.9105  
Iteration 7:   log likelihood = -1719.9105  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2212.80
                                                Prob > chi2       =     0.0000
Log likelihood = -1719.9105                     Pseudo R2         =     0.3915

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9677944   .0408513    23.69   0.000     .8877272    1.047861
      _hatsq |   .0721274   .0172478     4.18   0.000     .0383223    .1059325
       _cons |  -.1447857   .0569489    -2.54   0.011    -.2564035   -.0331679
------------------------------------------------------------------------------
Note: 0 failures and 317 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      5023           605  |       5628
     -     |       170           444  |        614
-----------+--------------------------+-----------
   Total   |      5193          1049  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.73%
Specificity                     Pr( -|~D)   42.33%
Positive predictive value       Pr( D| +)   89.25%
Negative predictive value       Pr(~D| -)   72.31%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   57.67%
False - rate for true D         Pr( -| D)    3.27%
False + rate for classified +   Pr(~D| +)   10.75%
False - rate for classified -   Pr( D| -)   27.69%
--------------------------------------------------
Correctly classified                        87.58%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv4_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv4_res = dv_indicator - bssv4_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
  bssv4_yhat |      6,242    .8319449    .2241962   .0025543          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv4_yhat
> 
> pause "next"
> 
> scatter bssv4_res dv_indicator
> 
> pause "next"
> 
> scatter bssv4_res bssv4_yhat
> */
. pause "complete: B.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.1
. 
. eststo clear

. eststo: logit dv_indicator `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: 7.state != 0 predicts success perfectly
      7.state dropped and 19 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 17.state != 0 predicts success perfectly
      17.state dropped and 9 obs not used

Iteration 0:   log pseudolikelihood = -1048.2677  
Iteration 1:   log pseudolikelihood = -939.81899  
Iteration 2:   log pseudolikelihood = -917.43914  
Iteration 3:   log pseudolikelihood = -916.74848  
Iteration 4:   log pseudolikelihood = -916.74612  
Iteration 5:   log pseudolikelihood = -916.74612  

Logistic regression                             Number of obs     =      3,296
                                                Wald chi2(23)     =          .
Log pseudolikelihood = -916.74612               Prob > chi2       =          .

                                    (Std. Err. adjusted for 722 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_pp |   1.004531   .0019864     2.29   0.022     1.000646    1.008432
           p75_pp |   1.000012   .0000348     0.35   0.727      .999944     1.00008
        mine_time |   1.024706   .0204623     1.22   0.222     .9853753    1.065607
onsite_insp_hours |   1.002816   .0005436     5.19   0.000     1.001752    1.003882
                  |
            state |
               1  |   1.197016   .4750595     0.45   0.650     .5499001     2.60565
               2  |    .864853   .1638736    -0.77   0.444     .5965617    1.253803
               3  |   .9842332   .4954683    -0.03   0.975     .3669429    2.639961
               4  |   3.281343   4.094913     0.95   0.341     .2843182    37.87029
               5  |   .8596345   .4179178    -0.31   0.756     .3315093    2.229112
               6  |   .4420356   .0862221    -4.19   0.000     .3015953    .6478732
               7  |          1  (empty)
               8  |   .0492129    .013134   -11.28   0.000     .0291682    .0830326
               9  |          1  (empty)
              10  |   .5004654   .2412537    -1.44   0.151     .1945562    1.287369
              11  |   1.925749   1.642525     0.77   0.442     .3618982    10.24738
              12  |    .483965   .1357031    -2.59   0.010     .2793432    .8384742
              13  |   1.402544   1.684761     0.28   0.778     .1331796     14.7705
              14  |   .3789409   .1371821    -2.68   0.007     .1863906    .7704046
              15  |   .3890122   .0857043    -4.29   0.000     .2525997    .5990922
              17  |          1  (empty)
                  |
             time |
            2007  |   1.340103   .2564706     1.53   0.126     .9209462    1.950034
            2009  |   1.168605   .2574605     0.71   0.479     .7588147    1.799698
            2010  |   .9074008    .189264    -0.47   0.641     .6029164    1.365656
            2011  |   1.074709   .2371936     0.33   0.744     .6973109    1.656362
            2012  |   .7498654   .1589327    -1.36   0.174     .4949628    1.136041
            2013  |   1.090687   .2848146     0.33   0.740      .653767    1.819605
            2014  |   .6985598   .1777433    -1.41   0.159     .4242498    1.150232
            2015  |   .5013999   .1388843    -2.49   0.013     .2913448    .8629015
                  |
            _cons |   .0000414   9.51e-06   -43.97   0.000     .0000264     .000065
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 8 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.PP.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.PP.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3296
 number of covariate patterns =      3296
           Pearson chi2(3270) =      4462.80
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1541.0869  
Iteration 1:   log likelihood = -1032.6677  
Iteration 2:   log likelihood = -934.83479  
Iteration 3:   log likelihood = -924.26927  
Iteration 4:   log likelihood =  -915.9696  
Iteration 5:   log likelihood = -912.39985  
Iteration 6:   log likelihood = -912.35445  
Iteration 7:   log likelihood = -912.35443  

Logistic regression                             Number of obs     =      3,296
                                                LR chi2(2)        =    1257.46
                                                Prob > chi2       =     0.0000
Log likelihood = -912.35443                     Pseudo R2         =     0.4080

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9432361   .0538552    17.51   0.000     .8376818     1.04879
      _hatsq |   .0617332   .0219371     2.81   0.005     .0187372    .1047291
       _cons |  -.0956178   .0733238    -1.30   0.192    -.2393297    .0480941
------------------------------------------------------------------------------
Note: 0 failures and 124 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2604           317  |       2921
     -     |       107           268  |        375
-----------+--------------------------+-----------
   Total   |      2711           585  |       3296

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.05%
Specificity                     Pr( -|~D)   45.81%
Positive predictive value       Pr( D| +)   89.15%
Negative predictive value       Pr(~D| -)   71.47%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   54.19%
False - rate for true D         Pr( -| D)    3.95%
False + rate for classified +   Pr(~D| +)   10.85%
False - rate for classified -   Pr( D| -)   28.53%
--------------------------------------------------
Correctly classified                        87.14%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp1_yhat 
(option pr assumed; Pr(dv_indicator))
(51 missing values generated)

. gen bpp1_res = dv_indicator - bpp1_yhat
(51 missing values generated)

. 
. summ dv_indicator bpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
   bpp1_yhat |      6,202    .7709389    .2521904   .0032775          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp1_yhat
> 
> pause "next"
> 
> scatter bpp1_res dv_indicator
> 
> pause "next"
> 
> scatter bpp1_res bpp1_yhat
> */
. pause "complete: B.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.2
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: 7.state != 0 predicts success perfectly
      7.state dropped and 19 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 17.state != 0 predicts success perfectly
      17.state dropped and 9 obs not used

Iteration 0:   log pseudolikelihood = -1048.2677  
Iteration 1:   log pseudolikelihood = -940.17601  
Iteration 2:   log pseudolikelihood = -917.86057  
Iteration 3:   log pseudolikelihood = -917.14952  
Iteration 4:   log pseudolikelihood = -917.14688  
Iteration 5:   log pseudolikelihood = -917.14688  

Logistic regression                             Number of obs     =      3,296
                                                Wald chi2(23)     =          .
Log pseudolikelihood = -917.14688               Prob > chi2       =          .

                                    (Std. Err. adjusted for 722 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_pp_1lag |   1.003008    .001905     1.58   0.114     .9992816    1.006749
      p75_pp_1lag |   1.000039   .0000342     1.15   0.252     .9999722    1.000106
        mine_time |   1.023111   .0204581     1.14   0.253     .9837897    1.064005
onsite_insp_hours |   1.002599   .0004925     5.28   0.000     1.001634    1.003565
                  |
            state |
               1  |   1.206083   .4761443     0.47   0.635     .5563336    2.614685
               2  |   .8750797    .166136    -0.70   0.482     .6031771    1.269551
               3  |   .9915331   .4899344    -0.02   0.986     .3764551    2.611567
               4  |   3.329129   4.104934     0.98   0.329     .2970086    37.31575
               5  |   .8839244   .4266514    -0.26   0.798     .3432088    2.276522
               6  |   .4478356   .0878067    -4.10   0.000      .304947    .6576773
               7  |          1  (empty)
               8  |   .0552358   .0145761   -10.97   0.000     .0329305    .0926496
               9  |          1  (empty)
              10  |   .4995155     .23484    -1.48   0.140     .1987782    1.255247
              11  |   1.870787   1.592312     0.74   0.462     .3527995    9.920203
              12  |   .5098967   .1413256    -2.43   0.015     .2961821    .8778205
              13  |   1.398797   1.693213     0.28   0.782     .1304349    15.00084
              14  |   .3885489   .1406707    -2.61   0.009     .1911066    .7899793
              15  |   .3857011   .0850465    -4.32   0.000     .2503584    .5942095
              17  |          1  (empty)
                  |
             time |
            2007  |   1.357808   .2651175     1.57   0.117     .9260573    1.990852
            2009  |   1.144845   .2521235     0.61   0.539     .7435165    1.762798
            2010  |   .8817764   .1837255    -0.60   0.546     .5861428    1.326519
            2011  |   1.052272   .2309026     0.23   0.816     .6844583    1.617742
            2012  |   .7373578    .155737    -1.44   0.149     .4874122    1.115476
            2013  |     1.0835   .2818032     0.31   0.758     .6507937    1.803909
            2014  |    .696865   .1756556    -1.43   0.152      .425197    1.142108
            2015  |   .5089578   .1396747    -2.46   0.014     .2972242     .871524
                  |
            _cons |   .0000422   9.65e-06   -44.06   0.000      .000027     .000066
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 6 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.PP.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.PP.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3296
 number of covariate patterns =      3296
           Pearson chi2(3270) =      3502.14
                  Prob > chi2 =         0.0025

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1541.0869  
Iteration 1:   log likelihood =  -1030.009  
Iteration 2:   log likelihood = -934.98698  
Iteration 3:   log likelihood = -926.65088  
Iteration 4:   log likelihood = -918.56746  
Iteration 5:   log likelihood = -912.59724  
Iteration 6:   log likelihood = -912.44771  
Iteration 7:   log likelihood = -912.44769  

Logistic regression                             Number of obs     =      3,296
                                                LR chi2(2)        =    1257.28
                                                Prob > chi2       =     0.0000
Log likelihood = -912.44769                     Pseudo R2         =     0.4079

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9395381   .0535267    17.55   0.000     .8346276    1.044449
      _hatsq |   .0643198    .021952     2.93   0.003     .0212947    .1073449
       _cons |  -.0980345   .0733395    -1.34   0.181    -.2417773    .0457083
------------------------------------------------------------------------------
Note: 0 failures and 134 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2603           316  |       2919
     -     |       108           269  |        377
-----------+--------------------------+-----------
   Total   |      2711           585  |       3296

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   96.02%
Specificity                     Pr( -|~D)   45.98%
Positive predictive value       Pr( D| +)   89.17%
Negative predictive value       Pr(~D| -)   71.35%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   54.02%
False - rate for true D         Pr( -| D)    3.98%
False + rate for classified +   Pr(~D| +)   10.83%
False - rate for classified -   Pr( D| -)   28.65%
--------------------------------------------------
Correctly classified                        87.14%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp2_yhat 
(option pr assumed; Pr(dv_indicator))
(51 missing values generated)

. gen bpp2_res = dv_indicator - bpp2_yhat
(51 missing values generated)

. 
. summ dv_indicator bpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
   bpp2_yhat |      6,202    .7699867    .2518882   .0034261          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp2_yhat
> 
> pause "next"
> 
> scatter bpp2_res dv_indicator
> 
> pause "next"
> 
> scatter bpp2_res bpp2_yhat
> */
. pause "complete: B.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.3
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: 7.state != 0 predicts success perfectly
      7.state dropped and 19 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 17.state != 0 predicts success perfectly
      17.state dropped and 9 obs not used

Iteration 0:   log pseudolikelihood = -1048.2677  
Iteration 1:   log pseudolikelihood = -939.58685  
Iteration 2:   log pseudolikelihood = -917.31362  
Iteration 3:   log pseudolikelihood = -916.60387  
Iteration 4:   log pseudolikelihood = -916.60122  
Iteration 5:   log pseudolikelihood = -916.60122  

Logistic regression                             Number of obs     =      3,296
                                                Wald chi2(23)     =          .
Log pseudolikelihood = -916.60122               Prob > chi2       =          .

                                    (Std. Err. adjusted for 722 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_pp_c_4lag |   1.001129   .0006166     1.83   0.067     .9999216    1.002339
    p75_pp_c_4lag |    1.00001   8.61e-06     1.11   0.267     .9999927    1.000026
        mine_time |   1.021176   .0203839     1.05   0.294     .9819954    1.061919
onsite_insp_hours |   1.002568   .0004928     5.22   0.000     1.001602    1.003534
                  |
            state |
               1  |   1.207194   .4758657     0.48   0.633     .5574945    2.614048
               2  |   .8936527   .1695943    -0.59   0.554     .6160709    1.296304
               3  |    .977846   .4824934    -0.05   0.964     .3717634     2.57202
               4  |   3.314981   4.018587     0.99   0.323     .3080432    35.67388
               5  |   .8856935   .4241691    -0.25   0.800     .3464439      2.2643
               6  |   .4485737   .0878922    -4.09   0.000     .3055286    .6585908
               7  |          1  (empty)
               8  |    .060724   .0156703   -10.86   0.000     .0366185    .1006976
               9  |          1  (empty)
              10  |   .4997912   .2341996    -1.48   0.139     .1994894    1.252153
              11  |   1.868421   1.585414     0.74   0.461     .3541633    9.857027
              12  |   .5129763   .1408722    -2.43   0.015     .2994626    .8787231
              13  |   1.350497   1.634422     0.25   0.804     .1259906    14.47603
              14  |   .3944742   .1428934    -2.57   0.010     .1939463     .802335
              15  |   .3852038    .085442    -4.30   0.000     .2493938    .5949705
              17  |          1  (empty)
                  |
             time |
            2007  |   1.366713   .2658027     1.61   0.108     .9335396    2.000883
            2009  |   1.142671   .2520823     0.60   0.545     .7415487    1.760772
            2010  |   .8779758   .1837786    -0.62   0.534     .5825166    1.323295
            2011  |   1.045632    .230269     0.20   0.839       .67909    1.610017
            2012  |   .7330829   .1540874    -1.48   0.140     .4855548    1.106797
            2013  |   1.074327   .2786067     0.28   0.782     .6462386    1.785993
            2014  |   .6958533   .1740346    -1.45   0.147     .4262163    1.136071
            2015  |   .5045356   .1373197    -2.51   0.012      .295951    .8601293
                  |
            _cons |   .0000432   9.88e-06   -43.94   0.000     .0000276    .0000677
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 5 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.PP.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.PP.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3296
 number of covariate patterns =      3296
           Pearson chi2(3270) =      3646.41
                  Prob > chi2 =         0.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1541.0869  
Iteration 1:   log likelihood = -1029.5672  
Iteration 2:   log likelihood = -934.57463  
Iteration 3:   log likelihood = -926.11514  
Iteration 4:   log likelihood = -918.01167  
Iteration 5:   log likelihood = -911.98048  
Iteration 6:   log likelihood = -911.82815  
Iteration 7:   log likelihood = -911.82813  

Logistic regression                             Number of obs     =      3,296
                                                LR chi2(2)        =    1258.52
                                                Prob > chi2       =     0.0000
Log likelihood = -911.82813                     Pseudo R2         =     0.4083

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9399089   .0535668    17.55   0.000     .8349198    1.044898
      _hatsq |   .0647964   .0219741     2.95   0.003      .021728    .1078648
       _cons |  -.0992529   .0733107    -1.35   0.176    -.2429393    .0444335
------------------------------------------------------------------------------
Note: 0 failures and 132 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2600           316  |       2916
     -     |       111           269  |        380
-----------+--------------------------+-----------
   Total   |      2711           585  |       3296

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   95.91%
Specificity                     Pr( -|~D)   45.98%
Positive predictive value       Pr( D| +)   89.16%
Negative predictive value       Pr(~D| -)   70.79%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   54.02%
False - rate for true D         Pr( -| D)    4.09%
False + rate for classified +   Pr(~D| +)   10.84%
False - rate for classified -   Pr( D| -)   29.21%
--------------------------------------------------
Correctly classified                        87.04%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp3_yhat 
(option pr assumed; Pr(dv_indicator))
(51 missing values generated)

. gen bpp3_res = dv_indicator - bpp3_yhat
(51 missing values generated)

. 
. summ dv_indicator bpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
   bpp3_yhat |      6,202    .7707144    .2512609   .0034678          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp3_yhat
> 
> pause "next"
> 
> scatter bpp3_res dv_indicator
> 
> pause "next"
> 
> scatter bpp3_res bpp3_yhat
> */
. pause "complete: B.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.4
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: 7.state != 0 predicts success perfectly
      7.state dropped and 19 obs not used

note: 9.state != 0 predicts success perfectly
      9.state dropped and 9 obs not used

note: 17.state != 0 predicts success perfectly
      17.state dropped and 9 obs not used

Iteration 0:   log pseudolikelihood = -1048.2677  
Iteration 1:   log pseudolikelihood = -939.85632  
Iteration 2:   log pseudolikelihood = -913.79032  
Iteration 3:   log pseudolikelihood = -912.42158  
Iteration 4:   log pseudolikelihood = -912.41868  
Iteration 5:   log pseudolikelihood = -912.41868  

Logistic regression                             Number of obs     =      3,296
                                                Wald chi2(23)     =          .
Log pseudolikelihood = -912.41868               Prob > chi2       =          .

                                    (Std. Err. adjusted for 722 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_pp_c_lag_all |   1.000386   .0003401     1.14   0.256     .9997196    1.001053
 p75_pp_c_lag_all |   1.000004   2.07e-06     1.77   0.077     .9999996    1.000008
        mine_time |   1.008289   .0202265     0.41   0.681      .969415    1.048722
onsite_insp_hours |   1.002721   .0003945     6.91   0.000     1.001948    1.003494
                  |
            state |
               1  |   1.141202   .4550254     0.33   0.740     .5223571    2.493203
               2  |   1.011552   .1958434     0.06   0.953     .6921337    1.478382
               3  |   .7463893   .4221503    -0.52   0.605     .2463396    2.261499
               4  |   3.132287   3.790647     0.94   0.345      .292247    33.57167
               5  |   .8700868   .4201126    -0.29   0.773     .3377291    2.241592
               6  |   .4137605   .0799352    -4.57   0.000     .2833372     .604219
               7  |          1  (empty)
               8  |    .060699   .0145359   -11.70   0.000     .0379611    .0970562
               9  |          1  (empty)
              10  |   .4630886   .2079259    -1.71   0.086     .1920774    1.116483
              11  |   1.746928   1.475195     0.66   0.509     .3337931    9.142667
              12  |   .4955167    .130532    -2.67   0.008     .2956852    .8303992
              13  |   1.458013   1.716189     0.32   0.749     .1451557    14.64498
              14  |   .3973374   .1551028    -2.36   0.018     .1848793    .8539463
              15  |   .3746324   .0811488    -4.53   0.000     .2450346    .5727741
              17  |          1  (empty)
                  |
             time |
            2007  |    1.31079   .2484169     1.43   0.153     .9040993    1.900423
            2009  |   1.145063   .2498469     0.62   0.535     .7466237    1.756133
            2010  |    .858813   .1790892    -0.73   0.465     .5706852    1.292411
            2011  |   1.010667   .2223037     0.05   0.962     .6567197    1.555379
            2012  |   .6877502   .1422017    -1.81   0.070     .4585992    1.031403
            2013  |   .9865918   .2567617    -0.05   0.959     .5923948    1.643099
            2014  |   .6056661   .1516363    -2.00   0.045     .3707866    .9893331
            2015  |   .4477963   .1226318    -2.93   0.003     .2618024     .765927
                  |
            _cons |    .000049   .0000112   -43.55   0.000     .0000314    .0000766
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 18 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.PP.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Estout\Model.PS.Y.P.B.PP.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      3296
 number of covariate patterns =      3296
           Pearson chi2(3270) =      3388.36
                  Prob > chi2 =         0.0729

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -1541.0869  
Iteration 1:   log likelihood = -1030.9769  
Iteration 2:   log likelihood = -929.04986  
Iteration 3:   log likelihood = -921.03403  
Iteration 4:   log likelihood = -916.41973  
Iteration 5:   log likelihood = -908.73712  
Iteration 6:   log likelihood = -908.38752  
Iteration 7:   log likelihood = -908.38633  
Iteration 8:   log likelihood = -908.38633  

Logistic regression                             Number of obs     =      3,296
                                                LR chi2(2)        =    1265.40
                                                Prob > chi2       =     0.0000
Log likelihood = -908.38633                     Pseudo R2         =     0.4106

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9518256   .0542652    17.54   0.000     .8454678    1.058183
      _hatsq |   .0589283   .0221235     2.66   0.008      .015567    .1022896
       _cons |  -.0951129   .0735324    -1.29   0.196    -.2392339     .049008
------------------------------------------------------------------------------
Note: 0 failures and 194 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2602           314  |       2916
     -     |       109           271  |        380
-----------+--------------------------+-----------
   Total   |      2711           585  |       3296

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   95.98%
Specificity                     Pr( -|~D)   46.32%
Positive predictive value       Pr( D| +)   89.23%
Negative predictive value       Pr(~D| -)   71.32%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   53.68%
False - rate for true D         Pr( -| D)    4.02%
False + rate for classified +   Pr(~D| +)   10.77%
False - rate for classified -   Pr( D| -)   28.68%
--------------------------------------------------
Correctly classified                        87.17%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp4_yhat 
(option pr assumed; Pr(dv_indicator))
(51 missing values generated)

. gen bpp4_res = dv_indicator - bpp4_yhat
(51 missing values generated)

. 
. summ dv_indicator bpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .8322405    .3736824          0          1
   bpp4_yhat |      6,202    .7759853    .2489454   .0035722          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp4_yhat
> 
> pause "next"
> 
> scatter bpp4_res dv_indicator
> 
> pause "next"
> 
> scatter bpp4_res bpp4_yhat
> */
. pause "complete: B.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. log close
      name:  <unnamed>
       log:  C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Model Summaries 10-12\PS\Log Files\PS_log_part_year.txt
  log type:  text
 closed on:  12 Oct 2016, 17:16:54
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
