--------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\log_part_year.txt
  log type:  text
 opened on:   7 Oct 2016, 20:00:33

. * log using "C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\log_part_quarter.txt", text
. * log using "C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\log_subpart_year.txt", text
. * log using "C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\log_subpart_quarter.txt", text
. 
. local injury_type "MR"

. * local injury_type "PS"
. 
. local unit_of_analysis "year_sum"

. * local unit_of_analysis "year_avg"
. * local unit_of_analysis "quarter"
. 
. local violation_level "part"

. * local violation_level "subpart"
. 
. ********************************************************************************
. ********************************************************************************
. // DATA SET-UP
. 
. // read data 
. use "X:\Projects\Mining\NIOSH\analysis\data\5_prediction-ready\MR_prediction_data.dta", clear
(Written by R.              )

. 
. // format variables
. if "`injury_type'" == "MR" {
.         rename MR dv
.         rename MR_indicator dv_indicator
.         local injury_label "MR"
. }

. 
. if "`injury_type'" == "PS" {
.         rename PS dv
.         rename PS_indicator dv_indicator
.         local injury_label "PS"
. }

. 
. if "`violation_level'" == "part" {
.         local violation_level_label "P"
. }

. 
. if "`violation_level'" == "subpart" {
.         local violation_level_label "SP"
. }

. 
. * recast int p* sp* total_violations total_mine_act_violations num_good_faith num_no_terminations num_insp total_injuries dv dv_indicator
. 
. gen sample_pp = quarter >= 2007 // flag obs after or equal to 2007 to use in penlaty points analyses (assessments changed for the last time in 2007)

. 
. tostring quarter, replace
quarter was double now str7

. encode quarter, gen(quart)

. drop quarter

. rename quart time

. 
. local time_label "Q" // will be overwritten if unit_of_analysis is year_sum or year_avg

. 
. if "`unit_of_analysis'" == "year_sum" { // collapse to mine years - sums 
.         local time_label "Y"
.         
.         // count number of complete quarters per year
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
(22,385 real changes made)
.         gen marker = 1
.         bysort mineid year: egen num_quarts = sum(marker)
.                 /*tab num_quarts
>                          num_quarts |      Freq.     Percent        Cum.
>                         ------------+-----------------------------------
>                                           1 |      1,100        3.63        3.63
>                                           2 |      1,666        5.50        9.13
>                                           3 |      2,511        8.29       17.42
>                                           4 |     25,012       82.58      100.00
>                         ------------+-----------------------------------
>                                   Total |     30,289      100.00 - Sarah 9/21/2016 @ 10:54 PM */
.         drop if num_quarts < 4
(5,277 observations deleted)
.         
.         // collapse to the mine-year 
.         collapse (sum) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp, by(mineid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_sum collapse"
. }

. 
. if "`unit_of_analysis'" == "year_avg" { // collapse on mine years - averages
.         local time_label "Y"
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
.         pause "collapsing to mine-year"
.         collapse (mean) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp, by(mineid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_avg collapse"
. }

. 
. drop dv_indicator

. gen dv_binary = 0 if dv == 0
(3,455 missing values generated)

. replace dv_binary = 1 if dv != 0
(3,455 real changes made)

. rename dv_binary dv_indicator

.         
. gen lnhours = log(hours)

. 
. pause "complete: data formatting"

. 
. // group variables
. local covariates "mine_time onsite_insp_hours"

. 
. *** lag 0 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in 47 48 71 72 75 77 {
  2.                 foreach var of varlist p`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
p47 p48 p71 p72 p75 p77
. 
.         foreach var of varlist p*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
p47_ss p48_ss p71_ss p72_ss p75_ss p77_ss
. 
.         foreach var of varlist p*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
p47_pp p48_pp p71_pp p72_pp p75_pp p77_pp
.         
.         pause "complete: variable groups - part no lag"
. }

. 
. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
. 
.         foreach var of varlist sp*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
. 
.         foreach var of varlist sp*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
.         
.         pause "complete: variable groups - subpart no lag"
. }

. 
. 
. *** lag 1 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in 47 48 71 72 75 77 {
  2.                 foreach var of varlist p`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
p47_1lag p48_1lag p71_1lag p72_1lag p75_1lag p77_1lag
. 
.         foreach var of varlist p*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
p47_ss_1lag p48_ss_1lag p71_ss_1lag p72_ss_1lag p75_ss_1lag p77_ss_1lag
. 
.         foreach var of varlist p*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
p47_pp_1lag p48_pp_1lag p71_pp_1lag p72_pp_1lag p75_pp_1lag p77_pp_1lag
.         
.         pause "complete: variable groups - part lag 1"
. }

. 
. 
. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
. 
.         foreach var of varlist sp*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
. 
. 
.         foreach var of varlist sp*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
. 
.         pause "complete: variable groups - subpart lag 1"
. } 

. 
. *** lag 4 ***
. if "`violation_level'" == "part" {
.         
.         foreach x in 47 48 71 72 75 77 {
  2.                 foreach var of varlist p`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
p47_c_4lag p48_c_4lag p71_c_4lag p72_c_4lag p75_c_4lag p77_c_4lag
. 
.         foreach var of varlist p*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
p47_ss_c_4lag p48_ss_c_4lag p71_ss_c_4lag p72_ss_c_4lag p75_ss_c_4lag p77_ss_c_4lag
. 
.         foreach var of varlist p*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
p47_pp_c_4lag p48_pp_c_4lag p71_pp_c_4lag p72_pp_c_4lag p75_pp_c_4lag p77_pp_c_4lag
. 
.         pause "complete: variable groups - part lag 4"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
. 
.         foreach var of varlist sp*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
. 
.         foreach var of varlist sp*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
. 
.         pause "complete: variable groups - subpart lag 4"
. }

. 
. *** lag all ***
. if "`violation_level'" == "part" {
. 
.         foreach x in 47 48 71 72 75 77 {
  2.                 foreach var of varlist p`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
p47_c_lag_all p48_c_lag_all p71_c_lag_all p72_c_lag_all p75_c_lag_all p77_c_lag_all
. 
.         foreach var of varlist p*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
p47_ss_c_lag_all p48_ss_c_lag_all p71_ss_c_lag_all p72_ss_c_lag_all p75_ss_c_lag_all p77_ss_c_lag_all
. 
.         foreach var of varlist p*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
p47_pp_c_lag_all p48_pp_c_lag_all p71_pp_c_lag_all p72_pp_c_lag_all p75_pp_c_lag_all p77_pp_c_lag_all
. 
.         pause "complete: variable groups - part lag all"
. }

. 
. *** subpart lag all ***
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
.         
.         foreach var of varlist sp*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
.         
.         foreach var of varlist sp*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
. 
.         pause "complete: variable groups - subpart lag all"
. }

. 
. ********************************************************************************
. *******************************************************************************
. // DATA OVERVIEW
. 
. // outcome variables
. summ dv

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37

. 
. pause "next"

. 
. tab dv_indicator

dv_indicato |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,798       44.75       44.75
          1 |      3,455       55.25      100.00
------------+-----------------------------------
      Total |      6,253      100.00

.           
. pause "next"

. 
. if "`violation_level'" == "part" {
.         summ `count_vars' `ss_vars' `pp_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         p47 |      6,253    .0308652    .2208875          0          4
         p48 |      6,253     .318727    1.248145          0         69
         p71 |      6,253    .0316648    .2084777          0          6
         p72 |      6,253    .0686071    .3349849          0          5
         p75 |      6,253    61.19367    74.81325          0        841
-------------+---------------------------------------------------------
         p77 |      6,253    1.407005    2.738063          0         45
      p47_ss |      6,253    .0043179    .0768079          0          3
      p48_ss |      6,253    .0702063    .3739304          0          7
      p71_ss |      6,253    .0059172     .078759          0          2
      p72_ss |      6,253     .006237    .0846096          0          2
-------------+---------------------------------------------------------
      p75_ss |      6,253    16.74796    22.09002          0        252
      p77_ss |      6,253    .2246921    .6935527          0         15
      p47_pp |      6,253    1.627379    13.44875          0        293
      p48_pp |      6,253    13.45146    66.03334          0       3787
      p71_pp |      6,253    1.474172    11.90392          0        422
-------------+---------------------------------------------------------
      p72_pp |      6,253    2.984967    16.88058          0        285
      p75_pp |      6,253    3162.992    5262.654          0      60818
      p77_pp |      6,253    55.24308    137.2511          0       2195
.         
.         pause "next"
.         
.         summ `count_lag_1_vars' `ss_lag_1_vars' `pp_lag_1_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    p47_1lag |      6,253    .0319846    .2323773          0          5
    p48_1lag |      6,253    .3144091    1.259505          0         69
    p71_1lag |      6,253     .029266    .1908178          0          4
    p72_1lag |      6,253    .0671678    .3321611          0          5
    p75_1lag |      6,253    59.77707    74.55003          0        926
-------------+---------------------------------------------------------
    p77_1lag |      6,253    1.399488    2.762226          0         54
 p47_ss_1lag |      6,253    .0043179    .0788629          0          3
 p48_ss_1lag |      6,253    .0705261    .3831667          0          9
 p71_ss_1lag |      6,253    .0055973    .0767253          0          2
 p72_ss_1lag |      6,253     .006237    .0864794          0          2
-------------+---------------------------------------------------------
 p75_ss_1lag |      6,253    16.35983    21.88199          0        226
 p77_ss_1lag |      6,253    .2256517    .6950844          0         12
 p47_pp_1lag |      6,253    1.659683     14.1797          0        362
 p48_pp_1lag |      6,253    13.25172    66.63073          0       3787
 p71_pp_1lag |      6,253    1.321925    10.28432          0        302
-------------+---------------------------------------------------------
 p72_pp_1lag |      6,253    2.910123    16.75465          0        285
 p75_pp_1lag |      6,253    3075.187    5239.899          0      71114
 p77_pp_1lag |      6,253    54.73533    139.7695          0       3198
.         
.         pause "next"
.         
.         summ `count_lag_4_vars' `ss_lag_4_vars' `pp_lag_4_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  p47_c_4lag |      6,253     .116744    .7325248          0         17
  p48_c_4lag |      6,253    1.159923    3.899655          0        143
  p71_c_4lag |      6,253    .1066688    .6051934          0          8
  p72_c_4lag |      6,253     .260355     1.15941          0         22
  p75_c_4lag |      6,253    224.6303    295.5619          0       3645
-------------+---------------------------------------------------------
  p77_c_4lag |      6,253    5.116584    9.941045          0        170
p47_ss_c_4~g |      6,253    .0158324    .2330061          0          9
p48_ss_c_4~g |      6,253    .2534783    1.196286          0         30
p71_ss_c_4~g |      6,253    .0212698    .2465926          0          6
p72_ss_c_4~g |      6,253    .0243083    .2923379          0          7
-------------+---------------------------------------------------------
p75_ss_c_4~g |      6,253    60.97217    84.82983          0        941
p77_ss_c_4~g |      6,253    .7925796    2.268451          0         38
p47_pp_c_4~g |      6,253    6.123781    45.19252          0       1226
p48_pp_c_4~g |      6,253    49.52407    207.2291          0       7851
p71_pp_c_4~g |      6,253     4.93795    33.17018          0        604
-------------+---------------------------------------------------------
p72_pp_c_4~g |      6,253    11.43739    58.23657          0       1098
p75_pp_c_4~g |      6,253    11787.54     20580.5          0     280327
p77_pp_c_4~g |      6,253    204.1308    507.4484          0      10036
.         
.         pause "next"
.         
.         summ `count_lag_all_vars' `ss_lag_all_vars' `pp_lag_all_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
p47_c_lag_~l |      6,253    .3617464    1.865509          0         36
p48_c_lag_~l |      6,253    4.830641    13.17843          0        288
p71_c_lag_~l |      6,253    .4850472    2.111869          0         36
p72_c_lag_~l |      6,253     .966736    3.909793          0         72
p75_c_lag_~l |      6,253    990.6915    2288.909          0      27670
-------------+---------------------------------------------------------
p77_c_lag_~l |      6,253    26.25172    70.72726          0        858
p47_ss_c_l~l |      6,253    .0449384    .4457757          0          8
p48_ss_c_l~l |      6,253    1.384296    4.759533          0         52
p71_ss_c_l~l |      6,253    .1050696    .6451216          0          8
p72_ss_c_l~l |      6,253    .1237806     1.08147          0         20
-------------+---------------------------------------------------------
p75_ss_c_l~l |      6,253    282.7846    639.4148          0       7503
p77_ss_c_l~l |      6,253    4.085879     10.9226          0        104
p47_pp_c_l~l |      6,253    14.92803    89.47016          0       1640
p48_pp_c_l~l |      6,253    170.4297    577.2885          0      15716
p71_pp_c_l~l |      6,253    18.09899    93.01788          0       1713
-------------+---------------------------------------------------------
p72_pp_c_l~l |      6,253    37.30273    182.9094          0       3984
p75_pp_c_l~l |      6,253    40611.28    109100.8          0    1515903
p77_pp_c_l~l |      6,253    760.4978    2434.551          0      33461
. }

. 
. pause "complete: data overview"

. 
. *******************************************************************************/
. /*******************************************************************************
> // MODEL LABEL KEY
> 
> Model X.Y.Z
>   X
>     C: response variable is count of injuries
>     B: response variable is binary of injuries
>   Y
>     V: predictors are number of violations
>     SSV: predictors are number of significant and substantial violations
>     PP: predictors are number of penalty points
>   Z
>     1: inj_t ~ viol_t
>     2: inj_t ~ viol_(t_-1)
>     3: inj_t ~ viol_(annual sum pre_t)
>     4: inj_t ~ viol_(sum since study period) 
> 
> *******************************************************************************/
. ********************************************************************************
. // NULL MODELS
. 
. // count outcome 
. glm dv, family(poisson) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -10403.696  
Iteration 1:   log pseudolikelihood = -9571.6889  
Iteration 2:   log pseudolikelihood = -9569.6224  
Iteration 3:   log pseudolikelihood = -9569.6223  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,252
                                                  Scale parameter =          1
Deviance         =  9564.378845                   (1/df) Deviance =   1.529811
Pearson          =  11313.67441                   (1/df) Pearson  =   1.809609

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =    3.06113
Log pseudolikelihood = -9569.622269               BIC             =  -45083.21

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000103   3.13e-07  -377.89   0.000     9.69e-06    .0000109
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

.         
. pause "next"    

.         
. quietly poisson dv, vce(cl mineid) exposure(hours) irr

. estat gof

         Deviance goodness-of-fit =  9564.379
         Prob > chi2(6252)        =    0.0000

         Pearson goodness-of-fit  =  11313.67
         Prob > chi2(6252)        =    0.0000

. 
. pause "next"

.         
. glm dv, family(nbinomial) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -9289.8451  
Iteration 1:   log pseudolikelihood = -9243.3399  
Iteration 2:   log pseudolikelihood =   -9243.32  
Iteration 3:   log pseudolikelihood =   -9243.32  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,252
                                                  Scale parameter =          1
Deviance         =  4172.877676                   (1/df) Deviance =   .6674468
Pearson          =  4767.148604                   (1/df) Pearson  =   .7624998

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.956763
Log pseudolikelihood = -9243.320013               BIC             =  -50474.71

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |    .000011   2.41e-07  -521.67   0.000     .0000105    .0000115
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. nbreg dv, vce(cl mineid) exposure(hours) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -9569.6223  
Iteration 1:   log pseudolikelihood = -9569.6223  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8961.9317  
Iteration 1:   log pseudolikelihood = -8961.9317  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(0)      =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8961.9317               Pseudo R2         =     0.0000

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000108   2.45e-07  -505.30   0.000     .0000103    .0000113
   ln(hours) |          1  (exposure)
-------------+----------------------------------------------------------------
    /lnalpha |  -1.115699   .0832504                     -1.278867   -.9525312
-------------+----------------------------------------------------------------
       alpha |   .3276861     .02728                      .2783525    .3857633
------------------------------------------------------------------------------

. 
. pause "next"

. 
. predict c_null_yhat 
(option n assumed; predicted number of events)

. summ dv_indicator c_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
 c_null_yhat |      6,253    1.975549    2.934928   .0006916   30.43051

. 
. pause "complete: null model - count outcome"

. 
. // binary outcome
. logit dv_indicator, vce(cl mineid) offset(lnhours) or

Iteration 0:   log pseudolikelihood = -3081.8508  
Iteration 1:   log pseudolikelihood = -3080.7305  
Iteration 2:   log pseudolikelihood = -3080.7304  

Logistic regression                             Number of obs     =      6,253
                                                Wald chi2(0)      =          .
Log pseudolikelihood = -3080.7304               Prob > chi2       =          .

                             (Std. Err. adjusted for 1,238 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000159   5.74e-07  -305.50   0.000     .0000148     .000017
     lnhours |          1  (offset)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6253
 number of covariate patterns =         1
              Pearson chi2(0) =         0.00
                  Prob > chi2 =              .

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4299.6702  
Iteration 1:   log likelihood = -3040.0027  
Iteration 2:   log likelihood = -3016.2028  
Iteration 3:   log likelihood = -3016.1433  
Iteration 4:   log likelihood = -3016.1433  

Logistic regression                             Number of obs     =      6,253
                                                LR chi2(2)        =    2567.05
                                                Prob > chi2       =     0.0000
Log likelihood = -3016.1433                     Pseudo R2         =     0.2985

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.373769   .0377239    36.42   0.000     1.299831    1.447707
      _hatsq |   .0540479   .0259748     2.08   0.037     .0031383    .1049575
       _cons |   -.105095   .0369067    -2.85   0.004    -.1774307   -.0327593
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2854           875  |       3729
     -     |       601          1923  |       2524
-----------+--------------------------+-----------
   Total   |      3455          2798  |       6253

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   82.60%
Specificity                     Pr( -|~D)   68.73%
Positive predictive value       Pr( D| +)   76.54%
Negative predictive value       Pr(~D| -)   76.19%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   31.27%
False - rate for true D         Pr( -| D)   17.40%
False + rate for classified +   Pr(~D| +)   23.46%
False - rate for classified -   Pr( D| -)   23.81%
--------------------------------------------------
Correctly classified                        76.40%
--------------------------------------------------

. 
. pause "next"

. 
. predict b_null_yhat 
(option pr assumed; Pr(dv_indicator))

. summ dv_indicator b_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
 b_null_yhat |      6,253    .5525348    .2479745   .0010138   .9780964

. 
. pause "complete: null model - binary outcome"

. 
. ********************************************************************************
. ********************************************************************************
. 
. if "`violation_level'" == "subpart" {
.         set matsize 11000, perm
.         set emptycells drop
. }

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.1
. 
. // poisson model
. glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9590.1394  
Iteration 1:   log pseudolikelihood = -8982.2458  
Iteration 2:   log pseudolikelihood = -8978.9546  
Iteration 3:   log pseudolikelihood = -8978.9523  
Iteration 4:   log pseudolikelihood = -8978.9523  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8383.038966                   (1/df) Deviance =   1.348406
Pearson          =  9302.785863                   (1/df) Pearson  =   1.496346

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.883401
Log pseudolikelihood =  -8978.95233               BIC             =  -45958.62

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p47 |   1.015518   .0860421     0.18   0.856      .860137    1.198968
              p48 |   1.004999   .0068031     0.74   0.461     .9917527    1.018421
              p71 |   .9597593   .0413261    -0.95   0.340     .8820852    1.044273
              p72 |   1.017976   .0229381     0.79   0.429     .9739963    1.063941
              p75 |    1.00098   .0003041     3.22   0.001     1.000384    1.001576
              p77 |   .9917831   .0047815    -1.71   0.087     .9824556    1.001199
        mine_time |   .9938556   .0091627    -0.67   0.504     .9760583    1.011977
onsite_insp_hours |   .9998642   .0000595    -2.28   0.023     .9997476    .9999809
                  |
            state |
               1  |   1.137033     .09215     1.58   0.113     .9700361    1.332778
               2  |   2.192973   .1455271    11.83   0.000     1.925515    2.497581
               3  |   .7528386   .1248972    -1.71   0.087     .5438587     1.04212
               4  |   1.204309   .1157855     1.93   0.053      .997473    1.454035
               5  |   .9654494   .1520919    -0.22   0.823     .7089827     1.31469
               6  |   1.063789   .0630742     1.04   0.297      .947079    1.194882
               7  |   1.036585   .2335839     0.16   0.873     .6664923    1.612184
               8  |   .9573115   .0485446    -0.86   0.390     .8667412    1.057346
               9  |   .8188575   .0431743    -3.79   0.000     .7384629    .9080045
              10  |   1.211465   .1584954     1.47   0.143     .9374509    1.565572
              11  |   .9280119   .2442357    -0.28   0.777     .5540296    1.554441
              12  |   .9895685   .1039975    -0.10   0.921     .8053597    1.215911
              13  |      1.388   .2038765     2.23   0.026     1.040784    1.851051
              14  |   .6569845   .0832117    -3.32   0.001     .5125597    .8421041
              15  |   .7073526   .0625328    -3.92   0.000     .5948211    .8411735
              17  |   1.127784   .0537317     2.52   0.012      1.02724     1.23817
                  |
             time |
            2000  |    1.11413    .067393     1.79   0.074     .9895718    1.254367
            2002  |   1.010701   .0568165     0.19   0.850     .9052586    1.128426
            2003  |   .8923118    .052861    -1.92   0.054     .7944947    1.002172
            2004  |   .9096387   .0581402    -1.48   0.138     .8025346    1.031037
            2005  |   .8047644   .0484818    -3.61   0.000     .7151373    .9056242
            2006  |   .7614515   .0551743    -3.76   0.000     .6606398    .8776467
            2007  |   .7232703   .0538898    -4.35   0.000     .6249984    .8369941
            2008  |    .675973    .051237    -5.17   0.000     .5826536    .7842387
            2009  |   .6017778   .0474468    -6.44   0.000     .5156128     .702342
            2010  |   .5865548   .0506067    -6.18   0.000     .4953004    .6946219
            2011  |    .619056   .0531853    -5.58   0.000     .5231187    .7325877
            2012  |   .6450183   .0552197    -5.12   0.000     .5453823    .7628568
            2013  |   .5966304   .0626532    -4.92   0.000     .4856453     .732979
            2014  |   .5856213    .059835    -5.24   0.000     .4793431     .715463
            2015  |   .6024351   .0699432    -4.36   0.000     .4798274    .7563721
                  |
            _cons |   .0000153   9.13e-07  -185.78   0.000     .0000136    .0000172
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8383.039
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9302.786
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9217.2932  
Iteration 1:   log pseudolikelihood = -9089.5869  
Iteration 2:   log pseudolikelihood = -9088.4986  
Iteration 3:   log pseudolikelihood = -9088.4985  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3863.234604                   (1/df) Deviance =   .6213985
Pearson          =  4145.181605                   (1/df) Pearson  =   .6667495

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.918439
Log pseudolikelihood = -9088.498476               BIC             =  -50478.42

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p47 |   1.070506   .0746736     0.98   0.329     .9337128    1.227341
              p48 |   1.002957   .0067489     0.44   0.661     .9898162    1.016272
              p71 |   1.030051   .0514824     0.59   0.554     .9339321    1.136062
              p72 |    .994694    .028379    -0.19   0.852     .9405987      1.0519
              p75 |   1.001554   .0003471     4.48   0.000     1.000874    1.002234
              p77 |   .9943497   .0065416    -0.86   0.389     .9816108    1.007254
        mine_time |   .9958951   .0070064    -0.58   0.559      .982257    1.009722
onsite_insp_hours |   .9998322   .0000551    -3.04   0.002     .9997242    .9999403
                  |
            state |
               1  |   1.044072   .1144951     0.39   0.694     .8421436     1.29442
               2  |   1.703567   .0915397     9.91   0.000     1.533277     1.89277
               3  |   .7130043   .1171088    -2.06   0.039     .5167552    .9837833
               4  |   1.056558   .0841778     0.69   0.490     .9038091    1.235123
               5  |    .878363   .1497966    -0.76   0.447     .6287957    1.226983
               6  |   .8936255   .0443639    -2.27   0.023     .8107702     .984948
               7  |   .9164016   .2109587    -0.38   0.705     .5836284    1.438915
               8  |   1.132402   .0513059     2.74   0.006      1.03618     1.23756
               9  |    .734372   .0349821    -6.48   0.000     .6689118    .8062383
              10  |    .829407   .1361621    -1.14   0.255      .601212    1.144215
              11  |    .886961   .2401238    -0.44   0.658     .5217491    1.507812
              12  |   1.002238   .0889675     0.03   0.980      .842191    1.192699
              13  |   1.359598   .2168829     1.93   0.054     .9945512    1.858635
              14  |   .6348954   .0891215    -3.24   0.001      .482189    .8359629
              15  |   .6667031   .0441046    -6.13   0.000     .5856292    .7590008
              17  |   1.063042   .0508639     1.28   0.201     .9678828    1.167558
                  |
             time |
            2000  |   1.061592   .0710792     0.89   0.372     .9310329    1.210459
            2002  |   .9466648   .0645652    -0.80   0.422     .8282127    1.082058
            2003  |   .8784982   .0672496    -1.69   0.091     .7561029    1.020706
            2004  |   .8427773   .0608743    -2.37   0.018     .7315264    .9709473
            2005  |   .7447373   .0531306    -4.13   0.000     .6475559    .8565031
            2006  |   .7512756   .0576978    -3.72   0.000     .6462896    .8733159
            2007  |   .6928496   .0539727    -4.71   0.000      .594745    .8071368
            2008  |   .6196065   .0469663    -6.31   0.000     .5340656    .7188483
            2009  |   .5087847   .0424667    -8.10   0.000      .432003     .599213
            2010  |   .5516175   .0473151    -6.94   0.000     .4662578    .6526043
            2011  |   .5882527   .0495441    -6.30   0.000     .4987394    .6938317
            2012  |   .6014319   .0530789    -5.76   0.000     .5058995    .7150043
            2013  |    .500675   .0479413    -7.22   0.000     .4150023     .604034
            2014  |   .4783004    .047355    -7.45   0.000     .3939362    .5807317
            2015  |   .5226621   .0537492    -6.31   0.000     .4272534    .6393761
                  |
            _cons |   .0000175   1.14e-06  -167.91   0.000     .0000154    .0000199
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -10475.246  
Iteration 1:   log pseudolikelihood = -9037.1315  
Iteration 2:   log pseudolikelihood = -8985.8273  
Iteration 3:   log pseudolikelihood = -8979.1601  
Iteration 4:   log pseudolikelihood = -8978.9531  
Iteration 5:   log pseudolikelihood = -8978.9523  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8709.9609  
Iteration 1:   log pseudolikelihood = -8671.7344  
Iteration 2:   log pseudolikelihood = -8670.8904  
Iteration 3:   log pseudolikelihood =   -8670.89  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood =   -8670.89               Pseudo R2         =     0.0325

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p47 |    1.06017   .0812938     0.76   0.446     .9122321    1.232099
              p48 |   1.001989   .0058728     0.34   0.735     .9905442    1.013566
              p71 |   .9872219   .0399793    -0.32   0.751     .9118929    1.068774
              p72 |   .9986013   .0244103    -0.06   0.954      .951886    1.047609
              p75 |   1.001276   .0003212     3.98   0.000     1.000647    1.001906
              p77 |   .9917223   .0058438    -1.41   0.158     .9803347    1.003242
        mine_time |    .994445   .0074469    -0.74   0.457     .9799559    1.009148
onsite_insp_hours |    .999847   .0000564    -2.71   0.007     .9997364    .9999577
                  |
            state |
               1  |   1.081172   .1036286     0.81   0.415      .896001    1.304611
               2  |   1.951623   .1100393    11.86   0.000      1.74744    2.179664
               3  |   .7278786   .1212045    -1.91   0.056     .5251931    1.008786
               4  |   1.092261   .0887164     1.09   0.277     .9315143    1.280747
               5  |   .9136861   .1503282    -0.55   0.583     .6618345    1.261376
               6  |   .9517941   .0490441    -0.96   0.338      .860364     1.05294
               7  |   .9684833   .2210265    -0.14   0.888     .6192009    1.514791
               8  |   1.016575   .0495447     0.34   0.736     .9239627     1.11847
               9  |    .769042   .0356064    -5.67   0.000     .7023274    .8420937
              10  |   .9737306   .1441902    -0.18   0.857     .7284383    1.301622
              11  |   .8841978   .2235723    -0.49   0.626     .5386669    1.451371
              12  |   .9952768    .089897    -0.05   0.958     .8337969     1.18803
              13  |   1.338391   .1999151     1.95   0.051     .9987093    1.793604
              14  |   .6315754   .0836044    -3.47   0.001     .4872456    .8186579
              15  |   .6830693   .0486332    -5.35   0.000     .5941017    .7853598
              17  |   1.088733   .0498782     1.86   0.063     .9952337    1.191015
                  |
             time |
            2000  |   1.095695   .0664125     1.51   0.132     .9729629    1.233908
            2002  |   .9906587   .0603638    -0.15   0.878     .8791395    1.116324
            2003  |   .8823454   .0572011    -1.93   0.054     .7770636    1.001892
            2004  |   .8891815   .0585862    -1.78   0.075     .7814597    1.011752
            2005  |   .7831478   .0501371    -3.82   0.000      .690796    .8878461
            2006  |   .7725473   .0548231    -3.64   0.000     .6722337      .88783
            2007  |   .7177253   .0524737    -4.54   0.000     .6219078    .8283054
            2008  |   .6527861   .0466654    -5.97   0.000      .567442     .750966
            2009  |   .5604972   .0436175    -7.44   0.000     .4812087    .6528499
            2010  |   .5687677   .0457494    -7.02   0.000     .4858114    .6658895
            2011  |   .6074903   .0487814    -6.21   0.000     .5190247    .7110346
            2012  |   .6222891   .0511261    -5.77   0.000     .5297354    .7310135
            2013  |   .5445447   .0511632    -6.47   0.000     .4529581    .6546498
            2014  |   .5265326   .0500974    -6.74   0.000     .4369553    .6344736
            2015  |    .558682   .0569247    -5.71   0.000     .4575461     .682173
                  |
            _cons |   .0000166   1.00e-06  -181.79   0.000     .0000147    .0000187
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |   -1.52352   .0974815                      -1.71458    -1.33246
------------------+----------------------------------------------------------------
            alpha |   .2179433   .0212454                      .1800392    .2638274
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.V.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.V.1.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    616.12
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8978.952      36     18029.9   18272.57
        nbin |      6,253 -8961.932   -8670.89      37    17415.78   17665.19
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv1_yhat 
(option n assumed; predicted number of events)

. gen cv1_res = dv - cv1_yhat

. 
. summ dv cv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
    cv1_yhat |      6,253    1.927074    2.931497   .0006347   31.89323

. /*
> pause "next"
> 
> scatter dv cv1_yhat
> 
> pause "next"
> 
> scatter cv1_res dv
> 
> pause "next"
> 
> scatter cv1_res cv1_yhat
> */
. pause "complete: C.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.2
. 
. // poisson model
. glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9587.6576  
Iteration 1:   log pseudolikelihood =   -8982.58  
Iteration 2:   log pseudolikelihood =  -8979.296  
Iteration 3:   log pseudolikelihood = -8979.2938  
Iteration 4:   log pseudolikelihood = -8979.2938  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8383.721891                   (1/df) Deviance =   1.348516
Pearson          =  9309.215058                   (1/df) Pearson  =   1.497381

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =    2.88351
Log pseudolikelihood = -8979.293792               BIC             =  -45957.94

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p47_1lag |   .9926931   .0693224    -0.11   0.916     .8657119      1.1383
         p48_1lag |   1.005415   .0066868     0.81   0.417     .9923941    1.018607
         p71_1lag |   .8961258   .0486018    -2.02   0.043     .8057562    .9966307
         p72_1lag |   1.018959   .0230352     0.83   0.406     .9747967    1.065123
         p75_1lag |    1.00093   .0003015     3.09   0.002     1.000339    1.001521
         p77_1lag |   .9926136   .0047029    -1.56   0.118     .9834386    1.001874
        mine_time |   .9932905   .0089883    -0.74   0.457     .9758291    1.011064
onsite_insp_hours |   .9998719    .000058    -2.21   0.027     .9997582    .9999857
                  |
            state |
               1  |   1.133985   .0894438     1.59   0.111     .9715566    1.323568
               2  |    2.20435   .1448416    12.03   0.000     1.937985    2.507325
               3  |   .7480907   .1237728    -1.75   0.079     .5409057    1.034634
               4  |   1.202522    .116992     1.90   0.058     .9937581    1.455143
               5  |   .9607748   .1509321    -0.25   0.799     .7061596    1.307195
               6  |   1.059555   .0623335     0.98   0.325     .9441641    1.189049
               7  |   1.033857   .2313466     0.15   0.882     .6667867    1.603003
               8  |   .9453427   .0472301    -1.13   0.261     .8571613    1.042596
               9  |   .8327222    .044546    -3.42   0.001     .7498347    .9247721
              10  |   1.223415    .169955     1.45   0.147     .9318072    1.606281
              11  |   .9243449   .2415093    -0.30   0.763     .5539051    1.542527
              12  |   .9854176    .103082    -0.14   0.888     .8027462    1.209657
              13  |   1.380228   .2033553     2.19   0.029     1.034045    1.842308
              14  |   .6528071   .0834292    -3.34   0.001     .5081603    .8386272
              15  |   .7018598    .063074    -3.94   0.000     .5885122    .8370382
              17  |    1.12953   .0545554     2.52   0.012     1.027509    1.241681
                  |
             time |
            2000  |    1.13229   .0683583     2.06   0.040     1.005933    1.274518
            2002  |   1.012885   .0567596     0.23   0.819     .9075295    1.130471
            2003  |   .8929416   .0532966    -1.90   0.058     .7943607    1.003756
            2004  |   .9231304   .0592576    -1.25   0.213     .8139968    1.046896
            2005  |   .8057662   .0486018    -3.58   0.000     .7159236    .9068832
            2006  |   .7682108   .0555618    -3.65   0.000     .6666782    .8852065
            2007  |    .734855   .0538735    -4.20   0.000     .6365003    .8484079
            2008  |   .6733438   .0529266    -5.03   0.000     .5772051    .7854954
            2009  |   .6024756    .047485    -6.43   0.000      .516239    .7031179
            2010  |   .5903765   .0513844    -6.05   0.000     .4977868    .7001881
            2011  |   .6217477   .0531409    -5.56   0.000     .5258499    .7351342
            2012  |   .6424132   .0550929    -5.16   0.000     .5430203    .7599987
            2013  |   .5958131   .0618197    -4.99   0.000     .4861744    .7301767
            2014  |   .5871182   .0602774    -5.19   0.000     .4801044    .7179851
            2015  |   .6038425    .071766    -4.24   0.000     .4783649    .7622334
                  |
            _cons |   .0000153   9.24e-07  -184.05   0.000     .0000136    .0000173
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8383.722
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9309.215
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9218.4876  
Iteration 1:   log pseudolikelihood = -9090.9783  
Iteration 2:   log pseudolikelihood = -9089.8912  
Iteration 3:   log pseudolikelihood = -9089.8911  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3866.019843                   (1/df) Deviance =   .6218465
Pearson          =  4150.604613                   (1/df) Pearson  =   .6676218

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.918884
Log pseudolikelihood = -9089.891096               BIC             =  -50475.64

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p47_1lag |    1.05835   .0738971     0.81   0.417     .9229877    1.213564
         p48_1lag |   1.002731   .0063735     0.43   0.668     .9903171    1.015301
         p71_1lag |   .9876591   .0551774    -0.22   0.824     .8852239    1.101948
         p72_1lag |   1.002223   .0312097     0.07   0.943     .9428823    1.065298
         p75_1lag |   1.001447   .0003354     4.32   0.000      1.00079    1.002105
         p77_1lag |   .9956335   .0058099    -0.75   0.453     .9843111    1.007086
        mine_time |    .995146   .0069707    -0.69   0.487      .981577    1.008903
onsite_insp_hours |   .9998448   .0000535    -2.90   0.004       .99974    .9999497
                  |
            state |
               1  |   1.041271   .1130082     0.37   0.709     .8417511    1.288083
               2  |   1.712214   .0914206    10.07   0.000      1.54209    1.901106
               3  |   .7091834   .1170794    -2.08   0.037     .5131369    .9801304
               4  |   1.057074    .082454     0.71   0.477     .9072143    1.231689
               5  |   .8785392   .1496386    -0.76   0.447     .6291858    1.226714
               6  |   .8921109   .0442441    -2.30   0.021     .8094754    .9831823
               7  |   .9150907    .210523    -0.39   0.700     .5829608    1.436445
               8  |   1.120257   .0483319     2.63   0.008     1.029423    1.219107
               9  |   .7408173   .0369255    -6.02   0.000     .6718674    .8168432
              10  |   .8338213   .1390782    -1.09   0.276     .6013064    1.156246
              11  |   .8850542   .2377013    -0.45   0.649       .52283    1.498233
              12  |   .9962165   .0884297    -0.04   0.966     .8371366    1.185526
              13  |   1.354489   .2162581     1.90   0.057     .9905411     1.85216
              14  |   .6291917   .0890112    -3.28   0.001     .4768308    .8302363
              15  |   .6634217   .0440081    -6.19   0.000     .5825394    .7555342
              17  |   1.057928   .0515859     1.15   0.248     .9615025    1.164023
                  |
             time |
            2000  |   1.076255   .0723467     1.09   0.274     .9434022    1.227817
            2002  |   .9412777   .0639302    -0.89   0.373     .8239586    1.075301
            2003  |   .8756727   .0669506    -1.74   0.082     .7538105    1.017235
            2004  |   .8446239   .0609247    -2.34   0.019     .7332705    .9728872
            2005  |   .7446648   .0531115    -4.13   0.000     .6475166    .8563885
            2006  |   .7535902   .0580088    -3.68   0.000     .6480561    .8763101
            2007  |   .6998007   .0543412    -4.60   0.000     .6010028    .8148398
            2008  |   .6219946    .047146    -6.26   0.000     .5361265    .7216158
            2009  |   .5067676   .0423352    -8.14   0.000      .430229    .5969225
            2010  |    .552239   .0474951    -6.90   0.000     .4665731    .6536336
            2011  |   .5867161   .0495728    -6.31   0.000     .4971739     .692385
            2012  |   .5986325   .0527971    -5.82   0.000     .5036022    .7115951
            2013  |   .4958504   .0473923    -7.34   0.000     .4111447    .5980075
            2014  |   .4790865   .0473445    -7.45   0.000     .3947265    .5814759
            2015  |   .5178233   .0536462    -6.35   0.000     .4226663    .6344036
                  |
            _cons |   .0000176   1.15e-06  -168.01   0.000     .0000155      .00002
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -10145.943  
Iteration 1:   log pseudolikelihood = -9001.3178  
Iteration 2:   log pseudolikelihood = -8979.9182  
Iteration 3:   log pseudolikelihood = -8979.2967  
Iteration 4:   log pseudolikelihood = -8979.2938  
Iteration 5:   log pseudolikelihood = -8979.2938  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood =  -8711.796  
Iteration 1:   log pseudolikelihood = -8673.8938  
Iteration 2:   log pseudolikelihood = -8673.0557  
Iteration 3:   log pseudolikelihood = -8673.0553  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8673.0553               Pseudo R2         =     0.0322

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p47_1lag |   1.035142   .0739628     0.48   0.629     .8998701    1.190748
         p48_1lag |   1.002438   .0057336     0.43   0.670     .9912627    1.013738
         p71_1lag |   .9356865   .0455838    -1.36   0.172     .8504767    1.029433
         p72_1lag |   1.005238   .0261456     0.20   0.841     .9552774    1.057811
         p75_1lag |   1.001196   .0003163     3.78   0.000     1.000576    1.001816
         p77_1lag |   .9932847      .0055    -1.22   0.224     .9825632    1.004123
        mine_time |   .9938042   .0073697    -0.84   0.402     .9794643    1.008354
onsite_insp_hours |   .9998557   .0000552    -2.61   0.009     .9997475    .9999639
                  |
            state |
               1  |   1.078208   .1017266     0.80   0.425     .8961769    1.297214
               2  |    1.95879   .1107383    11.89   0.000     1.753339    2.188314
               3  |   .7226224   .1214806    -1.93   0.053     .5197749    1.004633
               4  |   1.092105    .087428     1.10   0.271     .9335161    1.277636
               5  |   .9123111   .1500024    -0.56   0.577     .6609797    1.259209
               6  |   .9499877    .048903    -1.00   0.319     .8588162    1.050838
               7  |    .965536   .2196111    -0.15   0.877     .6182481    1.507906
               8  |   1.001007   .0471704     0.02   0.983     .9126956    1.097863
               9  |   .7793701   .0381155    -5.10   0.000     .7081338    .8577727
              10  |    .981088   .1496599    -0.13   0.900     .7275478    1.322983
              11  |   .8817826   .2212606    -0.50   0.616     .5392305    1.441945
              12  |   .9910565   .0893019    -0.10   0.921     .8306127    1.182492
              13  |   1.333909     .20001     1.92   0.055     .9942477    1.789607
              14  |   .6264836   .0838059    -3.50   0.000     .4819953    .8142853
              15  |     .67883   .0488819    -5.38   0.000     .5894769    .7817273
              17  |   1.085681   .0509492     1.75   0.080     .9902772    1.190276
                  |
             time |
            2000  |   1.110824   .0679058     1.72   0.086     .9853955    1.252219
            2002  |    .987304   .0598767    -0.21   0.833     .8766542     1.11192
            2003  |   .8801448   .0570805    -1.97   0.049     .7750874     .999442
            2004  |   .8946956   .0589323    -1.69   0.091     .7863355    1.017988
            2005  |   .7830997   .0500231    -3.83   0.000     .6909455    .8875449
            2006  |   .7759214   .0551923    -3.57   0.000     .6749485    .8919998
            2007  |   .7257347   .0529602    -4.39   0.000     .6290162    .8373248
            2008  |   .6549761   .0471065    -5.88   0.000     .5688611    .7541273
            2009  |   .5586365   .0434627    -7.48   0.000     .4796282    .6506598
            2010  |   .5708559   .0461661    -6.93   0.000     .4871787    .6689053
            2011  |   .6078983   .0488867    -6.19   0.000     .5192518    .7116786
            2012  |   .6201935   .0509797    -5.81   0.000     .5279086     .728611
            2013  |   .5415917   .0505738    -6.57   0.000     .4510107    .6503649
            2014  |   .5276483   .0501981    -6.72   0.000       .43789     .635805
            2015  |   .5561954   .0572836    -5.70   0.000     .4545278    .6806037
                  |
            _cons |   .0000167   1.01e-06  -181.46   0.000     .0000148    .0000188
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.523528    .097317                     -1.714266    -1.33279
------------------+----------------------------------------------------------------
            alpha |   .2179416   .0212094                      .1800959    .2637403
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.V.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.V.2.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    612.48
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8979.294      36    18030.59   18273.26
        nbin |      6,253 -8961.932  -8673.055      37    17420.11   17669.52
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv2_yhat 
(option n assumed; predicted number of events)

. gen cv2_res = dv - cv2_yhat

. 
. summ dv cv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
    cv2_yhat |      6,253    1.924376    2.908562   .0006382   28.34059

. /*
> pause "next"
> 
> scatter dv cv2_yhat
> 
> pause "next"
> 
> scatter cv2_res dv
> 
> pause "next"
> 
> scatter cv2_res cv2_yhat
> */
. pause "complete: C.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.3
. 
. // poisson model
. glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9588.5647  
Iteration 1:   log pseudolikelihood = -8984.1559  
Iteration 2:   log pseudolikelihood = -8980.8745  
Iteration 3:   log pseudolikelihood = -8980.8723  
Iteration 4:   log pseudolikelihood = -8980.8723  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8386.878884                   (1/df) Deviance =   1.349023
Pearson          =  9312.143395                   (1/df) Pearson  =   1.497852

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.884015
Log pseudolikelihood = -8980.872289               BIC             =  -45954.78

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p47_c_4lag |   .9975301   .0237937    -0.10   0.917     .9519687    1.045272
       p48_c_4lag |   1.002354   .0026922     0.88   0.381     .9970909    1.007644
       p71_c_4lag |     .96499   .0168188    -2.04   0.041     .9325825    .9985237
       p72_c_4lag |   1.004793   .0060601     0.79   0.428     .9929851    1.016741
       p75_c_4lag |   1.000229   .0000759     3.02   0.003      1.00008    1.000378
       p77_c_4lag |   .9976861   .0015298    -1.51   0.131     .9946923    1.000689
        mine_time |   .9926505   .0088927    -0.82   0.410     .9753732    1.010234
onsite_insp_hours |   .9998818   .0000567    -2.09   0.037     .9997708    .9999929
                  |
            state |
               1  |   1.135179   .0889595     1.62   0.106     .9735514    1.323639
               2  |    2.21704   .1428428    12.36   0.000     1.954029    2.515452
               3  |   .7522517   .1268633    -1.69   0.091     .5405208    1.046921
               4  |     1.1999   .1160394     1.88   0.060     .9927217    1.450316
               5  |   .9577701   .1502036    -0.28   0.783     .7043207    1.302423
               6  |   1.054182   .0617317     0.90   0.368     .9398752    1.182391
               7  |   1.036647   .2308527     0.16   0.872     .6700007    1.603933
               8  |   .9487383   .0495049    -1.01   0.313     .8565071    1.050901
               9  |   .8396379   .0449016    -3.27   0.001     .7560876    .9324209
              10  |   1.229632   .1737816     1.46   0.144     .9321299    1.622086
              11  |    .929482   .2431959    -0.28   0.780     .5565791    1.552227
              12  |    .981726   .1031404    -0.18   0.861     .7990296    1.206196
              13  |   1.376741   .2024672     2.17   0.030     1.031983    1.836675
              14  |   .6504453   .0829427    -3.37   0.001     .5066036    .8351283
              15  |   .6998716   .0629333    -3.97   0.000     .5867827    .8347558
              17  |   1.140072    .058759     2.54   0.011     1.030533    1.261256
                  |
             time |
            2000  |   1.160991   .0720874     2.40   0.016     1.027961    1.311237
            2002  |   1.007015   .0561809     0.13   0.900     .9027095    1.123374
            2003  |   .8908843   .0535653    -1.92   0.055     .7918482    1.002307
            2004  |    .925186   .0597228    -1.20   0.228     .8152337    1.049968
            2005  |   .8072878   .0482309    -3.58   0.000     .7180817    .9075758
            2006  |   .7675368   .0562458    -3.61   0.000      .664848    .8860863
            2007  |   .7333797   .0537076    -4.23   0.000     .6353205    .8465741
            2008  |   .6743638    .052665    -5.04   0.000      .578654     .785904
            2009  |     .59913   .0476753    -6.44   0.000     .5126103    .7002527
            2010  |   .5910031   .0509977    -6.09   0.000     .4990447    .6999066
            2011  |   .6168825   .0530154    -5.62   0.000      .521254    .7300548
            2012  |   .6370102   .0550348    -5.22   0.000     .5377823     .754547
            2013  |   .5925965   .0616474    -5.03   0.000     .4832915    .7266228
            2014  |   .5819362   .0598913    -5.26   0.000      .475633    .7119979
            2015  |   .5972924   .0703952    -4.37   0.000     .4740966    .7525011
                  |
            _cons |   .0000154   9.24e-07  -185.09   0.000     .0000137    .0000174
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8386.879
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9312.143
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9219.8992  
Iteration 1:   log pseudolikelihood = -9092.1964  
Iteration 2:   log pseudolikelihood = -9091.0996  
Iteration 3:   log pseudolikelihood = -9091.0995  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3868.436565                   (1/df) Deviance =   .6222353
Pearson          =   4155.39003                   (1/df) Pearson  =   .6683915

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.919271
Log pseudolikelihood = -9091.099457               BIC             =  -50473.22

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p47_c_4lag |   1.018079   .0228273     0.80   0.424     .9743071    1.063817
       p48_c_4lag |   1.002166   .0027954     0.78   0.438     .9967023     1.00766
       p71_c_4lag |   .9905516   .0185966    -0.51   0.613     .9547654    1.027679
       p72_c_4lag |   .9999739   .0092568    -0.00   0.998     .9819945    1.018282
       p75_c_4lag |   1.000346   .0000859     4.03   0.000     1.000178    1.000515
       p77_c_4lag |   .9979883   .0017211    -1.17   0.243     .9946208    1.001367
        mine_time |   .9941528   .0069601    -0.84   0.402     .9806043    1.007888
onsite_insp_hours |   .9998607   .0000525    -2.65   0.008     .9997579    .9999636
                  |
            state |
               1  |   1.045317   .1117257     0.41   0.678     .8477543    1.288921
               2  |   1.739031   .0913114    10.54   0.000     1.568965    1.927532
               3  |   .7223821   .1204881    -1.95   0.051      .520946    1.001708
               4  |   1.060115   .0831376     0.74   0.457     .9090735    1.236252
               5  |    .877083   .1487592    -0.77   0.439     .6290297    1.222954
               6  |   .8888873   .0439216    -2.38   0.017     .8068396    .9792785
               7  |   .9163611   .2090112    -0.38   0.702     .5860269      1.4329
               8  |   1.126552   .0501552     2.68   0.007     1.032416    1.229271
               9  |   .7489721   .0390986    -5.54   0.000     .6761302    .8296615
              10  |   .8379723   .1418356    -1.04   0.296     .6013882    1.167628
              11  |   .8943203   .2390512    -0.42   0.676     .5296238    1.510145
              12  |   .9911515   .0879699    -0.10   0.920     .8328973    1.179475
              13  |   1.350767   .2154368     1.89   0.059     .9881446    1.846463
              14  |   .6285762   .0896596    -3.26   0.001      .475273    .8313285
              15  |   .6626407   .0438941    -6.21   0.000     .5819605    .7545061
              17  |   1.070572   .0558823     1.31   0.191     .9664606    1.185898
                  |
             time |
            2000  |   1.099082   .0750286     1.38   0.166     .9614414    1.256427
            2002  |    .935403   .0631349    -0.99   0.322     .8194963    1.067703
            2003  |   .8743631   .0668471    -1.76   0.079     .7526889    1.015706
            2004  |   .8446285   .0609298    -2.34   0.019     .7332663    .9729033
            2005  |   .7425332   .0529669    -4.17   0.000     .6456502    .8539539
            2006  |    .756016    .058298    -3.63   0.000     .6499695    .8793645
            2007  |   .7001812   .0543337    -4.59   0.000      .601392    .8151982
            2008  |   .6262861   .0475827    -6.16   0.000     .5396373     .726848
            2009  |   .5061333    .042322    -8.14   0.000     .4296244    .5962671
            2010  |   .5516931    .047285    -6.94   0.000     .4663822    .6526092
            2011  |   .5827864   .0493236    -6.38   0.000     .4937063    .6879392
            2012  |   .5952168   .0525699    -5.87   0.000     .5006066    .7077075
            2013  |   .4922323   .0471447    -7.40   0.000      .407985    .5938763
            2014  |   .4761413   .0473488    -7.46   0.000     .3918231    .5786042
            2015  |   .5127567   .0528804    -6.48   0.000     .4189163    .6276181
                  |
            _cons |   .0000178   1.15e-06  -168.57   0.000     .0000156    .0000202
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =  -10020.12  
Iteration 1:   log pseudolikelihood = -8995.4197  
Iteration 2:   log pseudolikelihood = -8980.9195  
Iteration 3:   log pseudolikelihood = -8980.8723  
Iteration 4:   log pseudolikelihood = -8980.8723  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8712.7325  
Iteration 1:   log pseudolikelihood = -8675.5147  
Iteration 2:   log pseudolikelihood =  -8674.703  
Iteration 3:   log pseudolikelihood = -8674.7027  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8674.7027               Pseudo R2         =     0.0320

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p47_c_4lag |   1.011057    .023665     0.47   0.638     .9657227     1.05852
       p48_c_4lag |   1.001406   .0023755     0.59   0.554     .9967605    1.006072
       p71_c_4lag |   .9752552   .0160621    -1.52   0.128     .9442767     1.00725
       p72_c_4lag |   1.000955   .0075244     0.13   0.899     .9863157    1.015812
       p75_c_4lag |   1.000292   .0000808     3.62   0.000     1.000134    1.000451
       p77_c_4lag |   .9977596   .0017193    -1.30   0.193     .9943956    1.001135
        mine_time |   .9930116   .0073105    -0.95   0.341     .9787863    1.007444
onsite_insp_hours |   .9998671    .000054    -2.46   0.014     .9997613     .999973
                  |
            state |
               1  |   1.079937   .1004235     0.83   0.408     .9000049    1.295841
               2  |   1.975611    .109372    12.30   0.000     1.772467    2.202039
               3  |   .7295125   .1250171    -1.84   0.066     .5213888    1.020713
               4  |   1.092564    .087622     1.10   0.270     .9336449    1.278533
               5  |   .9105406   .1494434    -0.57   0.568     .6600777     1.25604
               6  |   .9458331   .0484679    -1.09   0.277     .8554524    1.045763
               7  |   .9669857   .2187221    -0.15   0.882     .6207077    1.506444
               8  |   1.004267   .0497963     0.09   0.932     .9112604    1.106766
               9  |   .7873117   .0396238    -4.75   0.000     .7133579    .8689323
              10  |    .987199   .1532632    -0.08   0.934     .7282075    1.338302
              11  |   .8879692   .2230981    -0.47   0.636     .5426721    1.452976
              12  |   .9872951   .0890552    -0.14   0.887     .8273088     1.17822
              13  |   1.330341   .1995319     1.90   0.057     .9915053     1.78497
              14  |   .6251524   .0838827    -3.50   0.000     .4805871    .8132045
              15  |   .6774316   .0487935    -5.41   0.000     .5882417    .7801445
              17  |   1.096435   .0558922     1.81   0.071     .9921829    1.211641
                  |
             time |
            2000  |    1.13578   .0717298     2.02   0.044     1.003545    1.285439
            2002  |   .9817047    .059071    -0.31   0.759      .872494    1.104585
            2003  |   .8793514   .0572516    -1.97   0.048     .7740047    .9990364
            2004  |   .8957793   .0591892    -1.67   0.096     .7869684    1.019635
            2005  |   .7820036   .0498343    -3.86   0.000     .6901837    .8860389
            2006  |   .7775286   .0555112    -3.52   0.000     .6759978    .8943087
            2007  |   .7256109   .0528743    -4.40   0.000     .6290394    .8370081
            2008  |   .6577289   .0473479    -5.82   0.000     .5711782    .7573947
            2009  |     .55629   .0433975    -7.52   0.000      .477416    .6481948
            2010  |   .5707912   .0459383    -6.97   0.000      .487496    .6683185
            2011  |   .6037063   .0487404    -6.25   0.000     .5153517    .7072089
            2012  |   .6167293   .0508723    -5.86   0.000     .5246641    .7249497
            2013  |   .5380172   .0504422    -6.61   0.000     .4477041    .6465486
            2014  |   .5244742   .0501741    -6.75   0.000      .434804    .6326372
            2015  |   .5510918   .0565326    -5.81   0.000     .4507184    .6738181
                  |
            _cons |   .0000168   1.02e-06  -182.02   0.000     .0000149    .0000189
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |   -1.52313   .0970024                     -1.713251   -1.333008
------------------+----------------------------------------------------------------
            alpha |   .2180285   .0211493                      .1802788    .2636828
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.V.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.V.3.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    612.34
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8980.872      36    18033.74   18276.41
        nbin |      6,253 -8961.932  -8674.703      37    17423.41   17672.82
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv3_yhat 
(option n assumed; predicted number of events)

. gen cv3_res = dv - cv3_yhat

. 
. summ dv cv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
    cv3_yhat |      6,253    1.922302    2.890726   .0006387    27.8425

. 
. pause "next"

. /*
> scatter dv cv3_yhat
> 
> pause "next"
> 
> scatter cv3_res dv
> 
> pause "next"
> 
> scatter cv3_res cv3_yhat
> */
. pause "complete: C.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.4
. 
. // poisson model
. glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9591.7502  
Iteration 1:   log pseudolikelihood = -8987.9042  
Iteration 2:   log pseudolikelihood = -8984.6578  
Iteration 3:   log pseudolikelihood = -8984.6556  
Iteration 4:   log pseudolikelihood = -8984.6556  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8394.445549                   (1/df) Deviance =   1.350241
Pearson          =  9338.116553                   (1/df) Pearson  =   1.502029

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.885225
Log pseudolikelihood = -8984.655621               BIC             =  -45947.21

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_c_lag_all |   1.013906   .0102211     1.37   0.171       .99407    1.034139
    p48_c_lag_all |   1.001373   .0010821     1.27   0.204     .9992541    1.003496
    p71_c_lag_all |   .9902925    .005039    -1.92   0.055     .9804654    1.000218
    p72_c_lag_all |   1.002477   .0030825     0.80   0.421     .9964533    1.008536
    p75_c_lag_all |   1.000028   .0000114     2.48   0.013     1.000006    1.000051
    p77_c_lag_all |    .999218   .0004515    -1.73   0.083     .9983335    1.000103
        mine_time |   .9860302   .0081751    -1.70   0.090     .9701368    1.002184
onsite_insp_hours |   .9999445   .0000445    -1.25   0.212     .9998574    1.000032
                  |
            state |
               1  |   1.092719   .0752046     1.29   0.198     .9548295    1.250521
               2  |   2.223511   .1292262    13.75   0.000     1.984125    2.491779
               3  |   .7655982   .1509274    -1.35   0.175     .5202332    1.126688
               4  |   1.166653   .1000811     1.80   0.072     .9861016    1.380264
               5  |   .9232899   .1408993    -0.52   0.601     .6846047    1.245192
               6  |   1.016241   .0588881     0.28   0.781     .9071353    1.138469
               7  |   1.028792   .2286324     0.13   0.898     .6655212    1.590353
               8  |   .9228786   .0473432    -1.56   0.118        .8346    1.020495
               9  |   .7957371   .0481883    -3.77   0.000     .7066794    .8960181
              10  |   1.189948   .1836358     1.13   0.260     .8793635    1.610229
              11  |   .9415213   .2439443    -0.23   0.816      .566614    1.564491
              12  |   .9370358   .0956813    -0.64   0.524     .7670779    1.144651
              13  |   1.322548   .1972227     1.87   0.061     .9873639    1.771517
              14  |   .6372251   .0830586    -3.46   0.001     .4935642    .8227011
              15  |   .6847056   .0647751    -4.00   0.000     .5688239    .8241948
              17  |   1.185581   .0888632     2.27   0.023     1.023601    1.373193
                  |
             time |
            2000  |   1.104739   .0661393     1.66   0.096     .9824246    1.242281
            2002  |   1.004355   .0553149     0.08   0.937     .9015865    1.118838
            2003  |   .8880351   .0528215    -2.00   0.046     .7903138    .9978396
            2004  |   .9174275   .0583165    -1.36   0.175     .8099625    1.039151
            2005  |   .8082343   .0485093    -3.55   0.000     .7185371    .9091288
            2006  |   .7774342   .0557469    -3.51   0.000     .6755028    .8947467
            2007  |   .7431481   .0542653    -4.07   0.000     .6440505    .8574933
            2008  |   .6768775   .0523101    -5.05   0.000     .5817388    .7875755
            2009  |   .5943938   .0502347    -6.16   0.000     .5036578    .7014762
            2010  |   .5766736   .0525899    -6.04   0.000     .4822859    .6895338
            2011  |    .605984   .0528403    -5.74   0.000     .5107855    .7189253
            2012  |    .621596    .053032    -5.57   0.000     .5258806    .7347324
            2013  |    .577567   .0584082    -5.43   0.000     .4737204    .7041783
            2014  |   .5624987   .0599114    -5.40   0.000     .4565207    .6930787
            2015  |   .5683014   .0677831    -4.74   0.000     .4498349    .7179666
                  |
            _cons |   .0000163   1.00e-06  -178.94   0.000     .0000144    .0000184
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8394.446
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9338.117
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9231.9321  
Iteration 1:   log pseudolikelihood = -9097.2938  
Iteration 2:   log pseudolikelihood = -9096.0509  
Iteration 3:   log pseudolikelihood = -9096.0506  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3878.338892                   (1/df) Deviance =    .623828
Pearson          =   4161.45878                   (1/df) Pearson  =   .6693677

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.920854
Log pseudolikelihood = -9096.050621               BIC             =  -50463.32

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_c_lag_all |   1.014443   .0082653     1.76   0.078     .9983724    1.030773
    p48_c_lag_all |   1.001195   .0013017     0.92   0.358     .9986469    1.003749
    p71_c_lag_all |   1.002004   .0071488     0.28   0.779     .9880903    1.016114
    p72_c_lag_all |   1.003033    .003427     0.89   0.375     .9963384    1.009772
    p75_c_lag_all |    1.00002   .0000126     1.56   0.119      .999995    1.000044
    p77_c_lag_all |    .999222   .0004924    -1.58   0.114     .9982574    1.000188
        mine_time |   .9922664   .0077272    -1.00   0.319     .9772363    1.007528
onsite_insp_hours |   .9999673   .0000412    -0.79   0.428     .9998866    1.000048
                  |
            state |
               1  |   1.030044   .1071597     0.28   0.776     .8400432    1.263018
               2  |   1.725164   .0898925    10.47   0.000     1.557676     1.91066
               3  |   .7282724     .13655    -1.69   0.091     .5043068    1.051702
               4  |   1.050884   .0811788     0.64   0.521     .9032353    1.222668
               5  |   .8530774   .1398556    -0.97   0.332     .6186434     1.17635
               6  |   .8658795   .0431773    -2.89   0.004     .7852574    .9547789
               7  |   .9215475   .2118889    -0.36   0.722     .5872233    1.446213
               8  |   1.051777   .0419007     1.27   0.205     .9727779    1.137193
               9  |   .6800875   .0418186    -6.27   0.000      .602871    .7671941
              10  |   .8129557   .1386579    -1.21   0.225     .5819502    1.135659
              11  |   .9160718   .2411074    -0.33   0.739     .5468847    1.534487
              12  |   .9390638   .0846646    -0.70   0.486     .7869588    1.120568
              13  |   1.313246   .2137738     1.67   0.094     .9545205    1.806787
              14  |   .6048516   .0907366    -3.35   0.001     .4507711    .8115992
              15  |   .6536411   .0437486    -6.35   0.000     .5732814    .7452652
              17  |   1.038718   .0811107     0.49   0.627     .8913112    1.210502
                  |
             time |
            2000  |    1.05374   .0698859     0.79   0.430     .9252951    1.200015
            2002  |    .937535   .0626794    -0.96   0.335     .8223941    1.068796
            2003  |   .8736818   .0659359    -1.79   0.074     .7535533    1.012961
            2004  |   .8402626   .0602569    -2.43   0.015     .7300854    .9670667
            2005  |   .7354239   .0518528    -4.36   0.000     .6405038    .8444107
            2006  |   .7584406   .0576722    -3.64   0.000     .6534251    .8803337
            2007  |   .7015865   .0543172    -4.58   0.000     .6028104    .8165479
            2008  |   .6261574    .047445    -6.18   0.000     .5397425    .7264078
            2009  |   .5122363   .0431022    -7.95   0.000      .434356    .6040805
            2010  |   .5481428   .0471115    -7.00   0.000     .4631642    .6487126
            2011  |   .5767159   .0485192    -6.54   0.000     .4890465    .6801014
            2012  |   .5776797   .0508631    -6.23   0.000     .4861174     .686488
            2013  |    .475415   .0452876    -7.81   0.000     .3944466    .5730039
            2014  |   .4565836   .0462983    -7.73   0.000     .3742891    .5569722
            2015  |   .4860963   .0506711    -6.92   0.000     .3962711    .5962828
                  |
            _cons |   .0000184   1.23e-06  -163.76   0.000     .0000162     .000021
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -10034.278  
Iteration 1:   log pseudolikelihood = -8998.7615  
Iteration 2:   log pseudolikelihood = -8984.6662  
Iteration 3:   log pseudolikelihood = -8984.6556  
Iteration 4:   log pseudolikelihood = -8984.6556  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8716.7583  
Iteration 1:   log pseudolikelihood = -8682.5533  
Iteration 2:   log pseudolikelihood = -8681.8409  
Iteration 3:   log pseudolikelihood = -8681.8407  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8681.8407               Pseudo R2         =     0.0313

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_c_lag_all |   1.014839   .0085679     1.74   0.081     .9981847    1.031772
    p48_c_lag_all |   1.001126   .0011794     0.96   0.339      .998817     1.00344
    p71_c_lag_all |   .9962772   .0058274    -0.64   0.524      .984921    1.007764
    p72_c_lag_all |   1.002938   .0031295     0.94   0.347     .9968229     1.00909
    p75_c_lag_all |   1.000026   .0000122     2.10   0.036     1.000002    1.000049
    p77_c_lag_all |   .9992225   .0004963    -1.57   0.117     .9982502    1.000196
        mine_time |   .9888504    .007706    -1.44   0.150     .9738617     1.00407
onsite_insp_hours |   .9999454   .0000412    -1.33   0.185     .9998647    1.000026
                  |
            state |
               1  |   1.045005   .0881891     0.52   0.602     .8856962    1.232969
               2  |   1.959895   .1047199    12.59   0.000     1.765029    2.176274
               3  |   .7361687   .1454996    -1.55   0.121     .4997377    1.084458
               4  |   1.075437   .0811745     0.96   0.335     .9275466    1.246907
               5  |   .8842244   .1406832    -0.77   0.439     .6473414    1.207791
               6  |   .9171434   .0470941    -1.68   0.092     .8293334    1.014251
               7  |   .9638975   .2185778    -0.16   0.871     .6180285    1.503326
               8  |   .9494723   .0438114    -1.12   0.261     .8673719    1.039344
               9  |   .7252692    .041551    -5.61   0.000     .6482366    .8114559
              10  |    .956329     .15115    -0.28   0.778     .7015732    1.303592
              11  |   .9031047   .2241457    -0.41   0.681      .555232    1.468932
              12  |   .9370258   .0854722    -0.71   0.476     .7836244    1.120457
              13  |    1.28295   .1956595     1.63   0.102     .9514702    1.729914
              14  |   .6036803   .0837041    -3.64   0.000     .4600261    .7921938
              15  |   .6652199   .0489882    -5.54   0.000     .5758122    .7685101
              17  |    1.09191   .0809154     1.19   0.235     .9442973    1.262596
                  |
             time |
            2000  |   1.086214    .065214     1.38   0.168     .9656309    1.221856
            2002  |   .9828714   .0585958    -0.29   0.772     .8744815    1.104696
            2003  |   .8797438    .056389    -2.00   0.046     .7758839    .9975064
            2004  |   .8890566   .0580679    -1.80   0.072     .7822291    1.010473
            2005  |   .7781722   .0491327    -3.97   0.000     .6875939    .8806826
            2006  |   .7815893   .0549298    -3.51   0.000     .6810146    .8970172
            2007  |    .729016   .0529067    -4.36   0.000     .6323579    .8404485
            2008  |   .6597485   .0471929    -5.81   0.000     .5734433    .7590429
            2009  |   .5605515   .0443303    -7.32   0.000     .4800646    .6545328
            2010  |    .564455   .0459257    -7.03   0.000     .4812526    .6620419
            2011  |   .5960632   .0478477    -6.45   0.000     .5092886    .6976228
            2012  |   .5989302   .0489278    -6.27   0.000     .5103168    .7029309
            2013  |   .5210201   .0484065    -7.02   0.000     .4342819    .6250823
            2014  |   .5056112   .0496397    -6.95   0.000     .4171072    .6128944
            2015  |   .5236631   .0542906    -6.24   0.000     .4273699    .6416528
                  |
            _cons |   .0000176   1.09e-06  -177.50   0.000     .0000156    .0000199
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.522555   .0956701                     -1.710065   -1.335045
------------------+----------------------------------------------------------------
            alpha |   .2181537   .0208708                       .180854    .2631463
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.V.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.V.4.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    605.63
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8984.656      36    18041.31   18283.98
        nbin |      6,253 -8961.932  -8681.841      37    17437.68   17687.09
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv4_yhat 
(option n assumed; predicted number of events)

. gen cv4_res = dv - cv4_yhat

. 
. summ dv cv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
    cv4_yhat |      6,253    1.911876    2.798293    .000633   23.60368

. /*
> pause "next"
> 
> scatter dv cv4_yhat
> 
> pause "next"
> 
> scatter cv4_res dv
> 
> pause "next"
> 
> scatter cv4_res cv4_yhat
> */
. pause "complete: C.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.1
. 
. // poisson model
. glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9589.1096  
Iteration 1:   log pseudolikelihood = -8986.2429  
Iteration 2:   log pseudolikelihood = -8982.7561  
Iteration 3:   log pseudolikelihood = -8982.7536  
Iteration 4:   log pseudolikelihood = -8982.7536  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8390.641604                   (1/df) Deviance =   1.349629
Pearson          =  9300.638015                   (1/df) Pearson  =   1.496001

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.884617
Log pseudolikelihood = -8982.753649               BIC             =  -45951.02

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_ss |   .8280463   .2292854    -0.68   0.496     .4812353    1.424793
           p48_ss |   .9952598   .0268468    -0.18   0.860     .9440079    1.049294
           p71_ss |   .7599296    .090802    -2.30   0.022     .6012644    .9604644
           p72_ss |   .9889366   .0876066    -0.13   0.900     .8313107     1.17645
           p75_ss |   1.002324   .0008114     2.87   0.004     1.000735    1.003915
           p77_ss |   1.015647   .0175438     0.90   0.369     .9818375    1.050621
        mine_time |   .9938073   .0091817    -0.67   0.501     .9759735    1.011967
onsite_insp_hours |   .9998884   .0000533    -2.09   0.036     .9997839    .9999929
                  |
            state |
               1  |   1.098144   .0880552     1.17   0.243     .9384373     1.28503
               2  |   2.041828   .1420459    10.26   0.000      1.78157    2.340106
               3  |   .7430096   .1191635    -1.85   0.064     .5425992    1.017442
               4  |   1.261992   .1279146     2.30   0.022     1.034617    1.539337
               5  |   .9791785   .1507257    -0.14   0.891      .724162       1.324
               6  |   1.063938   .0646009     1.02   0.307     .9445666    1.198396
               7  |   1.022859   .2332785     0.10   0.921     .6541637    1.599356
               8  |   .9100042   .0424348    -2.02   0.043     .8305211    .9970942
               9  |   .8041512   .0399518    -4.39   0.000     .7295387    .8863946
              10  |   1.184288   .1504414     1.33   0.183     .9232694      1.5191
              11  |   .8960391   .2373145    -0.41   0.679     .5331969    1.505797
              12  |   .9469743    .093523    -0.55   0.581     .7803217    1.149219
              13  |   1.369189    .203013     2.12   0.034     1.023891    1.830936
              14  |   .6494299   .0849706    -3.30   0.001     .5025302    .8392715
              15  |   .6858246   .0692767    -3.73   0.000     .5626408     .835978
              17  |   1.095623   .0466182     2.15   0.032     1.007959    1.190911
                  |
             time |
            2000  |   1.118084   .0663048     1.88   0.060     .9953974    1.255893
            2002  |   1.018997   .0566514     0.34   0.735     .9137978    1.136307
            2003  |    .888899   .0517325    -2.02   0.043     .7930743    .9963019
            2004  |   .8986563    .057958    -1.66   0.098     .7919471    1.019744
            2005  |    .803233   .0491277    -3.58   0.000      .712492    .9055305
            2006  |   .7587249   .0547495    -3.83   0.000     .6586607    .8739909
            2007  |   .7365922   .0528742    -4.26   0.000     .6399204    .8478679
            2008  |    .688636   .0531388    -4.83   0.000     .5919793    .8010744
            2009  |   .6165182   .0505245    -5.90   0.000     .5250356    .7239408
            2010  |   .6036332   .0517655    -5.89   0.000     .5102429    .7141167
            2011  |    .636254   .0553164    -5.20   0.000       .53657    .7544573
            2012  |   .6639122   .0564591    -4.82   0.000     .5619846    .7843264
            2013  |   .6165553   .0640098    -4.66   0.000      .503039    .7556879
            2014  |   .6076692   .0617481    -4.90   0.000     .4979351    .7415864
            2015  |   .6251109   .0755914    -3.89   0.000      .493203    .7922979
                  |
            _cons |   .0000152   9.11e-07  -184.94   0.000     .0000135    .0000171
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8383.039
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9302.786
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9216.7199  
Iteration 1:   log pseudolikelihood = -9089.4409  
Iteration 2:   log pseudolikelihood = -9088.3596  
Iteration 3:   log pseudolikelihood = -9088.3587  
Iteration 4:   log pseudolikelihood = -9088.3587  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3862.954951                   (1/df) Deviance =   .6213535
Pearson          =  4135.171224                   (1/df) Pearson  =   .6651393

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.918394
Log pseudolikelihood =  -9088.35865               BIC             =   -50478.7

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_ss |    1.02444   .2386353     0.10   0.917     .6489421    1.617214
           p48_ss |   1.000024   .0287154     0.00   0.999     .9452975    1.057919
           p71_ss |    .777126   .1110296    -1.76   0.078      .587325    1.028263
           p72_ss |   .8714583   .0635114    -1.89   0.059     .7554601    1.005268
           p75_ss |   1.003956   .0008964     4.42   0.000       1.0022    1.005714
           p77_ss |   1.017143   .0208276     0.83   0.406       .97713    1.058795
        mine_time |   .9965756   .0070039    -0.49   0.625     .9829423    1.010398
onsite_insp_hours |   .9998798   .0000494    -2.43   0.015     .9997829    .9999767
                  |
            state |
               1  |   1.007094   .1069214     0.07   0.947     .8178986    1.240054
               2  |   1.603595   .0879471     8.61   0.000     1.440163    1.785573
               3  |    .731814   .1228591    -1.86   0.063     .5266214    1.016958
               4  |   1.099751   .0883602     1.18   0.237      .939516    1.287315
               5  |   .8991725   .1525219    -0.63   0.531     .6448492    1.253799
               6  |   .8900601    .044014    -2.36   0.019     .8078429    .9806449
               7  |   .9123986   .2104166    -0.40   0.691     .5806056    1.433798
               8  |   1.098188   .0429458     2.40   0.017      1.01716     1.18567
               9  |   .7436952   .0319258    -6.90   0.000     .6836818    .8089765
              10  |    .823508   .1362267    -1.17   0.240     .5954702    1.138874
              11  |   .8599044   .2365361    -0.55   0.583     .5015428    1.474322
              12  |   .9737661    .087797    -0.29   0.768     .8160342    1.161986
              13  |   1.351217   .2181308     1.86   0.062     .9847206    1.854116
              14  |   .6318581   .0894437    -3.24   0.001     .4787692    .8338978
              15  |   .6567064   .0447224    -6.17   0.000     .5746502    .7504796
              17  |   1.067192   .0426309     1.63   0.104     .9868241    1.154105
                  |
             time |
            2000  |   1.062759   .0711846     0.91   0.363     .9320095     1.21185
            2002  |   .9505739   .0649428    -0.74   0.458     .8314424    1.086775
            2003  |   .8829549   .0679555    -1.62   0.106     .7593235    1.026716
            2004  |   .8417816   .0611789    -2.37   0.018      .730022    .9706507
            2005  |   .7460655   .0534256    -4.09   0.000     .6483695    .8584822
            2006  |   .7464159   .0574851    -3.80   0.000     .6418386    .8680325
            2007  |   .6955013   .0535359    -4.72   0.000     .5981046    .8087584
            2008  |   .6348346   .0487114    -5.92   0.000     .5461944      .73786
            2009  |   .5308712    .044506    -7.55   0.000     .4504308    .6256772
            2010  |   .5647831   .0485754    -6.64   0.000     .4771689    .6684843
            2011  |   .6019713   .0509672    -5.99   0.000     .5099258    .7106317
            2012  |   .6213204   .0552101    -5.36   0.000     .5220096    .7395248
            2013  |   .5150538   .0495199    -6.90   0.000      .426593    .6218583
            2014  |   .4940307   .0494647    -7.04   0.000     .4060015    .6011465
            2015  |   .5421496   .0568712    -5.84   0.000     .4413961    .6659011
                  |
            _cons |   .0000172   1.13e-06  -166.50   0.000     .0000151    .0000195
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -9768.8438  
Iteration 1:   log pseudolikelihood = -8994.0968  
Iteration 2:   log pseudolikelihood = -8982.7603  
Iteration 3:   log pseudolikelihood = -8982.7536  
Iteration 4:   log pseudolikelihood = -8982.7536  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8710.9283  
Iteration 1:   log pseudolikelihood = -8672.6321  
Iteration 2:   log pseudolikelihood = -8671.7972  
Iteration 3:   log pseudolikelihood = -8671.7968  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8671.7968               Pseudo R2         =     0.0324

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_ss |   .9417173   .2676108    -0.21   0.833     .5395503    1.643649
           p48_ss |   .9964365   .0277534    -0.13   0.898     .9434989    1.052344
           p71_ss |   .7746687   .1086663    -1.82   0.069     .5884561    1.019807
           p72_ss |   .9096809   .0685354    -1.26   0.209      .784801    1.054432
           p75_ss |   1.003216   .0008527     3.78   0.000     1.001546    1.004889
           p77_ss |   1.010009   .0182275     0.55   0.581     .9749085    1.046374
        mine_time |   .9949892   .0074937    -0.67   0.505     .9804097    1.009785
onsite_insp_hours |    .999879    .000051    -2.37   0.018      .999779    .9999789
                  |
            state |
               1  |   1.043992   .0970546     0.46   0.643     .8700922    1.252648
               2  |   1.826352   .1058337    10.39   0.000     1.630268    2.046021
               3  |   .7303524   .1218085    -1.88   0.060     .5267065    1.012736
               4  |   1.139697   .0948193     1.57   0.116     .9682157     1.34155
               5  |    .933507   .1512395    -0.42   0.671     .6795361    1.282397
               6  |   .9520471   .0493037    -0.95   0.343     .8601561    1.053755
               7  |   .9588338   .2209604    -0.18   0.855     .6103606    1.506261
               8  |   .9677677   .0409417    -0.77   0.439     .8907601    1.051433
               9  |    .765547   .0329197    -6.21   0.000     .7036698    .8328654
              10  |   .9610519   .1417978    -0.27   0.788     .7197088    1.283326
              11  |   .8533061    .218167    -0.62   0.535     .5169825    1.408425
              12  |    .959429   .0871152    -0.46   0.648     .8030166    1.146307
              13  |   1.328327   .2004402     1.88   0.060     .9882382    1.785454
              14  |   .6276548   .0847221    -3.45   0.001     .4817526    .8177446
              15  |   .6693614   .0516057    -5.21   0.000     .5754872    .7785485
              17  |   1.069257   .0418981     1.71   0.087     .9902124    1.154611
                  |
             time |
            2000  |   1.100678   .0665818     1.59   0.113     .9776194    1.239227
            2002  |   .9968517    .060716    -0.05   0.959      .884679    1.123247
            2003  |   .8867201   .0576883    -1.85   0.065      .780565    1.007312
            2004  |   .8858175   .0590003    -1.82   0.069      .777409    1.009343
            2005  |   .7869218   .0506225    -3.72   0.000     .6937035    .8926665
            2006  |   .7693429   .0546058    -3.69   0.000     .6694283    .8841702
            2007  |   .7245982   .0522543    -4.47   0.000     .6290902    .8346061
            2008  |   .6682153   .0483892    -5.57   0.000     .5797972    .7701169
            2009  |   .5815296   .0456112    -6.91   0.000     .4986655    .6781633
            2010  |   .5866331   .0473691    -6.61   0.000     .5007654    .6872248
            2011  |   .6251532   .0505744    -5.81   0.000     .5334883    .7325681
            2012  |   .6445888   .0531711    -5.32   0.000     .5483634    .7576996
            2013  |   .5623678    .052623    -6.15   0.000     .4681339    .6755708
            2014  |   .5462049   .0520999    -6.34   0.000     .4530681    .6584877
            2015  |   .5820485   .0607177    -5.19   0.000     .4744213    .7140921
                  |
            _cons |   .0000163   9.96e-07  -180.57   0.000     .0000145    .0000184
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |   -1.51978   .0969831                     -1.709863   -1.329696
------------------+----------------------------------------------------------------
            alpha |   .2187601    .021216                      .1808906    .2645576
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.SSV.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.SSV.1.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    614.31
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8978.952      36     18029.9   18272.57
        nbin |      6,253 -8961.932  -8671.797      37    17417.59      17667
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv1_yhat 
(option n assumed; predicted number of events)

. gen cssv1_res = dv - cssv1_yhat

. 
. summ dv cssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
  cssv1_yhat |      6,253    1.924011    2.900447    .000657   32.89595

. /*
> pause "next"
> 
> scatter dv cssv1_yhat
> 
> pause "next"
> 
> scatter cssv1_res dv
> 
> pause "next"
> 
> scatter cssv1_res cssv1_yhat
> */
. pause "complete: C.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.2
. 
. // poisson model
. glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9585.7537  
Iteration 1:   log pseudolikelihood = -8983.3591  
Iteration 2:   log pseudolikelihood = -8979.8728  
Iteration 3:   log pseudolikelihood = -8979.8704  
Iteration 4:   log pseudolikelihood = -8979.8704  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8384.875071                   (1/df) Deviance =   1.348701
Pearson          =   9307.93187                   (1/df) Pearson  =   1.497174

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.883694
Log pseudolikelihood = -8979.870382               BIC             =  -45956.78

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_ss_1lag |    .859632   .1662631    -0.78   0.434     .5884101    1.255871
      p48_ss_1lag |   .9932874   .0219104    -0.31   0.760     .9512589    1.037173
      p71_ss_1lag |   .7311333   .0949015    -2.41   0.016     .5669049    .9429376
      p72_ss_1lag |   .9919961   .0697941    -0.11   0.909     .8642149    1.138671
      p75_ss_1lag |   1.002465   .0008536     2.89   0.004     1.000793    1.004139
      p77_ss_1lag |   1.016598   .0183757     0.91   0.362     .9812125    1.053259
        mine_time |   .9931678   .0091416    -0.74   0.456     .9754112    1.011248
onsite_insp_hours |   .9998869   .0000531    -2.13   0.033     .9997827     .999991
                  |
            state |
               1  |    1.09771   .0870889     1.18   0.240     .9396278    1.282387
               2  |   2.048167   .1414915    10.38   0.000     1.788804    2.345137
               3  |   .7445265   .1187134    -1.85   0.064     .5447004     1.01766
               4  |   1.264879    .131234     2.26   0.024     1.032131    1.550112
               5  |   .9821288   .1510958    -0.12   0.907     .7264658    1.327766
               6  |   1.065757   .0650495     1.04   0.297     .9455933    1.201191
               7  |   1.022883   .2326243     0.10   0.921     .6550064    1.597373
               8  |   .9133844   .0433274    -1.91   0.056     .8322924    1.002377
               9  |   .8078925   .0403383    -4.27   0.000     .7325762    .8909521
              10  |   1.183912   .1504051     1.33   0.184     .9229588    1.518647
              11  |   .8966099   .2374959    -0.41   0.680     .5335012    1.506855
              12  |   .9505632   .0945229    -0.51   0.610     .7822373     1.15511
              13  |   1.360438   .2013257     2.08   0.038     1.017919    1.818213
              14  |   .6512428   .0874228    -3.19   0.001     .5005848    .8472434
              15  |   .6858485   .0695193    -3.72   0.000     .5622744    .8365813
              17  |   1.100627   .0482415     2.19   0.029     1.010023    1.199359
                  |
             time |
            2000  |    1.13642   .0668015     2.18   0.030     1.012753    1.275189
            2002  |   1.016522   .0568863     0.29   0.770     .9109236    1.134361
            2003  |   .8885114    .051858    -2.03   0.043     .7924695    .9961928
            2004  |   .9088443   .0575533    -1.51   0.131     .8027613    1.028946
            2005  |   .7956826   .0501792    -3.62   0.000     .7031684    .9003686
            2006  |   .7629769   .0540921    -3.82   0.000     .6639945    .8767147
            2007  |     .73688   .0528933    -4.25   0.000     .6401732    .8481958
            2008  |   .6887815   .0527157    -4.87   0.000     .5928366    .8002542
            2009  |   .6131406   .0494509    -6.07   0.000     .5234908    .7181432
            2010  |   .6025226   .0527917    -5.78   0.000     .5074497    .7154079
            2011  |    .640671   .0551644    -5.17   0.000     .5411817    .7584501
            2012  |   .6658009   .0568609    -4.76   0.000     .5631834    .7871163
            2013  |   .6179413   .0640751    -4.64   0.000     .5042955    .7571979
            2014  |   .6101581   .0621708    -4.85   0.000     .4997018    .7450302
            2015  |   .6257226   .0765246    -3.83   0.000     .4923587    .7952104
                  |
            _cons |   .0000152   9.20e-07  -182.78   0.000     .0000135    .0000171
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8384.875
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9307.932
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9217.1304  
Iteration 1:   log pseudolikelihood = -9090.1192  
Iteration 2:   log pseudolikelihood = -9089.0362  
Iteration 3:   log pseudolikelihood = -9089.0353  
Iteration 4:   log pseudolikelihood = -9089.0353  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3864.308159                   (1/df) Deviance =   .6215712
Pearson          =  4143.416897                   (1/df) Pearson  =   .6664656

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =    2.91861
Log pseudolikelihood = -9089.035254               BIC             =  -50477.35

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_ss_1lag |   1.033748   .2208648     0.16   0.877     .6800671    1.571367
      p48_ss_1lag |   .9938587   .0252632    -0.24   0.809     .9455569    1.044628
      p71_ss_1lag |   .8878219   .1322517    -0.80   0.424     .6630239    1.188838
      p72_ss_1lag |   .9497204   .0894919    -0.55   0.584     .7895638    1.142363
      p75_ss_1lag |    1.00398   .0008845     4.51   0.000     1.002248    1.005715
      p77_ss_1lag |   1.015126   .0194633     0.78   0.434     .9776863    1.053999
        mine_time |   .9957789   .0070093    -0.60   0.548     .9821354    1.009612
onsite_insp_hours |   .9998808   .0000491    -2.43   0.015     .9997846     .999977
                  |
            state |
               1  |   1.009474   .1071157     0.09   0.929     .8199247    1.242844
               2  |    1.61964   .0875168     8.92   0.000     1.456881    1.800582
               3  |   .7290585   .1215489    -1.90   0.058     .5258353    1.010823
               4  |   1.101517   .0873419     1.22   0.223     .9429691    1.286723
               5  |   .9022018   .1526195    -0.61   0.543      .647607    1.256886
               6  |    .891445   .0442391    -2.32   0.021     .8088213     .982509
               7  |   .9137135   .2090166    -0.39   0.693     .5835706    1.430628
               8  |   1.103442    .043502     2.50   0.013     1.021391    1.192085
               9  |   .7404133    .031763    -7.01   0.000     .6807043    .8053598
              10  |   .8265251   .1373345    -1.15   0.252     .5967896    1.144698
              11  |   .8620687   .2361202    -0.54   0.588     .5039625    1.474638
              12  |   .9735216   .0880733    -0.30   0.767     .8153393    1.162392
              13  |   1.342953   .2157899     1.84   0.066     .9801381    1.840071
              14  |   .6270755   .0918477    -3.19   0.001     .4705918     .835594
              15  |   .6568717   .0447909    -6.16   0.000     .5746966     .750797
              17  |    1.06928   .0436482     1.64   0.101     .9870636    1.158344
                  |
             time |
            2000  |     1.0815   .0727019     1.17   0.244     .9479947    1.233806
            2002  |   .9454484   .0644366    -0.82   0.410     .8272267    1.080566
            2003  |    .880102   .0675001    -1.67   0.096     .7572678    1.022861
            2004  |   .8410841   .0610149    -2.39   0.017     .7296096    .9695903
            2005  |   .7435566   .0531964    -4.14   0.000     .6462736    .8554835
            2006  |   .7502242   .0580176    -3.72   0.000     .6447102    .8730067
            2007  |   .6970855    .053623    -4.69   0.000     .5995257    .8105211
            2008  |   .6345191   .0485601    -5.94   0.000     .5461372    .7372038
            2009  |   .5256155   .0439046    -7.70   0.000     .4462388    .6191116
            2010  |   .5679145   .0491313    -6.54   0.000     .4793403    .6728557
            2011  |   .6017021   .0509748    -6.00   0.000     .5096473    .7103843
            2012  |    .618055   .0549316    -5.41   0.000     .5192468    .7356655
            2013  |   .5144095   .0494101    -6.92   0.000     .4261372    .6209672
            2014  |   .4946163   .0494524    -7.04   0.000     .4065971    .6016898
            2015  |   .5401663   .0567931    -5.86   0.000     .4395741    .6637781
                  |
            _cons |   .0000172   1.13e-06  -166.79   0.000     .0000152    .0000196
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -9723.3458  
Iteration 1:   log pseudolikelihood = -8990.7106  
Iteration 2:   log pseudolikelihood = -8979.8766  
Iteration 3:   log pseudolikelihood = -8979.8704  
Iteration 4:   log pseudolikelihood = -8979.8704  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood =  -8711.386  
Iteration 1:   log pseudolikelihood = -8673.1036  
Iteration 2:   log pseudolikelihood = -8672.2764  
Iteration 3:   log pseudolikelihood = -8672.2761  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8672.2761               Pseudo R2         =     0.0323

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_ss_1lag |   .9626922   .2249463    -0.16   0.871     .6089653    1.521887
      p48_ss_1lag |   .9924926   .0237941    -0.31   0.753     .9469356    1.040241
      p71_ss_1lag |   .8044743   .1218738    -1.44   0.151     .5978048    1.082592
      p72_ss_1lag |   .9782909   .0869407    -0.25   0.805     .8219053    1.164432
      p75_ss_1lag |   1.003262   .0008525     3.83   0.000     1.001593    1.004934
      p77_ss_1lag |   1.009788   .0173739     0.57   0.571     .9763038    1.044421
        mine_time |   .9943377   .0074759    -0.76   0.450     .9797927    1.009099
onsite_insp_hours |    .999879   .0000507    -2.39   0.017     .9997796    .9999783
                  |
            state |
               1  |   1.046153   .0969303     0.49   0.626     .8724245    1.254476
               2  |   1.835929   .1052076    10.60   0.000     1.640884    2.054158
               3  |   .7269963   .1202851    -1.93   0.054       .52565    1.005467
               4  |   1.140177   .0944097     1.58   0.113     .9693721    1.341078
               5  |   .9360104   .1514518    -0.41   0.683     .6816342    1.285316
               6  |   .9531306   .0496088    -0.92   0.356     .8606941    1.055494
               7  |   .9590154   .2198178    -0.18   0.855     .6119558    1.502904
               8  |   .9712769   .0411323    -0.69   0.491      .893914    1.055335
               9  |   .7628849   .0329142    -6.27   0.000     .7010265    .8302016
              10  |   .9631141   .1426599    -0.25   0.800     .7204348     1.28754
              11  |   .8547844   .2182161    -0.61   0.539     .5182689    1.409802
              12  |   .9599187   .0874032    -0.45   0.653     .8030272    1.147463
              13  |   1.320025    .198903     1.84   0.065     .9824758    1.773545
              14  |   .6230079   .0872796    -3.38   0.001     .4734188    .8198637
              15  |   .6688785    .051739    -5.20   0.000     .5747848    .7783757
              17  |   1.072023   .0428487     1.74   0.082     .9912467    1.159382
                  |
             time |
            2000  |   1.117668   .0680999     1.83   0.068      .991856    1.259438
            2002  |   .9908276   .0601051    -0.15   0.879     .8797574     1.11592
            2003  |   .8829999   .0572288    -1.92   0.055     .7776655    1.002602
            2004  |   .8874633   .0587833    -1.80   0.071     .7794154     1.01049
            2005  |   .7814674   .0504182    -3.82   0.000     .6886422     .886805
            2006  |   .7717013   .0548324    -3.65   0.000     .6713795    .8870139
            2007  |   .7247807   .0522979    -4.46   0.000      .629197     .834885
            2008  |   .6674248   .0481408    -5.61   0.000     .5794364    .7687743
            2009  |   .5754359   .0449262    -7.08   0.000     .4937884    .6705839
            2010  |   .5870752   .0478846    -6.53   0.000     .5003405    .6888454
            2011  |   .6258015   .0506359    -5.79   0.000     .5340265    .7333486
            2012  |    .642737   .0532028    -5.34   0.000     .5464806    .7559478
            2013  |   .5615007   .0526476    -6.16   0.000     .4672396    .6747781
            2014  |   .5459824   .0521586    -6.33   0.000     .4527537    .6584083
            2015  |   .5801155   .0610552    -5.17   0.000     .4719852    .7130181
                  |
            _cons |   .0000164   1.00e-06  -180.02   0.000     .0000145    .0000185
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.522958   .0972024                     -1.713471   -1.332445
------------------+----------------------------------------------------------------
            alpha |   .2180659   .0211965                       .180239    .2638314
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.SSV.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.SSV.2.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    615.19
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622   -8979.87      36    18031.74   18274.41
        nbin |      6,253 -8961.932  -8672.276      37    17418.55   17667.96
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv2_yhat 
(option n assumed; predicted number of events)

. gen cssv2_res = dv - cssv2_yhat

. 
. summ dv cssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
  cssv2_yhat |      6,253    1.922936    2.893737    .000658   36.51684

. /*
> pause "next"
> 
> scatter dv cssv2_yhat
> 
> pause "next"
> 
> scatter cssv2_res dv
> 
> pause "next"
> 
> scatter cssv2_res cssv2_yhat
> */
. pause "complete: C.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.3
. 
. // poisson model
. glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9588.7197  
Iteration 1:   log pseudolikelihood = -8986.9135  
Iteration 2:   log pseudolikelihood = -8983.3955  
Iteration 3:   log pseudolikelihood =  -8983.393  
Iteration 4:   log pseudolikelihood =  -8983.393  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8391.920366                   (1/df) Deviance =   1.349834
Pearson          =  9323.279011                   (1/df) Pearson  =   1.499643

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.884821
Log pseudolikelihood =  -8983.39303               BIC             =  -45949.74

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_ss_c_4lag |   .9150463   .0838307    -0.97   0.333     .7646477    1.095027
    p48_ss_c_4lag |   1.004538   .0087524     0.52   0.603     .9875294     1.02184
    p71_ss_c_4lag |    .916021   .0442414    -1.82   0.069      .833287    1.006969
    p72_ss_c_4lag |   .9914221   .0206539    -0.41   0.679     .9517566    1.032741
    p75_ss_c_4lag |   1.000575   .0002257     2.55   0.011     1.000133    1.001017
    p77_ss_c_4lag |   1.004224   .0062539     0.68   0.499     .9920408    1.016556
        mine_time |   .9924027   .0089602    -0.84   0.398     .9749956    1.010121
onsite_insp_hours |    .999892   .0000523    -2.06   0.039     .9997895    .9999946
                  |
            state |
               1  |   1.091587   .0882949     1.08   0.279     .9315526    1.279114
               2  |   2.056478   .1412355    10.50   0.000     1.797484     2.35279
               3  |   .7429069   .1204195    -1.83   0.067     .5407061    1.020722
               4  |   1.258786   .1274097     2.27   0.023     1.032277    1.534996
               5  |   .9730374    .149123    -0.18   0.858     .7205739    1.313955
               6  |   1.063133   .0648266     1.00   0.315      .943374    1.198095
               7  |   1.021255   .2315319     0.09   0.926     .6548706    1.592622
               8  |   .9101858    .043578    -1.97   0.049     .8286594     .999733
               9  |   .8056824   .0396411    -4.39   0.000     .7316158    .8872472
              10  |   1.181137   .1540689     1.28   0.202     .9146789    1.525219
              11  |   .8996386   .2378845    -0.40   0.689     .5357861    1.510583
              12  |   .9498522   .0944518    -0.52   0.605     .7816528    1.154246
              13  |   1.359021   .2012923     2.07   0.038     1.016599     1.81678
              14  |   .6516703   .0876823    -3.18   0.001     .5006091    .8483151
              15  |   .6846963   .0691441    -3.75   0.000     .5617451    .8345583
              17  |   1.083677   .0469114     1.86   0.063     .9955252    1.179635
                  |
             time |
            2000  |   1.167826   .0698195     2.59   0.009     1.038695     1.31301
            2002  |   1.009346   .0559571     0.17   0.867     .9054208    1.125201
            2003  |   .8870778   .0517778    -2.05   0.040     .7911849    .9945931
            2004  |   .9101515   .0582917    -1.47   0.142     .8027817    1.031882
            2005  |   .7968841   .0493858    -3.66   0.000     .7057374    .8998026
            2006  |   .7644032   .0548502    -3.74   0.000     .6641161    .8798344
            2007  |   .7329078   .0531323    -4.29   0.000     .6358306    .8448067
            2008  |   .6885187   .0527862    -4.87   0.000     .5924575    .8001552
            2009  |   .6101081   .0494242    -6.10   0.000     .5205373    .7150918
            2010  |   .6045417   .0526188    -5.78   0.000     .5097278    .7169918
            2011  |   .6379952   .0546498    -5.25   0.000     .5393922    .7546233
            2012  |   .6640633   .0564719    -4.81   0.000     .5621126    .7845048
            2013  |    .617692   .0638013    -4.66   0.000     .5044888    .7562972
            2014  |   .6111805    .062156    -4.84   0.000     .5007302    .7459937
            2015  |   .6226139    .074937    -3.94   0.000     .4917783    .7882579
                  |
            _cons |   .0000153   9.17e-07  -184.64   0.000     .0000136    .0000172
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =   8391.92
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9323.279
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood =  -9218.625  
Iteration 1:   log pseudolikelihood = -9091.6863  
Iteration 2:   log pseudolikelihood = -9090.6106  
Iteration 3:   log pseudolikelihood = -9090.6096  
Iteration 4:   log pseudolikelihood = -9090.6096  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3867.456939                   (1/df) Deviance =   .6220777
Pearson          =   4147.19258                   (1/df) Pearson  =    .667073

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.919114
Log pseudolikelihood = -9090.609644               BIC             =   -50474.2

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_ss_c_4lag |   .9999293   .0861968    -0.00   0.999     .8444876    1.183983
    p48_ss_c_4lag |   1.001386    .009086     0.15   0.879      .983735    1.019353
    p71_ss_c_4lag |   .9553625   .0461993    -0.94   0.345     .8689723    1.050341
    p72_ss_c_4lag |   .9655719   .0297348    -1.14   0.255     .9090168    1.025646
    p75_ss_c_4lag |   1.000964   .0002389     4.04   0.000     1.000496    1.001432
    p77_ss_c_4lag |   1.003937   .0059738     0.66   0.509      .992297    1.015714
        mine_time |   .9948316   .0069738    -0.74   0.460     .9812567    1.008594
onsite_insp_hours |   .9998866   .0000489    -2.32   0.020     .9997908    .9999825
                  |
            state |
               1  |   1.004768   .1064302     0.04   0.964      .816398      1.2366
               2  |   1.634893   .0883487     9.10   0.000     1.470588    1.817556
               3  |   .7316608   .1237965    -1.85   0.065     .5251544    1.019372
               4  |    1.10293   .0874613     1.24   0.217     .9441666    1.288391
               5  |   .8976268   .1519011    -0.64   0.523      .644245    1.250664
               6  |   .8905646   .0440819    -2.34   0.019     .8082244    .9812933
               7  |   .9107771   .2082547    -0.41   0.683     .5818081    1.425754
               8  |   1.098993   .0440601     2.35   0.019     1.015942    1.188832
               9  |   .7429889   .0324468    -6.80   0.000       .68204    .8093844
              10  |   .8258176   .1380996    -1.14   0.252     .5950311    1.146116
              11  |   .8664996   .2351996    -0.53   0.598      .509004     1.47508
              12  |    .971443   .0875942    -0.32   0.748     .8140764     1.15923
              13  |    1.34259   .2155432     1.84   0.067     .9801426    1.839068
              14  |   .6350438   .0957795    -3.01   0.003     .4725225    .8534633
              15  |   .6559698   .0446792    -6.19   0.000     .5739937    .7496535
              17  |   1.058697   .0433034     1.39   0.163      .977137    1.147065
                  |
             time |
            2000  |   1.111534   .0753626     1.56   0.119     .9732191    1.269505
            2002  |   .9393168   .0635881    -0.92   0.355     .8226006    1.072593
            2003  |   .8794536   .0672862    -1.68   0.093     .7569868    1.021733
            2004  |   .8431087   .0611485    -2.35   0.019     .7313884    .9718943
            2005  |   .7434357    .053083    -4.15   0.000     .6463469    .8551083
            2006  |   .7576379   .0586994    -3.58   0.000     .6508985    .8818812
            2007  |   .6972462   .0536993    -4.68   0.000     .5995561    .8108537
            2008  |   .6353686   .0485547    -5.93   0.000     .5469872    .7380305
            2009  |   .5241538   .0437747    -7.73   0.000      .445011    .6173717
            2010  |   .5696954   .0491632    -6.52   0.000     .4810457    .6746821
            2011  |   .5999719   .0508044    -6.03   0.000     .5082213    .7082865
            2012  |   .6157266   .0545485    -5.47   0.000     .5175808    .7324831
            2013  |   .5129413    .049138    -6.97   0.000     .4251338    .6188848
            2014  |   .4945589   .0495443    -7.03   0.000     .4063925     .601853
            2015  |   .5371093   .0563574    -5.92   0.000     .4372688    .6597461
                  |
            _cons |   .0000174   1.14e-06  -167.46   0.000     .0000153    .0000197
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -9730.5803  
Iteration 1:   log pseudolikelihood =  -8993.863  
Iteration 2:   log pseudolikelihood =  -8983.399  
Iteration 3:   log pseudolikelihood =  -8983.393  
Iteration 4:   log pseudolikelihood =  -8983.393  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8713.9928  
Iteration 1:   log pseudolikelihood = -8675.7173  
Iteration 2:   log pseudolikelihood = -8674.8944  
Iteration 3:   log pseudolikelihood = -8674.8941  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8674.8941               Pseudo R2         =     0.0320

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_ss_c_4lag |   .9665738   .0986631    -0.33   0.739     .7913134    1.180651
    p48_ss_c_4lag |   1.001808   .0087917     0.21   0.837     .9847243    1.019189
    p71_ss_c_4lag |    .930945   .0476814    -1.40   0.162     .8420288    1.029251
    p72_ss_c_4lag |   .9781477   .0270489    -0.80   0.424     .9265439    1.032625
    p75_ss_c_4lag |   1.000785   .0002293     3.43   0.001     1.000336    1.001235
    p77_ss_c_4lag |   1.002777   .0056725     0.49   0.624     .9917209    1.013957
        mine_time |   .9935959   .0073669    -0.87   0.386     .9792614     1.00814
onsite_insp_hours |   .9998842   .0000502    -2.30   0.021     .9997858    .9999827
                  |
            state |
               1  |   1.040817    .096371     0.43   0.666     .8680814    1.247926
               2  |   1.845731   .1054893    10.72   0.000     1.650136    2.064511
               3  |   .7283133   .1227536    -1.88   0.060     .5234225    1.013407
               4  |   1.140305   .0941039     1.59   0.112     .9700079    1.340499
               5  |   .9304445    .150403    -0.45   0.656     .6777926    1.277274
               6  |   .9515952   .0494256    -0.96   0.339     .8594906     1.05357
               7  |    .957214   .2193211    -0.19   0.849     .6109111    1.499823
               8  |   .9676493    .041896    -0.76   0.448     .8889223    1.053349
               9  |   .7639186   .0332347    -6.19   0.000     .7014797    .8319152
              10  |   .9614116   .1438574    -0.26   0.793     .7170392    1.289068
              11  |   .8594178   .2182015    -0.60   0.551     .5225032    1.413578
              12  |   .9590774   .0869979    -0.46   0.645     .8028625    1.145687
              13  |   1.320578   .1991421     1.84   0.065      .982661    1.774699
              14  |    .627704   .0894792    -3.27   0.001     .4746965    .8300297
              15  |     .66791    .051598    -5.22   0.000     .5740638     .777098
              17  |   1.060829   .0427615     1.46   0.143     .9802429    1.148039
                  |
             time |
            2000  |   1.148406   .0715312     2.22   0.026     1.016427    1.297522
            2002  |   .9849637   .0592658    -0.25   0.801     .8753928    1.108249
            2003  |   .8830899   .0571801    -1.92   0.055     .7778388    1.002583
            2004  |    .890783    .059048    -1.74   0.081     .7822538    1.014369
            2005  |   .7816026   .0501131    -3.84   0.000     .6893036    .8862606
            2006  |   .7783244   .0554882    -3.52   0.000     .6768259     .895044
            2007  |   .7238965   .0523902    -4.46   0.000     .6281638     .834219
            2008  |   .6680231   .0481138    -5.60   0.000     .5800754    .7693049
            2009  |   .5731816   .0447747    -7.12   0.000     .4918127    .6680128
            2010  |   .5885455   .0477519    -6.53   0.000     .5020158    .6899898
            2011  |    .623597   .0505211    -5.83   0.000     .5320389    .7309113
            2012  |   .6402445   .0528333    -5.40   0.000     .5446333    .7526403
            2013  |    .560265    .052402    -6.19   0.000      .466423    .6729875
            2014  |   .5462661   .0523501    -6.31   0.000     .4527218     .659139
            2015  |   .5761507   .0603129    -5.27   0.000      .469278    .7073625
                  |
            _cons |   .0000165   1.01e-06  -180.44   0.000     .0000146    .0000186
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.520954   .0970683                     -1.711204   -1.330704
------------------+----------------------------------------------------------------
            alpha |   .2185033   .0212098                      .1806481    .2642913
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.SSV.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.SSV.3.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    617.00
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8983.393      36    18038.79   18281.46
        nbin |      6,253 -8961.932  -8674.894      37    17423.79    17673.2
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv3_yhat 
(option n assumed; predicted number of events)

. gen cssv3_res = dv - cssv3_yhat

. 
. summ dv cssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
  cssv3_yhat |      6,253    1.921747    2.883544     .00066   35.47914

. /*
> pause "next"
> 
> scatter dv cssv3_yhat
> 
> pause "next"
> 
> scatter cssv3_res dv
> 
> pause "next"
> 
> scatter cssv3_res cssv3_yhat
> */
. pause "complete: C.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.4
. 
. // poisson model
. glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9593.1526  
Iteration 1:   log pseudolikelihood = -9002.9251  
Iteration 2:   log pseudolikelihood = -8999.6297  
Iteration 3:   log pseudolikelihood = -8999.6274  
Iteration 4:   log pseudolikelihood = -8999.6274  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8424.389029                   (1/df) Deviance =   1.355057
Pearson          =  9319.950141                   (1/df) Pearson  =   1.499107

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.890014
Log pseudolikelihood = -8999.627361               BIC             =  -45917.27

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_ss_c_lag_all |   .9682217   .0263726    -1.19   0.236     .9178879    1.021316
 p48_ss_c_lag_all |   1.003758   .0038307     0.98   0.326     .9962779    1.011294
 p71_ss_c_lag_all |   .9751756   .0216839    -1.13   0.258     .9335888    1.018615
 p72_ss_c_lag_all |   1.006506   .0127133     0.51   0.608     .9818939    1.031734
 p75_ss_c_lag_all |   1.000017   .0000438     0.39   0.698     .9999311    1.000103
 p77_ss_c_lag_all |    1.00145   .0015465     0.94   0.348     .9984239    1.004486
        mine_time |   .9885552   .0087283    -1.30   0.192     .9715952    1.005811
onsite_insp_hours |   .9999274   .0000513    -1.42   0.157     .9998268    1.000028
                  |
            state |
               1  |   1.086226   .0870752     1.03   0.302     .9282937    1.271028
               2  |   2.164473   .1328406    12.58   0.000      1.91916    2.441142
               3  |   .6972195   .1213848    -2.07   0.038     .4956519     .980759
               4  |   1.219996   .1093708     2.22   0.027      1.02341    1.454345
               5  |   .9339191   .1447251    -0.44   0.659     .6892909    1.265365
               6  |   1.046096   .0637708     0.74   0.460     .9282859    1.178858
               7  |   1.032335   .2273806     0.14   0.885     .6704034    1.589663
               8  |    .909627   .0504709    -1.71   0.088     .8158949    1.014127
               9  |   .7652447   .0428375    -4.78   0.000     .6857268    .8539837
              10  |   1.125549   .1851355     0.72   0.472     .8153706    1.553725
              11  |   .8965117   .2235175    -0.44   0.661     .5499651    1.461426
              12  |   .9408007   .0851212    -0.67   0.500     .7879219    1.123342
              13  |    1.32284    .195526     1.89   0.058      .990132    1.767346
              14  |   .6253372   .0853518    -3.44   0.001     .4785578    .8171357
              15  |   .6723568   .0688439    -3.88   0.000     .5501026    .8217808
              17  |   .9947656    .082285    -0.06   0.949     .8458845    1.169851
                  |
             time |
            2000  |   1.106693   .0662106     1.69   0.090     .9842417    1.244378
            2002  |   1.004709   .0553669     0.09   0.932     .9018471    1.119304
            2003  |   .8851613   .0528897    -2.04   0.041     .7873391    .9951372
            2004  |   .9129831   .0575296    -1.44   0.149      .806912    1.032998
            2005  |   .8067121    .048989    -3.54   0.000     .7161893    .9086765
            2006  |     .77245    .054888    -3.63   0.000     .6720267    .8878799
            2007  |   .7368769   .0533359    -4.22   0.000      .639417    .8491917
            2008  |   .6786793   .0515875    -5.10   0.000     .5847408    .7877089
            2009  |   .5953409   .0489045    -6.31   0.000      .506808    .6993394
            2010  |    .579642   .0522478    -6.05   0.000     .4857739    .6916487
            2011  |   .6112457   .0528038    -5.70   0.000     .5160394    .7240169
            2012  |    .629893   .0538657    -5.40   0.000     .5326915    .7448312
            2013  |   .5846042   .0588257    -5.33   0.000     .4799653    .7120557
            2014  |   .5785983   .0602625    -5.25   0.000     .4717613      .70963
            2015  |   .5874605    .070196    -4.45   0.000     .4648022    .7424876
                  |
            _cons |   .0000163   1.01e-06  -177.76   0.000     .0000144    .0000184
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8424.389
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =   9319.95
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9229.1491  
Iteration 1:   log pseudolikelihood = -9098.2743  
Iteration 2:   log pseudolikelihood = -9097.0624  
Iteration 3:   log pseudolikelihood = -9097.0622  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3880.361958                   (1/df) Deviance =   .6241534
Pearson          =  4159.641645                   (1/df) Pearson  =   .6690754

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.921178
Log pseudolikelihood = -9097.062154               BIC             =   -50461.3

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_ss_c_lag_all |   .9991251   .0429527    -0.02   0.984     .9183885    1.086959
 p48_ss_c_lag_all |   1.004553   .0041907     1.09   0.276     .9963723      1.0128
 p71_ss_c_lag_all |   .9895225   .0237499    -0.44   0.661     .9440514    1.037184
 p72_ss_c_lag_all |   .9867865   .0113188    -1.16   0.246     .9648496    1.009222
 p75_ss_c_lag_all |    1.00001   .0000417     0.25   0.805     .9999286    1.000092
 p77_ss_c_lag_all |   1.001766   .0017952     0.98   0.325     .9982534     1.00529
        mine_time |   .9939105   .0079285    -0.77   0.444     .9784917    1.009572
onsite_insp_hours |   .9999551   .0000415    -1.08   0.279     .9998738    1.000036
                  |
            state |
               1  |   .9977555   .1085804    -0.02   0.984     .8061064    1.234968
               2  |   1.713656   .0913754    10.10   0.000     1.543604    1.902441
               3  |   .7174247   .1346877    -1.77   0.077     .4965622    1.036523
               4  |   1.077023      .0825     0.97   0.333     .9268786    1.251489
               5  |   .8493188   .1425011    -0.97   0.330      .611299    1.180016
               6  |   .8829813   .0446099    -2.46   0.014     .7997371    .9748904
               7  |   .9347814   .2104761    -0.30   0.765      .601247     1.45334
               8  |   1.057142    .043778     1.34   0.180     .9747287    1.146524
               9  |   .7363145   .0390793    -5.77   0.000     .6635696    .8170341
              10  |   .7839583   .1338077    -1.43   0.154     .5610584    1.095413
              11  |   .8733972   .2273967    -0.52   0.603      .524317    1.454888
              12  |   .9425069   .0841041    -0.66   0.507      .791276    1.122641
              13  |   1.322159   .2137746     1.73   0.084     .9630665    1.815144
              14  |   .6264254   .0968357    -3.03   0.002     .4626865    .8481095
              15  |   .6559858   .0450104    -6.14   0.000     .5734418    .7504117
              17  |   .9401458   .0655343    -0.89   0.376     .8200889    1.077778
                  |
             time |
            2000  |   1.056842   .0699794     0.83   0.404     .9282125    1.203298
            2002  |   .9363354   .0627552    -0.98   0.326     .8210736    1.067778
            2003  |   .8694833     .06565    -1.85   0.064     .7498796    1.008163
            2004  |   .8361718   .0598448    -2.50   0.012     .7267332    .9620908
            2005  |   .7356131   .0518509    -4.36   0.000     .6406948    .8445936
            2006  |   .7586367   .0576024    -3.64   0.000      .653737    .8803687
            2007  |   .7007853   .0540001    -4.61   0.000     .6025516    .8150339
            2008  |   .6277911   .0476318    -6.14   0.000     .5410442    .7284463
            2009  |   .5145048   .0429535    -7.96   0.000     .4368444    .6059714
            2010  |   .5507661   .0472319    -6.96   0.000     .4655549    .6515736
            2011  |   .5784134   .0485018    -6.53   0.000     .4907524     .681733
            2012  |   .5830836   .0514899    -6.11   0.000     .4904158    .6932616
            2013  |   .4797797   .0455759    -7.73   0.000     .3982753    .5779635
            2014  |   .4604062   .0461331    -7.74   0.000      .378312     .560315
            2015  |    .495888   .0516278    -6.74   0.000     .4043556    .6081401
                  |
            _cons |   .0000183   1.22e-06  -163.90   0.000      .000016    .0000208
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -9875.5345  
Iteration 1:   log pseudolikelihood = -9012.3275  
Iteration 2:   log pseudolikelihood = -8999.6356  
Iteration 3:   log pseudolikelihood = -8999.6274  
Iteration 4:   log pseudolikelihood = -8999.6274  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8721.4541  
Iteration 1:   log pseudolikelihood = -8686.9716  
Iteration 2:   log pseudolikelihood = -8686.3457  
Iteration 3:   log pseudolikelihood = -8686.3455  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8686.3455               Pseudo R2         =     0.0308

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_ss_c_lag_all |   .9857454   .0369769    -0.38   0.702     .9158721    1.060949
 p48_ss_c_lag_all |   1.004444   .0040224     1.11   0.268     .9965908    1.012358
 p71_ss_c_lag_all |   .9840016   .0239586    -0.66   0.508     .9381465    1.032098
 p72_ss_c_lag_all |   .9954778   .0117887    -0.38   0.702     .9726385    1.018853
 p75_ss_c_lag_all |   1.000018   .0000425     0.43   0.668     .9999349    1.000102
 p77_ss_c_lag_all |   1.001357   .0016863     0.81   0.421     .9980578    1.004668
        mine_time |   .9909813   .0079698    -1.13   0.260     .9754832    1.006726
onsite_insp_hours |   .9999356   .0000436    -1.48   0.140     .9998501    1.000021
                  |
            state |
               1  |    1.02258    .092585     0.25   0.805     .8563058     1.22114
               2  |   1.931064   .1068812    11.89   0.000     1.732543    2.152332
               3  |   .7010605   .1320625    -1.89   0.059     .4846298    1.014147
               4  |   1.110518   .0850714     1.37   0.171     .9556948    1.290423
               5  |   .8836614   .1427595    -0.77   0.444     .6438288    1.212834
               6  |   .9388927   .0495093    -1.20   0.232     .8467023    1.041121
               7  |   .9760654   .2184556    -0.11   0.914     .6294618    1.513521
               8  |   .9459949   .0457349    -1.15   0.251      .860472    1.040018
               9  |   .7432362    .039449    -5.59   0.000     .6698033    .8247197
              10  |   .9079402   .1456152    -0.60   0.547     .6630432    1.243291
              11  |   .8627273   .2060407    -0.62   0.536     .5402385    1.377722
              12  |   .9370492   .0822789    -0.74   0.459     .7888992    1.113021
              13  |   1.290634    .195313     1.69   0.092      .959378    1.736266
              14  |     .61143   .0896093    -3.36   0.001     .4587724    .8148848
              15  |   .6636115   .0514838    -5.29   0.000     .5700023    .7725938
              17  |   .9520689   .0706214    -0.66   0.508     .8232448    1.101052
                  |
             time |
            2000  |   1.089488    .065293     1.43   0.153      .968746    1.225279
            2002  |   .9815559   .0587703    -0.31   0.756     .8728702    1.103775
            2003  |   .8759204   .0561797    -2.07   0.039       .77245    .9932507
            2004  |   .8841706   .0575714    -1.89   0.059     .7782363    1.004525
            2005  |   .7776275   .0491552    -3.98   0.000     .6870141    .8801924
            2006  |   .7807098   .0544962    -3.55   0.000     .6808835    .8951718
            2007  |   .7269181   .0523885    -4.43   0.000     .6311607    .8372035
            2008  |   .6594025   .0469269    -5.85   0.000     .5735538     .758101
            2009  |   .5612717    .043647    -7.43   0.000     .4819255    .6536817
            2010  |   .5674271   .0456262    -7.05   0.000      .484692    .6642847
            2011  |   .5988446   .0476577    -6.44   0.000     .5123575    .6999308
            2012  |   .6053212   .0491935    -6.18   0.000     .5161906    .7098419
            2013  |   .5265903   .0483791    -6.98   0.000     .4398159     .630485
            2014  |   .5122116   .0490451    -6.99   0.000     .4245662      .61795
            2015  |   .5358617   .0551745    -6.06   0.000     .4379349    .6556859
                  |
            _cons |   .0000175   1.08e-06  -178.05   0.000     .0000155    .0000197
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.507912   .0949908                     -1.694091   -1.321733
------------------+----------------------------------------------------------------
            alpha |   .2213717   .0210283                      .1837663    .2666726
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.SSV.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.SSV.4.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    626.56
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8999.627      36    18071.25   18313.92
        nbin |      6,253 -8961.932  -8686.346      37    17446.69    17696.1
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv4_yhat 
(option n assumed; predicted number of events)

. gen cssv4_res = dv - cssv4_yhat

. 
. summ dv cssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
  cssv4_yhat |      6,253    1.914518    2.818447   .0006567   23.66237

. /*
> pause "next"
> 
> scatter dv cssv4_yhat
> 
> pause "next"
> 
> scatter cssv4_res dv
> 
> pause "next"
> 
> scatter cssv4_res cssv4_yhat
> */
. pause "complete: C.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.1
. 
. // poisson model
. glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9566.6197  
Iteration 1:   log pseudolikelihood = -8983.6905  
Iteration 2:   log pseudolikelihood = -8980.6137  
Iteration 3:   log pseudolikelihood = -8980.6119  
Iteration 4:   log pseudolikelihood = -8980.6119  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8386.358168                   (1/df) Deviance =    1.34894
Pearson          =  9274.682098                   (1/df) Pearson  =   1.491826

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.883932
Log pseudolikelihood = -8980.611931               BIC             =   -45955.3

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_pp |   .9984964    .001195    -1.26   0.209      .996157    1.000841
           p48_pp |   1.000181   .0001263     1.43   0.153      .999933    1.000428
           p71_pp |   .9997396   .0006442    -0.40   0.686     .9984778    1.001003
           p72_pp |   .9997172   .0004958    -0.57   0.568      .998746    1.000689
           p75_pp |   1.000013   3.84e-06     3.47   0.001     1.000006    1.000021
           p77_pp |    .999951   .0001092    -0.45   0.654      .999737    1.000165
        mine_time |   .9908508   .0086913    -1.05   0.295     .9739618    1.008033
onsite_insp_hours |   .9998765   .0000579    -2.13   0.033      .999763      .99999
                  |
            state |
               1  |   1.184151   .1022847     1.96   0.050     .9997278    1.402595
               2  |   2.198404   .1377034    12.58   0.000      1.94442    2.485564
               3  |   .7513329    .121123    -1.77   0.076     .5477842    1.030517
               4  |   1.236386   .1269285     2.07   0.039     1.011041    1.511956
               5  |   .9649388   .1530694    -0.22   0.822     .7070866    1.316822
               6  |   1.065603   .0661298     1.02   0.306     .9435631    1.203427
               7  |   1.041455   .2377373     0.18   0.859      .665784    1.629101
               8  |   .9730119   .0523917    -0.51   0.611     .8755588    1.081312
               9  |   .8215105   .0416946    -3.87   0.000     .7437236    .9074331
              10  |   1.224853    .162556     1.53   0.126     .9443148    1.588733
              11  |   .9176555   .2315364    -0.34   0.733     .5596422    1.504696
              12  |   .9965179   .1045077    -0.03   0.973     .8113666     1.22392
              13  |   1.361071   .1985772     2.11   0.035     1.022569    1.811629
              14  |    .659824    .085345    -3.21   0.001     .5120701    .8502112
              15  |   .6999157   .0635127    -3.93   0.000     .5858747    .8361547
              17  |   1.123169   .0565748     2.31   0.021     1.017582    1.239712
                  |
             time |
            2000  |   1.103636   .0656902     1.66   0.098     .9821123    1.240198
            2002  |   1.009719   .0562653     0.17   0.862     .9052499    1.126245
            2003  |   .8889814   .0526565    -1.99   0.047      .791542    .9984157
            2004  |   .9170434   .0591002    -1.34   0.179     .8082262    1.040511
            2005  |   .8231332   .0504174    -3.18   0.001     .7300178    .9281256
            2006  |   .7817577   .0564777    -3.41   0.001     .6785432    .9006724
            2007  |   .6895442    .052648    -4.87   0.000     .5937058    .8008532
            2008  |   .6188325   .0486693    -6.10   0.000     .5304308    .7219673
            2009  |   .5556998    .044241    -7.38   0.000     .4754155    .6495417
            2010  |   .5482376   .0492984    -6.68   0.000     .4596503    .6538983
            2011  |   .5777408   .0506204    -6.26   0.000     .4865781    .6859832
            2012  |   .6036305   .0522855    -5.83   0.000     .5093795    .7153209
            2013  |   .5627975   .0586508    -5.52   0.000     .4588238    .6903325
            2014  |   .5494993   .0564349    -5.83   0.000     .4493107    .6720283
            2015  |     .56368   .0681841    -4.74   0.000     .4447021    .7144899
                  |
            _cons |   .0000162   9.89e-07  -180.64   0.000     .0000144    .0000183
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `pp_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8386.358
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9274.682
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9220.7176  
Iteration 1:   log pseudolikelihood = -9093.7123  
Iteration 2:   log pseudolikelihood = -9092.6118  
Iteration 3:   log pseudolikelihood = -9092.6117  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3871.461094                   (1/df) Deviance =   .6227217
Pearson          =  4156.244162                   (1/df) Pearson  =   .6685289

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.919754
Log pseudolikelihood = -9092.611722               BIC             =   -50470.2

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_pp |   .9994528   .0010861    -0.50   0.614     .9973264    1.001584
           p48_pp |   1.000205   .0001739     1.18   0.238     .9998646    1.000546
           p71_pp |   1.000376    .000731     0.51   0.607     .9989446     1.00181
           p72_pp |   .9993288   .0005257    -1.28   0.202     .9982991     1.00036
           p75_pp |   1.000017   4.51e-06     3.69   0.000     1.000008    1.000025
           p77_pp |   .9999621   .0001328    -0.29   0.776     .9997019    1.000222
        mine_time |   .9943168   .0068752    -0.82   0.410     .9809325    1.007884
onsite_insp_hours |   .9998839   .0000491    -2.37   0.018     .9997878    .9999801
                  |
            state |
               1  |   1.086891   .1148178     0.79   0.430     .8836208    1.336921
               2  |   1.715131   .0877603    10.54   0.000     1.551468    1.896059
               3  |   .7333131   .1237127    -1.84   0.066     .5268519    1.020682
               4  |   1.086587   .0889007     1.01   0.310      .925598    1.275578
               5  |    .873184   .1473479    -0.80   0.422     .6272886     1.21547
               6  |   .8945009   .0449678    -2.22   0.027     .8105685    .9871244
               7  |   .9276604   .2155453    -0.32   0.747     .5883141    1.462746
               8  |   1.111731   .0522391     2.25   0.024     1.013917     1.21898
               9  |   .7454833   .0353549    -6.19   0.000      .679312    .8181004
              10  |   .8545426   .1483182    -0.91   0.365     .6081286    1.200804
              11  |   .8876014   .2345897    -0.45   0.652      .528748    1.490004
              12  |   .9877138   .0871632    -0.14   0.889     .8308349    1.174215
              13  |   1.330139   .2123767     1.79   0.074     .9727247     1.81888
              14  |   .6373932   .0922062    -3.11   0.002     .4800332    .8463373
              15  |   .6631566   .0444498    -6.13   0.000     .5815165    .7562582
              17  |   1.048122   .0490582     1.00   0.315     .9562483    1.148823
                  |
             time |
            2000  |   1.053087   .0691583     0.79   0.431     .9259005    1.197745
            2002  |   .9448192   .0631596    -0.85   0.396     .8287954    1.077085
            2003  |   .8775183   .0660214    -1.74   0.082     .7572074    1.016945
            2004  |   .8473811   .0606827    -2.31   0.021     .7364148    .9750683
            2005  |   .7504653   .0531223    -4.06   0.000     .6532472    .8621516
            2006  |   .7673391   .0585825    -3.47   0.001     .6606969    .8911942
            2007  |   .6701991   .0522806    -5.13   0.000     .5751799    .7809153
            2008  |   .5843874    .045095    -6.96   0.000      .502362    .6798058
            2009  |   .4797808   .0403269    -8.74   0.000     .4069088    .5657033
            2010  |   .5215336    .045177    -7.52   0.000      .440097    .6180395
            2011  |    .553625   .0466585    -7.02   0.000     .4693296    .6530606
            2012  |   .5618165   .0490231    -6.61   0.000     .4735002    .6666054
            2013  |   .4677277   .0444678    -7.99   0.000      .388211    .5635319
            2014  |    .446355   .0446133    -8.07   0.000     .3669464     .542948
            2015  |   .4860453   .0498909    -7.03   0.000     .3974695    .5943602
                  |
            _cons |   .0000184   1.18e-06  -169.19   0.000     .0000162    .0000208
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -9373.0172  
Iteration 1:   log pseudolikelihood = -8983.5022  
Iteration 2:   log pseudolikelihood = -8980.6144  
Iteration 3:   log pseudolikelihood = -8980.6119  
Iteration 4:   log pseudolikelihood = -8980.6119  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8712.3912  
Iteration 1:   log pseudolikelihood = -8676.3838  
Iteration 2:   log pseudolikelihood = -8675.6395  
Iteration 3:   log pseudolikelihood = -8675.6393  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8675.6393               Pseudo R2         =     0.0319

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_pp |   .9991286   .0011242    -0.77   0.438     .9969276    1.001334
           p48_pp |   1.000159   .0001341     1.18   0.236      .999896    1.000422
           p71_pp |   .9999894   .0005954    -0.02   0.986     .9988231    1.001157
           p72_pp |   .9994202   .0004686    -1.24   0.216     .9985022    1.000339
           p75_pp |   1.000016   4.20e-06     3.70   0.000     1.000007    1.000024
           p77_pp |    .999935   .0001219    -0.53   0.594     .9996961    1.000174
        mine_time |   .9924105   .0071947    -1.05   0.293      .978409    1.006612
onsite_insp_hours |   .9998755    .000051    -2.44   0.015     .9997755    .9999755
                  |
            state |
               1  |   1.123908   .1066884     1.23   0.218     .9331022     1.35373
               2  |    1.95272   .1037899    12.59   0.000     1.759533    2.167118
               3  |    .735527   .1241415    -1.82   0.069     .5283646    1.023914
               4  |   1.124705   .0951174     1.39   0.165     .9529092    1.327472
               5  |   .9115025   .1494891    -0.56   0.572     .6609343    1.257064
               6  |   .9542457   .0502208    -0.89   0.374     .8607213    1.057932
               7  |    .975744   .2256217    -0.11   0.915      .620172    1.535181
               8  |   1.014327   .0518744     0.28   0.781     .9175844    1.121269
               9  |   .7774896   .0352087    -5.56   0.000     .7114556    .8496525
              10  |   .9970704   .1542836    -0.02   0.985       .73623    1.350324
              11  |   .8786146   .2138319    -0.53   0.595     .5453033    1.415659
              12  |    .991572   .0883157    -0.10   0.924     .8327427    1.180695
              13  |   1.313465   .1960264     1.83   0.068     .9803517    1.759766
              14  |   .6336051   .0861983    -3.35   0.001     .4853082    .8272175
              15  |   .6780803   .0493385    -5.34   0.000     .5879576     .782017
              17  |   1.076116   .0503789     1.57   0.117     .9817695    1.179528
                  |
             time |
            2000  |   1.085864   .0644139     1.39   0.165     .9666783    1.219745
            2002  |   .9899263   .0592585    -0.17   0.866     .8803364    1.113159
            2003  |   .8829397   .0564399    -1.95   0.051     .7789687    1.000788
            2004  |   .8941455   .0586226    -1.71   0.088     .7863232    1.016753
            2005  |   .7943166   .0505787    -3.62   0.000     .7011206    .8999007
            2006  |   .7892399   .0556173    -3.36   0.001     .6874251    .9061346
            2007  |   .6908324   .0510931    -5.00   0.000     .5976115    .7985948
            2008  |   .6093639   .0446242    -6.76   0.000      .527889    .7034137
            2009  |   .5242161   .0408401    -8.29   0.000     .4499827    .6106957
            2010  |   .5357474   .0441071    -7.58   0.000     .4559132    .6295612
            2011  |   .5706396   .0457062    -7.00   0.000     .4877347    .6676365
            2012  |   .5813583   .0470303    -6.70   0.000     .4961169    .6812457
            2013  |   .5108431   .0472561    -7.26   0.000     .4261339    .6123911
            2014  |   .4924984   .0469963    -7.42   0.000     .4084882    .5937862
            2015  |   .5211747   .0534515    -6.35   0.000     .4262696    .6372097
                  |
            _cons |   .0000175   1.04e-06  -183.15   0.000     .0000155    .0000196
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |   -1.52639   .0958399                     -1.714233   -1.338548
------------------+----------------------------------------------------------------
            alpha |   .2173187   .0208278                      .1801018    .2622263
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.PP.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.PP.1.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    609.95
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8980.612      36    18033.22   18275.89
        nbin |      6,253 -8961.932  -8675.639      37    17425.28   17674.69
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp1_yhat 
(option n assumed; predicted number of events)

. gen cpp1_res = dv - cpp1_yhat

. 
. summ dv cpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
   cpp1_yhat |      6,253      1.9146    2.835453   .0006369   30.91517

. /*
> pause "next"
> 
> scatter dv cpp1_yhat
> 
> pause "next"
> 
> scatter cpp1_res dv
> 
> pause "next"
> 
> scatter cpp1_res cpp1_yhat
> */
. pause "complete: C.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.2
. 
. // poisson model
. glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9566.8457  
Iteration 1:   log pseudolikelihood = -8984.0812  
Iteration 2:   log pseudolikelihood = -8980.9903  
Iteration 3:   log pseudolikelihood = -8980.9885  
Iteration 4:   log pseudolikelihood = -8980.9885  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8387.111355                   (1/df) Deviance =   1.349061
Pearson          =  9283.555368                   (1/df) Pearson  =   1.493253

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.884052
Log pseudolikelihood = -8980.988524               BIC             =  -45954.55

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_pp_1lag |   .9985248   .0008767    -1.68   0.093      .996808    1.000245
      p48_pp_1lag |   1.000165   .0001237     1.33   0.183     .9999224    1.000407
      p71_pp_1lag |   .9987566   .0008483    -1.46   0.143     .9970953    1.000421
      p72_pp_1lag |   .9995979    .000476    -0.84   0.398     .9986655    1.000531
      p75_pp_1lag |   1.000013   3.85e-06     3.34   0.001     1.000005     1.00002
      p77_pp_1lag |   .9999654   .0000968    -0.36   0.721     .9997758    1.000155
        mine_time |   .9904705   .0085958    -1.10   0.270     .9737656    1.007462
onsite_insp_hours |   .9998828    .000057    -2.06   0.040      .999771    .9999946
                  |
            state |
               1  |   1.177865    .100508     1.92   0.055     .9964642    1.392288
               2  |   2.193237   .1363091    12.64   0.000     1.941707    2.477351
               3  |   .7482165    .119696    -1.81   0.070     .5468349     1.02376
               4  |   1.237855   .1316568     2.01   0.045     1.004933    1.524764
               5  |   .9623718   .1521042    -0.24   0.808     .7060074    1.311827
               6  |   1.062662   .0657408     0.98   0.326     .9413172    1.199648
               7  |   1.038233   .2357615     0.17   0.869     .6652802    1.620262
               8  |   .9647134   .0496137    -0.70   0.485     .8722127    1.067024
               9  |   .8369039   .0446975    -3.33   0.001     .7537277    .9292589
              10  |   1.224773   .1658173     1.50   0.134     .9393225    1.596969
              11  |     .91546   .2298669    -0.35   0.725     .5596383    1.497516
              12  |   .9932759   .1036435    -0.06   0.948      .809564    1.218677
              13  |   1.357645   .1986471     2.09   0.037     1.019156    1.808555
              14  |   .6580032   .0854208    -3.22   0.001     .5101837    .8486516
              15  |    .697175   .0642213    -3.92   0.000     .5820123    .8351249
              17  |   1.122329   .0537603     2.41   0.016     1.021756    1.232802
                  |
             time |
            2000  |   1.106704   .0658506     1.70   0.088     .9848806    1.243596
            2002  |   1.009665   .0561883     0.17   0.863     .9053312    1.126022
            2003  |   .8896384   .0527126    -1.97   0.048      .792097    .9991913
            2004  |   .9205397   .0589772    -1.29   0.196     .8119097    1.043704
            2005  |    .820616   .0503712    -3.22   0.001     .7275978    .9255259
            2006  |   .7842507   .0565796    -3.37   0.001     .6808402     .903368
            2007  |   .7182422   .0525585    -4.52   0.000     .6222758    .8290084
            2008  |   .6195564   .0495493    -5.99   0.000     .5296704    .7246963
            2009  |   .5561353   .0437868    -7.45   0.000     .4766086    .6489318
            2010  |   .5507935   .0494277    -6.65   0.000     .4619583    .6567117
            2011  |   .5817473   .0504042    -6.25   0.000     .4908896    .6894216
            2012  |   .6013781   .0519962    -5.88   0.000     .5076345     .712433
            2013  |   .5625589   .0574225    -5.64   0.000     .4605561    .6871529
            2014  |   .5539674   .0561516    -5.83   0.000     .4541551    .6757161
            2015  |    .565375   .0688691    -4.68   0.000     .4452978    .7178317
                  |
            _cons |   .0000162   9.90e-07  -180.48   0.000     .0000144    .0000183
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8387.111
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9283.555
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9221.1942  
Iteration 1:   log pseudolikelihood = -9094.3474  
Iteration 2:   log pseudolikelihood = -9093.2497  
Iteration 3:   log pseudolikelihood = -9093.2496  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3872.736853                   (1/df) Deviance =    .622927
Pearson          =  4162.241643                   (1/df) Pearson  =   .6694936

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.919958
Log pseudolikelihood = -9093.249601               BIC             =  -50468.92

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_pp_1lag |   .9994421   .0010294    -0.54   0.588     .9974266    1.001462
      p48_pp_1lag |   1.000163   .0001463     1.11   0.266     .9998759    1.000449
      p71_pp_1lag |    1.00018   .0009942     0.18   0.857     .9982331     1.00213
      p72_pp_1lag |   .9995448   .0005948    -0.77   0.444     .9983797    1.000711
      p75_pp_1lag |   1.000016   4.40e-06     3.64   0.000     1.000007    1.000025
      p77_pp_1lag |    .999973   .0001093    -0.25   0.805     .9997588    1.000187
        mine_time |   .9938144   .0068994    -0.89   0.371     .9803834    1.007429
onsite_insp_hours |   .9998902   .0000485    -2.26   0.024     .9997951    .9999853
                  |
            state |
               1  |   1.082963   .1144298     0.75   0.451     .8803848    1.332154
               2  |    1.71358   .0864904    10.67   0.000     1.552177    1.891766
               3  |   .7282754   .1214431    -1.90   0.057     .5252355    1.009804
               4  |   1.083657    .087726     0.99   0.321     .9246638    1.269988
               5  |    .872445   .1464092    -0.81   0.416     .6279048    1.212222
               6  |   .8928193   .0448926    -2.25   0.024      .809028    .9852889
               7  |    .924113   .2154584    -0.34   0.735     .5851485    1.459433
               8  |   1.097147   .0479873     2.12   0.034     1.007012     1.19535
               9  |   .7445874   .0375319    -5.85   0.000     .6745431    .8219051
              10  |   .8545231   .1488074    -0.90   0.367     .6074279    1.202134
              11  |   .8841091   .2314457    -0.47   0.638      .529267    1.476852
              12  |   .9842755   .0870048    -0.18   0.858     .8277037    1.170465
              13  |   1.327965    .211912     1.78   0.075     .9713028    1.815592
              14  |    .633254   .0921374    -3.14   0.002     .4761344    .8422215
              15  |   .6612128   .0443333    -6.17   0.000     .5797884    .7540724
              17  |   1.041289   .0475768     0.89   0.376     .9520937    1.138841
                  |
             time |
            2000  |   1.055618   .0694005     0.82   0.410     .9279947    1.200793
            2002  |   .9443184   .0631373    -0.86   0.392     .8283368    1.076539
            2003  |   .8775634   .0660312    -1.74   0.083     .7572354    1.017012
            2004  |   .8478504   .0607278    -2.30   0.021      .736803    .9756342
            2005  |   .7497507   .0531052    -4.07   0.000     .6525682     .861406
            2006  |   .7691233    .058757    -3.44   0.001     .6621687    .8933533
            2007  |   .6885505   .0529091    -4.86   0.000     .5922818    .8004665
            2008  |   .5881322   .0454483    -6.87   0.000     .5054728    .6843089
            2009  |   .4794209   .0404094    -8.72   0.000      .406416    .5655396
            2010  |   .5230553   .0453413    -7.48   0.000     .4413273    .6199182
            2011  |   .5562067   .0469543    -6.95   0.000     .4713884    .6562867
            2012  |   .5618266   .0489328    -6.62   0.000     .4736593    .6664054
            2013  |    .465995   .0442804    -8.04   0.000     .3868096    .5613907
            2014  |   .4480275   .0443012    -8.12   0.000     .3690945    .5438409
            2015  |   .4846949   .0501129    -7.00   0.000     .3957877    .5935738
                  |
            _cons |   .0000184   1.19e-06  -169.23   0.000     .0000162    .0000209
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =  -9360.449  
Iteration 1:   log pseudolikelihood = -8983.6787  
Iteration 2:   log pseudolikelihood = -8980.9908  
Iteration 3:   log pseudolikelihood = -8980.9885  
Iteration 4:   log pseudolikelihood = -8980.9885  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8713.0525  
Iteration 1:   log pseudolikelihood =  -8677.032  
Iteration 2:   log pseudolikelihood = -8676.2856  
Iteration 3:   log pseudolikelihood = -8676.2853  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8676.2853               Pseudo R2         =     0.0319

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_pp_1lag |   .9990064    .000929    -1.07   0.285     .9971872    1.000829
      p48_pp_1lag |   1.000141   .0001243     1.14   0.255     .9998978    1.000385
      p71_pp_1lag |    .999417   .0008217    -0.71   0.478     .9978077    1.001029
      p72_pp_1lag |   .9995358   .0005037    -0.92   0.357     .9985491    1.000524
      p75_pp_1lag |   1.000015   4.15e-06     3.65   0.000     1.000007    1.000023
      p77_pp_1lag |   .9999515   .0001061    -0.46   0.648     .9997435     1.00016
        mine_time |   .9919531   .0071822    -1.12   0.264     .9779756     1.00613
onsite_insp_hours |   .9998803   .0000504    -2.38   0.017     .9997816     .999979
                  |
            state |
               1  |   1.119807   .1058696     1.20   0.231     .9303974    1.347777
               2  |   1.949381   .1031132    12.62   0.000     1.757406    2.162327
               3  |   .7305579   .1220075    -1.88   0.060     .5266219    1.013469
               4  |   1.122778   .0949765     1.37   0.171     .9512406     1.32525
               5  |   .9103583   .1487594    -0.57   0.565     .6608754    1.254022
               6  |   .9526065   .0501513    -0.92   0.356     .8592129    1.056152
               7  |   .9719908   .2246952    -0.12   0.902     .6178596    1.529095
               8  |   .9999069   .0481274    -0.00   0.998     .9098916    1.098828
               9  |   .7838145    .038268    -4.99   0.000     .7122875    .8625242
              10  |   .9979179    .155639    -0.01   0.989     .7350862    1.354726
              11  |   .8764523   .2119271    -0.55   0.585     .5456408    1.407828
              12  |   .9891269   .0881728    -0.12   0.902      .830566    1.177958
              13  |   1.311713   .1960974     1.81   0.070     .9785578    1.758292
              14  |   .6305247   .0862217    -3.37   0.001      .482285    .8243288
              15  |   .6758236   .0495294    -5.35   0.000     .5853976    .7802177
              17  |   1.071452   .0482746     1.53   0.126     .9808928    1.170372
                  |
             time |
            2000  |   1.088509   .0646674     1.43   0.153     .9688644    1.222929
            2002  |   .9893453   .0592198    -0.18   0.858     .8798266    1.112497
            2003  |   .8828897   .0564459    -1.95   0.051     .7789086    1.000752
            2004  |   .8954212   .0586685    -1.69   0.092     .7875101    1.018119
            2005  |   .7927286   .0504947    -3.65   0.000     .6996893    .8981395
            2006  |    .791379   .0557959    -3.32   0.001     .6892407    .9086532
            2007  |     .71174   .0513629    -4.71   0.000     .6178659    .8198767
            2008  |   .6127472   .0449163    -6.68   0.000     .5307447    .7074195
            2009  |   .5230409   .0407901    -8.31   0.000     .4489039    .6094217
            2010  |   .5371141   .0442358    -7.55   0.000     .4570493    .6312044
            2011  |   .5738348   .0459239    -6.94   0.000     .4905299    .6712872
            2012  |   .5806117   .0468918    -6.73   0.000     .4956104    .6801914
            2013  |   .5092676    .046881    -7.33   0.000     .4251949    .6099637
            2014  |   .4942541   .0465379    -7.48   0.000     .4109633    .5944256
            2015  |   .5203743    .053698    -6.33   0.000     .4250885    .6370188
                  |
            _cons |   .0000175   1.05e-06  -183.03   0.000     .0000155    .0000197
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.527666   .0961297                     -1.716076   -1.339255
------------------+----------------------------------------------------------------
            alpha |   .2170417   .0208642                      .1797701    .2620408
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.PP.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.PP.2.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    609.41
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8980.989      36    18033.98   18276.65
        nbin |      6,253 -8961.932  -8676.285      37    17426.57   17675.98
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp2_yhat 
(option n assumed; predicted number of events)

. gen cpp2_res = dv - cpp2_yhat

. 
. summ dv cpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
   cpp2_yhat |      6,253    1.913547    2.826235   .0006354   30.22677

. /*
> pause "next"
> 
> scatter dv cpp2_yhat
> 
> pause "next"
> 
> scatter cpp2_res dv
> 
> pause "next"
> 
> scatter cpp2_res cpp2_yhat
> */
. pause "complete: C.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.3
. 
. // poisson model
. glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood =  -9565.355  
Iteration 1:   log pseudolikelihood = -8982.5965  
Iteration 2:   log pseudolikelihood = -8979.5171  
Iteration 3:   log pseudolikelihood = -8979.5154  
Iteration 4:   log pseudolikelihood = -8979.5154  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8384.165038                   (1/df) Deviance =   1.348587
Pearson          =  9283.094657                   (1/df) Pearson  =   1.493179

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.883581
Log pseudolikelihood = -8979.515366               BIC             =  -45957.49

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_pp_c_4lag |   .9994113   .0003531    -1.67   0.096     .9987194    1.000104
    p48_pp_c_4lag |   1.000062   .0000521     1.20   0.232     .9999602    1.000164
    p71_pp_c_4lag |   .9994344   .0002858    -1.98   0.048     .9988745    .9999946
    p72_pp_c_4lag |     .99993   .0001304    -0.54   0.592     .9996744    1.000186
    p75_pp_c_4lag |   1.000003   1.01e-06     3.11   0.002     1.000001    1.000005
    p77_pp_c_4lag |   .9999924   .0000315    -0.24   0.810     .9999306    1.000054
        mine_time |   .9905079   .0085876    -1.10   0.271     .9738187    1.007483
onsite_insp_hours |   .9998862    .000057    -2.00   0.046     .9997745    .9999978
                  |
            state |
               1  |   1.171308    .100043     1.85   0.064      .990761    1.384757
               2  |   2.193024    .134631    12.79   0.000     1.944409    2.473427
               3  |   .7451958   .1195508    -1.83   0.067     .5441432    1.020534
               4  |   1.235438   .1301916     2.01   0.045     1.004894    1.518873
               5  |   .9576708   .1512888    -0.27   0.784     .7026628    1.305225
               6  |   1.061094   .0656564     0.96   0.338     .9399071    1.197907
               7  |   1.037905   .2345118     0.16   0.869     .6665473     1.61616
               8  |   .9553292   .0505853    -0.86   0.388     .8611551    1.059802
               9  |    .844115   .0451621    -3.17   0.002      .760082    .9374386
              10  |   1.226406   .1696881     1.48   0.140     .9351043    1.608452
              11  |   .9141406   .2287127    -0.36   0.720     .5598185    1.492721
              12  |    .992512   .1030455    -0.07   0.942     .8097697    1.216494
              13  |   1.361458   .1992909     2.11   0.035     1.021892    1.813859
              14  |   .6539198   .0846981    -3.28   0.001     .5073104    .8428985
              15  |   .6937484   .0642041    -3.95   0.000     .5786635    .8317214
              17  |   1.121845    .057928     2.23   0.026     1.013865    1.241326
                  |
             time |
            2000  |   1.112398   .0661206     1.79   0.073     .9900678    1.249842
            2002  |   1.008791   .0560543     0.16   0.875     .9046974    1.124861
            2003  |   .8894904   .0526103    -1.98   0.048     .7921284    .9988193
            2004  |   .9214813   .0592786    -1.27   0.204     .8123235    1.045307
            2005  |   .8189663   .0500789    -3.27   0.001     .7264671    .9232432
            2006  |   .7841099   .0570078    -3.35   0.001     .6799724     .904196
            2007  |   .7247603   .0528861    -4.41   0.000     .6281766     .836194
            2008  |   .6246777   .0494609    -5.94   0.000     .5348836    .7295461
            2009  |   .5573684   .0443893    -7.34   0.000     .4768171    .6515276
            2010  |   .5556381   .0495922    -6.58   0.000      .466466    .6618568
            2011  |   .5828482    .050403    -6.24   0.000     .4919784    .6905019
            2012  |   .6012838   .0521208    -5.87   0.000     .5073354    .7126296
            2013  |   .5631746   .0575458    -5.62   0.000     .4609633    .6880496
            2014  |   .5529863   .0563868    -5.81   0.000     .4528134    .6753197
            2015  |   .5663425   .0681036    -4.73   0.000     .4474255    .7168652
                  |
            _cons |   .0000162   9.88e-07  -180.83   0.000     .0000144    .0000183
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8384.165
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9283.095
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9221.9172  
Iteration 1:   log pseudolikelihood = -9094.8857  
Iteration 2:   log pseudolikelihood = -9093.7797  
Iteration 3:   log pseudolikelihood = -9093.7796  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3873.796895                   (1/df) Deviance =   .6230975
Pearson          =  4163.429648                   (1/df) Pearson  =   .6696847

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.920128
Log pseudolikelihood = -9093.779622               BIC             =  -50467.86

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_pp_c_4lag |   .9997569   .0003361    -0.72   0.469     .9990984    1.000416
    p48_pp_c_4lag |   1.000078   .0000643     1.21   0.225     .9999519    1.000204
    p71_pp_c_4lag |   .9998806   .0003324    -0.36   0.719     .9992292    1.000532
    p72_pp_c_4lag |   .9998606   .0001814    -0.77   0.442     .9995052    1.000216
    p75_pp_c_4lag |   1.000004   1.18e-06     3.25   0.001     1.000002    1.000006
    p77_pp_c_4lag |   .9999866   .0000335    -0.40   0.689     .9999209    1.000052
        mine_time |   .9937048    .006951    -0.90   0.367      .980174    1.007422
onsite_insp_hours |   .9998976   .0000483    -2.12   0.034     .9998029    .9999924
                  |
            state |
               1  |   1.078095   .1136995     0.71   0.476     .8767714    1.325646
               2  |   1.724856   .0876287    10.73   0.000     1.561381    1.905447
               3  |   .7318877   .1231892    -1.85   0.064     .5262264    1.017926
               4  |   1.085239   .0876428     1.01   0.311     .9263672    1.271357
               5  |   .8705038   .1459411    -0.83   0.408     .6267086    1.209138
               6  |   .8920698      .0448    -2.27   0.023     .8084464     .984343
               7  |    .924739   .2144789    -0.34   0.736     .5869433    1.456942
               8  |   1.100303    .049981     2.10   0.035     1.006576    1.202757
               9  |   .7550433   .0407192    -5.21   0.000     .6793082     .839222
              10  |   .8542525   .1495969    -0.90   0.368     .6060712    1.204062
              11  |   .8843341    .230438    -0.47   0.637     .5306547     1.47374
              12  |   .9809745    .086842    -0.22   0.828     .8247152     1.16684
              13  |   1.330544   .2124561     1.79   0.074     .9729995    1.819474
              14  |   .6319801   .0927544    -3.13   0.002     .4739957    .8426213
              15  |   .6607642   .0443307    -6.18   0.000     .5793478    .7536222
              17  |    1.04444   .0510982     0.89   0.374     .9489416     1.14955
                  |
             time |
            2000  |   1.059606   .0697423     0.88   0.379     .9313633    1.205507
            2002  |   .9425604   .0629657    -0.89   0.376     .8268877    1.074414
            2003  |   .8769582    .066036    -1.74   0.081     .7566279    1.016425
            2004  |   .8473378   .0607412    -2.31   0.021     .7362722    .9751575
            2005  |   .7482021   .0530974    -4.09   0.000     .6510466    .8598562
            2006  |    .769212   .0589761    -3.42   0.001     .6618869    .8939398
            2007  |    .694987   .0534332    -4.73   0.000     .5977687    .8080164
            2008  |   .5952808   .0458779    -6.73   0.000     .5118237    .6923463
            2009  |   .4833611   .0407991    -8.61   0.000     .4096607    .5703207
            2010  |   .5265507   .0455765    -7.41   0.000     .4443887    .6239034
            2011  |   .5581011   .0471668    -6.90   0.000     .4729065    .6586437
            2012  |   .5636885   .0491583    -6.57   0.000     .4751245     .668761
            2013  |   .4667805   .0443277    -8.02   0.000     .3875062    .5622725
            2014  |   .4495206   .0446997    -8.04   0.000     .3699195    .5462506
            2015  |   .4850882   .0498003    -7.05   0.000     .3966746    .5932081
                  |
            _cons |   .0000184   1.18e-06  -169.26   0.000     .0000162    .0000209
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -9367.7617  
Iteration 1:   log pseudolikelihood = -8982.6643  
Iteration 2:   log pseudolikelihood = -8979.5188  
Iteration 3:   log pseudolikelihood = -8979.5154  
Iteration 4:   log pseudolikelihood = -8979.5154  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8713.7385  
Iteration 1:   log pseudolikelihood = -8677.6096  
Iteration 2:   log pseudolikelihood = -8676.8558  
Iteration 3:   log pseudolikelihood = -8676.8556  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8676.8556               Pseudo R2         =     0.0318

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_pp_c_4lag |   .9996062   .0003303    -1.19   0.233     .9989589    1.000254
    p48_pp_c_4lag |   1.000057   .0000529     1.08   0.278     .9999537    1.000161
    p71_pp_c_4lag |   .9996425   .0002911    -1.23   0.220     .9990721    1.000213
    p72_pp_c_4lag |   .9998764   .0001489    -0.83   0.407     .9995845    1.000168
    p75_pp_c_4lag |   1.000004   1.10e-06     3.35   0.001     1.000002    1.000006
    p77_pp_c_4lag |   .9999863   .0000334    -0.41   0.681     .9999208    1.000052
        mine_time |   .9918702   .0072115    -1.12   0.262     .9778361    1.006106
onsite_insp_hours |   .9998854     .00005    -2.29   0.022     .9997873    .9999834
                  |
            state |
               1  |   1.113767   .1048239     1.14   0.252     .9261519    1.339388
               2  |   1.955095   .1033192    12.69   0.000     1.762727    2.168455
               3  |   .7305095   .1230289    -1.86   0.062     .5251346    1.016205
               4  |    1.12275   .0947507     1.37   0.170     .9515874    1.324699
               5  |   .9075925   .1484223    -0.59   0.553     .6587043    1.250522
               6  |   .9515579   .0500415    -0.94   0.345     .8583638     1.05487
               7  |   .9717618   .2237579    -0.12   0.901     .6188169     1.52601
               8  |   .9974627   .0506061    -0.05   0.960     .9030486    1.101748
               9  |   .7944638   .0407286    -4.49   0.000     .7185165    .8784387
              10  |   .9983886   .1573323    -0.01   0.992     .7330979    1.359682
              11  |   .8760151   .2110541    -0.55   0.583     .5463057    1.404713
              12  |   .9864659    .087878    -0.15   0.878     .8284265    1.174655
              13  |   1.314928   .1969556     1.83   0.068     .9804044    1.763594
              14  |   .6283854   .0861589    -3.39   0.001     .4803043    .8221209
              15  |   .6743179   .0495267    -5.37   0.000     .5839106    .7787229
              17  |   1.072889   .0527273     1.43   0.152     .9743664    1.181374
                  |
             time |
            2000  |   1.093452   .0650251     1.50   0.133      .973152    1.228623
            2002  |   .9881285   .0590572    -0.20   0.842     .8789009    1.110931
            2003  |    .882731   .0564475    -1.95   0.051     .7787482    1.000598
            2004  |   .8958839   .0587351    -1.68   0.094     .7878546    1.018726
            2005  |   .7914215   .0504447    -3.67   0.000     .6984781    .8967325
            2006  |   .7917651   .0560181    -3.30   0.001     .6892442    .9095354
            2007  |    .718536   .0518163    -4.58   0.000     .6238285    .8276215
            2008  |   .6189163   .0450795    -6.59   0.000     .5365789    .7138883
            2009  |    .525511   .0411058    -8.23   0.000     .4508169    .6125808
            2010  |   .5408682   .0444512    -7.48   0.000     .4604002    .6354003
            2011  |   .5754088   .0461353    -6.89   0.000     .4917322    .6733244
            2012  |   .5821175   .0470749    -6.69   0.000     .4967929    .6820967
            2013  |   .5096511   .0468891    -7.33   0.000     .4255596    .6103592
            2014  |   .4950401   .0469364    -7.42   0.000     .4110882    .5961365
            2015  |   .5209178   .0533712    -6.37   0.000      .426146    .6367663
                  |
            _cons |   .0000175   1.05e-06  -183.02   0.000     .0000155    .0000197
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.529162   .0967227                     -1.718735   -1.339589
------------------+----------------------------------------------------------------
            alpha |   .2167172   .0209615                      .1792928    .2619533
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.PP.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.PP.3.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    605.32
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622  -8979.515      36    18031.03    18273.7
        nbin |      6,253 -8961.932  -8676.856      37    17427.71   17677.12
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp3_yhat 
(option n assumed; predicted number of events)

. gen cpp3_res = dv - cpp3_yhat

. 
. summ dv cpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
   cpp3_yhat |      6,253     1.91313    2.824372   .0006357   30.20433

. /*
> pause "next"
> 
> scatter dv cpp3_yhat
> 
> pause "next"
> 
> scatter cpp3_res dv
> 
> pause "next"
> 
> scatter cpp3_res cpp3_yhat
> */
. pause "complete: C.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.4
. 
. // poisson model
. glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood = -9585.1692  
Iteration 1:   log pseudolikelihood = -8993.7585  
Iteration 2:   log pseudolikelihood = -8990.5918  
Iteration 3:   log pseudolikelihood = -8990.5898  
Iteration 4:   log pseudolikelihood = -8990.5898  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  8406.313958                   (1/df) Deviance =    1.35215
Pearson          =  9333.832438                   (1/df) Pearson  =    1.50134

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.887123
Log pseudolikelihood = -8990.589826               BIC             =  -45935.34

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_pp_c_lag_all |   .9999369   .0001957    -0.32   0.747     .9995534    1.000321
 p48_pp_c_lag_all |   1.000029   .0000183     1.57   0.117     .9999928    1.000064
 p71_pp_c_lag_all |   .9997613    .000139    -1.72   0.086     .9994889    1.000034
 p72_pp_c_lag_all |    .999995   .0000772    -0.06   0.949     .9998437    1.000146
 p75_pp_c_lag_all |          1   2.03e-07     1.90   0.057            1    1.000001
 p77_pp_c_lag_all |   1.000002   .0000117     0.20   0.839     .9999795    1.000025
        mine_time |   .9848321   .0086471    -1.74   0.082     .9680292    1.001927
onsite_insp_hours |   .9999233   .0000503    -1.52   0.127     .9998247    1.000022
                  |
            state |
               1  |   1.124142   .0974708     1.35   0.177     .9484534    1.332374
               2  |   2.247218   .1396199    13.03   0.000     1.989573    2.538227
               3  |   .7261194   .1195136    -1.94   0.052     .5259045    1.002557
               4  |   1.231599   .1191951     2.15   0.031     1.018801    1.488844
               5  |   .9257343   .1441299    -0.50   0.620     .6822769    1.256065
               6  |   1.047996   .0654432     0.75   0.453     .9272685    1.184442
               7  |   1.043742     .23201     0.19   0.847     .6751218     1.61363
               8  |   .9561202   .0512991    -0.84   0.403     .8606819    1.062141
               9  |   .8578613   .0573743    -2.29   0.022     .7524682    .9780161
              10  |   1.199999   .1653742     1.32   0.186     .9159571    1.572123
              11  |    .919357   .2280335    -0.34   0.735     .5653998    1.494902
              12  |   .9735576    .094873    -0.27   0.783     .8042892     1.17845
              13  |   1.326645   .1953767     1.92   0.055     .9940247    1.770567
              14  |   .6474971    .083691    -3.36   0.001     .5025941     .834177
              15  |   .6836437   .0674211    -3.86   0.000     .5634872     .829422
              17  |   1.050741   .0783925     0.66   0.507     .9077998    1.216189
                  |
             time |
            2000  |   1.099641   .0652582     1.60   0.109     .9788954     1.23528
            2002  |   1.009696   .0558845     0.17   0.862     .9058963     1.12539
            2003  |   .8945287   .0530685    -1.88   0.060     .7963358    1.004829
            2004  |   .9271086   .0593087    -1.18   0.237     .8178578    1.050953
            2005  |   .8233834   .0505346    -3.17   0.002     .7300628    .9286327
            2006  |   .7930934   .0581783    -3.16   0.002      .686884    .9157254
            2007  |   .7570599   .0559719    -3.76   0.000     .6549349    .8751095
            2008  |   .6904911   .0545566    -4.69   0.000     .5914303     .806144
            2009  |   .6002002   .0509221    -6.02   0.000     .5082514    .7087836
            2010  |   .5803006   .0538204    -5.87   0.000     .4838467    .6959824
            2011  |   .6058835   .0530985    -5.72   0.000     .5102599    .7194272
            2012  |   .6182839   .0532281    -5.58   0.000     .5222855    .7319272
            2013  |   .5696155   .0580466    -5.52   0.000     .4664876    .6955421
            2014  |   .5548395   .0575828    -5.68   0.000     .4527176    .6799976
            2015  |   .5576311   .0671901    -4.85   0.000     .4403359    .7061711
                  |
            _cons |   .0000163   1.01e-06  -178.93   0.000     .0000145    .0000184
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

.         
. quietly poisson dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. est store pois

. estat gof

         Deviance goodness-of-fit =  8406.314
         Prob > chi2(6217)        =    0.0000

         Pearson goodness-of-fit  =  9333.832
         Prob > chi2(6217)        =    0.0000

.         
. pause "next"

. 
. // negative binomial model
. glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform

Iteration 0:   log pseudolikelihood =  -9229.777  
Iteration 1:   log pseudolikelihood = -9098.5071  
Iteration 2:   log pseudolikelihood = -9097.3121  
Iteration 3:   log pseudolikelihood = -9097.3119  

Generalized linear models                         No. of obs      =      6,253
Optimization     : ML                             Residual df     =      6,217
                                                  Scale parameter =          1
Deviance         =  3880.861468                   (1/df) Deviance =   .6242338
Pearson          =  4160.379734                   (1/df) Pearson  =   .6691941

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   2.921258
Log pseudolikelihood = -9097.311909               BIC             =   -50460.8

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_pp_c_lag_all |   1.000001   .0002127     0.00   0.998     .9995838    1.000418
 p48_pp_c_lag_all |   1.000028   .0000238     1.18   0.237     .9999815    1.000075
 p71_pp_c_lag_all |   1.000047   .0002117     0.22   0.824     .9996321    1.000462
 p72_pp_c_lag_all |   1.000002   .0000775     0.03   0.975     .9998505    1.000154
 p75_pp_c_lag_all |          1   2.15e-07     1.32   0.187     .9999999    1.000001
 p77_pp_c_lag_all |   .9999975   .0000118    -0.21   0.835     .9999745    1.000021
        mine_time |   .9922296   .0074858    -1.03   0.301     .9776658     1.00701
onsite_insp_hours |   .9999491   .0000431    -1.18   0.238     .9998647    1.000034
                  |
            state |
               1  |   1.038494   .1108557     0.35   0.723     .8424447    1.280168
               2  |   1.731738   .0897918    10.59   0.000     1.564396     1.91698
               3  |   .7118557   .1215691    -1.99   0.047      .509361    .9948515
               4  |   1.070254   .0803042     0.90   0.366     .9238868    1.239809
               5  |   .8474958   .1395243    -1.01   0.315     .6137665    1.170232
               6  |    .879662   .0443102    -2.55   0.011      .796965    .9709399
               7  |   .9351299   .2125133    -0.30   0.768     .5990069    1.459863
               8  |   1.063354   .0423558     1.54   0.123     .9834962    1.149697
               9  |   .7096063   .0656308    -3.71   0.000     .5919577    .8506368
              10  |   .8376007   .1445941    -1.03   0.305      .597166    1.174841
              11  |   .8857312   .2289045    -0.47   0.639     .5337294    1.469883
              12  |   .9448923   .0848643    -0.63   0.528     .7923785    1.126761
              13  |   1.315154   .2128056     1.69   0.090     .9577309    1.805968
              14  |   .6148134   .0914063    -3.27   0.001     .4594015    .8227999
              15  |   .6560286   .0444029    -6.23   0.000      .574526    .7490932
              17  |   .9709446   .0717591    -0.40   0.690     .8400113    1.122286
                  |
             time |
            2000  |   1.053095   .0696974     0.78   0.434     .9249798    1.198955
            2002  |   .9405879    .062886    -0.92   0.360     .8250678    1.072282
            2003  |   .8758266   .0660103    -1.76   0.079      .755551    1.015249
            2004  |   .8439603   .0606639    -2.36   0.018     .7330567    .9716424
            2005  |   .7421611   .0525693    -4.21   0.000     .6459594    .8526899
            2006  |   .7657574   .0585319    -3.49   0.000     .6592168    .8895168
            2007  |   .7086207   .0550395    -4.43   0.000      .608555    .8251404
            2008  |   .6321327   .0481732    -6.02   0.000     .5444279    .7339664
            2009  |   .5158466   .0434842    -7.85   0.000     .4372875    .6085189
            2010  |   .5509441   .0476367    -6.89   0.000     .4650604     .652688
            2011  |   .5772895   .0484903    -6.54   0.000     .4896611    .6805995
            2012  |   .5787786   .0509542    -6.21   0.000     .4870514     .687781
            2013  |   .4739102   .0451575    -7.84   0.000     .3931766    .5712214
            2014  |   .4524726   .0455622    -7.88   0.000     .3714323    .5511945
            2015  |   .4824964   .0504392    -6.97   0.000     .3931073    .5922117
                  |
            _cons |   .0000184   1.22e-06  -165.22   0.000     .0000162     .000021
        ln(hours) |          1  (exposure)
-----------------------------------------------------------------------------------

. 
. pause "next"

. 
. eststo clear

. eststo: nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -9567.2891  
Iteration 1:   log pseudolikelihood = -8998.2527  
Iteration 2:   log pseudolikelihood = -8990.6105  
Iteration 3:   log pseudolikelihood = -8990.5898  
Iteration 4:   log pseudolikelihood = -8990.5898  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -9249.9658  
Iteration 1:   log pseudolikelihood = -8971.6355  
Iteration 2:   log pseudolikelihood =  -8961.958  
Iteration 3:   log pseudolikelihood = -8961.9317  
Iteration 4:   log pseudolikelihood = -8961.9317  

Fitting full model:

Iteration 0:   log pseudolikelihood = -8719.7143  
Iteration 1:   log pseudolikelihood = -8684.9381  
Iteration 2:   log pseudolikelihood = -8684.2385  
Iteration 3:   log pseudolikelihood = -8684.2383  

Negative binomial regression                    Number of obs     =      6,253
                                                Wald chi2(35)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -8684.2383               Pseudo R2         =     0.0310

                                  (Std. Err. adjusted for 1,238 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_pp_c_lag_all |   .9999661   .0002045    -0.17   0.868     .9995654    1.000367
 p48_pp_c_lag_all |   1.000026   .0000203     1.28   0.201     .9999861    1.000066
 p71_pp_c_lag_all |   .9998953   .0001686    -0.62   0.535     .9995649    1.000226
 p72_pp_c_lag_all |   .9999965   .0000713    -0.05   0.961     .9998567    1.000136
 p75_pp_c_lag_all |          1   2.17e-07     1.84   0.066            1    1.000001
 p77_pp_c_lag_all |   .9999987   .0000118    -0.11   0.911     .9999756    1.000022
        mine_time |   .9884727   .0076909    -1.49   0.136     .9735132    1.003662
onsite_insp_hours |   .9999272   .0000436    -1.67   0.095     .9998416    1.000013
                  |
            state |
               1  |   1.064337   .0993132     0.67   0.504     .8864485    1.277923
               2  |   1.972038   .1064953    12.57   0.000     1.773977    2.192211
               3  |   .7099319   .1224733    -1.99   0.047     .5062586    .9955453
               4  |   1.110008   .0864278     1.34   0.180     .9529046    1.293012
               5  |   .8793213   .1413807    -0.80   0.424      .641635    1.205056
               6  |   .9369731   .0496615    -1.23   0.219     .8445234    1.039543
               7  |   .9787828   .2211518    -0.09   0.924     .6285806    1.524094
               8  |   .9698013   .0453112    -0.66   0.512      .884938    1.062803
               9  |   .7804385   .0591749    -3.27   0.001     .6726642    .9054804
              10  |   .9758748   .1518594    -0.16   0.875     .7193422    1.323892
              11  |   .8773692    .209443    -0.55   0.584     .5495232    1.400808
              12  |   .9522468   .0846169    -0.55   0.582     .8000396    1.133411
              13  |   1.286227   .1943424     1.67   0.096      .956545    1.729537
              14  |   .6140199   .0847279    -3.53   0.000     .4685179    .8047088
              15  |   .6670295    .050444    -5.35   0.000     .5751394    .7736009
              17  |   1.006136   .0732572     0.08   0.933     .8723288    1.160467
                  |
             time |
            2000  |    1.08415   .0648077     1.35   0.176     .9642878    1.218911
            2002  |   .9873174   .0589845    -0.21   0.831     .8782217    1.109965
            2003  |   .8838947   .0565826    -1.93   0.054     .7796699    1.002052
            2004  |   .8953495    .058774    -1.68   0.092     .7872571    1.018283
            2005  |   .7889407   .0504004    -3.71   0.000     .6960918    .8941744
            2006  |   .7932182   .0562668    -3.27   0.001     .6902602    .9115331
            2007  |   .7397622   .0541182    -4.12   0.000      .640946    .8538131
            2008  |   .6681024    .048227    -5.59   0.000     .5799613     .769639
            2009  |   .5647716   .0447693    -7.21   0.000     .4835021    .6597014
            2010  |   .5676899   .0466712    -6.89   0.000     .4832053    .6669459
            2011  |   .5967166   .0479268    -6.43   0.000     .5098022    .6984488
            2012  |   .5987869   .0491125    -6.25   0.000     .5098668    .7032146
            2013  |    .517019   .0480955    -7.09   0.000     .4308476     .620425
            2014  |   .4976484   .0480515    -7.23   0.000     .4118443    .6013292
            2015  |   .5147574   .0536215    -6.37   0.000     .4196953    .6313512
                  |
            _cons |   .0000176   1.08e-06  -179.19   0.000     .0000156    .0000199
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |   -1.51961   .0954524                     -1.706693   -1.332527
------------------+----------------------------------------------------------------
            alpha |   .2187972   .0208847                      .1814649    .2638098
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.PP.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.C.PP.4.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(1)  =    612.70
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      6,253 -9569.622   -8990.59      36    18053.18   18295.85
        nbin |      6,253 -8961.932  -8684.238      37    17442.48   17691.89
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp4_yhat 
(option n assumed; predicted number of events)

. gen cpp4_res = dv - cpp4_yhat

. 
. summ dv cpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |      6,253    1.881017    3.268911          0         37
   cpp4_yhat |      6,253    1.912377    2.807186   .0006487   23.18188

. /*
> pause "next"
> 
> scatter dv cpp4_yhat
> 
> pause "next"
> 
> scatter cpp4_res dv
> 
> pause "next"
> 
> scatter cpp4_res cpp4_yhat
> */
. pause "complete: C.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.1
. 
. eststo clear

. eststo: logit dv_indicator `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2912.2282  
Iteration 2:   log pseudolikelihood = -2900.3359  
Iteration 3:   log pseudolikelihood = -2900.2368  
Iteration 4:   log pseudolikelihood = -2900.2368  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2900.2368               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p47 |    .914201   .1256196    -0.65   0.514     .6983591    1.196753
              p48 |     1.0605   .0443365     1.41   0.160     .9770665    1.151057
              p71 |   1.353507   .2531728     1.62   0.106     .9380883    1.952888
              p72 |   1.147523    .154904     1.02   0.308     .8807604    1.495082
              p75 |   1.005617   .0014365     3.92   0.000     1.002805    1.008436
              p77 |   1.032029     .01825     1.78   0.075     .9968728    1.068426
        mine_time |   .9990617   .0139138    -0.07   0.946     .9721599    1.026708
onsite_insp_hours |   1.000696   .0001998     3.48   0.000     1.000304    1.001087
                  |
            state |
               1  |   1.558793    .626844     1.10   0.270     .7087467    3.428354
               2  |   2.467107   .2362064     9.43   0.000     2.044994     2.97635
               3  |   .6313622    .229649    -1.26   0.206     .3095039    1.287926
               4  |   1.918613   .5977403     2.09   0.036     1.041831    3.533277
               5  |   .8075245    .225762    -0.76   0.444     .4668558    1.396782
               6  |   .7208946   .0652001    -3.62   0.000     .6037905    .8607107
               7  |   .8127701   .2639831    -0.64   0.523     .4300335    1.536148
               8  |   1.367186   .1141386     3.75   0.000     1.160822    1.610237
               9  |   2.369822   .2257515     9.06   0.000     1.966208    2.856288
              10  |    .619917   .2323391    -1.28   0.202     .2973796    1.292278
              11  |   .6074972   .1586538    -1.91   0.056     .3641201    1.013547
              12  |   1.062583   .1833522     0.35   0.725     .7576786    1.490186
              13  |   2.023546   .7557626     1.89   0.059     .9732013    4.207493
              14  |   .6596133   .2038818    -1.35   0.178      .359906    1.208898
              15  |   .5618363   .0604339    -5.36   0.000     .4550408    .6936961
              17  |          1  (empty)
                  |
             time |
            2000  |   .9846934   .1377245    -0.11   0.912     .7485959    1.295253
            2002  |   .7522485   .1115106    -1.92   0.055     .5625774    1.005867
            2003  |   .8124958   .1363434    -1.24   0.216     .5847667    1.128911
            2004  |   .5372005   .0861975    -3.87   0.000     .3922431    .7357284
            2005  |   .5447438   .0816802    -4.05   0.000     .4060327     .730842
            2006  |   .5866802   .0895757    -3.49   0.000     .4349486    .7913433
            2007  |   .5566389   .0904865    -3.60   0.000     .4047653    .7654977
            2008  |   .4422753   .0717968    -5.03   0.000     .3217458    .6079566
            2009  |   .2192174   .0385369    -8.63   0.000     .1553244     .309393
            2010  |   .3082019   .0567334    -6.39   0.000     .2148559    .4421029
            2011  |   .3822947    .068453    -5.37   0.000     .2691434    .5430163
            2012  |   .3385769   .0649835    -5.64   0.000     .2324263    .4932072
            2013  |   .2366187   .0492904    -6.92   0.000     .1573019    .3559297
            2014  |   .1908965   .0421073    -7.51   0.000     .1238919    .2941395
            2015  |   .2565786   .0566455    -6.16   0.000     .1664556    .3954963
                  |
            _cons |   .0000221   2.83e-06   -83.56   0.000     .0000172    .0000284
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.V.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.V.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6188) =      5939.23
                  Prob > chi2 =         0.9881

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2899.5332  
Iteration 2:   log likelihood = -2892.2369  
Iteration 3:   log likelihood = -2892.0269  
Iteration 4:   log likelihood = -2892.0263  
Iteration 5:   log likelihood = -2892.0263  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2802.22
                                                Prob > chi2       =     0.0000
Log likelihood = -2892.0263                     Pseudo R2         =     0.3264

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.120695   .0319454    35.08   0.000     1.058083    1.183306
      _hatsq |  -.0310072    .015103    -2.05   0.040    -.0606086   -.0014057
       _cons |   .0265563   .0362784     0.73   0.464    -.0445481    .0976607
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2763           744  |       3507
     -     |       681          2054  |       2735
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.23%
Specificity                     Pr( -|~D)   73.41%
Positive predictive value       Pr( D| +)   78.79%
Negative predictive value       Pr(~D| -)   75.10%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.59%
False - rate for true D         Pr( -| D)   19.77%
False + rate for classified +   Pr(~D| +)   21.21%
False - rate for classified -   Pr( D| -)   24.90%
--------------------------------------------------
Correctly classified                        77.17%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv1_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv1_res = dv_indicator - bv1_yhat
(11 missing values generated)

. 
. summ dv_indicator bv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
    bv1_yhat |      6,242    .5517462    .2922812   .0003778   .9999937

. /*
> pause "next"
> 
> scatter dv_indicator bv1_yhat
> 
> pause "next"
> 
> scatter bv1_res dv_indicator
> 
> pause "next"
> 
> scatter bv1_res bv1_yhat
> */
. pause "complete: B.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.2
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood =  -2914.499  
Iteration 2:   log pseudolikelihood =  -2902.751  
Iteration 3:   log pseudolikelihood = -2902.6511  
Iteration 4:   log pseudolikelihood = -2902.6511  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2902.6511               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p47_1lag |   .9953437   .1316037    -0.04   0.972     .7681177    1.289788
         p48_1lag |    1.04092   .0401491     1.04   0.298     .9651306    1.122662
         p71_1lag |   1.346416   .2678299     1.50   0.135     .9117124    1.988387
         p72_1lag |   .9871774   .1220264    -0.10   0.917     .7747775    1.257805
         p75_1lag |   1.005164   .0014089     3.67   0.000     1.002406    1.007929
         p77_1lag |   1.035762    .018341     1.98   0.047     1.000431    1.072341
        mine_time |   .9959182   .0139176    -0.29   0.770     .9690104    1.023573
onsite_insp_hours |   1.000781   .0001967     3.97   0.000     1.000395    1.001166
                  |
            state |
               1  |   1.562189   .6318862     1.10   0.270     .7070219    3.451708
               2  |   2.524455   .2414736     9.68   0.000     2.092893    3.045007
               3  |   .6477151   .2311978    -1.22   0.224     .3217755    1.303812
               4  |   1.914173    .595906     2.09   0.037       1.0399    3.523473
               5  |   .8272389   .2263468    -0.69   0.488     .4838688    1.414277
               6  |   .7224976   .0652074    -3.60   0.000     .6053593    .8623026
               7  |   .8308582   .2697177    -0.57   0.568     .4397494    1.569815
               8  |   1.395543   .1178001     3.95   0.000     1.182747    1.646624
               9  |   2.432048   .2309022     9.36   0.000       2.0191    2.929453
              10  |   .6136519   .2308562    -1.30   0.194     .2935618    1.282758
              11  |   .6149781   .1551865    -1.93   0.054     .3750278    1.008453
              12  |   1.050402    .181741     0.28   0.776     .7483076    1.474452
              13  |   2.014583   .7455173     1.89   0.058     .9754143    4.160841
              14  |   .6824654   .2115594    -1.23   0.218     .3717185    1.252989
              15  |   .5710555   .0611501    -5.23   0.000     .4629451    .7044126
              17  |          1  (empty)
                  |
             time |
            2000  |    1.02367   .1435631     0.17   0.868      .777651    1.347521
            2002  |    .747135    .110653    -1.97   0.049     .5588993    .9987681
            2003  |   .8126382   .1366151    -1.23   0.217     .5845196    1.129784
            2004  |   .5360012    .086001    -3.89   0.000     .3913732    .7340749
            2005  |   .5531264   .0827056    -3.96   0.000     .4126193    .7414797
            2006  |   .5940032   .0907048    -3.41   0.001     .4403619    .8012498
            2007  |   .5730761    .093059    -3.43   0.001     .4168597    .7878339
            2008  |   .4475527   .0729208    -4.93   0.000      .325204    .6159314
            2009  |    .222199   .0389645    -8.58   0.000      .157571    .3133341
            2010  |   .3080197   .0566725    -6.40   0.000     .2147662    .4417647
            2011  |   .3824033   .0684384    -5.37   0.000     .2692668    .5430758
            2012  |    .331594   .0636965    -5.75   0.000     .2275609    .4831874
            2013  |   .2327706   .0486042    -6.98   0.000     .1545934    .3504816
            2014  |   .1923732   .0424013    -7.48   0.000     .1248906    .2963188
            2015  |   .2504715   .0553037    -6.27   0.000     .1624854    .3861022
                  |
            _cons |   .0000222   2.84e-06   -83.68   0.000     .0000172    .0000285
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.V.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.V.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6187) =      6081.63
                  Prob > chi2 =         0.8281

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2900.7971  
Iteration 2:   log likelihood = -2894.1111  
Iteration 3:   log likelihood = -2893.9569  
Iteration 4:   log likelihood = -2893.9566  
Iteration 5:   log likelihood = -2893.9566  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2798.36
                                                Prob > chi2       =     0.0000
Log likelihood = -2893.9566                     Pseudo R2         =     0.3259

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |    1.12362   .0320977    35.01   0.000      1.06071     1.18653
      _hatsq |  -.0338368   .0150167    -2.25   0.024    -.0632691   -.0044046
       _cons |   .0293157   .0361956     0.81   0.418    -.0416263    .1002577
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2764           750  |       3514
     -     |       680          2048  |       2728
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.26%
Specificity                     Pr( -|~D)   73.20%
Positive predictive value       Pr( D| +)   78.66%
Negative predictive value       Pr(~D| -)   75.07%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.80%
False - rate for true D         Pr( -| D)   19.74%
False + rate for classified +   Pr(~D| +)   21.34%
False - rate for classified -   Pr( D| -)   24.93%
--------------------------------------------------
Correctly classified                        77.09%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv2_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv2_res = dv_indicator - bv2_yhat
(11 missing values generated)

. 
. summ dv_indicator bv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
    bv2_yhat |      6,242    .5517462    .2919261   .0003718   .9999903

. /*
> pause "next"
> 
> scatter dv_indicator bv2_yhat
> 
> pause "next"
> 
> scatter bv2_res dv_indicator
> 
> pause "next"
> 
> scatter bv2_res bv2_yhat
> */
. pause "complete: B.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.3
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2917.9876  
Iteration 2:   log pseudolikelihood =  -2906.659  
Iteration 3:   log pseudolikelihood = -2906.5584  
Iteration 4:   log pseudolikelihood = -2906.5584  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2906.5584               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p47_c_4lag |   1.010498   .0474743     0.22   0.824     .9216055    1.107964
       p48_c_4lag |   1.016792   .0129322     1.31   0.190     .9917588    1.042457
       p71_c_4lag |   1.063747   .0702644     0.94   0.349     .9345735    1.210775
       p72_c_4lag |   1.007083   .0392435     0.18   0.856     .9330309    1.087012
       p75_c_4lag |   1.001027   .0003712     2.77   0.006     1.000299    1.001754
       p77_c_4lag |    1.01032   .0059574     1.74   0.082      .998711    1.022064
        mine_time |   .9917555   .0140122    -0.59   0.558     .9646688    1.019603
onsite_insp_hours |   1.000857   .0001991     4.31   0.000     1.000467    1.001247
                  |
            state |
               1  |    1.55401   .6267531     1.09   0.274     .7049411    3.425743
               2  |   2.571209   .2489532     9.75   0.000     2.126773     3.10852
               3  |   .6373759   .2255256    -1.27   0.203     .3185746    1.275205
               4  |    1.91609   .5921553     2.10   0.035     1.045581    3.511351
               5  |   .8155162   .2272397    -0.73   0.464     .4723341    1.408043
               6  |   .7217636   .0652131    -3.61   0.000     .6046261    .8615948
               7  |   .8338563   .2631045    -0.58   0.565     .4492766    1.547635
               8  |   1.361847   .1181089     3.56   0.000     1.148964    1.614175
               9  |   2.359743   .2441844     8.30   0.000     1.926563    2.890323
              10  |   .6040822   .2270548    -1.34   0.180     .2891726    1.261929
              11  |   .6296103   .1604625    -1.82   0.069     .3820625     1.03755
              12  |   1.025245   .1779605     0.14   0.886      .729587    1.440714
              13  |   2.005412   .7373376     1.89   0.058     .9755266    4.122571
              14  |   .6735533   .2146093    -1.24   0.215     .3607115     1.25772
              15  |   .5664584   .0611251    -5.27   0.000     .4584764    .6998728
              17  |          1  (empty)
                  |
             time |
            2000  |   1.066519   .1508707     0.46   0.649     .8082709     1.40728
            2002  |   .7378022   .1093543    -2.05   0.040     .5517954    .9865108
            2003  |   .8027173   .1347391    -1.31   0.190     .5776773    1.115424
            2004  |   .5332996   .0858169    -3.91   0.000     .3890439    .7310446
            2005  |   .5472369   .0822669    -4.01   0.000     .4075803    .7347468
            2006  |    .595267   .0913098    -3.38   0.001     .4407003    .8040448
            2007  |   .5792472   .0941236    -3.36   0.001     .4212595    .7964861
            2008  |   .4565885   .0745104    -4.80   0.000     .3316025    .6286835
            2009  |   .2258479   .0396826    -8.47   0.000     .1600501    .3186957
            2010  |   .3091971   .0569034    -6.38   0.000     .2155676    .4434934
            2011  |   .3801922    .068268    -5.39   0.000     .2673991    .5405631
            2012  |   .3308549    .063594    -5.75   0.000     .2270006    .4822231
            2013  |   .2292065   .0478903    -7.05   0.000     .1521869    .3452047
            2014  |   .1904161   .0420717    -7.51   0.000     .1234906    .2936117
            2015  |   .2476031   .0550304    -6.28   0.000     .1601675    .3827698
                  |
            _cons |    .000023   2.94e-06   -83.79   0.000     .0000179    .0000296
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.V.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.V.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6187) =      6063.44
                  Prob > chi2 =         0.8670

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2905.1305  
Iteration 2:   log likelihood = -2898.3634  
Iteration 3:   log likelihood = -2898.2301  
Iteration 4:   log likelihood = -2898.2299  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2789.81
                                                Prob > chi2       =     0.0000
Log likelihood = -2898.2299                     Pseudo R2         =     0.3249

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.121169   .0319757    35.06   0.000     1.058498    1.183841
      _hatsq |  -.0321808   .0151091    -2.13   0.033     -.061794   -.0025675
       _cons |   .0273431    .036237     0.75   0.451      -.04368    .0983663
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2770           748  |       3518
     -     |       674          2050  |       2724
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.43%
Specificity                     Pr( -|~D)   73.27%
Positive predictive value       Pr( D| +)   78.74%
Negative predictive value       Pr(~D| -)   75.26%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.73%
False - rate for true D         Pr( -| D)   19.57%
False + rate for classified +   Pr(~D| +)   21.26%
False - rate for classified -   Pr( D| -)   24.74%
--------------------------------------------------
Correctly classified                        77.22%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv3_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv3_res = dv_indicator - bv3_yhat
(11 missing values generated)

. 
. summ dv_indicator bv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
    bv3_yhat |      6,242    .5517462    .2917048   .0003793   .9999846

. /*
> pause "next"
> 
> scatter dv_indicator bv3_yhat
> 
> pause "next"
> 
> scatter bv3_res dv_indicator
> 
> pause "next"
> 
> scatter bv3_res bv3_yhat
> */
. pause "complete: B.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.4
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2923.4995  
Iteration 2:   log pseudolikelihood = -2912.0842  
Iteration 3:   log pseudolikelihood = -2911.9179  
Iteration 4:   log pseudolikelihood = -2911.9179  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2911.9179               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_c_lag_all |   .9778287   .0237627    -0.92   0.356     .9323465     1.02553
    p48_c_lag_all |   1.003935   .0060262     0.65   0.513     .9921927    1.015816
    p71_c_lag_all |   1.076504   .0391847     2.03   0.043     1.002379     1.15611
    p72_c_lag_all |    .998288    .014477    -0.12   0.906     .9703131    1.027069
    p75_c_lag_all |   1.000007   .0000454     0.16   0.873     .9999182    1.000096
    p77_c_lag_all |   1.001792   .0023902     0.75   0.453     .9971179    1.006487
        mine_time |   .9871589   .0150403    -0.85   0.396     .9581162    1.017082
onsite_insp_hours |   1.001238    .000173     7.16   0.000     1.000899    1.001577
                  |
            state |
               1  |    1.57945   .6341496     1.14   0.255     .7190318    3.469473
               2  |   2.845036   .2863759    10.39   0.000     2.335648    3.465517
               3  |   .6013883   .2634117    -1.16   0.246     .2548728    1.419013
               4  |   1.859045   .5519727     2.09   0.037     1.038862    3.326763
               5  |   .7839902   .2187534    -0.87   0.383     .4537362    1.354621
               6  |   .7174324   .0646325    -3.69   0.000     .6013086     .855982
               7  |   .9588738   .2648419    -0.15   0.879     .5580315    1.647647
               8  |   1.327372   .1001904     3.75   0.000     1.144837    1.539011
               9  |   2.292652   .2276718     8.36   0.000     1.887164    2.785266
              10  |   .5880255   .2225064    -1.40   0.161     .2800948    1.234489
              11  |     .66347   .1849816    -1.47   0.141     .3841478    1.145893
              12  |   .9352319   .1610863    -0.39   0.697     .6672777    1.310787
              13  |   2.046801    .767153     1.91   0.056     .9818389    4.266885
              14  |   .6521618    .218904    -1.27   0.203     .3377862    1.259125
              15  |   .5910434   .0628915    -4.94   0.000     .4797832    .7281045
              17  |          1  (empty)
                  |
             time |
            2000  |   .9790384   .1353222    -0.15   0.878     .7467017    1.283667
            2002  |   .7317675   .1074718    -2.13   0.033     .5487323    .9758559
            2003  |   .7885696   .1309971    -1.43   0.153     .5694277    1.092047
            2004  |   .5226786   .0837114    -4.05   0.000      .381863    .7154211
            2005  |   .5333045   .0789127    -4.25   0.000     .3990465    .7127331
            2006  |   .5914446   .0897998    -3.46   0.001     .4392128    .7964401
            2007  |   .5904012   .0952634    -3.27   0.001     .4303311    .8100124
            2008  |   .4716433   .0765795    -4.63   0.000     .3430885    .6483673
            2009  |   .2376121   .0418331    -8.16   0.000      .168271    .3355273
            2010  |   .3191806   .0587542    -6.20   0.000     .2225096    .4578509
            2011  |   .3870708   .0700216    -5.25   0.000     .2715232    .5517901
            2012  |    .327754   .0631706    -5.79   0.000     .2246411     .478197
            2013  |   .2168723   .0451041    -7.35   0.000     .1442697    .3260116
            2014  |   .1743546   .0382318    -7.97   0.000      .113445    .2679671
            2015  |   .2268158   .0513915    -6.55   0.000     .1454822    .3536201
                  |
            _cons |   .0000242   3.10e-06   -83.02   0.000     .0000188    .0000311
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.V.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.V.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6188) =      6245.40
                  Prob > chi2 =         0.3014

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2909.2831  
Iteration 2:   log likelihood = -2903.3186  
Iteration 3:   log likelihood = -2903.0551  
Iteration 4:   log likelihood = -2903.0546  
Iteration 5:   log likelihood = -2903.0546  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2780.16
                                                Prob > chi2       =     0.0000
Log likelihood = -2903.0546                     Pseudo R2         =     0.3238

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.124364   .0321293    35.00   0.000     1.061392    1.187336
      _hatsq |   -.034881   .0150552    -2.32   0.021    -.0643887   -.0053733
       _cons |   .0293478   .0361122     0.81   0.416    -.0414308    .1001264
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2770           753  |       3523
     -     |       674          2045  |       2719
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.43%
Specificity                     Pr( -|~D)   73.09%
Positive predictive value       Pr( D| +)   78.63%
Negative predictive value       Pr(~D| -)   75.21%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.91%
False - rate for true D         Pr( -| D)   19.57%
False + rate for classified +   Pr(~D| +)   21.37%
False - rate for classified -   Pr( D| -)   24.79%
--------------------------------------------------
Correctly classified                        77.14%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv4_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bv4_res = dv_indicator - bv4_yhat
(11 missing values generated)

. 
. summ dv_indicator bv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
    bv4_yhat |      6,242    .5517462    .2909416   .0003767   .9999949

. /*
> pause "next"
> 
> scatter dv_indicator bv4_yhat
> 
> pause "next"
> 
> scatter bv4_res dv_indicator
> 
> pause "next"
> 
> scatter bv4_res bv4_yhat
> */
. pause "complete: B.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.1
. 
. eststo clear

. eststo: logit dv_indicator `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2914.5158  
Iteration 2:   log pseudolikelihood = -2903.8283  
Iteration 3:   log pseudolikelihood =  -2903.748  
Iteration 4:   log pseudolikelihood = -2903.7479  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2903.7479               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_ss |   .6352314   .3293265    -0.88   0.381     .2299528     1.75479
           p48_ss |   1.171684   .1327103     1.40   0.162     .9384246    1.462923
           p71_ss |    .939042   .3661318    -0.16   0.872     .4373228    2.016359
           p72_ss |   1.709626   .7253851     1.26   0.206     .7442874    3.927004
           p75_ss |   1.012015   .0031055     3.89   0.000     1.005946     1.01812
           p77_ss |   1.099199   .0620249     1.68   0.094     .9841133    1.227743
        mine_time |   .9987127   .0138107    -0.09   0.926     .9720077    1.026151
onsite_insp_hours |   1.001017    .000174     5.85   0.000     1.000676    1.001358
                  |
            state |
               1  |   1.542242   .5975242     1.12   0.263      .721712    3.295648
               2  |   2.475664   .2293035     9.79   0.000     2.064671    2.968469
               3  |   .7908054   .2668313    -0.70   0.487     .4081874    1.532074
               4  |   1.927857    .589763     2.15   0.032      1.05847    3.511327
               5  |     .82208   .2254894    -0.71   0.475     .4802163    1.407315
               6  |   .7066711    .063855    -3.84   0.000     .5919739    .8435913
               7  |   .8734609   .2659384    -0.44   0.657     .4809304    1.586371
               8  |   1.434084   .1084697     4.77   0.000     1.236495    1.663247
               9  |   2.642245   .2308683    11.12   0.000     2.226377    3.135794
              10  |   .5900099   .2212164    -1.41   0.159     .2829518    1.230286
              11  |   .6126293   .1723441    -1.74   0.082     .3529708    1.063302
              12  |   .9992131   .1726046    -0.00   0.996     .7122313    1.401829
              13  |   2.008055   .7417101     1.89   0.059      .973575    4.141729
              14  |   .6333267   .1955112    -1.48   0.139     .3458258     1.15984
              15  |   .5729848    .061035    -5.23   0.000     .4650206    .7060151
              17  |          1  (empty)
                  |
             time |
            2000  |   .9763308    .137214    -0.17   0.865     .7412569    1.285953
            2002  |   .7513995   .1119382    -1.92   0.055     .5611319    1.006183
            2003  |   .8052271    .135797    -1.28   0.199     .5785861    1.120647
            2004  |   .5238199    .084673    -4.00   0.000     .3815832    .7190758
            2005  |   .5334796   .0800627    -4.19   0.000     .3975324    .7159177
            2006  |   .5716445   .0876631    -3.65   0.000     .4232454    .7720757
            2007  |    .567999   .0925365    -3.47   0.001     .4127363    .7816682
            2008  |   .4628924   .0752347    -4.74   0.000     .3366145    .6365424
            2009  |    .242954    .042545    -8.08   0.000     .1723716    .3424384
            2010  |   .3195651   .0585727    -6.22   0.000     .2231227    .4576938
            2011  |   .3966892   .0714844    -5.13   0.000     .2786518    .5647276
            2012  |   .3539807   .0681875    -5.39   0.000     .2426677    .5163535
            2013  |   .2457639   .0519789    -6.64   0.000     .1623639    .3720032
            2014  |   .1979514   .0440216    -7.28   0.000     .1280157    .3060934
            2015  |    .259384   .0576872    -6.07   0.000     .1677395    .4010985
                  |
            _cons |   .0000218   2.78e-06   -84.26   0.000      .000017     .000028
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.SSV.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.SSV.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6187) =      5780.99
                  Prob > chi2 =         0.9999

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2904.2004  
Iteration 2:   log likelihood = -2896.4235  
Iteration 3:   log likelihood = -2896.2586  
Iteration 4:   log likelihood = -2896.2584  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2793.76
                                                Prob > chi2       =     0.0000
Log likelihood = -2896.2584                     Pseudo R2         =     0.3254

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.116059   .0317027    35.20   0.000     1.053923    1.178195
      _hatsq |  -.0266731    .015325    -1.74   0.082    -.0567097    .0033634
       _cons |   .0217673   .0364235     0.60   0.550    -.0496214     .093156
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2766           740  |       3506
     -     |       678          2058  |       2736
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.31%
Specificity                     Pr( -|~D)   73.55%
Positive predictive value       Pr( D| +)   78.89%
Negative predictive value       Pr(~D| -)   75.22%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.45%
False - rate for true D         Pr( -| D)   19.69%
False + rate for classified +   Pr(~D| +)   21.11%
False - rate for classified -   Pr( D| -)   24.78%
--------------------------------------------------
Correctly classified                        77.28%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv1_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv1_res = dv_indicator - bssv1_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
  bssv1_yhat |      6,242    .5517462    .2922274   .0003881   .9999785

. /*
> pause "next"
> 
> scatter dv_indicator bssv1_yhat
> 
> pause "next"
> 
> scatter bssv1_res dv_indicator
> 
> pause "next"
> 
> scatter bssv1_res bssv1_yhat
> */
. pause "complete: B.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.2
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2914.0314  
Iteration 2:   log pseudolikelihood = -2903.2526  
Iteration 3:   log pseudolikelihood = -2903.1676  
Iteration 4:   log pseudolikelihood = -2903.1676  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2903.1676               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_ss_1lag |   .7258601   .3086376    -0.75   0.451     .3154422    1.670267
      p48_ss_1lag |   1.117878   .1220713     1.02   0.308      .902493    1.384665
      p71_ss_1lag |   1.463456   .8309898     0.67   0.502     .4808889    4.453637
      p72_ss_1lag |   1.460691   .5870725     0.94   0.346     .6644289    3.211207
      p75_ss_1lag |   1.012566   .0031159     4.06   0.000     1.006477    1.018691
      p77_ss_1lag |   1.117324   .0686049     1.81   0.071     .9906365    1.260213
        mine_time |   .9969206   .0138135    -0.22   0.824      .970211    1.024366
onsite_insp_hours |    1.00102   .0001735     5.88   0.000      1.00068     1.00136
                  |
            state |
               1  |   1.554208   .6062701     1.13   0.258     .7235522    3.338477
               2  |   2.477279   .2318054     9.69   0.000     2.062177     2.97594
               3  |   .7931716   .2660993    -0.69   0.490       .41096    1.530857
               4  |   1.923449   .5866915     2.14   0.032     1.057905    3.497153
               5  |   .8314895   .2292316    -0.67   0.503     .4843851    1.427325
               6  |   .7071298   .0638555    -3.84   0.000     .5924253    .8440432
               7  |   .8686986    .263538    -0.46   0.643     .4793351    1.574342
               8  |   1.443547   .1099394     4.82   0.000      1.24338    1.675937
               9  |   2.647301   .2309645    11.16   0.000     2.231208    3.140991
              10  |   .5923538   .2223668    -1.39   0.163     .2838207    1.236284
              11  |   .6136372    .170265    -1.76   0.078     .3562296    1.057044
              12  |   1.003959    .173745     0.02   0.982     .7151662    1.409369
              13  |   1.968712   .7184173     1.86   0.063     .9628622    4.025321
              14  |   .6436121    .196453    -1.44   0.149     .3538406    1.170687
              15  |    .572748   .0610265    -5.23   0.000     .4648017    .7057638
              17  |          1  (empty)
                  |
             time |
            2000  |   1.021684   .1437477     0.15   0.879     .7754522    1.346101
            2002  |   .7533491   .1119597    -1.91   0.057     .5629815    1.008088
            2003  |   .8107287   .1370193    -1.24   0.214     .5821246    1.129107
            2004  |   .5270408   .0852662    -3.96   0.000     .3838261    .7236925
            2005  |   .5405513   .0808522    -4.11   0.000     .4031991    .7246933
            2006  |   .5803518   .0890797    -3.54   0.000     .4295741    .7840513
            2007  |   .5753998   .0941024    -3.38   0.001     .4176014    .7928251
            2008  |   .4659812   .0763407    -4.66   0.000      .338001    .6424197
            2009  |   .2417449   .0424993    -8.08   0.000     .1712829    .3411934
            2010  |   .3238721   .0594331    -6.14   0.000     .2260327    .4640618
            2011  |   .3956667   .0714486    -5.13   0.000     .2777291    .5636864
            2012  |   .3494511   .0676019    -5.43   0.000     .2391773    .5105671
            2013  |   .2476429   .0523469    -6.60   0.000     .1636434    .3747601
            2014  |   .1999399   .0445528    -7.22   0.000      .129189    .3094378
            2015  |   .2616759   .0584179    -6.01   0.000     .1689418     .405313
                  |
            _cons |   .0000216   2.77e-06   -84.01   0.000     .0000168    .0000278
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.SSV.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.SSV.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6187) =      5955.45
                  Prob > chi2 =         0.9822

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2902.2438  
Iteration 2:   log likelihood = -2895.2654  
Iteration 3:   log likelihood =   -2895.14  
Iteration 4:   log likelihood = -2895.1399  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2795.99
                                                Prob > chi2       =     0.0000
Log likelihood = -2895.1399                     Pseudo R2         =     0.3256

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.118787   .0318506    35.13   0.000     1.056361    1.181213
      _hatsq |  -.0311357   .0151139    -2.06   0.039    -.0607585   -.0015129
       _cons |   .0266067   .0363214     0.73   0.464    -.0445819    .0977952
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2776           738  |       3514
     -     |       668          2060  |       2728
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.60%
Specificity                     Pr( -|~D)   73.62%
Positive predictive value       Pr( D| +)   79.00%
Negative predictive value       Pr(~D| -)   75.51%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.38%
False - rate for true D         Pr( -| D)   19.40%
False + rate for classified +   Pr(~D| +)   21.00%
False - rate for classified -   Pr( D| -)   24.49%
--------------------------------------------------
Correctly classified                        77.48%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv2_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv2_res = dv_indicator - bssv2_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
  bssv2_yhat |      6,242    .5517462      .29228   .0003875    .999968

. /*
> pause "next"
> 
> scatter dv_indicator bssv2_yhat
> 
> pause "next"
> 
> scatter bssv2_res dv_indicator
> 
> pause "next"
> 
> scatter bssv2_res bssv2_yhat
> */
. pause "complete: B.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.3
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2915.7702  
Iteration 2:   log pseudolikelihood = -2905.0287  
Iteration 3:   log pseudolikelihood =  -2904.946  
Iteration 4:   log pseudolikelihood =  -2904.946  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood =  -2904.946               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_ss_c_4lag |   .8509692   .1572353    -0.87   0.382      .592428     1.22234
    p48_ss_c_4lag |   1.020622   .0400431     0.52   0.603     .9450806    1.102201
    p71_ss_c_4lag |   1.060803   .1816068     0.34   0.730     .7584227    1.483742
    p72_ss_c_4lag |   1.095294   .1200154     0.83   0.406     .8836117    1.357688
    p75_ss_c_4lag |   1.003001   .0008594     3.50   0.000     1.001318    1.004687
    p77_ss_c_4lag |   1.043161   .0214425     2.06   0.040      1.00197    1.086045
        mine_time |   .9936684   .0138594    -0.46   0.649     .9668723    1.021207
onsite_insp_hours |   1.001029   .0001751     5.88   0.000     1.000686    1.001372
                  |
            state |
               1  |   1.534891   .5995648     1.10   0.273     .7138026     3.30048
               2  |   2.504568   .2397892     9.59   0.000     2.076052    3.021534
               3  |   .7825016   .2653706    -0.72   0.470     .4025467    1.521087
               4  |   1.914323   .5802436     2.14   0.032     1.056843    3.467527
               5  |   .8268889    .230106    -0.68   0.495     .4792647    1.426655
               6  |   .7097054   .0640039    -3.80   0.000     .5947214    .8469205
               7  |   .8573662    .259611    -0.51   0.611     .4736113    1.552068
               8  |   1.417537   .1086748     4.55   0.000     1.219769    1.647371
               9  |   2.551371   .2270488    10.53   0.000     2.143011    3.037546
              10  |   .5860595   .2206196    -1.42   0.156     .2802274    1.225668
              11  |   .6264475   .1743424    -1.68   0.093     .3630717    1.080879
              12  |   .9956008   .1723047    -0.03   0.980      .709204    1.397653
              13  |   1.965748   .7112791     1.87   0.062     .9672357    3.995062
              14  |   .6487696   .2062264    -1.36   0.173     .3479497    1.209663
              15  |   .5688987    .060867    -5.27   0.000     .4612794    .7016263
              17  |          1  (empty)
                  |
             time |
            2000  |   1.074136   .1519456     0.51   0.613     .8140468    1.417323
            2002  |   .7440779   .1108826    -1.98   0.047     .5556128    .9964708
            2003  |   .8086896   .1364488    -1.26   0.208     .5809786    1.125651
            2004  |   .5301772   .0858996    -3.92   0.000     .3859304    .7283383
            2005  |   .5393385   .0809014    -4.12   0.000     .4019575    .7236736
            2006  |    .589326   .0907085    -3.44   0.001     .4358523    .7968412
            2007  |   .5779432   .0944506    -3.35   0.001     .4195437    .7961468
            2008  |   .4704824   .0770997    -4.60   0.000     .3412353    .6486836
            2009  |   .2424716   .0427448    -8.04   0.000     .1716344    .3425449
            2010  |   .3256042   .0597066    -6.12   0.000     .2273022    .4664191
            2011  |   .3948465   .0714134    -5.14   0.000     .2769982    .5628332
            2012  |   .3483477   .0673523    -5.45   0.000     .2384706    .5088514
            2013  |    .245686   .0518863    -6.65   0.000     .1624111    .3716594
            2014  |   .1999602   .0445559    -7.22   0.000     .1292039     .309465
            2015  |   .2623772   .0586798    -5.98   0.000     .1692612    .4067191
                  |
            _cons |   .0000222   2.82e-06   -84.12   0.000     .0000173    .0000284
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.SSV.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.SSV.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6187) =      5927.03
                  Prob > chi2 =         0.9910

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2904.1557  
Iteration 2:   log likelihood = -2897.1231  
Iteration 3:   log likelihood = -2896.9991  
Iteration 4:   log likelihood =  -2896.999  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2792.28
                                                Prob > chi2       =     0.0000
Log likelihood =  -2896.999                     Pseudo R2         =     0.3252

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |    1.11835   .0318374    35.13   0.000      1.05595     1.18075
      _hatsq |  -.0306355   .0151406    -2.02   0.043    -.0603106   -.0009605
       _cons |   .0259483   .0363155     0.71   0.475    -.0452288    .0971255
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2768           746  |       3514
     -     |       676          2052  |       2728
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.37%
Specificity                     Pr( -|~D)   73.34%
Positive predictive value       Pr( D| +)   78.77%
Negative predictive value       Pr(~D| -)   75.22%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.66%
False - rate for true D         Pr( -| D)   19.63%
False + rate for classified +   Pr(~D| +)   21.23%
False - rate for classified -   Pr( D| -)   24.78%
--------------------------------------------------
Correctly classified                        77.22%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv3_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv3_res = dv_indicator - bssv3_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
  bssv3_yhat |      6,242    .5517462    .2921125   .0003923   .9999582

. /*
> pause "next"
> 
> scatter dv_indicator bssv3_yhat
> 
> pause "next"
> 
> scatter bssv3_res dv_indicator
> 
> pause "next"
> 
> scatter bssv3_res bssv3_yhat
> */
. pause "complete: B.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.4
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2920.1369  
Iteration 2:   log pseudolikelihood = -2907.5274  
Iteration 3:   log pseudolikelihood = -2907.3854  
Iteration 4:   log pseudolikelihood = -2907.3854  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2907.3854               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_ss_c_lag_all |    .964119   .0731468    -0.48   0.630     .8309038    1.118692
 p48_ss_c_lag_all |   1.005917   .0147843     0.40   0.688     .9773539    1.035315
 p71_ss_c_lag_all |   1.104962   .1004519     1.10   0.272     .9246235    1.320474
 p72_ss_c_lag_all |   .9466233   .0282305    -1.84   0.066     .8928785    1.003603
 p75_ss_c_lag_all |   1.000078   .0001387     0.56   0.572     .9998066     1.00035
 p77_ss_c_lag_all |   1.022119   .0085524     2.61   0.009     1.005493    1.039019
        mine_time |   .9868603   .0151804    -0.86   0.390     .9575513    1.017066
onsite_insp_hours |   1.001213   .0001716     7.07   0.000     1.000877    1.001549
                  |
            state |
               1  |    1.56394   .6341951     1.10   0.270     .7063966    3.462516
               2  |   2.899174   .2869066    10.76   0.000      2.38802    3.519739
               3  |   .7034155   .2624539    -0.94   0.346     .3385455    1.461527
               4  |   1.804301   .5441323     1.96   0.050     .9990973    3.258444
               5  |   .7981876   .2211156    -0.81   0.416     .4637707    1.373747
               6  |   .7171244   .0647553    -3.68   0.000     .6008032    .8559664
               7  |   .9674284   .2455989    -0.13   0.896     .5882016    1.591151
               8  |   1.365767   .1025272     4.15   0.000     1.178902    1.582253
               9  |   2.715147    .272951     9.94   0.000     2.229579    3.306463
              10  |   .5812866   .2203428    -1.43   0.152     .2765244    1.221933
              11  |   .6307678   .1562254    -1.86   0.063     .3881934    1.024922
              12  |   .9663847   .1683108    -0.20   0.844     .6869105    1.359565
              13  |   2.063931   .7719023     1.94   0.053     .9916289    4.295773
              14  |   .7414964   .2536473    -0.87   0.382     .3792577    1.449719
              15  |   .5893005   .0622836    -5.00   0.000      .479041    .7249381
              17  |          1  (empty)
                  |
             time |
            2000  |   .9782582   .1353665    -0.16   0.874     .7458791    1.283035
            2002  |   .7267707   .1069756    -2.17   0.030     .5446362    .9698138
            2003  |    .780988    .129953    -1.49   0.137     .5636483    1.082133
            2004  |   .5168383   .0830686    -4.11   0.000     .3771775    .7082125
            2005  |   .5263829   .0780598    -4.33   0.000     .3936162    .7039317
            2006  |   .5870875   .0893956    -3.50   0.000     .4356029    .7912522
            2007  |   .5829884   .0940203    -3.35   0.001     .4249953    .7997158
            2008  |   .4664039   .0759987    -4.68   0.000     .3388927    .6418923
            2009  |   .2349559   .0415966    -8.18   0.000     .1660695    .3324168
            2010  |   .3159569   .0580034    -6.28   0.000     .2204775    .4527845
            2011  |   .3837075   .0696269    -5.28   0.000     .2688702     .547593
            2012  |   .3270894    .063229    -5.78   0.000     .2239352    .4777609
            2013  |   .2200801   .0461246    -7.22   0.000     .1459436    .3318763
            2014  |   .1769607   .0391851    -7.82   0.000     .1146548    .2731251
            2015  |   .2317806   .0521268    -6.50   0.000     .1491572    .3601718
                  |
            _cons |    .000024   3.07e-06   -83.31   0.000     .0000187    .0000309
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.SSV.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.SSV.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6187) =      6248.95
                  Prob > chi2 =         0.2874

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2903.9048  
Iteration 2:   log likelihood =  -2898.261  
Iteration 3:   log likelihood = -2898.0651  
Iteration 4:   log likelihood = -2898.0645  
Iteration 5:   log likelihood = -2898.0645  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2790.14
                                                Prob > chi2       =     0.0000
Log likelihood = -2898.0645                     Pseudo R2         =     0.3250

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.126639   .0322758    34.91   0.000     1.063379    1.189898
      _hatsq |  -.0373195   .0148197    -2.52   0.012    -.0663656   -.0082734
       _cons |   .0319753   .0359988     0.89   0.374     -.038581    .1025316
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2787           756  |       3543
     -     |       657          2042  |       2699
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.92%
Specificity                     Pr( -|~D)   72.98%
Positive predictive value       Pr( D| +)   78.66%
Negative predictive value       Pr(~D| -)   75.66%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   27.02%
False - rate for true D         Pr( -| D)   19.08%
False + rate for classified +   Pr(~D| +)   21.34%
False - rate for classified -   Pr( D| -)   24.34%
--------------------------------------------------
Correctly classified                        77.36%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv4_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bssv4_res = dv_indicator - bssv4_yhat
(11 missing values generated)

. 
. summ dv_indicator bssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
  bssv4_yhat |      6,242    .5517462    .2912751    .000379   .9999924

. /*
> pause "next"
> 
> scatter dv_indicator bssv4_yhat
> 
> pause "next"
> 
> scatter bssv4_res dv_indicator
> 
> pause "next"
> 
> scatter bssv4_res bssv4_yhat
> */
. pause "complete: B.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.1
. 
. eststo clear

. eststo: logit dv_indicator `pp_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2922.7156  
Iteration 2:   log pseudolikelihood = -2912.6906  
Iteration 3:   log pseudolikelihood = -2912.6471  
Iteration 4:   log pseudolikelihood = -2912.6471  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2912.6471               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p47_pp |   .9976455   .0025645    -0.92   0.359     .9926318    1.002685
           p48_pp |   1.001506   .0010194     1.48   0.139     .9995096    1.003506
           p71_pp |   1.004242   .0035707     1.19   0.234     .9972681    1.011265
           p72_pp |   1.001971   .0028374     0.70   0.487     .9964253    1.007548
           p75_pp |   1.000021   .0000205     1.05   0.296     .9999813    1.000062
           p77_pp |   1.000378    .000369     1.02   0.306     .9996546    1.001101
        mine_time |    .995371   .0139834    -0.33   0.741     .9683379    1.023159
onsite_insp_hours |   1.001153   .0001926     5.99   0.000     1.000776    1.001531
                  |
            state |
               1  |   1.646522   .6558503     1.25   0.211      .754246    3.594364
               2  |   2.622154   .2458365    10.28   0.000     2.182001    3.151095
               3  |   .7740309   .2680941    -0.74   0.460     .3925865    1.526094
               4  |   1.823595   .5603916     1.96   0.051      .998513    3.330451
               5  |   .7869362   .2205513    -0.85   0.393     .4543357     1.36302
               6  |   .7228738   .0651488    -3.60   0.000     .6058264    .8625352
               7  |   .8998782   .2694461    -0.35   0.725     .5003946    1.618284
               8  |   1.262596   .1009737     2.92   0.004     1.079422    1.476855
               9  |   2.356338   .2388989     8.45   0.000     1.931692    2.874334
              10  |   .5987756   .2226782    -1.38   0.168     .2888759    1.241129
              11  |   .7113966   .1944603    -1.25   0.213     .4163282    1.215592
              12  |   .9660693   .1671733    -0.20   0.842     .6881961    1.356139
              13  |   1.957857   .7267594     1.81   0.070     .9458315    4.052735
              14  |   .6509294   .2094039    -1.33   0.182     .3464993    1.222828
              15  |    .577743   .0618457    -5.13   0.000      .468399    .7126124
              17  |          1  (empty)
                  |
             time |
            2000  |   .9699495   .1338288    -0.22   0.825     .7401242    1.271141
            2002  |   .7303163   .1069638    -2.15   0.032     .5480776    .9731504
            2003  |   .7871671    .130466    -1.44   0.149      .568837    1.089296
            2004  |   .5225548   .0836893    -4.05   0.000     .3817758    .7152457
            2005  |   .5330724   .0795002    -4.22   0.000      .397962    .7140536
            2006  |   .5904028   .0896082    -3.47   0.001     .4384879    .7949489
            2007  |   .5476603   .0901348    -3.66   0.000     .3966607    .7561419
            2008  |   .4173262   .0700278    -5.21   0.000     .3003607      .57984
            2009  |   .2096657   .0377668    -8.67   0.000     .1472996    .2984373
            2010  |    .288791   .0541389    -6.63   0.000     .1999912    .4170194
            2011  |   .3511632   .0643068    -5.71   0.000     .2452633    .5027885
            2012  |   .3038274   .0588505    -6.15   0.000     .2078507     .444122
            2013  |     .20507   .0430833    -7.54   0.000     .1358541    .3095505
            2014  |   .1656638   .0366134    -8.13   0.000     .1074245    .2554769
            2015  |   .2180571   .0485399    -6.84   0.000     .1409584    .3373257
                  |
            _cons |   .0000244   3.08e-06   -84.09   0.000      .000019    .0000312
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.1.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.PP.1.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.PP.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6188) =      5855.26
                  Prob > chi2 =         0.9988

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2911.7935  
Iteration 2:   log likelihood = -2904.8322  
Iteration 3:   log likelihood = -2904.7143  
Iteration 4:   log likelihood = -2904.7142  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2776.85
                                                Prob > chi2       =     0.0000
Log likelihood = -2904.7142                     Pseudo R2         =     0.3234

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.119353   .0318012    35.20   0.000     1.057023    1.181682
      _hatsq |  -.0284426   .0154032    -1.85   0.065    -.0586323    .0017471
       _cons |   .0225594   .0363665     0.62   0.535    -.0487175    .0938364
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2779           749  |       3528
     -     |       665          2049  |       2714
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.69%
Specificity                     Pr( -|~D)   73.23%
Positive predictive value       Pr( D| +)   78.77%
Negative predictive value       Pr(~D| -)   75.50%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.77%
False - rate for true D         Pr( -| D)   19.31%
False + rate for classified +   Pr(~D| +)   21.23%
False - rate for classified -   Pr( D| -)   24.50%
--------------------------------------------------
Correctly classified                        77.35%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp1_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bpp1_res = dv_indicator - bpp1_yhat
(11 missing values generated)

. 
. summ dv_indicator bpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
   bpp1_yhat |      6,242    .5517462    .2911151   .0003609   .9999702

. /*
> pause "next"
> 
> scatter dv_indicator bpp1_yhat
> 
> pause "next"
> 
> scatter bpp1_res dv_indicator
> 
> pause "next"
> 
> scatter bpp1_res bpp1_yhat
> */
. pause "complete: B.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.2
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2923.7227  
Iteration 2:   log pseudolikelihood = -2913.8187  
Iteration 3:   log pseudolikelihood = -2913.7767  
Iteration 4:   log pseudolikelihood = -2913.7767  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2913.7767               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p47_pp_1lag |   .9991463   .0024383    -0.35   0.726     .9943786    1.003937
      p48_pp_1lag |   1.001121    .000892     1.26   0.209     .9993737     1.00287
      p71_pp_1lag |   1.004358   .0037832     1.15   0.248     .9969703      1.0118
      p72_pp_1lag |   .9988678   .0026738    -0.42   0.672      .993641    1.004122
      p75_pp_1lag |   1.000018   .0000201     0.89   0.371     .9999786    1.000057
      p77_pp_1lag |   1.000447   .0003887     1.15   0.250     .9996854    1.001209
        mine_time |   .9946808   .0140738    -0.38   0.706     .9674757    1.022651
onsite_insp_hours |   1.001201     .00019     6.33   0.000     1.000829    1.001573
                  |
            state |
               1  |    1.64942   .6580939     1.25   0.210     .7545963    3.605354
               2  |   2.632863   .2468622    10.32   0.000     2.190877    3.164015
               3  |   .7887567   .2709626    -0.69   0.490     .4022803    1.546527
               4  |   1.823331   .5661426     1.93   0.053     .9921289     3.35091
               5  |   .7947091   .2208579    -0.83   0.408     .4609464    1.370143
               6  |   .7237752   .0651354    -3.59   0.000     .6067373    .8633895
               7  |   .9031121   .2684437    -0.34   0.732     .5043453    1.617169
               8  |   1.290042   .1051577     3.12   0.002     1.099559    1.513525
               9  |   2.444152   .2458228     8.89   0.000     2.006864    2.976725
              10  |   .5931226   .2215329    -1.40   0.162     .2852453    1.233305
              11  |   .7166463   .1955009    -1.22   0.222     .4198531    1.223242
              12  |   .9604131   .1664467    -0.23   0.816     .6838148    1.348893
              13  |   1.962193   .7254103     1.82   0.068     .9507314    4.049725
              14  |   .6798028   .2205234    -1.19   0.234     .3599639    1.283828
              15  |   .5840595   .0624562    -5.03   0.000     .4736245    .7202446
              17  |          1  (empty)
                  |
             time |
            2000  |    .973798   .1345165    -0.19   0.848     .7428264    1.276587
            2002  |   .7300864   .1070255    -2.15   0.032     .5477648    .9730931
            2003  |   .7867414    .130658    -1.44   0.149     .5681576     1.08942
            2004  |   .5211658    .083635    -4.06   0.000     .3805203    .7137957
            2005  |   .5341205   .0796596    -4.20   0.000     .3987398    .7154657
            2006  |     .59061   .0898621    -3.46   0.001      .438318    .7958152
            2007  |   .5654748   .0915868    -3.52   0.000     .4116698    .7767434
            2008  |   .4247124   .0712964    -5.10   0.000     .3056356    .5901821
            2009  |   .2133548   .0381195    -8.65   0.000     .1503213    .3028198
            2010  |   .2927743   .0548656    -6.55   0.000      .202777    .4227145
            2011  |   .3561445   .0647559    -5.68   0.000     .2493771    .5086227
            2012  |   .3026988   .0588822    -6.14   0.000     .2067433    .4431899
            2013  |   .2050716   .0431542    -7.53   0.000     .1357635    .3097618
            2014  |   .1668944   .0367662    -8.13   0.000      .108374    .2570147
            2015  |   .2180657   .0485809    -6.84   0.000     .1409146    .3374572
                  |
            _cons |   .0000241   3.05e-06   -84.07   0.000     .0000188    .0000309
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.2.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.PP.2.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.PP.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6188) =      5938.62
                  Prob > chi2 =         0.9883

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2912.3212  
Iteration 2:   log likelihood = -2905.7094  
Iteration 3:   log likelihood = -2905.6055  
Iteration 4:   log likelihood = -2905.6054  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2775.06
                                                Prob > chi2       =     0.0000
Log likelihood = -2905.6054                     Pseudo R2         =     0.3232

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.120802   .0318932    35.14   0.000     1.058292    1.183311
      _hatsq |  -.0302442   .0153468    -1.97   0.049    -.0603234    -.000165
       _cons |   .0244253   .0363149     0.67   0.501    -.0467505    .0956012
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2773           756  |       3529
     -     |       671          2042  |       2713
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.52%
Specificity                     Pr( -|~D)   72.98%
Positive predictive value       Pr( D| +)   78.58%
Negative predictive value       Pr(~D| -)   75.27%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   27.02%
False - rate for true D         Pr( -| D)   19.48%
False + rate for classified +   Pr(~D| +)   21.42%
False - rate for classified -   Pr( D| -)   24.73%
--------------------------------------------------
Correctly classified                        77.14%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp2_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bpp2_res = dv_indicator - bpp2_yhat
(11 missing values generated)

. 
. summ dv_indicator bpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
   bpp2_yhat |      6,242    .5517462    .2909597    .000357   .9999461

. /*
> pause "next"
> 
> scatter dv_indicator bpp2_yhat
> 
> pause "next"
> 
> scatter bpp2_res dv_indicator
> 
> pause "next"
> 
> scatter bpp2_res bpp2_yhat
> */
. pause "complete: B.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.3
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2924.3282  
Iteration 2:   log pseudolikelihood = -2914.5799  
Iteration 3:   log pseudolikelihood = -2914.5412  
Iteration 4:   log pseudolikelihood = -2914.5412  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2914.5412               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p47_pp_c_4lag |   .9997641   .0008487    -0.28   0.781     .9981022    1.001429
    p48_pp_c_4lag |     1.0005   .0002964     1.69   0.092     .9999192    1.001081
    p71_pp_c_4lag |   1.000811    .001165     0.70   0.486     .9985305    1.003097
    p72_pp_c_4lag |   .9998368   .0008338    -0.20   0.845     .9982039    1.001472
    p75_pp_c_4lag |   1.000001   5.26e-06     0.22   0.824     .9999909    1.000011
    p77_pp_c_4lag |   1.000099   .0001234     0.81   0.421     .9998575    1.000341
        mine_time |   .9946534   .0141837    -0.38   0.707     .9672387    1.022845
onsite_insp_hours |   1.001261   .0001926     6.55   0.000     1.000884    1.001639
                  |
            state |
               1  |   1.639715   .6553038     1.24   0.216     .7491868    3.588779
               2  |   2.649917   .2507324    10.30   0.000     2.201368    3.189864
               3  |   .7830585   .2677312    -0.72   0.474     .4006496    1.530466
               4  |   1.825532   .5641994     1.95   0.051     .9961322    3.345508
               5  |   .7918874   .2221558    -0.83   0.406      .456949    1.372332
               6  |   .7216814   .0650391    -3.62   0.000     .6048307    .8611071
               7  |   .9255983   .2680997    -0.27   0.790     .5246527    1.632951
               8  |   1.287079   .1070369     3.03   0.002     1.093496    1.514933
               9  |   2.452365   .2699596     8.15   0.000     1.976441    3.042892
              10  |   .5913877   .2214773    -1.40   0.161     .2838531    1.232114
              11  |   .7215322   .1962921    -1.20   0.230     .4233379    1.229771
              12  |   .9473668   .1647411    -0.31   0.756     .6737512      1.3321
              13  |   1.963024   .7229184     1.83   0.067     .9537962    4.040133
              14  |   .6683586   .2225664    -1.21   0.226     .3479811      1.2837
              15  |    .584842   .0627985    -5.00   0.000     .4738482    .7218349
              17  |          1  (empty)
                  |
             time |
            2000  |   .9760037   .1350314    -0.18   0.861     .7441947    1.280019
            2002  |   .7274137   .1068885    -2.17   0.030      .545385    .9701966
            2003  |     .78409   .1305187    -1.46   0.144     .5658168    1.086566
            2004  |   .5184049   .0834185    -4.08   0.000     .3781804    .7106228
            2005  |   .5300504   .0794317    -4.24   0.000      .395147    .7110097
            2006  |   .5872311   .0896667    -3.49   0.000     .4353472    .7921044
            2007  |   .5735418   .0926753    -3.44   0.001     .4178538    .7872376
            2008  |   .4381872   .0730508    -4.95   0.000     .3160493    .6075256
            2009  |   .2206031   .0392719    -8.49   0.000     .1556253    .3127109
            2010  |   .2997624    .056118    -6.44   0.000     .2076946    .4326424
            2011  |   .3617537   .0655956    -5.61   0.000     .2535522    .5161294
            2012  |   .3082072   .0598345    -6.06   0.000     .2106653    .4509128
            2013  |   .2067073     .04343    -7.50   0.000     .1369352    .3120303
            2014  |   .1679331   .0368083    -8.14   0.000     .1092865    .2580514
            2015  |   .2187823   .0488472    -6.81   0.000     .1412425    .3388901
                  |
            _cons |    .000024   3.04e-06   -83.78   0.000     .0000187    .0000308
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.3.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.PP.3.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.PP.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6226
           Pearson chi2(6187) =      5882.74
                  Prob > chi2 =         0.9972

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood =   -2913.74  
Iteration 2:   log likelihood = -2906.8283  
Iteration 3:   log likelihood = -2906.7159  
Iteration 4:   log likelihood = -2906.7158  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2772.84
                                                Prob > chi2       =     0.0000
Log likelihood = -2906.7158                     Pseudo R2         =     0.3229

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.118542   .0317892    35.19   0.000     1.056236    1.180848
      _hatsq |  -.0282286   .0154113    -1.83   0.067    -.0584343     .001977
       _cons |    .022322    .036359     0.61   0.539    -.0489402    .0935843
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2776           753  |       3529
     -     |       668          2045  |       2713
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.60%
Specificity                     Pr( -|~D)   73.09%
Positive predictive value       Pr( D| +)   78.66%
Negative predictive value       Pr(~D| -)   75.38%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.91%
False - rate for true D         Pr( -| D)   19.40%
False + rate for classified +   Pr(~D| +)   21.34%
False - rate for classified -   Pr( D| -)   24.62%
--------------------------------------------------
Correctly classified                        77.23%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp3_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bpp3_res = dv_indicator - bpp3_yhat
(11 missing values generated)

. 
. summ dv_indicator bpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
   bpp3_yhat |      6,242    .5517462    .2910032   .0003582   .9999594

. /*
> pause "next"
> 
> scatter dv_indicator bpp3_yhat
> 
> pause "next"
> 
> scatter bpp3_res dv_indicator
> 
> pause "next"
> 
> scatter bpp3_res bpp3_yhat
> */
. pause "complete: B.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.4
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: 17.state != 0 predicts success perfectly
      17.state dropped and 11 obs not used

Iteration 0:   log pseudolikelihood = -3080.1072  
Iteration 1:   log pseudolikelihood = -2923.9112  
Iteration 2:   log pseudolikelihood = -2912.9956  
Iteration 3:   log pseudolikelihood = -2912.8855  
Iteration 4:   log pseudolikelihood = -2912.8854  

Logistic regression                             Number of obs     =      6,242
                                                Wald chi2(35)     =          .
Log pseudolikelihood = -2912.8854               Prob > chi2       =          .

                                  (Std. Err. adjusted for 1,237 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p47_pp_c_lag_all |   .9994996   .0004869    -1.03   0.304     .9985458    1.000454
 p48_pp_c_lag_all |   1.000132   .0001461     0.90   0.367     .9998454    1.000418
 p71_pp_c_lag_all |   1.001372   .0008122     1.69   0.091     .9997813    1.002965
 p72_pp_c_lag_all |   .9998992   .0003015    -0.33   0.738     .9993085     1.00049
 p75_pp_c_lag_all |   .9999996   8.67e-07    -0.43   0.667     .9999979    1.000001
 p77_pp_c_lag_all |   1.000051   .0000529     0.96   0.339     .9999469    1.000154
        mine_time |   .9930259   .0145541    -0.48   0.633     .9649062    1.021965
onsite_insp_hours |   1.001284   .0001701     7.55   0.000     1.000951    1.001617
                  |
            state |
               1  |   1.630663   .6580786     1.21   0.226      .739348    3.596495
               2  |   2.772026   .2701212    10.46   0.000     2.290085     3.35539
               3  |    .699022   .2495174    -1.00   0.316     .3472583    1.407113
               4  |    1.83633   .5516014     2.02   0.043     1.019213    3.308543
               5  |   .7775604   .2185241    -0.90   0.371     .4482436    1.348821
               6  |   .7197661    .064587    -3.66   0.000     .6036847    .8581685
               7  |   .9438579   .2553908    -0.21   0.831     .5553758    1.604081
               8  |   1.300211   .0941747     3.62   0.000     1.128135    1.498534
               9  |   2.129868   .2168604     7.43   0.000     1.744554    2.600284
              10  |   .5902928   .2222818    -1.40   0.162     .2821872    1.234803
              11  |   .7178275   .1986903    -1.20   0.231     .4172657    1.234888
              12  |   .9235384   .1593339    -0.46   0.645     .6585686    1.295117
              13  |   2.029111   .7619826     1.88   0.060     .9719814    4.235977
              14  |    .668756   .2189398    -1.23   0.219      .352045     1.27039
              15  |   .5912406   .0627395    -4.95   0.000     .4802186    .7279299
              17  |          1  (empty)
                  |
             time |
            2000  |   .9725217   .1345722    -0.20   0.840      .741506     1.27551
            2002  |   .7276857   .1068141    -2.17   0.030      .545757    .9702604
            2003  |   .7842594   .1302496    -1.46   0.143     .5663597    1.085993
            2004  |   .5183902   .0830403    -4.10   0.000     .3787074    .7095938
            2005  |   .5284792   .0783876    -4.30   0.000     .3951591    .7067794
            2006  |   .5862874    .088951    -3.52   0.000     .4354788    .7893219
            2007  |   .5832943   .0942483    -3.34   0.001      .424963    .8006162
            2008  |   .4589044   .0746387    -4.79   0.000     .3336401    .6311988
            2009  |   .2295791   .0403982    -8.36   0.000     .1626109    .3241269
            2010  |   .3068644   .0568687    -6.37   0.000     .2134029    .4412581
            2011  |   .3712422    .067268    -5.47   0.000     .2602689    .5295323
            2012  |   .3132172   .0607712    -5.98   0.000     .2141377    .4581397
            2013  |   .2059354   .0434502    -7.49   0.000     .1361873     .311405
            2014  |   .1649283   .0362333    -8.20   0.000     .1072244    .2536862
            2015  |   .2152202    .048835    -6.77   0.000     .1379557    .3357582
                  |
            _cons |   .0000241   3.08e-06   -83.26   0.000     .0000188    .0000309
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.4.csv"', replace plain wide p eform
(note: file C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.PP.4.csv not found)
(output written to C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\Model.MR.Y.P.B.PP.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =      6242
 number of covariate patterns =      6227
           Pearson chi2(6188) =      6001.43
                  Prob > chi2 =         0.9543

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -4293.1367  
Iteration 1:   log likelihood = -2910.4585  
Iteration 2:   log likelihood = -2904.4037  
Iteration 3:   log likelihood = -2904.2199  
Iteration 4:   log likelihood = -2904.2194  
Iteration 5:   log likelihood = -2904.2194  

Logistic regression                             Number of obs     =      6,242
                                                LR chi2(2)        =    2777.83
                                                Prob > chi2       =     0.0000
Log likelihood = -2904.2194                     Pseudo R2         =     0.3235

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.123447   .0320398    35.06   0.000      1.06065    1.186244
      _hatsq |  -.0334635   .0151801    -2.20   0.027    -.0632159   -.0037111
       _cons |   .0277344   .0362016     0.77   0.444    -.0432194    .0986882
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |      2775           752  |       3527
     -     |       669          2046  |       2715
-----------+--------------------------+-----------
   Total   |      3444          2798  |       6242

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   80.57%
Specificity                     Pr( -|~D)   73.12%
Positive predictive value       Pr( D| +)   78.68%
Negative predictive value       Pr(~D| -)   75.36%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   26.88%
False - rate for true D         Pr( -| D)   19.43%
False + rate for classified +   Pr(~D| +)   21.32%
False - rate for classified -   Pr( D| -)   24.64%
--------------------------------------------------
Correctly classified                        77.23%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp4_yhat 
(option pr assumed; Pr(dv_indicator))
(11 missing values generated)

. gen bpp4_res = dv_indicator - bpp4_yhat
(11 missing values generated)

. 
. summ dv_indicator bpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |      6,253    .5525348    .4972722          0          1
   bpp4_yhat |      6,242    .5517462    .2909118    .000358   .9999958

. /*
> pause "next"
> 
> scatter dv_indicator bpp4_yhat
> 
> pause "next"
> 
> scatter bpp4_res dv_indicator
> 
> pause "next"
> 
> scatter bpp4_res bpp4_yhat
> */
. pause "complete: B.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. log close
      name:  <unnamed>
       log:  C:\Users\jbodson\Dropbox (Stanford Law School)\R-code\Injury-Classification\Test\log_part_year.txt
  log type:  text
 closed on:   7 Oct 2016, 20:09:30
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
