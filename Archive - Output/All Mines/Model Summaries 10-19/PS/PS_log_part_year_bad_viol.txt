-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/PS_log_part_year_bad_viol.txt
  log type:  text
 opened on:  20 Oct 2016, 13:42:37

. 
. ********************************************************************************
. ********************************************************************************
. // DATA SET-UP
. 
. // read data 
. if "`injury_type'" == "MR" {
.         use "X:\Projects\Mining\NIOSH\analysis\data\5_prediction-ready\MR_prediction_data.dta", clear
. }

. 
. if "`injury_type'" == "PS" {
.         use "X:\Projects\Mining\NIOSH\analysis\data\5_prediction-ready\PS_prediction_data.dta", clear
(Written by R.              )
. }

. 
. // drop mines according to sample 
. if "`mine_sample'" == "bad_viol" {
.         keep if inlist(mineid, "0100851", "0101247", "0101322", "0101401", "0102901", "0503013", "0503505", "0503672", "0503836") | ///
>                         inlist(mineid, "0504452", "0504674", "1100877", "1102752", "1102846", "1102997", "1103054", "1103232", "1202215") | ///
>                         inlist(mineid, "1202349", "1502085", "1507475", "1508079", "1508413", "1509571", "1509636", "1512482", "1513061") | ///
>                         inlist(mineid, "1514492", "1515215", "1516404", "1516487", "1516576", "1516599", "1517234", "1517252", "1517478") | ///
>                         inlist(mineid, "1517497", "1517541", "1517651", "1517894", "1517963", "1518043", "1518112", "1518264", "1518360") | ///
>                         inlist(mineid, "1518361", "1518375", "1518567", "1518575", "1518589", "1518648", "1518805", "1518826", "1518850") | ///
>                         inlist(mineid, "1518854", "1518861", "1518924", "1518991", "1519080", "1519102", "1519129", "1519159", "1519174") | ///
>                         inlist(mineid, "1519180", "1519224", "1519242", "1519261", "1519270", "1519297", "1519308", "1519347", "1519358") | ///
>                         inlist(mineid, "1519374", "1519390", "1519515", "1519535", "1519669", "3301070", "3301159", "3401787", "3600963") | ///
>                         inlist(mineid, "3600970", "3605018", "3605708", "3607230", "3607416", "3608525", "3609371", "4003272", "4003333") | ///
>                         inlist(mineid, "4200121", "4201280", "4202113", "4403795", "4404856", "4406804", "4601318", "4601436", "4601437") | ///
>                         inlist(mineid, "4601456", "4601939", "4601968", "4607273", "4608387", "4608436", "4608622", "4608801", "4609086") | ///
>                         inlist(mineid, "4609192", "4609221", "4609244")         
(26,659 observations deleted)
. }

. if "`mine_sample'" == "bad_inj" {
.         keep if inlist(mineid, "0100851","0101247","0101322","0101401","0102901","0503505","0503672","0503836","0504452") | ///
>                         inlist(mineid, "0504674","1100726","1100877","1102662","1102664","1102752","1102846","1102997","1103054") | ///
>                         inlist(mineid, "1103058","1103232","1202215","1202349","1502085","1502132","1502263","1502502","1508079") | ///
>                         inlist(mineid, "1508413","1508978","1509571","1509636","1511065","1512941","1514492","1517216","1517234") | ///
>                         inlist(mineid, "1517478","1517495","1517497","1517515","1517587","1517651","1517741","1517786","1517811") | ///
>                         inlist(mineid, "1517961","1518022","1518065","1518197","1518235","1518241","1518356","1518376","1518485") | ///
>                         inlist(mineid, "1518500","1518547","1518552","1518575","1518826","1519015","1519374","1519515","3301070") | ///
>                         inlist(mineid, "3301159","3401787","3600963","3600970","3605018","3605708","3606967","3607230","3607416") | ///
>                         inlist(mineid, "3608255","3608525","3610045","4200121","4201211","4201566","4403795","4404856","4406804") | ///
>                         inlist(mineid, "4406816","4406832","4406853","4406929","4601271","4601318","4601437","4601456","4601816") | ///
>                         inlist(mineid, "4601968","4602143","4604168","4604955","4605121","4605592","4606051","4606958","4607191") | ///
>                         inlist(mineid, "4607273","4607908","4608019","4608055","4608159","4608218","4608285","4608297","4608315") | ///
>                         inlsit(mineid, "4608436","4608437","4608589","4608622","4608635","4608637","4608650","4608679","4608680") | ///
>                         inlist(mineid, "4608759","4608763","4608787","4608791","4608801","4608808","4608814","4608878","4608890") | ///
>                         inlist(mineid, "4608891","4609028","4609086","4609115","4609136")
. }

. if "`mine_sample'" == "big" {
.         keep if inlist(mineid, "0100851", "0101247", "0101322", "0101401", "0102901", "0503672", "0503836", "0504452", "0504591") | ///
>                         inlist(mineid, "0504674", "1100726", "1100877", "1102662", "1102664", "1102752", "1102846", "1102997", "1103054") | ///
>                         inlist(mineid, "1103058", "1103141", "1103147", "1103156", "1103189", "1103193", "1103203", "1103232", "1103235") | ///
>                         inlist(mineid, "1508079", "1508413", "1509571", "1514492", "1517216", "1517234", "1517497", "1517587", "1517651") | ///
>                         inlist(mineid, "1517741", "1518376", "1518547", "1518552", "1518565", "1518575", "1518589", "1518647", "1518662") | ///
>                         inlist(mineid, "1518775", "1518826", "1518991", "1519015", "1519097", "1519358", "1519374", "1519424", "1519515") | ///
>                         inlist(mineid, "1519535", "2401950", "2902170", "3300968", "3301070", "3301159", "3304526", "3600963", "3600970") | ///
>                         inlist(mineid, "3605018", "3605708", "3606967", "3607230", "3607416", "3609326", "3610045", "4200079", "4200089") | ///
>                         inlist(mineid, "4200121", "4201211", "4201566", "4201890", "4202028", "4403795", "4404856", "4406929", "4407223") | ///
>                         inlist(mineid, "4601271", "4601318", "4601433", "4601436", "4601437", "4601456", "4601816", "4601968", "4604168") | ///
>                         inlist(mineid, "4605121", "4605252", "4605437", "4607273", "4607908", "4608194", "4608315", "4608429", "4608436") | ///
>                         inlist(mineid, "4608589", "4608622", "4608730", "4608759", "4608763", "4608801", "4608864", "4608878", "4608890") | ///
>                         inlist(mineid, "4608932", "4609028", "4609029", "4609086", "4609152", "4609163", "4609172", "4609192", "4609217") | ///
>                         inlist(mineid, "4609230", "4609258", "4609261", "4609297", "4609319", "4801646")
. }

. if "`mine_sample'" == "bignbad" {
.         * NOT DONE YET 
. }

. pause "sample restrictions applied"
pause:  "sample restrictions applied"
-> . q
execution resumes...

. 
. // format variables
. if "`injury_type'" == "MR" {
.         rename MR dv
.         rename MR_indicator dv_indicator
.         local injury_label "MR"
.         local relevant_parts "47 48 71 72 75 77"
. }

. 
. if "`injury_type'" == "PS" {
.         rename PS dv
.         rename PS_indicator dv_indicator
.         local injury_label "PS"
.         local relevant_parts "48 75"
. }

. 
. if "`violation_level'" == "part" {
.         local violation_level_label "P"
. }

. 
. if "`violation_level'" == "subpart" {
.         local violation_level_label "SP"
. }

. 
. * recast int p* sp* total_violations total_mine_act_violations num_good_faith num_no_terminations num_insp total_injuries dv dv_indicator
. 
. gen sample_pp = quarter >= 2007 // flag obs after or equal to 2007 to use in penlaty points analyses (assessments changed for the last time in 2007)

. 
. tostring quarter, replace
quarter was double now str7

. encode quarter, gen(quart)

. drop quarter year

. rename quart time

. 
. local time_label "Q" // will be overwritten if unit_of_analysis is year_sum or year_avg

. 
. if "`unit_of_analysis'" == "year_sum" { // collapse to mine years - sums 
.         local time_label "Y"
.         
.         // count number of complete quarters per year
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
(2,677 real changes made)
.         gen marker = 1
.         bysort mineid year: egen num_quarts = sum(marker)
.                 /*tab num_quarts
>                          num_quarts |      Freq.     Percent        Cum.
>                         ------------+-----------------------------------
>                                           1 |      1,100        3.63        3.63
>                                           2 |      1,666        5.50        9.13
>                                           3 |      2,511        8.29       17.42
>                                           4 |     25,012       82.58      100.00
>                         ------------+-----------------------------------
>                                   Total |     30,289      100.00 - Sarah 9/21/2016 @ 10:54 PM */
.         drop if num_quarts < 4
(290 observations deleted)
.         
.         // collapse to the mine-year 
.         collapse (sum) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp union longwall, by(mineid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_sum collapse"
pause:  "complete: year_sum collapse"
-> . pause off
-> . q
execution resumes...
. }

. 
. if "`unit_of_analysis'" == "year_avg" { // collapse on mine years - averages
.         local time_label "Y"
.         decode time, gen(year)
.         replace year = regexs(0) if(regexm(year, "^[0-9][0-9][0-9][0-9]"))
.         pause "collapsing to mine-year"
.         collapse (mean) p* sp* onsite_insp_hours hours dv* (firstnm) state sample_pp union longwall, by(mineid year)
.         rename year time
.         encode time, gen(time2)
.         drop time
.         rename time2 time
.         bys mineid: gen mine_time = _n
.         
.         pause "complete: year_avg collapse"
. }

. 
. drop dv_indicator

. gen dv_binary = 0 if dv == 0
(814 missing values generated)

. replace dv_binary = 1 if dv != 0
(814 real changes made)

. rename dv_binary dv_indicator

.         
. gen lnhours = log(hours)

. 
. pause "complete: data formatting"

. 
. // group variables
. local covariates "mine_time onsite_insp_hours"

. 
. if "`union_longwall_status'" == "on" {
.         local covariates "`covariates' union longwall"
. }

. 
. *** lag 0 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
p48 p75
. 
.         foreach var of varlist p*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
p48_ss p75_ss
. 
.         foreach var of varlist p*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
p48_pp p75_pp
.         
.         pause "complete: variable groups - part no lag"
. }

. 
. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x' {
  3.                         local count_vars `count_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_vars'"
. 
.         foreach var of varlist sp*ss {
  2.                 local ss_vars `ss_vars' `var'
  3.         }
.         noi di "`ss_vars'"
. 
.         foreach var of varlist sp*pp {
  2.                 local pp_vars `pp_vars' `var'
  3.         }
.         noi di "`pp_vars'"
.         
.         pause "complete: variable groups - subpart no lag"
. }

. 
. 
. *** lag 1 ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
p48_1lag p75_1lag
. 
.         foreach var of varlist p*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
p48_ss_1lag p75_ss_1lag
. 
.         foreach var of varlist p*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
p48_pp_1lag p75_pp_1lag
.         
.         pause "complete: variable groups - part lag 1"
. }

. 
. 
. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_1lag  {
  3.                         local count_lag_1_vars `count_lag_1_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_1_vars'"
. 
.         foreach var of varlist sp*ss_1lag  {
  2.                 local ss_lag_1_vars `ss_lag_1_vars' `var'
  3.         }
.         noi di "`ss_lag_1_vars'"
. 
. 
.         foreach var of varlist sp*pp_1lag  {
  2.                 local pp_lag_1_vars `pp_lag_1_vars' `var'
  3.         }
.         noi di "`pp_lag_1_vars'"
. 
.         pause "complete: variable groups - subpart lag 1"
. } 

. 
. *** lag 4 ***
. if "`violation_level'" == "part" {
.         
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
p48_c_4lag p75_c_4lag
. 
.         foreach var of varlist p*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
p48_ss_c_4lag p75_ss_c_4lag
. 
.         foreach var of varlist p*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
p48_pp_c_4lag p75_pp_c_4lag
. 
.         pause "complete: variable groups - part lag 4"
. }

. 
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_4lag  {
  3.                         local count_lag_4_vars `count_lag_4_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_4_vars'"
. 
.         foreach var of varlist sp*ss_c_4lag {
  2.                 local ss_lag_4_vars `ss_lag_4_vars' `var'
  3.         }
.         noi di "`ss_lag_4_vars'"
. 
.         foreach var of varlist sp*pp_c_4lag {
  2.                 local pp_lag_4_vars `pp_lag_4_vars' `var'
  3.         }
.         noi di "`pp_lag_4_vars'"
. 
.         pause "complete: variable groups - subpart lag 4"
. }

. 
. *** lag all ***
. if "`violation_level'" == "part" {
. 
.         foreach x in `relevant_parts' {
  2.                 foreach var of varlist p`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
p48_c_lag_all p75_c_lag_all
. 
.         foreach var of varlist p*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
p48_ss_c_lag_all p75_ss_c_lag_all
. 
.         foreach var of varlist p*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
p48_pp_c_lag_all p75_pp_c_lag_all
. 
.         pause "complete: variable groups - part lag all"
. }

. 
. *** subpart lag all ***
. if "`violation_level'" == "subpart" {
. 
.         foreach x in 1 2 3 4 5 6 7 8 9 0 {
  2.                 foreach var of varlist sp*`x'_c_lag_all  {
  3.                         local count_lag_all_vars `count_lag_all_vars' `var'
  4.                 }
  5.         }
.         noi di "`count_lag_all_vars'"
.         
.         foreach var of varlist sp*ss_c_lag_all {
  2.                 local ss_lag_all_vars `ss_lag_all_vars' `var'
  3.         }
.         noi di "`ss_lag_all_vars'"
.         
.         foreach var of varlist sp*pp_c_lag_all {
  2.                 local pp_lag_all_vars `pp_lag_all_vars' `var'
  3.         }
.         noi di "`pp_lag_all_vars'"
. 
.         pause "complete: variable groups - subpart lag all"
. }

. 
. ********************************************************************************
. *******************************************************************************
. // DATA OVERVIEW
. 
. // outcome variables
. summ dv

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200

. 
. pause "next"

. 
. tab dv_indicator

dv_indicato |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         21        2.51        2.51
          1 |        814       97.49      100.00
------------+-----------------------------------
      Total |        835      100.00

.           
. pause "next"

. 
. if "`violation_level'" == "part" {
.         summ `count_vars' `ss_vars' `pp_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         p48 |        835    .6790419    1.390264          0         17
         p75 |        835    229.9329    158.8961          0       1177
      p48_ss |        835    .1952096    .6635245          0          7
      p75_ss |        835    70.03952    56.36805          0        321
      p48_pp |        835    28.54491    69.69472          0        810
-------------+---------------------------------------------------------
      p75_pp |        835    11475.98    12284.88          0      83190
.         
.         pause "next"
.         
.         summ `count_lag_1_vars' `ss_lag_1_vars' `pp_lag_1_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    p48_1lag |        835    .6706587    1.441269          0         17
    p75_1lag |        835    225.4275    158.2805          0       1231
 p48_ss_1lag |        835    .1976048    .6894157          0          9
 p75_ss_1lag |        835    68.60359    55.43752          0        298
 p48_pp_1lag |        835    28.21796    72.29291          0        810
-------------+---------------------------------------------------------
 p75_pp_1lag |        835    11199.09    12231.85          0      95414
.         
.         pause "next"
.         
.         summ `count_lag_4_vars' `ss_lag_4_vars' `pp_lag_4_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  p48_c_4lag |        835    2.531737    4.764214          0         43
  p75_c_4lag |        835    866.3796    639.3998          0       4860
p48_ss_c_4~g |        835    .7281437    2.183788          0         30
p75_ss_c_4~g |        835    262.5054    219.4614          0       1222
p48_pp_c_4~g |        835    107.5808    247.4675          0       2329
-------------+---------------------------------------------------------
p75_pp_c_4~g |        835    43567.23     48457.8          0     378581
.         
.         pause "next"
.         
.         summ `count_lag_all_vars' `ss_lag_all_vars' `pp_lag_all_vars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
p48_c_lag_~l |        835    16.63593    22.57456          0        108
p75_c_lag_~l |        835     5534.32    6213.775          0      38328
p48_ss_c_l~l |        835    5.326946    9.982583          0         52
p75_ss_c_l~l |        835     1777.61    2027.297          0      13253
p48_pp_c_l~l |        835    553.3976    986.7471          0       5556
-------------+---------------------------------------------------------
p75_pp_c_l~l |        835      210475    302499.5          0    2148250
. }

. 
. pause "complete: data overview"

. 
. *******************************************************************************/
. /*******************************************************************************
> // MODEL LABEL KEY
> 
> Model X.Y.Z
>   X
>     C: response variable is count of injuries
>     B: response variable is binary of injuries
>   Y
>     V: predictors are number of violations
>     SSV: predictors are number of significant and substantial violations
>     PP: predictors are number of penalty points
>   Z
>     1: inj_t ~ viol_t
>     2: inj_t ~ viol_(t_-1)
>     3: inj_t ~ viol_(annual sum pre_t)
>     4: inj_t ~ viol_(sum since study period) 
> 
> *******************************************************************************/
. ********************************************************************************
. // NULL MODELS (V & SSV)
. 
. // count outcome (V & SSV)
. glm dv, family(poisson) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -7001.7797  
Iteration 1:   log pseudolikelihood = -6292.5356  
Iteration 2:   log pseudolikelihood = -6292.5319  
Iteration 3:   log pseudolikelihood = -6292.5319  

Generalized linear models                         No. of obs      =        835
Optimization     : ML                             Residual df     =        834
                                                  Scale parameter =          1
Deviance         =  8687.256175                   (1/df) Deviance =   10.41637
Pearson          =  12587.12172                   (1/df) Pearson  =   15.09247

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   15.07433
Log pseudolikelihood = -6292.531871               BIC             =   3076.578

                               (Std. Err. adjusted for 103 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000499   3.01e-06  -164.59   0.000     .0000444    .0000562
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

.         
. pause "next"    

.         
. quietly poisson dv, vce(cl mineid) exposure(hours) irr

. estat gof

         Deviance goodness-of-fit =  8687.251
         Prob > chi2(834)         =    0.0000

         Pearson goodness-of-fit  =  12587.12
         Prob > chi2(834)         =    0.0000

. 
. pause "next"

.         
. glm dv, family(nbinomial) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -3453.9295  
Iteration 1:   log pseudolikelihood = -3453.6816  
Iteration 2:   log pseudolikelihood = -3453.6815  

Generalized linear models                         No. of obs      =        835
Optimization     : ML                             Residual df     =        834
                                                  Scale parameter =          1
Deviance         =  427.4139949                   (1/df) Deviance =   .5124868
Pearson          =  990.1453123                   (1/df) Pearson  =   1.187225

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   8.274686
Log pseudolikelihood = -3453.681542               BIC             =  -5183.264

                               (Std. Err. adjusted for 103 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000607   3.99e-06  -147.73   0.000     .0000533     .000069
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. nbreg dv, vce(cl mineid) exposure(hours) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -6292.5319  
Iteration 1:   log pseudolikelihood = -6292.5319  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -3468.7529  
Iteration 1:   log pseudolikelihood = -3385.9713  
Iteration 2:   log pseudolikelihood = -3320.4721  
Iteration 3:   log pseudolikelihood = -3318.8245  
Iteration 4:   log pseudolikelihood =  -3318.824  
Iteration 5:   log pseudolikelihood =  -3318.824  

Fitting full model:

Iteration 0:   log pseudolikelihood =  -3318.824  
Iteration 1:   log pseudolikelihood =  -3318.824  

Negative binomial regression                    Number of obs     =        835
                                                Wald chi2(0)      =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood =  -3318.824               Pseudo R2         =     0.0000

                               (Std. Err. adjusted for 103 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |    .000059   3.82e-06  -150.65   0.000      .000052     .000067
   ln(hours) |          1  (exposure)
-------------+----------------------------------------------------------------
    /lnalpha |  -.9842043   .1768481                      -1.33082   -.6375884
-------------+----------------------------------------------------------------
       alpha |   .3737365   .0660946                      .2642604    .5285656
------------------------------------------------------------------------------

. 
. pause "next"

. 
. predict c_null_yhat 
(option n assumed; predicted number of events)

. summ dv c_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
 c_null_yhat |        835     33.4581    27.59429   .1439431   166.2665

. 
. pause "complete: null model - count outcome"

. 
. // binary outcome (V & SSV)
. logit dv_indicator, vce(cl mineid) offset(lnhours) or

Iteration 0:   log pseudolikelihood = -68.283005  
Iteration 1:   log pseudolikelihood = -60.343704  
Iteration 2:   log pseudolikelihood = -60.339445  
Iteration 3:   log pseudolikelihood = -60.339445  

Logistic regression                             Number of obs     =        835
                                                Wald chi2(0)      =          .
Log pseudolikelihood = -60.339445               Prob > chi2       =          .

                               (Std. Err. adjusted for 103 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0002599   .0000552   -38.84   0.000     .0001713    .0003942
     lnhours |          1  (offset)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       835
 number of covariate patterns =         1
              Pearson chi2(0) =         0.00
                  Prob > chi2 =              .

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -98.074781  
Iteration 1:   log likelihood = -97.208961  
Iteration 2:   log likelihood = -72.335615  
Iteration 3:   log likelihood = -63.275569  
Iteration 4:   log likelihood =   -58.5783  
Iteration 5:   log likelihood = -54.382928  
Iteration 6:   log likelihood =   -52.6869  
Iteration 7:   log likelihood = -52.638339  
Iteration 8:   log likelihood = -52.638297  
Iteration 9:   log likelihood = -52.638297  

Logistic regression                             Number of obs     =        835
                                                LR chi2(2)        =      90.87
                                                Prob > chi2       =     0.0000
Log likelihood = -52.638297                     Pseudo R2         =     0.4633

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |  -.5102576   .6259859    -0.82   0.415    -1.737167    .7166522
      _hatsq |   .4853481   .1769042     2.74   0.006     .1386222     .832074
       _cons |    .069867   .5687579     0.12   0.902    -1.044878    1.184612
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       810            19  |        829
     -     |         4             2  |          6
-----------+--------------------------+-----------
   Total   |       814            21  |        835

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.51%
Specificity                     Pr( -|~D)    9.52%
Positive predictive value       Pr( D| +)   97.71%
Negative predictive value       Pr(~D| -)   33.33%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   90.48%
False - rate for true D         Pr( -| D)    0.49%
False + rate for classified +   Pr(~D| +)    2.29%
False - rate for classified -   Pr( D| -)   66.67%
--------------------------------------------------
Correctly classified                        97.25%
--------------------------------------------------

. 
. pause "next"

. 
. predict b_null_yhat 
(option pr assumed; Pr(dv_indicator))

. summ dv_indicator b_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
 b_null_yhat |        835    .9748503    .0625992   .3878383   .9986354

. 
. pause "complete: null model - binary outcome"

. 
. *******************************************************************************/
. ********************************************************************************
. // NULL MODELS (PP)
. 
. // count outcome (PP)
. glm dv if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -2867.6545  
Iteration 1:   log pseudolikelihood = -2574.5373  
Iteration 2:   log pseudolikelihood = -2574.5041  
Iteration 3:   log pseudolikelihood = -2574.5041  

Generalized linear models                         No. of obs      =        472
Optimization     : ML                             Residual df     =        471
                                                  Scale parameter =          1
Deviance         =  3053.312702                   (1/df) Deviance =   6.482617
Pearson          =  3535.214877                   (1/df) Pearson  =   7.505764

Variance function: V(u) = u                       [Poisson]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   10.91315
Log pseudolikelihood =   -2574.5041               BIC             =   153.3756

                                (Std. Err. adjusted for 79 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000395   2.31e-06  -173.16   0.000     .0000352    .0000443
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

.         
. pause "next"    

.         
. quietly poisson dv if sample_pp == 1, vce(cl mineid) exposure(hours) irr

. estat gof

         Deviance goodness-of-fit =  3053.313
         Prob > chi2(471)         =    0.0000

         Pearson goodness-of-fit  =  3535.215
         Prob > chi2(471)         =    0.0000

. 
. pause "next"

.         
. glm dv if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) eform

Iteration 0:   log pseudolikelihood = -1820.2503  
Iteration 1:   log pseudolikelihood = -1816.8632  
Iteration 2:   log pseudolikelihood = -1816.8522  
Iteration 3:   log pseudolikelihood = -1816.8522  

Generalized linear models                         No. of obs      =        472
Optimization     : ML                             Residual df     =        471
                                                  Scale parameter =          1
Deviance         =  173.5616737                   (1/df) Deviance =   .3684961
Pearson          =  204.5396905                   (1/df) Pearson  =   .4342669

Variance function: V(u) = u+(1)u^2                [Neg. Binomial]
Link function    : g(u) = ln(u)                   [Log]

                                                  AIC             =   7.702763
Log pseudolikelihood = -1816.852172               BIC             =  -2726.375

                                (Std. Err. adjusted for 79 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000435   2.17e-06  -201.60   0.000     .0000395     .000048
   ln(hours) |          1  (exposure)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. nbreg dv if sample_pp == 1, vce(cl mineid) exposure(hours) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -2574.5041  
Iteration 1:   log pseudolikelihood = -2574.5041  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1818.8945  
Iteration 1:   log pseudolikelihood = -1715.8804  
Iteration 2:   log pseudolikelihood = -1685.7336  
Iteration 3:   log pseudolikelihood = -1685.3184  
Iteration 4:   log pseudolikelihood = -1685.3182  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1685.3182  
Iteration 1:   log pseudolikelihood = -1685.3182  

Negative binomial regression                    Number of obs     =        472
                                                Wald chi2(0)      =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1685.3182               Pseudo R2         =     0.0000

                                (Std. Err. adjusted for 79 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
          dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0000426   2.13e-06  -200.71   0.000     .0000386     .000047
   ln(hours) |          1  (exposure)
-------------+----------------------------------------------------------------
    /lnalpha |  -1.443541   .1440663                     -1.725905   -1.161176
-------------+----------------------------------------------------------------
       alpha |   .2360904   .0340127                      .1780118    .3131178
------------------------------------------------------------------------------

. 
. pause "next"

. 
. predict c_pp_null_yhat 
(option n assumed; predicted number of events)

. summ dv_indicator c_pp_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
c_pp_null_~t |        835    24.11942    19.89228   .1037663   119.8589

. 
. pause "complete: null model - count outcome"

. 
. // binary outcome (PP)
. logit dv_indicator if sample_pp == 1, vce(cl mineid) offset(lnhours) or

Iteration 0:   log pseudolikelihood = -49.997526  
Iteration 1:   log pseudolikelihood = -44.925467  
Iteration 2:   log pseudolikelihood = -44.912895  
Iteration 3:   log pseudolikelihood = -44.912891  

Logistic regression                             Number of obs     =        472
                                                Wald chi2(0)      =          .
Log pseudolikelihood = -44.912891               Prob > chi2       =          .

                                (Std. Err. adjusted for 79 clusters in mineid)
------------------------------------------------------------------------------
             |               Robust
dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       _cons |   .0001706   .0000386   -38.38   0.000     .0001095    .0002657
     lnhours |          1  (offset)
------------------------------------------------------------------------------

. 
. pause "next"

. 
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       472
 number of covariate patterns =         1
              Pearson chi2(0) =         0.00
                  Prob > chi2 =              .

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -69.875941  
Iteration 1:   log likelihood = -58.835492  
Iteration 2:   log likelihood = -56.303137  
Iteration 3:   log likelihood = -47.650429  
Iteration 4:   log likelihood = -43.443357  
Iteration 5:   log likelihood = -39.943808  
Iteration 6:   log likelihood = -39.077443  
Iteration 7:   log likelihood = -39.043103  
Iteration 8:   log likelihood = -39.042996  
Iteration 9:   log likelihood = -39.042996  

Logistic regression                             Number of obs     =        472
                                                LR chi2(2)        =      61.67
                                                Prob > chi2       =     0.0000
Log likelihood = -39.042996                     Pseudo R2         =     0.4413

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |  -.6664291   .8407384    -0.79   0.428    -2.314246    .9813879
      _hatsq |   .5854616   .2509321     2.33   0.020     .0936436    1.077279
       _cons |   .1343377    .735576     0.18   0.855    -1.307365     1.57604
------------------------------------------------------------------------------
Note: 0 failures and 1 success completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       455            15  |        470
     -     |         1             1  |          2
-----------+--------------------------+-----------
   Total   |       456            16  |        472

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   99.78%
Specificity                     Pr( -|~D)    6.25%
Positive predictive value       Pr( D| +)   96.81%
Negative predictive value       Pr(~D| -)   50.00%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   93.75%
False - rate for true D         Pr( -| D)    0.22%
False + rate for classified +   Pr(~D| +)    3.19%
False - rate for classified -   Pr( D| -)   50.00%
--------------------------------------------------
Correctly classified                        96.61%
--------------------------------------------------

. 
. pause "next"

. 
. predict b_pp_null_yhat 
(option pr assumed; Pr(dv_indicator))

. summ dv_indicator b_pp_null_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
b_pp_null_~t |        835    .9646826    .0774656   .2937582    .997923

. 
. pause "complete: null model - binary outcome"

. 
. ********************************************************************************
. ********************************************************************************
. 
. if "`violation_level'" == "subpart" {
.         set matsize 11000, perm
.         set emptycells drop
. }

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.1
. 
. // poisson model
. /*glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =  -3951.383  
Iteration 1:   log pseudolikelihood = -3922.7847  
Iteration 2:   log pseudolikelihood = -3922.7425  
Iteration 3:   log pseudolikelihood = -3922.7425  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -3118.4135  
Iteration 1:   log pseudolikelihood = -3048.9396  
Iteration 2:   log pseudolikelihood =  -2983.949  
Iteration 3:   log pseudolikelihood = -2982.0088  
Iteration 4:   log pseudolikelihood = -2982.0081  
Iteration 5:   log pseudolikelihood = -2982.0081  

Fitting full model:

Iteration 0:   log pseudolikelihood = -2833.4568  
Iteration 1:   log pseudolikelihood = -2800.3499  
Iteration 2:   log pseudolikelihood = -2773.7718  
Iteration 3:   log pseudolikelihood = -2773.5012  
Iteration 4:   log pseudolikelihood = -2773.5011  

Negative binomial regression                    Number of obs     =        747
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -2773.5011               Pseudo R2         =     0.0699

                                    (Std. Err. adjusted for 103 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p48 |   .9997555   .0228707    -0.01   0.991     .9559198    1.045601
              p75 |    1.00056    .000287     1.95   0.051     .9999976    1.001123
        mine_time |   1.011589   .0123259     0.95   0.344      .987717    1.036038
onsite_insp_hours |   .9999144   .0000637    -1.34   0.179     .9997895    1.000039
            union |   .8492355   .1081434    -1.28   0.199     .6616593    1.089988
         longwall |   .6162675   .0955084    -3.12   0.002     .4548321    .8350018
                  |
            state |
               1  |     1.6039   .3537712     2.14   0.032     1.040946    2.471305
               3  |   1.155718   .2335851     0.72   0.474     .7777025    1.717475
               4  |   1.450952   .2622281     2.06   0.039     1.018162    2.067709
               5  |   1.323413   .0906069     4.09   0.000     1.157227    1.513466
              10  |   1.486767   .2751378     2.14   0.032     1.034478    2.136802
              11  |   2.061219   .1522312     9.79   0.000     1.783441    2.382262
              12  |   1.253628   .1968871     1.44   0.150     .9214761    1.705505
              13  |   2.627423   .9130077     2.78   0.005     1.329672     5.19177
              14  |   .9224817   .1888956    -0.39   0.694     .6175302    1.378026
              15  |   1.056836   .2300729     0.25   0.800     .6897648     1.61925
              16  |    1.27398   .2790468     1.11   0.269     .8293146    1.957068
                  |
             time |
            2000  |   2.320584   .3033355     6.44   0.000     1.796108    2.998212
            2001  |   2.291897   .4304588     4.42   0.000     1.586078    3.311813
            2002  |   2.212537   .3536641     4.97   0.000     1.617446    3.026574
            2003  |   1.753284   .1911187     5.15   0.000     1.416009    2.170893
            2004  |   1.621628   .1761165     4.45   0.000     1.310711      2.0063
            2005  |   1.516563    .146089     4.32   0.000      1.25564    1.831707
            2006  |   1.402069   .1337865     3.54   0.000     1.162913    1.690409
            2007  |   1.262289   .1023945     2.87   0.004      1.07674    1.479812
            2008  |   1.094475   .0772176     1.28   0.201     .9531289    1.256782
            2010  |   1.039419   .0944271     0.43   0.670      .869886    1.241992
            2011  |    .907548   .0572021    -1.54   0.124     .8020824    1.026881
            2012  |   .8429861   .0692433    -2.08   0.038     .7176328    .9902356
            2013  |   .8253093   .0826209    -1.92   0.055     .6782718    1.004222
                  |
            _cons |   .0000432   5.37e-06   -80.76   0.000     .0000338    .0000551
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.643253     .17475                     -1.985757   -1.300749
------------------+----------------------------------------------------------------
            alpha |     .19335   .0337879                      .1372767    .2723276
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.1.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.V.1.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(6)  =  11765.90
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
        nbin |        747 -2982.008  -2773.501      31    5609.002     5752.1
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv1_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cv1_res = dv - cv1_yhat
(88 missing values generated)

. 
. summ dv cv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
    cv1_yhat |        747    30.11446    23.26646   .1168194   137.3618

. /*
> pause "next"
> 
> scatter dv cv1_yhat
> 
> pause "next"
> 
> scatter cv1_res dv
> 
> pause "next"
> 
> scatter cv1_res cv1_yhat
> */
. pause "complete: C.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.2
. 
. // poisson model
. /*glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -3959.8146  
Iteration 1:   log pseudolikelihood = -3931.8857  
Iteration 2:   log pseudolikelihood = -3931.8459  
Iteration 3:   log pseudolikelihood = -3931.8459  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -3118.4135  
Iteration 1:   log pseudolikelihood = -3048.9396  
Iteration 2:   log pseudolikelihood =  -2983.949  
Iteration 3:   log pseudolikelihood = -2982.0088  
Iteration 4:   log pseudolikelihood = -2982.0081  
Iteration 5:   log pseudolikelihood = -2982.0081  

Fitting full model:

Iteration 0:   log pseudolikelihood = -2834.3363  
Iteration 1:   log pseudolikelihood = -2801.7897  
Iteration 2:   log pseudolikelihood = -2774.9741  
Iteration 3:   log pseudolikelihood = -2774.6918  
Iteration 4:   log pseudolikelihood = -2774.6916  

Negative binomial regression                    Number of obs     =        747
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -2774.6916               Pseudo R2         =     0.0695

                                    (Std. Err. adjusted for 103 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p48_1lag |   .9879234   .0191742    -0.63   0.531     .9510484    1.026228
         p75_1lag |   1.000462   .0002796     1.65   0.098     .9999143     1.00101
        mine_time |   1.010773   .0123355     0.88   0.380     .9868829    1.035242
onsite_insp_hours |   .9999329   .0000635    -1.06   0.291     .9998085    1.000057
            union |   .8526238   .1090335    -1.25   0.212     .6635992    1.095492
         longwall |   .6159343    .094911    -3.14   0.002     .4553763    .8331022
                  |
            state |
               1  |   1.610365   .3540344     2.17   0.030     1.046622    2.477757
               3  |   1.159768   .2326211     0.74   0.460     .7827817    1.718309
               4  |   1.484672   .2671047     2.20   0.028       1.0435    2.112363
               5  |   1.343019   .0878371     4.51   0.000     1.181438    1.526697
              10  |   1.492141   .2762225     2.16   0.031     1.038095     2.14478
              11  |   2.055338   .1521323     9.73   0.000     1.777784    2.376226
              12  |   1.238429   .1944081     1.36   0.173      .910437    1.684583
              13  |   2.635409   .9106649     2.80   0.005       1.3388    5.187767
              14  |   .9101431   .1858223    -0.46   0.645      .609988    1.357995
              15  |   1.054949   .2320177     0.24   0.808     .6855271    1.623449
              16  |   1.285467    .279697     1.15   0.248     .8391763    1.969105
                  |
             time |
            2000  |   2.374369   .3023991     6.79   0.000     1.849862    3.047594
            2001  |   2.313112   .4303034     4.51   0.000     1.606384    3.330764
            2002  |   2.209331   .3497271     5.01   0.000     1.620016     3.01302
            2003  |    1.75648    .189937     5.21   0.000     1.421014     2.17114
            2004  |   1.636179   .1753596     4.59   0.000     1.326179    2.018642
            2005  |   1.525593   .1446842     4.45   0.000     1.266813    1.837236
            2006  |   1.422637   .1337766     3.75   0.000     1.183183    1.710551
            2007  |   1.287844   .1025898     3.18   0.001     1.101682    1.505463
            2008  |   1.099622    .077126     1.35   0.176     .9583877    1.261669
            2010  |   1.038982   .0954551     0.42   0.677     .8677708    1.243973
            2011  |   .9134507   .0582113    -1.42   0.155     .8061962    1.034974
            2012  |   .8373394   .0689289    -2.16   0.031     .7125765    .9839466
            2013  |   .8176301   .0825567    -1.99   0.046     .6708268    .9965596
                  |
            _cons |   .0000434   5.32e-06   -81.94   0.000     .0000341    .0000552
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.638818   .1725769                     -1.977063   -1.300574
------------------+----------------------------------------------------------------
            alpha |   .1942094   .0335161                      .1384754    .2723755
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.2.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.V.2.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(6)  =  11763.52
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
        nbin |        747 -2982.008  -2774.692      31    5611.383   5754.481
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv2_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cv2_res = dv - cv2_yhat
(88 missing values generated)

. 
. summ dv cv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
    cv2_yhat |        747    30.11748    23.13338   .1163501   126.7476

. /*
> pause "next"
> 
> scatter dv cv2_yhat
> 
> pause "next"
> 
> scatter cv2_res dv
> 
> pause "next"
> 
> scatter cv2_res cv2_yhat
> */
. pause "complete: C.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.3
. 
. // poisson model
. /*glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -3973.1764  
Iteration 1:   log pseudolikelihood = -3944.3004  
Iteration 2:   log pseudolikelihood = -3944.2578  
Iteration 3:   log pseudolikelihood = -3944.2578  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -3118.4135  
Iteration 1:   log pseudolikelihood = -3048.9396  
Iteration 2:   log pseudolikelihood =  -2983.949  
Iteration 3:   log pseudolikelihood = -2982.0088  
Iteration 4:   log pseudolikelihood = -2982.0081  
Iteration 5:   log pseudolikelihood = -2982.0081  

Fitting full model:

Iteration 0:   log pseudolikelihood = -2835.1824  
Iteration 1:   log pseudolikelihood = -2802.3709  
Iteration 2:   log pseudolikelihood = -2776.5987  
Iteration 3:   log pseudolikelihood =   -2776.34  
Iteration 4:   log pseudolikelihood = -2776.3399  

Negative binomial regression                    Number of obs     =        747
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -2776.3399               Pseudo R2         =     0.0690

                                    (Std. Err. adjusted for 103 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p48_c_4lag |   .9973595   .0059304    -0.44   0.657     .9858035    1.009051
       p75_c_4lag |   1.000086   .0000745     1.15   0.250     .9999396    1.000232
        mine_time |    1.01058   .0125853     0.85   0.398     .9862116     1.03555
onsite_insp_hours |   .9999507   .0000668    -0.74   0.460     .9998198    1.000082
            union |   .8579932   .1089288    -1.21   0.228     .6689864      1.1004
         longwall |   .6159375   .0952975    -3.13   0.002     .4548197    .8341307
                  |
            state |
               1  |   1.604593   .3538503     2.14   0.032      1.04149     2.47215
               3  |    1.16042   .2319476     0.74   0.457     .7842871    1.716942
               4  |   1.511516   .2744384     2.28   0.023     1.058923    2.157551
               5  |   1.348433   .0877516     4.59   0.000     1.186959    1.531873
              10  |   1.493049   .2790937     2.14   0.032     1.035047    2.153715
              11  |    2.05641   .1566955     9.46   0.000     1.771126    2.387647
              12  |   1.213533   .1888782     1.24   0.214     .8944746      1.6464
              13  |   2.658083   .9035966     2.88   0.004     1.365238    5.175216
              14  |   .8932837   .1814861    -0.56   0.579     .5998644    1.330227
              15  |   1.051337   .2332356     0.23   0.821     .6806212     1.62397
              16  |    1.29098   .2835096     1.16   0.245     .8394385     1.98541
                  |
             time |
            2000  |   2.439599   .3086747     7.05   0.000     1.903788    3.126211
            2001  |   2.331505   .4401764     4.48   0.000       1.6104    3.375507
            2002  |   2.215581   .3580897     4.92   0.000     1.614038    3.041317
            2003  |   1.758823    .194243     5.11   0.000     1.416499    2.183877
            2004  |   1.637847    .177245     4.56   0.000     1.324822    2.024831
            2005  |   1.528673   .1455319     4.46   0.000     1.268466    1.842256
            2006  |   1.431126   .1355709     3.78   0.000     1.188621    1.723107
            2007  |   1.288086   .1042837     3.13   0.002     1.099085    1.509587
            2008  |   1.106553   .0788856     1.42   0.156     .9622558    1.272489
            2010  |   1.035819   .0943665     0.39   0.699     .8664363    1.238315
            2011  |   .9031355   .0578664    -1.59   0.112     .7965518    1.023981
            2012  |   .8314144   .0700635    -2.19   0.028     .7048335     .980728
            2013  |   .8132962   .0856269    -1.96   0.050     .6616541    .9996926
                  |
            _cons |   .0000436   5.39e-06   -81.17   0.000     .0000342    .0000556
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.633133   .1721103                     -1.970463   -1.295803
------------------+----------------------------------------------------------------
            alpha |   .1953167    .033616                      .1393923     .273678
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.3.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.V.3.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(6)  =  11760.22
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
        nbin |        747 -2982.008   -2776.34      31     5614.68   5757.778
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv3_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cv3_res = dv - cv3_yhat
(88 missing values generated)

. 
. summ dv cv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
    cv3_yhat |        747     30.1089    23.01293   .1164695   119.1156

. 
. pause "next"

. /*
> scatter dv cv3_yhat
> 
> pause "next"
> 
> scatter cv3_res dv
> 
> pause "next"
> 
> scatter cv3_res cv3_yhat
> */
. pause "complete: C.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.V.4
. 
. // poisson model
. /*glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -3993.0704  
Iteration 1:   log pseudolikelihood = -3960.7247  
Iteration 2:   log pseudolikelihood = -3960.6673  
Iteration 3:   log pseudolikelihood = -3960.6673  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -3118.4135  
Iteration 1:   log pseudolikelihood = -3048.9396  
Iteration 2:   log pseudolikelihood =  -2983.949  
Iteration 3:   log pseudolikelihood = -2982.0088  
Iteration 4:   log pseudolikelihood = -2982.0081  
Iteration 5:   log pseudolikelihood = -2982.0081  

Fitting full model:

Iteration 0:   log pseudolikelihood = -2835.6984  
Iteration 1:   log pseudolikelihood = -2802.6465  
Iteration 2:   log pseudolikelihood = -2777.9059  
Iteration 3:   log pseudolikelihood = -2777.6683  
Iteration 4:   log pseudolikelihood = -2777.6682  

Negative binomial regression                    Number of obs     =        747
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -2777.6682               Pseudo R2         =     0.0685

                                    (Std. Err. adjusted for 103 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_c_lag_all |   .9990072   .0027648    -0.36   0.720      .993603    1.004441
    p75_c_lag_all |   .9999986   .0000124    -0.11   0.910     .9999744    1.000023
        mine_time |   1.016988   .0171292     1.00   0.317     .9839636    1.051121
onsite_insp_hours |    .999993   .0000577    -0.12   0.903     .9998799    1.000106
            union |   .8708515        .11    -1.09   0.274     .6798705    1.115481
         longwall |   .6153187   .0931386    -3.21   0.001     .4573584    .8278345
                  |
            state |
               1  |   1.615156   .3587418     2.16   0.031     1.045091    2.496172
               3  |   1.156062   .2273524     0.74   0.461     .7862905    1.699728
               4  |   1.620733   .3005942     2.60   0.009     1.126784    2.331214
               5  |   1.379562   .1224316     3.63   0.000      1.15931    1.641657
              10  |   1.521152   .3041141     2.10   0.036      1.02801    2.250857
              11  |   2.033503   .1621687     8.90   0.000     1.739253    2.377534
              12  |   1.147558   .1843228     0.86   0.392     .8376319    1.572158
              13  |     2.6999   .9118789     2.94   0.003     1.392702    5.234041
              14  |   .8524448   .1898235    -0.72   0.473     .5509594    1.318903
              15  |   1.052786   .2440291     0.22   0.824      .668401    1.658224
              16  |   1.318397   .2866619     1.27   0.204     .8609295    2.018947
                  |
             time |
            2000  |   2.388033   .3076047     6.76   0.000     1.855224    3.073862
            2001  |   2.372371   .4323384     4.74   0.000     1.659818     3.39082
            2002  |   2.250369   .3519078     5.19   0.000     1.656322    3.057474
            2003  |   1.771032   .1979593     5.11   0.000     1.422599    2.204807
            2004  |   1.642042   .1793156     4.54   0.000     1.325655    2.033938
            2005  |    1.52559   .1441152     4.47   0.000     1.267736    1.835891
            2006  |   1.442097   .1286063     4.11   0.000     1.210833    1.717532
            2007  |   1.292887   .1035181     3.21   0.001     1.105113    1.512565
            2008  |   1.104022   .0797657     1.37   0.171     .9582485     1.27197
            2010  |   1.017944   .0895993     0.20   0.840      .856646    1.209614
            2011  |    .885191   .0533301    -2.02   0.043     .7866014    .9961375
            2012  |   .8109981   .0673909    -2.52   0.012     .6891095    .9544462
            2013  |   .7951454   .0804464    -2.27   0.023     .6521221    .9695367
                  |
            _cons |   .0000434   5.61e-06   -77.73   0.000     .0000337    .0000559
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.627007   .1671703                     -1.954654   -1.299359
------------------+----------------------------------------------------------------
            alpha |    .196517   .0328518                      .1416134    .2727066
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.V.4.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.V.4.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(6)  =  11757.56
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
        nbin |        747 -2982.008  -2777.668      31    5617.336   5760.434
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cv4_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cv4_res = dv - cv4_yhat
(88 missing values generated)

. 
. summ dv cv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
    cv4_yhat |        747    30.08951    22.88889   .1131743   118.1042

. /*
> pause "next"
> 
> scatter dv cv4_yhat
> 
> pause "next"
> 
> scatter cv4_res dv
> 
> pause "next"
> 
> scatter cv4_res cv4_yhat
> */
. pause "complete: C.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.1
. 
. // poisson model
. /*glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -3966.3912  
Iteration 1:   log pseudolikelihood = -3936.7285  
Iteration 2:   log pseudolikelihood = -3936.6847  
Iteration 3:   log pseudolikelihood = -3936.6847  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -3118.4135  
Iteration 1:   log pseudolikelihood = -3048.9396  
Iteration 2:   log pseudolikelihood =  -2983.949  
Iteration 3:   log pseudolikelihood = -2982.0088  
Iteration 4:   log pseudolikelihood = -2982.0081  
Iteration 5:   log pseudolikelihood = -2982.0081  

Fitting full model:

Iteration 0:   log pseudolikelihood =  -2834.706  
Iteration 1:   log pseudolikelihood = -2803.3655  
Iteration 2:   log pseudolikelihood = -2774.8706  
Iteration 3:   log pseudolikelihood = -2774.5393  
Iteration 4:   log pseudolikelihood = -2774.5391  

Negative binomial regression                    Number of obs     =        747
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -2774.5391               Pseudo R2         =     0.0696

                                    (Std. Err. adjusted for 103 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_ss |   .9702526   .0257633    -1.14   0.255     .9210488    1.022085
           p75_ss |   1.001132   .0006729     1.68   0.092     .9998141    1.002452
        mine_time |    1.01147   .0122907     0.94   0.348     .9876653    1.035848
onsite_insp_hours |   .9999472   .0000577    -0.91   0.360     .9998342     1.00006
            union |   .8656192   .1096976    -1.14   0.255     .6752372    1.109679
         longwall |   .6195525   .0979335    -3.03   0.002     .4544933    .8445566
                  |
            state |
               1  |   1.580725   .3559008     2.03   0.042     1.016736    2.457563
               3  |   1.179846   .2334208     0.84   0.403      .800615     1.73871
               4  |   1.552097   .2837898     2.40   0.016     1.084633    2.221033
               5  |   1.357522   .0885863     4.68   0.000     1.194541     1.54274
              10  |   1.452758   .2792926     1.94   0.052     .9966664    2.117565
              11  |   2.059031   .1577316     9.43   0.000     1.771972    2.392594
              12  |   1.192926    .188306     1.12   0.264     .8754869    1.625465
              13  |   2.561511   .8989657     2.68   0.007     1.287555    5.095966
              14  |   .8875712   .1829356    -0.58   0.563     .5926028     1.32936
              15  |   1.032102   .2335943     0.14   0.889     .6623252    1.608326
              16  |   1.259134   .2811576     1.03   0.302     .8128371    1.950476
                  |
             time |
            2000  |   2.287307   .3054517     6.20   0.000     1.760569    2.971636
            2001  |    2.25646   .4424831     4.15   0.000     1.536421    3.313942
            2002  |   2.199365   .3640823     4.76   0.000     1.589973    3.042321
            2003  |   1.732625   .1947196     4.89   0.000      1.39009    2.159564
            2004  |   1.593677   .1773017     4.19   0.000     1.281449     1.98198
            2005  |   1.490822   .1445973     4.12   0.000     1.232725    1.802956
            2006  |   1.413687   .1391166     3.52   0.000     1.165707    1.714421
            2007  |   1.269047   .1006039     3.01   0.003     1.086422    1.482371
            2008  |   1.104479   .0772789     1.42   0.156     .9629415     1.26682
            2010  |   1.035665   .0943557     0.38   0.701      .866302    1.238138
            2011  |   .9007572   .0552741    -1.70   0.089     .7986832    1.015877
            2012  |   .8306383   .0681918    -2.26   0.024     .7071833    .9756451
            2013  |   .8155791   .0820601    -2.03   0.043     .6696098    .9933685
                  |
            _cons |   .0000439   5.44e-06   -80.95   0.000     .0000344     .000056
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.637878   .1755078                     -1.981867   -1.293889
------------------+----------------------------------------------------------------
            alpha |   .1943921   .0341173                      .1378117    .2742023
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.1.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.SSV.1.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(6)  =  11763.82
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
        nbin |        747 -2982.008  -2774.539      31    5611.078   5754.176
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv1_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cssv1_res = dv - cssv1_yhat
(88 missing values generated)

. 
. summ dv cssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
  cssv1_yhat |        747    30.07433    22.97471   .1173139   122.4957

. /*
> pause "next"
> 
> scatter dv cssv1_yhat
> 
> pause "next"
> 
> scatter cssv1_res dv
> 
> pause "next"
> 
> scatter cssv1_res cssv1_yhat
> */
. pause "complete: C.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.2
. 
. // poisson model
. /*glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -3971.0345  
Iteration 1:   log pseudolikelihood =  -3941.272  
Iteration 2:   log pseudolikelihood = -3941.2277  
Iteration 3:   log pseudolikelihood = -3941.2277  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -3118.4135  
Iteration 1:   log pseudolikelihood = -3048.9396  
Iteration 2:   log pseudolikelihood =  -2983.949  
Iteration 3:   log pseudolikelihood = -2982.0088  
Iteration 4:   log pseudolikelihood = -2982.0081  
Iteration 5:   log pseudolikelihood = -2982.0081  

Fitting full model:

Iteration 0:   log pseudolikelihood = -2835.2883  
Iteration 1:   log pseudolikelihood =  -2803.686  
Iteration 2:   log pseudolikelihood = -2775.8581  
Iteration 3:   log pseudolikelihood = -2775.5475  
Iteration 4:   log pseudolikelihood = -2775.5473  

Negative binomial regression                    Number of obs     =        747
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -2775.5473               Pseudo R2         =     0.0692

                                    (Std. Err. adjusted for 103 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_ss_1lag |    .971069   .0226093    -1.26   0.207     .9277515    1.016409
      p75_ss_1lag |   1.000943   .0006625     1.42   0.154     .9996456    1.002242
        mine_time |   1.010888   .0123812     0.88   0.377     .9869105    1.035448
onsite_insp_hours |   .9999569   .0000569    -0.76   0.449     .9998455    1.000068
            union |   .8666689     .10971    -1.13   0.258     .6762405    1.110722
         longwall |   .6185913   .0971493    -3.06   0.002     .4546982    .8415587
                  |
            state |
               1  |   1.586096   .3545108     2.06   0.039     1.023472    2.458006
               3  |    1.17677   .2321822     0.82   0.409     .7993656    1.732357
               4  |   1.559459   .2811668     2.46   0.014     1.095227    2.220463
               5  |   1.357621   .0882105     4.71   0.000     1.195288    1.542002
              10  |   1.459801   .2777261     1.99   0.047     1.005433    2.119504
              11  |   2.054912   .1571804     9.42   0.000     1.768825    2.387271
              12  |   1.184016   .1866483     1.07   0.284     .8693086    1.612653
              13  |   2.579028     .89494     2.73   0.006     1.306422      5.0913
              14  |   .8803682   .1817226    -0.62   0.537     .5874383    1.319369
              15  |   1.036449   .2333515     0.16   0.874     .6666595    1.611357
              16  |   1.268714   .2816039     1.07   0.284      .821166    1.960182
                  |
             time |
            2000  |   2.332092   .3033428     6.51   0.000     1.807287    3.009291
            2001  |   2.282388   .4415452     4.27   0.000     1.562133    3.334731
            2002  |   2.191199   .3612141     4.76   0.000     1.586219    3.026916
            2003  |    1.73654   .1948291     4.92   0.000     1.393751    2.163636
            2004  |   1.609446   .1759036     4.35   0.000     1.299107    1.993922
            2005  |   1.494523   .1456691     4.12   0.000     1.234631    1.809123
            2006  |   1.420519   .1376473     3.62   0.000     1.174806    1.717623
            2007  |   1.279151   .1030041     3.06   0.002     1.092392    1.497839
            2008  |   1.105119   .0776964     1.42   0.155     .9628636    1.268393
            2010  |   1.027863   .0929009     0.30   0.761     .8609968    1.227069
            2011  |   .9056969   .0564025    -1.59   0.112     .8016302    1.023273
            2012  |   .8258902   .0674307    -2.34   0.019     .7037608    .9692138
            2013  |   .8098763   .0812867    -2.10   0.036      .665249    .9859461
                  |
            _cons |    .000044   5.45e-06   -80.96   0.000     .0000345    .0000561
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.634692   .1742738                     -1.976262   -1.293121
------------------+----------------------------------------------------------------
            alpha |   .1950125   .0339856                      .1385863     .274413
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.2.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.SSV.2.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(6)  =  11761.81
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
        nbin |        747 -2982.008  -2775.547      31    5613.095   5756.193
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv2_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cssv2_res = dv - cssv2_yhat
(88 missing values generated)

. 
. summ dv cssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
  cssv2_yhat |        747    30.08347    22.94797   .1167251   120.6102

. /*
> pause "next"
> 
> scatter dv cssv2_yhat
> 
> pause "next"
> 
> scatter cssv2_res dv
> 
> pause "next"
> 
> scatter cssv2_res cssv2_yhat
> */
. pause "complete: C.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.3
. 
. // poisson model
. /*glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =  -3978.481  
Iteration 1:   log pseudolikelihood = -3948.5076  
Iteration 2:   log pseudolikelihood =  -3948.463  
Iteration 3:   log pseudolikelihood =  -3948.463  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -3118.4135  
Iteration 1:   log pseudolikelihood = -3048.9396  
Iteration 2:   log pseudolikelihood =  -2983.949  
Iteration 3:   log pseudolikelihood = -2982.0088  
Iteration 4:   log pseudolikelihood = -2982.0081  
Iteration 5:   log pseudolikelihood = -2982.0081  

Fitting full model:

Iteration 0:   log pseudolikelihood =  -2835.582  
Iteration 1:   log pseudolikelihood =  -2803.717  
Iteration 2:   log pseudolikelihood = -2776.6169  
Iteration 3:   log pseudolikelihood = -2776.3224  
Iteration 4:   log pseudolikelihood = -2776.3222  

Negative binomial regression                    Number of obs     =        747
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -2776.3222               Pseudo R2         =     0.0690

                                    (Std. Err. adjusted for 103 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_ss_c_4lag |   .9918649   .0075308    -1.08   0.282      .977214    1.006735
    p75_ss_c_4lag |   1.000209   .0001778     1.18   0.239     .9998609    1.000558
        mine_time |   1.010514    .012559     0.84   0.400     .9861966    1.035432
onsite_insp_hours |   .9999643   .0000584    -0.61   0.541     .9998499    1.000079
            union |   .8666295   .1096378    -1.13   0.258     .6763126    1.110502
         longwall |    .617651   .0969616    -3.07   0.002     .4540648    .8401727
                  |
            state |
               1  |   1.589605    .354764     2.08   0.038     1.026409    2.461831
               3  |   1.176725   .2310255     0.83   0.407     .8008651    1.728983
               4  |   1.565898   .2809206     2.50   0.012     1.101689    2.225709
               5  |   1.361243   .0889763     4.72   0.000     1.197561    1.547297
              10  |   1.472183   .2814548     2.02   0.043      1.01211    2.141392
              11  |   2.063535   .1613141     9.27   0.000     1.770395    2.405212
              12  |   1.180871   .1855708     1.06   0.290     .8678371    1.606817
              13  |   2.603475   .8864822     2.81   0.005     1.335733    5.074429
              14  |   .8785888   .1807291    -0.63   0.529     .5870704    1.314865
              15  |   1.037128   .2341705     0.16   0.872     .6662565    1.614444
              16  |   1.274513   .2844852     1.09   0.277     .8228998    1.973976
                  |
             time |
            2000  |   2.400138   .3077154     6.83   0.000     1.866835    3.085791
            2001  |    2.30137   .4497742     4.26   0.000     1.569024    3.375539
            2002  |   2.195384   .3662243     4.71   0.000      1.58313    3.044417
            2003  |    1.74217   .1984677     4.87   0.000     1.393547    2.178007
            2004  |   1.619007   .1792659     4.35   0.000     1.303163    2.011401
            2005  |   1.501372   .1475883     4.13   0.000     1.238264    1.820386
            2006  |   1.423772   .1379951     3.65   0.000     1.177444    1.721634
            2007  |   1.285334   .1046595     3.08   0.002     1.095737    1.507738
            2008  |   1.111176   .0796153     1.47   0.141     .9655936    1.278707
            2010  |   1.030927   .0934152     0.34   0.737     .8631735    1.231282
            2011  |   .9005872   .0561231    -1.68   0.093     .7970404    1.017586
            2012  |   .8263805   .0681023    -2.31   0.021     .7031245     .971243
            2013  |   .8088645   .0826722    -2.08   0.038      .662028    .9882691
                  |
            _cons |   .0000439   5.45e-06   -80.79   0.000     .0000344     .000056
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.632142   .1736471                     -1.972485     -1.2918
------------------+----------------------------------------------------------------
            alpha |   .1955102   .0339498                      .1391108    .2747756
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.3.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.SSV.3.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(6)  =  11760.26
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
        nbin |        747 -2982.008  -2776.322      31    5614.644   5757.742
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv3_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cssv3_res = dv - cssv3_yhat
(88 missing values generated)

. 
. summ dv cssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
  cssv3_yhat |        747    30.08989    22.91363   .1177302   117.5865

. /*
> pause "next"
> 
> scatter dv cssv3_yhat
> 
> pause "next"
> 
> scatter cssv3_res dv
> 
> pause "next"
> 
> scatter cssv3_res cssv3_yhat
> */
. pause "complete: C.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.SSV.4
. 
. // poisson model
. /*glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood =  -3990.444  
Iteration 1:   log pseudolikelihood = -3960.4287  
Iteration 2:   log pseudolikelihood = -3960.3807  
Iteration 3:   log pseudolikelihood = -3960.3807  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -3118.4135  
Iteration 1:   log pseudolikelihood = -3048.9396  
Iteration 2:   log pseudolikelihood =  -2983.949  
Iteration 3:   log pseudolikelihood = -2982.0088  
Iteration 4:   log pseudolikelihood = -2982.0081  
Iteration 5:   log pseudolikelihood = -2982.0081  

Fitting full model:

Iteration 0:   log pseudolikelihood = -2835.0319  
Iteration 1:   log pseudolikelihood = -2800.7399  
Iteration 2:   log pseudolikelihood =  -2777.533  
Iteration 3:   log pseudolikelihood = -2777.3347  
Iteration 4:   log pseudolikelihood = -2777.3347  

Negative binomial regression                    Number of obs     =        747
                                                Wald chi2(29)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -2777.3347               Pseudo R2         =     0.0686

                                    (Std. Err. adjusted for 103 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_ss_c_lag_all |   1.003005   .0055855     0.54   0.590     .9921172    1.014013
 p75_ss_c_lag_all |   .9999761   .0000388    -0.62   0.538        .9999    1.000052
        mine_time |    1.01888   .0177459     1.07   0.283     .9846856    1.054262
onsite_insp_hours |          1    .000057     0.00   0.997     .9998885    1.000112
            union |   .8731886    .107583    -1.10   0.271     .6858578    1.111686
         longwall |   .6087335   .0935834    -3.23   0.001     .4503686    .8227848
                  |
            state |
               1  |   1.582374   .3452453     2.10   0.035     1.031793    2.426755
               3  |   1.140553   .2217011     0.68   0.499     .7792176    1.669446
               4  |   1.553772   .2652922     2.58   0.010     1.111866    2.171311
               5  |   1.322566   .1095068     3.38   0.001     1.124447    1.555593
              10  |   1.437414   .2794976     1.87   0.062     .9819071    2.104232
              11  |    2.00017   .1763682     7.86   0.000     1.682716    2.377514
              12  |   1.146774   .1753881     0.90   0.371     .8497567    1.547608
              13  |   2.729733   .9227147     2.97   0.003     1.407323    5.294763
              14  |   .8308621   .1761003    -0.87   0.382     .5484256    1.258752
              15  |   1.052874   .2365056     0.23   0.819     .6779105    1.635237
              16  |   1.320272   .2852855     1.29   0.199     .8644405     2.01647
                  |
             time |
            2000  |   2.440063     .32933     6.61   0.000     1.872907    3.178966
            2001  |   2.431334   .4700528     4.60   0.000     1.664489    3.551473
            2002  |   2.304976   .3837363     5.02   0.000     1.663248    3.194302
            2003  |   1.815599   .2198116     4.93   0.000     1.432076    2.301831
            2004  |   1.679899   .1957242     4.45   0.000     1.336934    2.110844
            2005  |   1.555056   .1579179     4.35   0.000     1.274399    1.897521
            2006  |   1.462603   .1380997     4.03   0.000     1.215501    1.759938
            2007  |   1.307575   .1076194     3.26   0.001     1.112779    1.536471
            2008  |   1.106953   .0800428     1.41   0.160     .9606822    1.275495
            2010  |   1.015676   .0891206     0.18   0.859     .8551976    1.206269
            2011  |   .8826706   .0533167    -2.07   0.039     .7841205    .9936067
            2012  |   .8058559   .0672761    -2.59   0.010     .6842198    .9491157
            2013  |   .7880135   .0805124    -2.33   0.020     .6450083    .9627246
                  |
            _cons |   .0000428   5.58e-06   -77.14   0.000     .0000332    .0000553
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.627598   .1672212                     -1.955345    -1.29985
------------------+----------------------------------------------------------------
            alpha |   .1964008   .0328424                      .1415156    .2725726
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.SSV.4.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.SSV.4.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(6)  =  11758.23
(Assumption: pois nested in nbin)                     Prob > chi2 =    0.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
        nbin |        747 -2982.008  -2777.335      31    5616.669   5759.767
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) exposure(hours) iter(50) irr

. predict cssv4_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cssv4_res = dv - cssv4_yhat
(88 missing values generated)

. 
. summ dv cssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
  cssv4_yhat |        747    30.05715    22.79153   .1146939   118.8619

. /*
> pause "next"
> 
> scatter dv cssv4_yhat
> 
> pause "next"
> 
> scatter cssv4_res dv
> 
> pause "next"
> 
> scatter cssv4_res cssv4_yhat
> */
. pause "complete: C.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.1
. 
. // poisson model
. /*glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1626.0947  
Iteration 1:   log pseudolikelihood = -1613.9805  
Iteration 2:   log pseudolikelihood = -1613.9571  
Iteration 3:   log pseudolikelihood = -1613.9571  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1477.3626  
Iteration 1:   log pseudolikelihood = -1399.2522  
Iteration 2:   log pseudolikelihood = -1371.3437  
Iteration 3:   log pseudolikelihood = -1370.7703  
Iteration 4:   log pseudolikelihood = -1370.7701  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1318.7506  
Iteration 1:   log pseudolikelihood = -1303.6093  
Iteration 2:   log pseudolikelihood =  -1301.578  
Iteration 3:   log pseudolikelihood = -1301.5671  
Iteration 4:   log pseudolikelihood = -1301.5671  

Negative binomial regression                    Number of obs     =        384
                                                Wald chi2(21)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1301.5671               Pseudo R2         =     0.0505

                                     (Std. Err. adjusted for 78 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_pp |   1.000316   .0003571     0.89   0.376     .9996163    1.001016
           p75_pp |   1.000011   4.37e-06     2.56   0.010     1.000003     1.00002
        mine_time |   .9916872   .0116336    -0.71   0.477     .9691459    1.014753
onsite_insp_hours |   .9998906   .0000695    -1.57   0.115     .9997545    1.000027
            union |   .9676774   .1456541    -0.22   0.827     .7204574    1.299729
         longwall |   .7057201   .0978837    -2.51   0.012     .5377376    .9261782
                  |
            state |
               1  |   1.680245   .3421061     2.55   0.011     1.127363    2.504271
               3  |   1.047096   .2041058     0.24   0.813     .7146044     1.53429
               4  |   1.352406    .235448     1.73   0.083     .9614276    1.902381
               5  |   1.162426   .1620314     1.08   0.280      .884536    1.527618
              10  |    1.51298   .2306919     2.72   0.007     1.122138    2.039954
              11  |   2.773022   .3183133     8.89   0.000     2.214341    3.472659
              12  |   1.369193   .2495824     1.72   0.085     .9578645    1.957156
              13  |   2.449026   .8277413     2.65   0.008     1.262692    4.749953
              14  |   .9443695   .1905582    -0.28   0.777     .6358923    1.402492
              15  |   .7823583   .2259986    -0.85   0.396     .4441406    1.378132
              16  |   1.075748   .1585521     0.50   0.620      .805849    1.436042
                  |
             time |
            2007  |   1.283145   .1016384     3.15   0.002     1.098631    1.498648
            2008  |   1.076544   .0781026     1.02   0.309     .9338507     1.24104
            2010  |   1.071669   .0942371     0.79   0.431     .9020082    1.273243
            2011  |   .9512426   .0620999    -0.77   0.444     .8369941    1.081086
            2012  |   .8934222    .079163    -1.27   0.203     .7509911    1.062866
            2013  |   .8950158   .0965372    -1.03   0.304     .7244683    1.105712
                  |
            _cons |   .0000445   5.23e-06   -85.26   0.000     .0000354    .0000561
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.975707   .1982105                     -2.364193   -1.587222
------------------+----------------------------------------------------------------
            alpha |   .1386632   .0274845                      .0940252    .2044929
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.1.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.PP.1.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(2)  = -14709.77
(Assumption: nbin nested in pois)                     Prob > chi2 =    1.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        nbin |        384  -1370.77  -1301.567      23    2649.134   2739.999
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp1_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cpp1_res = dv - cpp1_yhat
(88 missing values generated)

. 
. summ dv cpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
   cpp1_yhat |        747    21.93114    18.75636   .1150299   141.8001

. /*
> pause "next"
> 
> scatter dv cpp1_yhat
> 
> pause "next"
> 
> scatter cpp1_res dv
> 
> pause "next"
> 
> scatter cpp1_res cpp1_yhat
> */
. pause "complete: C.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.2
. 
. // poisson model
. /*glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1638.4455  
Iteration 1:   log pseudolikelihood = -1626.3324  
Iteration 2:   log pseudolikelihood = -1626.3098  
Iteration 3:   log pseudolikelihood = -1626.3098  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1477.3626  
Iteration 1:   log pseudolikelihood = -1399.2522  
Iteration 2:   log pseudolikelihood = -1371.3437  
Iteration 3:   log pseudolikelihood = -1370.7703  
Iteration 4:   log pseudolikelihood = -1370.7701  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1320.7665  
Iteration 1:   log pseudolikelihood = -1306.2285  
Iteration 2:   log pseudolikelihood = -1304.2098  
Iteration 3:   log pseudolikelihood = -1304.1995  
Iteration 4:   log pseudolikelihood = -1304.1995  

Negative binomial regression                    Number of obs     =        384
                                                Wald chi2(21)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1304.1995               Pseudo R2         =     0.0486

                                     (Std. Err. adjusted for 78 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_pp_1lag |   1.000019   .0002698     0.07   0.944     .9994903    1.000548
      p75_pp_1lag |   1.000009   3.96e-06     2.32   0.020     1.000001    1.000017
        mine_time |   .9921735   .0118015    -0.66   0.509     .9693106    1.015576
onsite_insp_hours |   .9999155   .0000677    -1.25   0.212     .9997829    1.000048
            union |   .9737541    .151283    -0.17   0.864      .718135     1.32036
         longwall |   .6966125   .0935155    -2.69   0.007     .5354552    .9062736
                  |
            state |
               1  |   1.702535   .3523914     2.57   0.010     1.134786    2.554337
               3  |   1.059374   .2042121     0.30   0.765     .7260485    1.545726
               4  |   1.422424   .2324216     2.16   0.031     1.032629    1.959358
               5  |   1.177951   .1515094     1.27   0.203     .9154717    1.515688
              10  |   1.517204   .2301556     2.75   0.006     1.126987    2.042532
              11  |   2.715745    .305053     8.89   0.000     2.179092    3.384561
              12  |   1.339325   .2439909     1.60   0.109     .9371703    1.914049
              13  |   2.512282    .840418     2.75   0.006     1.304131    4.839668
              14  |   .9273605   .1870995    -0.37   0.709     .6244742    1.377154
              15  |   .7883616   .2229404    -0.84   0.400     .4529128     1.37226
              16  |   1.107523   .1705193     0.66   0.507     .8190261     1.49764
                  |
             time |
            2007  |   1.358699   .1122029     3.71   0.000     1.155659     1.59741
            2008  |   1.090685   .0781157     1.21   0.226     .9478418    1.255056
            2010  |   1.072255   .0970648     0.77   0.441     .8979327    1.280419
            2011  |   .9542186   .0632623    -0.71   0.480     .8379446    1.086627
            2012  |   .8806103   .0769928    -1.45   0.146     .7419287    1.045214
            2013  |    .877391    .095273    -1.20   0.228     .7091923    1.085481
                  |
            _cons |   .0000445   5.13e-06   -87.00   0.000     .0000355    .0000558
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.952994   .2012721                      -2.34748   -1.558508
------------------+----------------------------------------------------------------
            alpha |   .1418487   .0285502                      .0956098    .2104499
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.2.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.PP.2.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(2)  = -14704.50
(Assumption: nbin nested in pois)                     Prob > chi2 =    1.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        nbin |        384  -1370.77    -1304.2      23    2654.399   2745.264
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp2_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cpp2_res = dv - cpp2_yhat
(88 missing values generated)

. 
. summ dv cpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
   cpp2_yhat |        747    22.14095    18.73325   .1140458   116.2922

. /*
> pause "next"
> 
> scatter dv cpp2_yhat
> 
> pause "next"
> 
> scatter cpp2_res dv
> 
> pause "next"
> 
> scatter cpp2_res cpp2_yhat
> */
. pause "complete: C.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.3
. 
. // poisson model
. /*glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/
. 
. eststo clear

. eststo: nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1643.2241  
Iteration 1:   log pseudolikelihood = -1631.4235  
Iteration 2:   log pseudolikelihood = -1631.4037  
Iteration 3:   log pseudolikelihood = -1631.4037  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1477.3626  
Iteration 1:   log pseudolikelihood = -1399.2522  
Iteration 2:   log pseudolikelihood = -1371.3437  
Iteration 3:   log pseudolikelihood = -1370.7703  
Iteration 4:   log pseudolikelihood = -1370.7701  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1321.2935  
Iteration 1:   log pseudolikelihood = -1307.2033  
Iteration 2:   log pseudolikelihood = -1305.5326  
Iteration 3:   log pseudolikelihood = -1305.5251  
Iteration 4:   log pseudolikelihood = -1305.5251  

Negative binomial regression                    Number of obs     =        384
                                                Wald chi2(21)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1305.5251               Pseudo R2         =     0.0476

                                     (Std. Err. adjusted for 78 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_pp_c_4lag |   1.000036   .0000799     0.45   0.654     .9998791    1.000192
    p75_pp_c_4lag |   1.000002   9.81e-07     2.00   0.046            1    1.000004
        mine_time |   .9919147   .0121001    -0.67   0.506     .9684802    1.015916
onsite_insp_hours |   .9999284   .0000686    -1.04   0.296      .999794    1.000063
            union |   .9833415   .1480666    -0.11   0.911     .7320398    1.320912
         longwall |    .692111   .0924244    -2.76   0.006     .5327291    .8991768
                  |
            state |
               1  |   1.686175   .3457968     2.55   0.011     1.128081    2.520374
               3  |   1.065137   .2032273     0.33   0.741     .7328192    1.548154
               4  |   1.462582   .2360191     2.36   0.018     1.066008    2.006688
               5  |   1.174203   .1498696     1.26   0.208      .914324    1.507949
              10  |   1.523625   .2328413     2.76   0.006     1.129268    2.055698
              11  |   2.715535   .3082473     8.80   0.000     2.173869    3.392169
              12  |   1.308943   .2371924     1.49   0.137      .917646    1.867094
              13  |    2.52654   .8185561     2.86   0.004      1.33891    4.767614
              14  |   .9098499    .179402    -0.48   0.632     .6182041    1.339083
              15  |    .798882   .2276927    -0.79   0.431     .4569599    1.396649
              16  |   1.118743   .1753629     0.72   0.474     .8228191    1.521094
                  |
             time |
            2007  |   1.359318   .1159245     3.60   0.000     1.150083    1.606618
            2008  |    1.09913   .0810486     1.28   0.200     .9512232    1.270035
            2010  |   1.066974   .0934785     0.74   0.459     .8986268    1.266859
            2011  |   .9427054   .0637701    -0.87   0.383     .8256496    1.076357
            2012  |   .8740127   .0786678    -1.50   0.135     .7326611    1.042635
            2013  |   .8750252   .0982369    -1.19   0.234     .7021959    1.090393
                  |
            _cons |   .0000448   5.15e-06   -87.08   0.000     .0000358    .0000561
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.944131   .2007712                     -2.337636   -1.550627
------------------+----------------------------------------------------------------
            alpha |   .1431115   .0287327                      .0965556    .2121149
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.3.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.PP.3.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(2)  = -14701.85
(Assumption: nbin nested in pois)                     Prob > chi2 =    1.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        nbin |        384  -1370.77  -1305.525      23     2657.05   2747.915
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next" 

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp3_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cpp3_res = dv - cpp3_yhat
(88 missing values generated)

. 
. summ dv cpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
   cpp3_yhat |        747    22.28621    18.75053   .1156998   113.5822

. /*
> pause "next"
> 
> scatter dv cpp3_yhat
> 
> pause "next"
> 
> scatter cpp3_res dv
> 
> pause "next"
> 
> scatter cpp3_res cpp3_yhat
> */
. pause "complete: C.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model C.PP.4
. 
. // poisson model
. /*glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(poisson) link(log) vce(cl mineid) exposure(hours) iter(50) eform
>         
> quietly poisson dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr
> est store pois
> estat gof
>         
> pause "next"
> 
> // negative binomial model
> glm dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, family(nbinomial) link(log) vce(cl mineid) exposure(hours) iter(50) eform
> 
> pause "next"*/ 
. 
. eststo clear

. eststo: nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

Fitting Poisson model:

Iteration 0:   log pseudolikelihood = -1654.8953  
Iteration 1:   log pseudolikelihood = -1643.3058  
Iteration 2:   log pseudolikelihood = -1643.2894  
Iteration 3:   log pseudolikelihood = -1643.2894  

Fitting constant-only model:

Iteration 0:   log pseudolikelihood = -1477.3626  
Iteration 1:   log pseudolikelihood = -1399.2522  
Iteration 2:   log pseudolikelihood = -1371.3437  
Iteration 3:   log pseudolikelihood = -1370.7703  
Iteration 4:   log pseudolikelihood = -1370.7701  

Fitting full model:

Iteration 0:   log pseudolikelihood = -1322.0596  
Iteration 1:   log pseudolikelihood = -1308.9399  
Iteration 2:   log pseudolikelihood =  -1307.774  
Iteration 3:   log pseudolikelihood = -1307.7702  
Iteration 4:   log pseudolikelihood = -1307.7702  

Negative binomial regression                    Number of obs     =        384
                                                Wald chi2(21)     =          .
Dispersion           = mean                     Prob > chi2       =          .
Log pseudolikelihood = -1307.7702               Pseudo R2         =     0.0460

                                     (Std. Err. adjusted for 78 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
               dv |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_pp_c_lag_all |   1.000026   .0000387     0.66   0.509     .9999497    1.000101
 p75_pp_c_lag_all |   .9999998   2.19e-07    -0.76   0.445     .9999994           1
        mine_time |   1.002925   .0175103     0.17   0.867     .9691859    1.037839
onsite_insp_hours |          1   .0000641     0.01   0.996     .9998747    1.000126
            union |   1.035833   .1457478     0.25   0.802     .7861774    1.364768
         longwall |   .6529619   .0873804    -3.19   0.001     .5023179    .8487837
                  |
            state |
               1  |   1.624826   .3505264     2.25   0.024     1.064573    2.479921
               3  |   1.078405    .206333     0.39   0.693     .7411734    1.569075
               4  |   1.759532   .2469962     4.03   0.000     1.336315    2.316784
               5  |      1.179   .1704166     1.14   0.255     .8881331    1.565126
              10  |   1.542304   .2382333     2.81   0.005     1.139432     2.08762
              11  |   2.614739   .3210023     7.83   0.000     2.055556    3.326039
              12  |    1.15482   .2087397     0.80   0.426     .8103176    1.645786
              13  |   2.600755   .8400585     2.96   0.003     1.380882    4.898265
              14  |   .7947111   .1679061    -1.09   0.277     .5252522    1.202405
              15  |   .8508704   .2476924    -0.55   0.579      .480922    1.505401
              16  |   1.198105   .2019291     1.07   0.284     .8610588    1.667081
                  |
             time |
            2007  |   1.271456   .1036975     2.94   0.003     1.083625    1.491845
            2008  |   1.096857   .0829239     1.22   0.221     .9457968    1.272043
            2010  |   1.037208   .0906471     0.42   0.676     .8739259    1.230996
            2011  |   .9112066   .0539628    -1.57   0.116     .8113488    1.023355
            2012  |   .8368742   .0721897    -2.06   0.039     .7066993    .9910277
            2013  |   .8324347   .0880652    -1.73   0.083     .6765495    1.024238
                  |
            _cons |   .0000449   5.30e-06   -84.76   0.000     .0000356    .0000566
        ln(hours) |          1  (exposure)
------------------+----------------------------------------------------------------
         /lnalpha |  -1.925321   .1927536                     -2.303111    -1.54753
------------------+----------------------------------------------------------------
            alpha |    .145829   .0281091                      .0999475    .2127728
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.C.PP.4.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.C.PP.4.csv)

. est store nbin

. 
. pause "next"

. 
. // test for over-dispersion
. lrtest pois nbin, stats force 

Likelihood-ratio test                                 LR chi2(2)  = -14697.36
(Assumption: nbin nested in pois)                     Prob > chi2 =    1.0000

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
        nbin |        384  -1370.77   -1307.77      23     2661.54   2752.405
        pois |      2,734 -9822.414   -8656.45      25     17362.9   17510.74
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. pause "next"

. 
. // final model + diagnostics/assessment
. quietly nbreg dv `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) exposure(hours) iter(50) irr

. predict cpp4_yhat 
(option n assumed; predicted number of events)
(88 missing values generated)

. gen cpp4_res = dv - cpp4_yhat
(88 missing values generated)

. 
. summ dv cpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          dv |        835     28.2994    25.71727          0        200
   cpp4_yhat |        747     23.1751    19.18474   .1178048    120.432

. /*
> pause "next"
> 
> scatter dv cpp4_yhat
> 
> pause "next"
> 
> scatter cpp4_res dv
> 
> pause "next"
> 
> scatter cpp4_res cpp4_yhat
> */
. pause "complete: C.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.1
. 
. eststo clear

. eststo: logit dv_indicator `count_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 224 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 148 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 4 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 20 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 10 obs not used

note: 14.state != 0 predicts success perfectly
      14.state dropped and 1 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 14 obs not used

note: 1.time != 0 predicts success perfectly
      1.time dropped and 21 obs not used

note: 2.time != 0 predicts success perfectly
      2.time dropped and 19 obs not used

note: 5.time != 0 predicts success perfectly
      5.time dropped and 19 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -50.949281  
Iteration 1:   log pseudolikelihood = -41.014267  
Iteration 2:   log pseudolikelihood =  -38.31628  
Iteration 3:   log pseudolikelihood = -38.158018  
Iteration 4:   log pseudolikelihood = -38.156208  
Iteration 5:   log pseudolikelihood = -38.156207  

Logistic regression                             Number of obs     =        267
                                                Wald chi2(18)     =     183.58
Log pseudolikelihood = -38.156207               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 62 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
              p48 |   1.017475   .3797363     0.05   0.963     .4896019    2.114484
              p75 |   .9887092   .0061864    -1.81   0.070      .976658    1.000909
        mine_time |   1.098778   .1197512     0.86   0.387     .8874446    1.360439
onsite_insp_hours |   1.005419   .0015679     3.47   0.001      1.00235    1.008496
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   2.398782    2.18735     0.96   0.337     .4016202    14.32736
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   .9636861   .7294581    -0.05   0.961     .2185859    4.248631
              13  |    .095841   .1657756    -1.36   0.175     .0032302    2.843606
              14  |          1  (empty)
              15  |          1  (empty)
              16  |    .760817   .8610674    -0.24   0.809     .0827787    6.992652
                  |
             time |
            2000  |          1  (empty)
            2001  |          1  (empty)
            2002  |   2.305916   3.192243     0.60   0.546     .1529202     34.7714
            2003  |   3.771472    7.43298     0.67   0.501     .0792367    179.5129
            2004  |          1  (empty)
            2005  |   3.096706   4.030339     0.87   0.385     .2415838    39.69467
            2006  |   1.898106   3.461682     0.35   0.725      .053203    67.71805
            2007  |   .3286603    .443956    -0.82   0.410     .0232777    4.640391
            2008  |   .3278433   .4635723    -0.79   0.430     .0205146    5.239262
            2010  |   1.928194   2.775683     0.46   0.648     .1147691    32.39489
            2011  |   3.137512    6.42146     0.56   0.576     .0568139    173.2672
            2012  |   .3820746   .7496088    -0.49   0.624     .0081684    17.87136
            2013  |   .0200474   .0346282    -2.26   0.024     .0006788    .5920413
                  |
            _cons |   .0000413   .0000514    -8.11   0.000     3.60e-06    .0004733
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 3 successes completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.1.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.V.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       267
 number of covariate patterns =       267
            Pearson chi2(248) =       114.63
                  Prob > chi2 =         1.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -68.520722  
Iteration 1:   log likelihood =  -55.67835  
Iteration 2:   log likelihood = -40.466853  
Iteration 3:   log likelihood = -38.752086  
Iteration 4:   log likelihood = -37.645154  
Iteration 5:   log likelihood = -37.425366  
Iteration 6:   log likelihood = -37.423705  
Iteration 7:   log likelihood = -37.423704  

Logistic regression                             Number of obs     =        267
                                                LR chi2(2)        =      62.19
                                                Prob > chi2       =     0.0000
Log likelihood = -37.423704                     Pseudo R2         =     0.4538

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .7411896   .2743909     2.70   0.007     .2033933    1.278986
      _hatsq |   .1209403   .1053408     1.15   0.251    -.0855238    .3274044
       _cons |  -.1073294    .408997    -0.26   0.793    -.9089488    .6942899
------------------------------------------------------------------------------
Note: 0 failures and 26 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       243            13  |        256
     -     |         5             6  |         11
-----------+--------------------------+-----------
   Total   |       248            19  |        267

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   97.98%
Specificity                     Pr( -|~D)   31.58%
Positive predictive value       Pr( D| +)   94.92%
Negative predictive value       Pr(~D| -)   54.55%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   68.42%
False - rate for true D         Pr( -| D)    2.02%
False + rate for classified +   Pr(~D| +)    5.08%
False - rate for classified -   Pr( D| -)   45.45%
--------------------------------------------------
Correctly classified                        93.26%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv1_yhat 
(option pr assumed; Pr(dv_indicator))
(568 missing values generated)

. gen bv1_res = dv_indicator - bv1_yhat
(568 missing values generated)

. 
. summ dv_indicator bv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
    bv1_yhat |        267     .928839    .1557483   .0494376          1

. /*
> pause "next"
> 
> scatter dv_indicator bv1_yhat
> 
> pause "next"
> 
> scatter bv1_res dv_indicator
> 
> pause "next"
> 
> scatter bv1_res bv1_yhat
> */
. pause "complete: B.V.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.2
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 224 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 148 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 4 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 20 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 10 obs not used

note: 14.state != 0 predicts success perfectly
      14.state dropped and 1 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 14 obs not used

note: 1.time != 0 predicts success perfectly
      1.time dropped and 21 obs not used

note: 2.time != 0 predicts success perfectly
      2.time dropped and 19 obs not used

note: 5.time != 0 predicts success perfectly
      5.time dropped and 19 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -50.949281  
Iteration 1:   log pseudolikelihood = -41.309986  
Iteration 2:   log pseudolikelihood =  -38.95061  
Iteration 3:   log pseudolikelihood =  -38.84221  
Iteration 4:   log pseudolikelihood = -38.841264  
Iteration 5:   log pseudolikelihood = -38.841264  

Logistic regression                             Number of obs     =        267
                                                Wald chi2(18)     =     190.81
Log pseudolikelihood = -38.841264               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 62 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
         p48_1lag |     .83672   .2439332    -0.61   0.541     .4725252    1.481615
         p75_1lag |   .9948437   .0050686    -1.01   0.310     .9849588    1.004828
        mine_time |   1.119658   .1194497     1.06   0.289     .9083967     1.38005
onsite_insp_hours |    1.00409   .0015101     2.71   0.007     1.001134    1.007054
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |    2.30115   2.050926     0.94   0.350     .4011455    13.20043
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   1.036963   .7838936     0.05   0.962     .2356657    4.562787
              13  |    .123145    .237166    -1.09   0.277     .0028254    5.367272
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   .8348315   .7784286    -0.19   0.846     .1342475    5.191483
                  |
             time |
            2000  |          1  (empty)
            2001  |          1  (empty)
            2002  |   2.050642   2.579539     0.57   0.568     .1742403    24.13411
            2003  |   3.829597   7.572279     0.68   0.497     .0794454    184.6025
            2004  |          1  (empty)
            2005  |   3.099795   3.780774     0.93   0.354     .2838802    33.84783
            2006  |   1.731635   2.791792     0.34   0.733     .0734725    40.81202
            2007  |   .3041546   .4053956    -0.89   0.372     .0223132    4.145978
            2008  |   .3154599   .3897693    -0.93   0.350     .0280049     3.55348
            2010  |   1.548591   2.092312     0.32   0.746     .1096156    21.87767
            2011  |   2.914748   6.225061     0.50   0.616     .0443282    191.6559
            2012  |   .4158645   .8199614    -0.44   0.656     .0087224    19.82755
            2013  |   .0282098    .054572    -1.84   0.065     .0006364    1.250417
                  |
            _cons |   .0000386   .0000462    -8.48   0.000     3.68e-06    .0004037
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 1 success completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.2.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.V.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       267
 number of covariate patterns =       267
            Pearson chi2(248) =       200.97
                  Prob > chi2 =         0.9872

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -68.520722  
Iteration 1:   log likelihood =  -57.19122  
Iteration 2:   log likelihood = -41.204486  
Iteration 3:   log likelihood = -39.260096  
Iteration 4:   log likelihood =  -38.73938  
Iteration 5:   log likelihood = -38.662348  
Iteration 6:   log likelihood = -38.661615  
Iteration 7:   log likelihood = -38.661615  

Logistic regression                             Number of obs     =        267
                                                LR chi2(2)        =      59.72
                                                Prob > chi2       =     0.0000
Log likelihood = -38.661615                     Pseudo R2         =     0.4358

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .8885202   .3200231     2.78   0.005     .2612863    1.515754
      _hatsq |   .0547976     .10101     0.54   0.587    -.1431783    .2527736
       _cons |   -.064217   .4134745    -0.16   0.877    -.8746121    .7461781
------------------------------------------------------------------------------
Note: 0 failures and 9 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       243            13  |        256
     -     |         5             6  |         11
-----------+--------------------------+-----------
   Total   |       248            19  |        267

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   97.98%
Specificity                     Pr( -|~D)   31.58%
Positive predictive value       Pr( D| +)   94.92%
Negative predictive value       Pr(~D| -)   54.55%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   68.42%
False - rate for true D         Pr( -| D)    2.02%
False + rate for classified +   Pr(~D| +)    5.08%
False - rate for classified -   Pr( D| -)   45.45%
--------------------------------------------------
Correctly classified                        93.26%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv2_yhat 
(option pr assumed; Pr(dv_indicator))
(568 missing values generated)

. gen bv2_res = dv_indicator - bv2_yhat
(568 missing values generated)

. 
. summ dv_indicator bv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
    bv2_yhat |        267    .9288389    .1527009   .0727192          1

. /*
> pause "next"
> 
> scatter dv_indicator bv2_yhat
> 
> pause "next"
> 
> scatter bv2_res dv_indicator
> 
> pause "next"
> 
> scatter bv2_res bv2_yhat
> */
. pause "complete: B.V.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.3
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 224 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 148 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 4 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 20 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 10 obs not used

note: 14.state != 0 predicts success perfectly
      14.state dropped and 1 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 14 obs not used

note: 1.time != 0 predicts success perfectly
      1.time dropped and 21 obs not used

note: 2.time != 0 predicts success perfectly
      2.time dropped and 19 obs not used

note: 5.time != 0 predicts success perfectly
      5.time dropped and 19 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -50.949281  
Iteration 1:   log pseudolikelihood = -41.538363  
Iteration 2:   log pseudolikelihood = -39.410894  
Iteration 3:   log pseudolikelihood =   -39.3176  
Iteration 4:   log pseudolikelihood = -39.317188  
Iteration 5:   log pseudolikelihood = -39.317188  

Logistic regression                             Number of obs     =        267
                                                Wald chi2(18)     =     119.51
Log pseudolikelihood = -39.317188               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 62 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
       p48_c_4lag |   1.037673   .1175679     0.33   0.744     .8310356     1.29569
       p75_c_4lag |   .9992607   .0017044    -0.43   0.665     .9959257    1.002607
        mine_time |   1.128829   .1078473     1.27   0.205     .9360632    1.361292
onsite_insp_hours |   1.003272   .0012949     2.53   0.011     1.000737    1.005813
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   1.830947   1.563106     0.71   0.479     .3435521    9.757961
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   1.134419   .8008793     0.18   0.858     .2843417    4.525915
              13  |   .1110202   .2032237    -1.20   0.230     .0030709    4.013616
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   .9540097   1.006382    -0.04   0.964     .1206765    7.541937
                  |
             time |
            2000  |          1  (empty)
            2001  |          1  (empty)
            2002  |   1.713058   2.356449     0.39   0.696     .1155783    25.39032
            2003  |   4.070436   7.759177     0.74   0.461     .0970638    170.6965
            2004  |          1  (empty)
            2005  |   2.852659   3.463497     0.86   0.388     .2641077    30.81191
            2006  |   1.483641    2.49298     0.23   0.814     .0550864    39.95888
            2007  |   .3227427     .41569    -0.88   0.380     .0258533       4.029
            2008  |   .2905734   .3868925    -0.93   0.353     .0213746    3.950144
            2010  |    1.57401    2.09402     0.34   0.733     .1160357    21.35125
            2011  |   2.953598   5.891702     0.54   0.587     .0592125    147.3293
            2012  |   .4982698   .9723537    -0.36   0.721     .0108737    22.83234
            2013  |   .0388168   .0703332    -1.79   0.073     .0011135    1.353118
                  |
            _cons |   .0000353   .0000428    -8.46   0.000     3.28e-06      .00038
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.3.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.V.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       267
 number of covariate patterns =       267
            Pearson chi2(248) =       173.86
                  Prob > chi2 =         0.9999

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -68.520722  
Iteration 1:   log likelihood = -58.766115  
Iteration 2:   log likelihood = -41.976124  
Iteration 3:   log likelihood = -40.025703  
Iteration 4:   log likelihood = -39.176318  
Iteration 5:   log likelihood = -38.886033  
Iteration 6:   log likelihood = -38.882162  
Iteration 7:   log likelihood =  -38.88216  

Logistic regression                             Number of obs     =        267
                                                LR chi2(2)        =      59.28
                                                Prob > chi2       =     0.0000
Log likelihood =  -38.88216                     Pseudo R2         =     0.4325

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .7976748   .3070354     2.60   0.009     .1958964    1.399453
      _hatsq |   .0903001   .1044496     0.86   0.387    -.1144174    .2950176
       _cons |    -.07908   .4088912    -0.19   0.847     -.880492     .722332
------------------------------------------------------------------------------
Note: 0 failures and 11 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       243            14  |        257
     -     |         5             5  |         10
-----------+--------------------------+-----------
   Total   |       248            19  |        267

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   97.98%
Specificity                     Pr( -|~D)   26.32%
Positive predictive value       Pr( D| +)   94.55%
Negative predictive value       Pr(~D| -)   50.00%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   73.68%
False - rate for true D         Pr( -| D)    2.02%
False + rate for classified +   Pr(~D| +)    5.45%
False - rate for classified -   Pr( D| -)   50.00%
--------------------------------------------------
Correctly classified                        92.88%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv3_yhat 
(option pr assumed; Pr(dv_indicator))
(568 missing values generated)

. gen bv3_res = dv_indicator - bv3_yhat
(568 missing values generated)

. 
. summ dv_indicator bv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
    bv3_yhat |        267     .928839    .1520585   .0791167   .9999999

. /*
> pause "next"
> 
> scatter dv_indicator bv3_yhat
> 
> pause "next"
> 
> scatter bv3_res dv_indicator
> 
> pause "next"
> 
> scatter bv3_res bv3_yhat
> */
. pause "complete: B.V.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.V.4
. 
. eststo clear

. eststo: logit dv_indicator `count_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 224 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 148 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 4 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 20 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 10 obs not used

note: 14.state != 0 predicts success perfectly
      14.state dropped and 1 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 14 obs not used

note: 1.time != 0 predicts success perfectly
      1.time dropped and 21 obs not used

note: 2.time != 0 predicts success perfectly
      2.time dropped and 19 obs not used

note: 5.time != 0 predicts success perfectly
      5.time dropped and 19 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -50.949281  
Iteration 1:   log pseudolikelihood = -41.328768  
Iteration 2:   log pseudolikelihood = -38.886617  
Iteration 3:   log pseudolikelihood = -38.597427  
Iteration 4:   log pseudolikelihood = -38.570657  
Iteration 5:   log pseudolikelihood = -38.570545  
Iteration 6:   log pseudolikelihood = -38.570545  

Logistic regression                             Number of obs     =        267
                                                Wald chi2(18)     =     159.85
Log pseudolikelihood = -38.570545               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 62 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_c_lag_all |   .9827207   .0271376    -0.63   0.528     .9309459    1.037375
    p75_c_lag_all |   1.000537   .0003355     1.60   0.109     .9998795    1.001195
        mine_time |   1.012854   .0945098     0.14   0.891     .8435696     1.21611
onsite_insp_hours |   1.002535   .0014009     1.81   0.070     .9997932    1.005285
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   1.723049   1.872803     0.50   0.617     .2046992     14.5037
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   2.466316   1.532951     1.45   0.146     .7294242    8.339063
              13  |   .0969275   .1757157    -1.29   0.198     .0027755    3.384965
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   .9399359   1.062771    -0.05   0.956     .1024845    8.620618
                  |
             time |
            2000  |          1  (empty)
            2001  |          1  (empty)
            2002  |    1.14433   1.804658     0.09   0.932     .0520199    25.17289
            2003  |   2.336258   4.233662     0.47   0.640     .0669902    81.47613
            2004  |          1  (empty)
            2005  |   2.597105   3.361197     0.74   0.461     .2055211    32.81879
            2006  |   1.437969   2.478595     0.21   0.833     .0490402    42.16448
            2007  |   .3020301   .3917802    -0.92   0.356     .0237634    3.838765
            2008  |   .2888823   .3870149    -0.93   0.354     .0209107    3.990924
            2010  |   1.456563   1.910703     0.29   0.774      .111361    19.05134
            2011  |    2.61167   5.215567     0.48   0.631     .0521253    130.8543
            2012  |   .3832837   .7486174    -0.49   0.623     .0083364    17.62219
            2013  |   .0463073   .0900611    -1.58   0.114     .0010237    2.094675
                  |
            _cons |   .0000416   .0000534    -7.87   0.000     3.37e-06    .0005139
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.V.4.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.V.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       267
 number of covariate patterns =       267
            Pearson chi2(248) =       128.70
                  Prob > chi2 =         1.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -68.520722  
Iteration 1:   log likelihood = -56.181485  
Iteration 2:   log likelihood = -41.273349  
Iteration 3:   log likelihood = -39.707822  
Iteration 4:   log likelihood = -39.045565  
Iteration 5:   log likelihood = -37.786542  
Iteration 6:   log likelihood = -37.690282  
Iteration 7:   log likelihood = -37.690116  
Iteration 8:   log likelihood = -37.690116  

Logistic regression                             Number of obs     =        267
                                                LR chi2(2)        =      61.66
                                                Prob > chi2       =     0.0000
Log likelihood = -37.690116                     Pseudo R2         =     0.4499

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |    .763368   .2472125     3.09   0.002     .2788403    1.247896
      _hatsq |   .1230261   .0907425     1.36   0.175     -.054826    .3008781
       _cons |  -.1419567   .4129588    -0.34   0.731    -.9513411    .6674277
------------------------------------------------------------------------------
Note: 0 failures and 45 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       245            14  |        259
     -     |         3             5  |          8
-----------+--------------------------+-----------
   Total   |       248            19  |        267

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.79%
Specificity                     Pr( -|~D)   26.32%
Positive predictive value       Pr( D| +)   94.59%
Negative predictive value       Pr(~D| -)   62.50%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   73.68%
False - rate for true D         Pr( -| D)    1.21%
False + rate for classified +   Pr(~D| +)    5.41%
False - rate for classified -   Pr( D| -)   37.50%
--------------------------------------------------
Correctly classified                        93.63%
--------------------------------------------------

. 
. pause "next"

. 
. predict bv4_yhat 
(option pr assumed; Pr(dv_indicator))
(568 missing values generated)

. gen bv4_res = dv_indicator - bv4_yhat
(568 missing values generated)

. 
. summ dv_indicator bv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
    bv4_yhat |        267     .928839    .1527392   .0228144   .9999999

. /*
> pause "next"
> 
> scatter dv_indicator bv4_yhat
> 
> pause "next"
> 
> scatter bv4_res dv_indicator
> 
> pause "next"
> 
> scatter bv4_res bv4_yhat
> */
. pause "complete: B.V.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.1
. 
. eststo clear

. eststo: logit dv_indicator `ss_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: p48_ss != 0 predicts success perfectly
      p48_ss dropped and 89 obs not used

note: union != 0 predicts success perfectly
      union dropped and 187 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 130 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 4 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 17 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 8 obs not used

note: 14.state != 0 predicts success perfectly
      14.state dropped and 1 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 13 obs not used

note: 1.time != 0 predicts success perfectly
      1.time dropped and 21 obs not used

note: 2.time != 0 predicts success perfectly
      2.time dropped and 18 obs not used

note: 5.time != 0 predicts success perfectly
      5.time dropped and 18 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -48.829352  
Iteration 1:   log pseudolikelihood = -39.112558  
Iteration 2:   log pseudolikelihood = -36.768517  
Iteration 3:   log pseudolikelihood = -36.635179  
Iteration 4:   log pseudolikelihood = -36.633488  
Iteration 5:   log pseudolikelihood = -36.633487  

Logistic regression                             Number of obs     =        241
                                                Wald chi2(16)     =          .
Log pseudolikelihood = -36.633487               Prob > chi2       =          .

                                     (Std. Err. adjusted for 59 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_ss |          1  (omitted)
           p75_ss |   .9889685   .0120488    -0.91   0.363     .9656331    1.012868
        mine_time |   1.136603   .1504398     0.97   0.333     .8768883    1.473238
onsite_insp_hours |   1.004159    .001748     2.38   0.017     1.000739    1.007591
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   1.904213   2.063528     0.59   0.552     .2276662    15.92694
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   1.204981   .8973362     0.25   0.802     .2799623    5.186337
              13  |   .1538696   .2559034    -1.13   0.260     .0059089    4.006836
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   .9590939   1.026995    -0.04   0.969     .1175973    7.822131
                  |
             time |
            2000  |          1  (empty)
            2001  |          1  (empty)
            2002  |   3.734754   4.224792     1.16   0.244     .4067934    34.28862
            2003  |   8.948033   16.50036     1.19   0.235     .2410426    332.1708
            2004  |          1  (empty)
            2005  |    7.13723   6.833478     2.05   0.040     1.092834    46.61279
            2006  |   3.244582   5.615349     0.68   0.496     .1091432    96.45409
            2007  |   .6125392   .6283271    -0.48   0.633     .0820338    4.573774
            2008  |    .571374   .6348883    -0.50   0.614      .064729    5.043618
            2010  |   3.389234   3.616008     1.14   0.253     .4187416    27.43197
            2011  |   6.049292   11.25525     0.97   0.333     .1577495    231.9749
            2012  |   .8494686   1.595765    -0.09   0.931     .0213859    33.74178
            2013  |   .0473676   .0911497    -1.58   0.113     .0010902    2.058036
                  |
            _cons |   .0000135   .0000156    -9.73   0.000     1.41e-06    .0001291
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 1 success completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.1.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.SSV.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       241
 number of covariate patterns =       241
            Pearson chi2(223) =       155.95
                  Prob > chi2 =         0.9998

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -66.497342  
Iteration 1:   log likelihood = -53.212521  
Iteration 2:   log likelihood = -38.687453  
Iteration 3:   log likelihood = -37.000318  
Iteration 4:   log likelihood = -36.510458  
Iteration 5:   log likelihood = -36.436748  
Iteration 6:   log likelihood = -36.435994  
Iteration 7:   log likelihood = -36.435994  

Logistic regression                             Number of obs     =        241
                                                LR chi2(2)        =      60.12
                                                Prob > chi2       =     0.0000
Log likelihood = -36.435994                     Pseudo R2         =     0.4521

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .8880736   .3110358     2.86   0.004     .2784546    1.497693
      _hatsq |    .057872   .0996406     0.58   0.561      -.13742    .2531639
       _cons |   -.056454   .4037146    -0.14   0.889    -.8477201    .7348121
------------------------------------------------------------------------------
Note: 0 failures and 10 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       219            14  |        233
     -     |         3             5  |          8
-----------+--------------------------+-----------
   Total   |       222            19  |        241

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.65%
Specificity                     Pr( -|~D)   26.32%
Positive predictive value       Pr( D| +)   93.99%
Negative predictive value       Pr(~D| -)   62.50%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   73.68%
False - rate for true D         Pr( -| D)    1.35%
False + rate for classified +   Pr(~D| +)    6.01%
False - rate for classified -   Pr( D| -)   37.50%
--------------------------------------------------
Correctly classified                        92.95%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv1_yhat 
(option pr assumed; Pr(dv_indicator))
(594 missing values generated)

. gen bssv1_res = dv_indicator - bssv1_yhat
(594 missing values generated)

. 
. summ dv_indicator bssv1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
  bssv1_yhat |        241    .9211618    .1630957   .0467849          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv1_yhat
> 
> pause "next"
> 
> scatter bssv1_res dv_indicator
> 
> pause "next"
> 
> scatter bssv1_res bssv1_yhat
> */
. pause "complete: B.SSV.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.2
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_1_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 224 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 148 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 4 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 20 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 10 obs not used

note: 14.state != 0 predicts success perfectly
      14.state dropped and 1 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 14 obs not used

note: 1.time != 0 predicts success perfectly
      1.time dropped and 21 obs not used

note: 2.time != 0 predicts success perfectly
      2.time dropped and 19 obs not used

note: 5.time != 0 predicts success perfectly
      5.time dropped and 19 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -50.949281  
Iteration 1:   log pseudolikelihood = -41.565207  
Iteration 2:   log pseudolikelihood = -39.416989  
Iteration 3:   log pseudolikelihood =  -39.31874  
Iteration 4:   log pseudolikelihood = -39.318253  
Iteration 5:   log pseudolikelihood = -39.318253  

Logistic regression                             Number of obs     =        267
                                                Wald chi2(18)     =     139.90
Log pseudolikelihood = -39.318253               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 62 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_ss_1lag |   .9975186   .4825628    -0.01   0.996     .3864924    2.574548
      p75_ss_1lag |   .9938845   .0137964    -0.44   0.659     .9672085    1.021296
        mine_time |   1.114549   .1206286     1.00   0.316      .901515    1.377925
onsite_insp_hours |   1.003234   .0015475     2.09   0.036     1.000205    1.006271
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   1.992593   1.767285     0.78   0.437     .3503199    11.33372
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   1.156077   .8492483     0.20   0.843     .2739673    4.878373
              13  |   .1292217   .2298165    -1.15   0.250     .0039582    4.218609
              14  |          1  (empty)
              15  |          1  (empty)
              16  |    .875323   .9361899    -0.12   0.901     .1075913    7.121302
                  |
             time |
            2000  |          1  (empty)
            2001  |          1  (empty)
            2002  |   1.659652   2.225372     0.38   0.706     .1198588    22.98077
            2003  |   3.835497   7.688592     0.67   0.502     .0754246    195.0429
            2004  |          1  (empty)
            2005  |   3.003128   3.882613     0.85   0.395     .2382827    37.84906
            2006  |   1.575363    2.67854     0.27   0.789     .0562484    44.12163
            2007  |   .3153067     .43863    -0.83   0.407     .0206352    4.817904
            2008  |   .2920812   .4004664    -0.90   0.369      .019881    4.291096
            2010  |    1.65684   2.174378     0.38   0.700     .1265301    21.69538
            2011  |   2.792852   5.806688     0.49   0.621     .0474563    164.3623
            2012  |   .4707936   .9459848    -0.37   0.708     .0091723    24.16487
            2013  |   .0361456    .074946    -1.60   0.109     .0006211    2.103674
                  |
            _cons |   .0000382   .0000491    -7.91   0.000     3.07e-06    .0004746
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.2.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.SSV.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       267
 number of covariate patterns =       267
            Pearson chi2(248) =       222.70
                  Prob > chi2 =         0.8743

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -68.520722  
Iteration 1:   log likelihood = -58.566281  
Iteration 2:   log likelihood = -41.862989  
Iteration 3:   log likelihood =  -39.88065  
Iteration 4:   log likelihood = -39.274056  
Iteration 5:   log likelihood = -39.108462  
Iteration 6:   log likelihood = -39.106756  
Iteration 7:   log likelihood = -39.106756  

Logistic regression                             Number of obs     =        267
                                                LR chi2(2)        =      58.83
                                                Prob > chi2       =     0.0000
Log likelihood = -39.106756                     Pseudo R2         =     0.4293

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .8638605   .3179089     2.72   0.007     .2407705     1.48695
      _hatsq |   .0597183   .0989506     0.60   0.546    -.1342212    .2536579
       _cons |  -.0525421   .4093076    -0.13   0.898    -.8547702    .7496861
------------------------------------------------------------------------------
Note: 0 failures and 8 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       243            14  |        257
     -     |         5             5  |         10
-----------+--------------------------+-----------
   Total   |       248            19  |        267

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   97.98%
Specificity                     Pr( -|~D)   26.32%
Positive predictive value       Pr( D| +)   94.55%
Negative predictive value       Pr(~D| -)   50.00%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   73.68%
False - rate for true D         Pr( -| D)    2.02%
False + rate for classified +   Pr(~D| +)    5.45%
False - rate for classified -   Pr( D| -)   50.00%
--------------------------------------------------
Correctly classified                        92.88%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv2_yhat 
(option pr assumed; Pr(dv_indicator))
(568 missing values generated)

. gen bssv2_res = dv_indicator - bssv2_yhat
(568 missing values generated)

. 
. summ dv_indicator bssv2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
  bssv2_yhat |        267     .928839    .1520689   .0723139          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv2_yhat
> 
> pause "next"
> 
> scatter bssv2_res dv_indicator
> 
> pause "next"
> 
> scatter bssv2_res bssv2_yhat
> */
. pause "complete: B.SSV.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.3
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_4_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 224 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 148 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 4 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 20 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 10 obs not used

note: 14.state != 0 predicts success perfectly
      14.state dropped and 1 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 14 obs not used

note: 1.time != 0 predicts success perfectly
      1.time dropped and 21 obs not used

note: 2.time != 0 predicts success perfectly
      2.time dropped and 19 obs not used

note: 5.time != 0 predicts success perfectly
      5.time dropped and 19 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -50.949281  
Iteration 1:   log pseudolikelihood = -41.368594  
Iteration 2:   log pseudolikelihood = -39.176471  
Iteration 3:   log pseudolikelihood = -39.081294  
Iteration 4:   log pseudolikelihood = -39.080808  
Iteration 5:   log pseudolikelihood = -39.080808  

Logistic regression                             Number of obs     =        267
                                                Wald chi2(18)     =      98.57
Log pseudolikelihood = -39.080808               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 62 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_ss_c_4lag |    1.30689   .5186599     0.67   0.500     .6003801      2.8448
    p75_ss_c_4lag |   1.000008   .0037853     0.00   0.998     .9926161    1.007454
        mine_time |   1.115266   .1179116     1.03   0.302     .9065363    1.372056
onsite_insp_hours |   1.002869   .0013371     2.15   0.032     1.000251    1.005493
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   1.819429   1.646212     0.66   0.508     .3088671    10.71763
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   1.335162   .9383621     0.41   0.681     .3367467    5.293768
              13  |   .1288665   .2375438    -1.11   0.266     .0034761    4.777348
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   1.053191   1.101154     0.05   0.960     .1356882    8.174714
                  |
             time |
            2000  |          1  (empty)
            2001  |          1  (empty)
            2002  |   1.853377   2.353267     0.49   0.627     .1538783    22.32288
            2003  |    5.01997   9.392916     0.86   0.389     .1282359    196.5136
            2004  |          1  (empty)
            2005  |   3.650517   4.560536     1.04   0.300      .315472    42.24232
            2006  |   1.801489   3.035495     0.35   0.727     .0662772    48.96653
            2007  |   .3924946    .493962    -0.74   0.457     .0333104    4.624737
            2008  |   .3424416   .4472146    -0.82   0.412     .0264821    4.428132
            2010  |   1.820254    2.37683     0.46   0.646     .1408186    23.52902
            2011  |   3.551291   7.012008     0.64   0.521     .0740785    170.2472
            2012  |   .6242756   1.190508    -0.25   0.805     .0148633    26.22027
            2013  |   .0503594   .0980624    -1.53   0.125     .0011081    2.288672
                  |
            _cons |   .0000276   .0000344    -8.42   0.000     2.40e-06    .0003176
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.3.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.SSV.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       267
 number of covariate patterns =       267
            Pearson chi2(248) =       172.89
                  Prob > chi2 =         0.9999

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -68.520722  
Iteration 1:   log likelihood = -59.085301  
Iteration 2:   log likelihood = -41.492112  
Iteration 3:   log likelihood = -39.773101  
Iteration 4:   log likelihood = -38.937309  
Iteration 5:   log likelihood =  -38.66335  
Iteration 6:   log likelihood = -38.657493  
Iteration 7:   log likelihood = -38.657492  

Logistic regression                             Number of obs     =        267
                                                LR chi2(2)        =      59.73
                                                Prob > chi2       =     0.0000
Log likelihood = -38.657492                     Pseudo R2         =     0.4358

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .8024804   .3032311     2.65   0.008     .2081584    1.396802
      _hatsq |   .0873095   .1016587     0.86   0.390    -.1119378    .2865569
       _cons |   -.072022   .4064379    -0.18   0.859    -.8686257    .7245817
------------------------------------------------------------------------------
Note: 0 failures and 11 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       244            14  |        258
     -     |         4             5  |          9
-----------+--------------------------+-----------
   Total   |       248            19  |        267

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.39%
Specificity                     Pr( -|~D)   26.32%
Positive predictive value       Pr( D| +)   94.57%
Negative predictive value       Pr(~D| -)   55.56%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   73.68%
False - rate for true D         Pr( -| D)    1.61%
False + rate for classified +   Pr(~D| +)    5.43%
False - rate for classified -   Pr( D| -)   44.44%
--------------------------------------------------
Correctly classified                        93.26%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv3_yhat 
(option pr assumed; Pr(dv_indicator))
(568 missing values generated)

. gen bssv3_res = dv_indicator - bssv3_yhat
(568 missing values generated)

. 
. summ dv_indicator bssv3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
  bssv3_yhat |        267     .928839     .152446   .0658656   .9999999

. /*
> pause "next"
> 
> scatter dv_indicator bssv3_yhat
> 
> pause "next"
> 
> scatter bssv3_res dv_indicator
> 
> pause "next"
> 
> scatter bssv3_res bssv3_yhat
> */
. pause "complete: B.SSV.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.SSV.4
. 
. eststo clear

. eststo: logit dv_indicator `ss_lag_all_vars' `covariates' ib(freq).state ib(freq).time, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 224 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 148 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 4 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 20 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 10 obs not used

note: 14.state != 0 predicts success perfectly
      14.state dropped and 1 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 14 obs not used

note: 1.time != 0 predicts success perfectly
      1.time dropped and 21 obs not used

note: 2.time != 0 predicts success perfectly
      2.time dropped and 19 obs not used

note: 5.time != 0 predicts success perfectly
      5.time dropped and 19 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -50.949281  
Iteration 1:   log pseudolikelihood = -41.266061  
Iteration 2:   log pseudolikelihood = -38.494417  
Iteration 3:   log pseudolikelihood = -37.948294  
Iteration 4:   log pseudolikelihood = -37.897855  
Iteration 5:   log pseudolikelihood =  -37.89766  
Iteration 6:   log pseudolikelihood =  -37.89766  

Logistic regression                             Number of obs     =        267
                                                Wald chi2(18)     =     121.09
Log pseudolikelihood =  -37.89766               Prob > chi2       =     0.0000

                                     (Std. Err. adjusted for 62 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_ss_c_lag_all |   .8960897   .0718224    -1.37   0.171     .7658203    1.048518
 p75_ss_c_lag_all |   1.002088    .001087     1.92   0.055     .9999595     1.00422
        mine_time |   .9925508   .0854389    -0.09   0.931     .8384578    1.174963
onsite_insp_hours |   1.002531   .0013674     1.85   0.064     .9998547    1.005215
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |    3.09084   2.906459     1.20   0.230     .4893872    19.52093
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   2.875326   1.856648     1.64   0.102     .8110568    10.19349
              13  |   .0595149   .1121449    -1.50   0.134     .0014815    2.390889
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   .9049096   1.201336    -0.08   0.940     .0670765    12.20787
                  |
             time |
            2000  |          1  (empty)
            2001  |          1  (empty)
            2002  |   .7109761   1.202066    -0.20   0.840     .0258646    19.54355
            2003  |   1.314307   2.446728     0.15   0.883     .0342051     50.5013
            2004  |          1  (empty)
            2005  |   2.095686   2.820712     0.55   0.583      .149845    29.30963
            2006  |   1.225422   2.127358     0.12   0.907     .0407926    36.81201
            2007  |   .2756118    .366773    -0.97   0.333     .0203027    3.741471
            2008  |   .2787466   .3834741    -0.93   0.353      .018802    4.132522
            2010  |   1.551714   2.052641     0.33   0.740     .1160978    20.73956
            2011  |   2.500886   4.912015     0.47   0.641     .0532403    117.4755
            2012  |   .4176148    .735534    -0.50   0.620     .0132305     13.1818
            2013  |   .0521152   .0943858    -1.63   0.103     .0014975    1.813739
                  |
            _cons |   .0000471    .000063    -7.46   0.000     3.44e-06    .0006465
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 1 success completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.SSV.4.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.SSV.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       267
 number of covariate patterns =       267
            Pearson chi2(248) =       125.01
                  Prob > chi2 =         1.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -68.520722  
Iteration 1:   log likelihood = -55.796376  
Iteration 2:   log likelihood = -40.432044  
Iteration 3:   log likelihood = -38.770729  
Iteration 4:   log likelihood = -38.399584  
Iteration 5:   log likelihood = -37.333746  
Iteration 6:   log likelihood = -37.292394  
Iteration 7:   log likelihood = -37.292298  
Iteration 8:   log likelihood = -37.292298  

Logistic regression                             Number of obs     =        267
                                                LR chi2(2)        =      62.46
                                                Prob > chi2       =     0.0000
Log likelihood = -37.292298                     Pseudo R2         =     0.4558

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .7849265   .2951914     2.66   0.008      .206362    1.363491
      _hatsq |   .1139253   .1069579     1.07   0.287    -.0957082    .3235589
       _cons |  -.1331875   .4053785    -0.33   0.742    -.9277147    .6613398
------------------------------------------------------------------------------
Note: 0 failures and 56 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       244            13  |        257
     -     |         4             6  |         10
-----------+--------------------------+-----------
   Total   |       248            19  |        267

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.39%
Specificity                     Pr( -|~D)   31.58%
Positive predictive value       Pr( D| +)   94.94%
Negative predictive value       Pr(~D| -)   60.00%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   68.42%
False - rate for true D         Pr( -| D)    1.61%
False + rate for classified +   Pr(~D| +)    5.06%
False - rate for classified -   Pr( D| -)   40.00%
--------------------------------------------------
Correctly classified                        93.63%
--------------------------------------------------

. 
. pause "next"

. 
. predict bssv4_yhat 
(option pr assumed; Pr(dv_indicator))
(568 missing values generated)

. gen bssv4_res = dv_indicator - bssv4_yhat
(568 missing values generated)

. 
. summ dv_indicator bssv4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
  bssv4_yhat |        267     .928839    .1525177   .0386298          1

. /*
> pause "next"
> 
> scatter dv_indicator bssv4_yhat
> 
> pause "next"
> 
> scatter bssv4_res dv_indicator
> 
> pause "next"
> 
> scatter bssv4_res bssv4_yhat
> */
. pause "complete: B.SSV.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.1
. 
. eststo clear

. eststo: logit dv_indicator `pp_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 96 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 71 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 1 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 14 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 3 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 7 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
note: 14.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -39.215728  
Iteration 1:   log pseudolikelihood = -31.988778  
Iteration 2:   log pseudolikelihood = -30.010517  
Iteration 3:   log pseudolikelihood = -29.908474  
Iteration 4:   log pseudolikelihood = -29.907692  
Iteration 5:   log pseudolikelihood = -29.907692  

Logistic regression                             Number of obs     =        192
                                                Wald chi2(13)     =          .
Log pseudolikelihood = -29.907692               Prob > chi2       =          .

                                     (Std. Err. adjusted for 50 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
           p48_pp |   1.000461   .0061611     0.07   0.940     .9884581     1.01261
           p75_pp |   .9998433   .0001256    -1.25   0.212     .9995971     1.00009
        mine_time |   1.180311    .140684     1.39   0.164      .934415    1.490916
onsite_insp_hours |   1.004597   .0017639     2.61   0.009     1.001146    1.008061
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   .7671763   .8485734    -0.24   0.811     .0877772    6.705155
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   .8250865   .6609651    -0.24   0.810     .1716382    3.966294
              13  |    .132153   .2059341    -1.30   0.194     .0062323    2.802238
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   .6748388    .839567    -0.32   0.752     .0589142    7.730009
                  |
             time |
            2007  |   .2846416   .3391157    -1.05   0.292     .0275547    2.940364
            2008  |   .3896781   .5935891    -0.62   0.536     .0196828    7.714801
            2010  |   1.840406   2.470806     0.45   0.650     .1324791    25.56701
            2011  |   2.246859   4.290771     0.42   0.672     .0532178    94.86252
            2012  |   .3467658   .6178168    -0.59   0.552     .0105558    11.39156
            2013  |   .0189056   .0288005    -2.60   0.009     .0009547    .3743671
                  |
            _cons |   .0000483   .0000553    -8.68   0.000     5.12e-06    .0004557
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
Note: 0 failures and 1 success completely determined.
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.1.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.PP.1.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       192
 number of covariate patterns =       192
            Pearson chi2(177) =        86.09
                  Prob > chi2 =         1.0000

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -50.134837  
Iteration 1:   log likelihood = -40.561978  
Iteration 2:   log likelihood = -31.063665  
Iteration 3:   log likelihood = -30.400471  
Iteration 4:   log likelihood = -29.877902  
Iteration 5:   log likelihood = -29.600253  
Iteration 6:   log likelihood = -29.588792  
Iteration 7:   log likelihood = -29.588771  
Iteration 8:   log likelihood = -29.588771  

Logistic regression                             Number of obs     =        192
                                                LR chi2(2)        =      41.09
                                                Prob > chi2       =     0.0000
Log likelihood = -29.588771                     Pseudo R2         =     0.4098

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .7978389   .3243229     2.46   0.014     .1621778      1.4335
      _hatsq |    .084781   .1108622     0.76   0.444     -.132505     .302067
       _cons |  -.0299808   .4901759    -0.06   0.951     -.990708    .9307463
------------------------------------------------------------------------------
Note: 0 failures and 10 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       176            11  |        187
     -     |         2             3  |          5
-----------+--------------------------+-----------
   Total   |       178            14  |        192

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.88%
Specificity                     Pr( -|~D)   21.43%
Positive predictive value       Pr( D| +)   94.12%
Negative predictive value       Pr(~D| -)   60.00%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   78.57%
False - rate for true D         Pr( -| D)    1.12%
False + rate for classified +   Pr(~D| +)    5.88%
False - rate for classified -   Pr( D| -)   40.00%
--------------------------------------------------
Correctly classified                        93.23%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp1_yhat 
(option pr assumed; Pr(dv_indicator))
(508 missing values generated)

. gen bpp1_res = dv_indicator - bpp1_yhat
(508 missing values generated)

. 
. summ dv_indicator bpp1_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
   bpp1_yhat |        327    .9306974    .1507384   .0453657          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp1_yhat
> 
> pause "next"
> 
> scatter bpp1_res dv_indicator
> 
> pause "next"
> 
> scatter bpp1_res bpp1_yhat
> */
. pause "complete: B.PP.1"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.2
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_1_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 96 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 71 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 1 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 14 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 3 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 7 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
note: 14.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -39.215728  
Iteration 1:   log pseudolikelihood = -32.350986  
Iteration 2:   log pseudolikelihood = -30.775429  
Iteration 3:   log pseudolikelihood = -30.705582  
Iteration 4:   log pseudolikelihood = -30.705399  
Iteration 5:   log pseudolikelihood = -30.705399  

Logistic regression                             Number of obs     =        192
                                                Wald chi2(13)     =          .
Log pseudolikelihood = -30.705399               Prob > chi2       =          .

                                     (Std. Err. adjusted for 50 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
      p48_pp_1lag |    .997586   .0047586    -0.51   0.612     .9883029    1.006956
      p75_pp_1lag |   .9999363   .0000789    -0.81   0.420     .9997816    1.000091
        mine_time |   1.179519    .143283     1.36   0.174     .9296179    1.496598
onsite_insp_hours |   1.003069   .0010469     2.94   0.003     1.001019    1.005123
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   .7566886   .8360446    -0.25   0.801     .0867856    6.597608
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   1.079582   .9304889     0.09   0.929      .199346    5.846608
              13  |   .1411274   .2441072    -1.13   0.258     .0047566    4.187255
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   .6128972   .5746393    -0.52   0.602     .0975707    3.849957
                  |
             time |
            2007  |    .252292    .334926    -1.04   0.300     .0187027    3.403313
            2008  |   .3412692   .4088657    -0.90   0.370     .0326058    3.571899
            2010  |   1.559067   2.032761     0.34   0.733     .1210711    20.07653
            2011  |   2.303237   4.597004     0.42   0.676     .0460719    115.1441
            2012  |   .4117991    .761318    -0.48   0.631     .0109905    15.42955
            2013  |    .030786   .0567442    -1.89   0.059     .0008307    1.140965
                  |
            _cons |    .000053   .0000612    -8.52   0.000     5.50e-06    .0005103
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.2.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.PP.2.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       192
 number of covariate patterns =       192
            Pearson chi2(177) =       174.63
                  Prob > chi2 =         0.5363

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -50.134837  
Iteration 1:   log likelihood = -41.848621  
Iteration 2:   log likelihood = -31.669889  
Iteration 3:   log likelihood = -30.915139  
Iteration 4:   log likelihood =  -30.72691  
Iteration 5:   log likelihood =  -30.70129  
Iteration 6:   log likelihood = -30.701179  
Iteration 7:   log likelihood = -30.701179  

Logistic regression                             Number of obs     =        192
                                                LR chi2(2)        =      38.87
                                                Prob > chi2       =     0.0000
Log likelihood = -30.701179                     Pseudo R2         =     0.3876

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   1.028986   .4084911     2.52   0.012     .2283577    1.829614
      _hatsq |  -.0021709   .0974413    -0.02   0.982    -.1931523    .1888106
       _cons |  -.0363121   .5212153    -0.07   0.944    -1.057875    .9852512
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       176            11  |        187
     -     |         2             3  |          5
-----------+--------------------------+-----------
   Total   |       178            14  |        192

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.88%
Specificity                     Pr( -|~D)   21.43%
Positive predictive value       Pr( D| +)   94.12%
Negative predictive value       Pr(~D| -)   60.00%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   78.57%
False - rate for true D         Pr( -| D)    1.12%
False + rate for classified +   Pr(~D| +)    5.88%
False - rate for classified -   Pr( D| -)   40.00%
--------------------------------------------------
Correctly classified                        93.23%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp2_yhat 
(option pr assumed; Pr(dv_indicator))
(508 missing values generated)

. gen bpp2_res = dv_indicator - bpp2_yhat
(508 missing values generated)

. 
. summ dv_indicator bpp2_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
   bpp2_yhat |        327    .9282107    .1462363   .0693059   .9999999

. /*
> pause "next"
> 
> scatter dv_indicator bpp2_yhat
> 
> pause "next"
> 
> scatter bpp2_res dv_indicator
> 
> pause "next"
> 
> scatter bpp2_res bpp2_yhat
> */
. pause "complete: B.PP.2"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.3
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_4_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 96 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 71 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 1 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 14 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 3 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 7 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
note: 14.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -39.215728  
Iteration 1:   log pseudolikelihood = -32.403947  
Iteration 2:   log pseudolikelihood =  -30.77024  
Iteration 3:   log pseudolikelihood = -30.687528  
Iteration 4:   log pseudolikelihood = -30.687258  
Iteration 5:   log pseudolikelihood = -30.687258  

Logistic regression                             Number of obs     =        192
                                                Wald chi2(13)     =          .
Log pseudolikelihood = -30.687258               Prob > chi2       =          .

                                     (Std. Err. adjusted for 50 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
    p48_pp_c_4lag |   1.001672   .0033131     0.51   0.614     .9951992    1.008187
    p75_pp_c_4lag |   1.000007   .0000352     0.20   0.838     .9999382    1.000076
        mine_time |   1.137574   .1032414     1.42   0.156     .9522006    1.359037
onsite_insp_hours |   1.002017   .0009755     2.07   0.038     1.000107     1.00393
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   .9831655   1.010473    -0.02   0.987     .1311545    7.370046
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   1.524402   1.217679     0.53   0.598     .3185423     7.29511
              13  |     .10315    .171264    -1.37   0.171     .0039828    2.671486
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   .6059336   .6100341    -0.50   0.619     .0842293       4.359
                  |
             time |
            2007  |    .395307   .4860158    -0.75   0.450     .0355151    4.400036
            2008  |   .3274174   .4209761    -0.87   0.385     .0263434    4.069417
            2010  |    1.65254   2.148139     0.39   0.699     .1293226    21.11688
            2011  |   2.747412   5.040195     0.55   0.582     .0754004    100.1092
            2012  |   .5956899   1.087722    -0.28   0.777     .0166241    21.34535
            2013  |   .0546592   .0927441    -1.71   0.087      .001965    1.520397
                  |
            _cons |   .0000377   .0000465    -8.26   0.000     3.37e-06    .0004222
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.3.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.PP.3.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       192
 number of covariate patterns =       192
            Pearson chi2(177) =       188.39
                  Prob > chi2 =         0.2649

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -50.134837  
Iteration 1:   log likelihood = -42.566739  
Iteration 2:   log likelihood = -31.993591  
Iteration 3:   log likelihood = -31.060085  
Iteration 4:   log likelihood = -30.774063  
Iteration 5:   log likelihood = -30.686321  
Iteration 6:   log likelihood = -30.685662  
Iteration 7:   log likelihood = -30.685662  

Logistic regression                             Number of obs     =        192
                                                LR chi2(2)        =      38.90
                                                Prob > chi2       =     0.0000
Log likelihood = -30.685662                     Pseudo R2         =     0.3879

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .9898962   .4029024     2.46   0.014     .2002221     1.77957
      _hatsq |   .0048935   .0981591     0.05   0.960    -.1874948    .1972818
       _cons |  -.0057756   .5057451    -0.01   0.991    -.9970179    .9854667
------------------------------------------------------------------------------

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       176            10  |        186
     -     |         2             4  |          6
-----------+--------------------------+-----------
   Total   |       178            14  |        192

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.88%
Specificity                     Pr( -|~D)   28.57%
Positive predictive value       Pr( D| +)   94.62%
Negative predictive value       Pr(~D| -)   66.67%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   71.43%
False - rate for true D         Pr( -| D)    1.12%
False + rate for classified +   Pr(~D| +)    5.38%
False - rate for classified -   Pr( D| -)   33.33%
--------------------------------------------------
Correctly classified                        93.75%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp3_yhat 
(option pr assumed; Pr(dv_indicator))
(508 missing values generated)

. gen bpp3_res = dv_indicator - bpp3_yhat
(508 missing values generated)

. 
. summ dv_indicator bpp3_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
   bpp3_yhat |        327     .917332    .1549444   .0646679   .9999985

. /*
> pause "next"
> 
> scatter dv_indicator bpp3_yhat
> 
> pause "next"
> 
> scatter bpp3_res dv_indicator
> 
> pause "next"
> 
> scatter bpp3_res bpp3_yhat
> */
. pause "complete: B.PP.3"

. 
. ********************************************************************************
. ********************************************************************************
. 
. // Model B.PP.4
. 
. eststo clear

. eststo: logit dv_indicator `pp_lag_all_vars' `covariates' ib(freq).state ib(freq).time if sample_pp == 1, vce(cl mineid) offset(lnhours) iter(50) or

note: union != 0 predicts success perfectly
      union dropped and 96 obs not used

note: longwall != 0 predicts success perfectly
      longwall dropped and 71 obs not used

note: 4.state != 0 predicts success perfectly
      4.state dropped and 1 obs not used

note: 5.state != 0 predicts success perfectly
      5.state dropped and 14 obs not used

note: 11.state != 0 predicts success perfectly
      11.state dropped and 3 obs not used

note: 15.state != 0 predicts success perfectly
      15.state dropped and 7 obs not used

note: 1.state omitted because of collinearity
note: 10.state omitted because of collinearity
note: 14.state omitted because of collinearity
Iteration 0:   log pseudolikelihood = -39.215728  
Iteration 1:   log pseudolikelihood = -32.264499  
Iteration 2:   log pseudolikelihood = -30.313576  
Iteration 3:   log pseudolikelihood = -29.974198  
Iteration 4:   log pseudolikelihood =  -29.94657  
Iteration 5:   log pseudolikelihood = -29.946509  
Iteration 6:   log pseudolikelihood = -29.946509  

Logistic regression                             Number of obs     =        192
                                                Wald chi2(13)     =          .
Log pseudolikelihood = -29.946509               Prob > chi2       =          .

                                     (Std. Err. adjusted for 50 clusters in mineid)
-----------------------------------------------------------------------------------
                  |               Robust
     dv_indicator | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------+----------------------------------------------------------------
 p48_pp_c_lag_all |   .9986316   .0011178    -1.22   0.221     .9964432    1.000825
 p75_pp_c_lag_all |   1.000014   7.91e-06     1.73   0.083     .9999982    1.000029
        mine_time |   1.082294    .120291     0.71   0.477     .8704402    1.345711
onsite_insp_hours |    1.00182   .0013019     1.40   0.162     .9992721    1.004375
            union |          1  (omitted)
         longwall |          1  (omitted)
                  |
            state |
               1  |          1  (empty)
               3  |   1.297792   1.661845     0.20   0.839     .1054938    15.96553
               4  |          1  (empty)
               5  |          1  (empty)
              10  |          1  (empty)
              11  |          1  (empty)
              12  |   2.307835   1.845159     1.05   0.296     .4815623    11.06005
              13  |   .0861504   .1539708    -1.37   0.170      .002594    2.861225
              14  |          1  (empty)
              15  |          1  (empty)
              16  |   .5245646   .4766513    -0.71   0.478     .0883783    3.113526
                  |
             time |
            2007  |    .329548   .4178316    -0.88   0.381     .0274591    3.955043
            2008  |   .3592623   .4500722    -0.82   0.414     .0308357    4.185714
            2010  |   1.569725   1.985405     0.36   0.721     .1315875    18.72545
            2011  |   2.563747   5.023804     0.48   0.631     .0550679    119.3581
            2012  |   .4933837   .9592565    -0.36   0.716     .0109205    22.29078
            2013  |   .0409935   .0722307    -1.81   0.070     .0012969    1.295793
                  |
            _cons |   .0000549   .0000673    -8.01   0.000     4.98e-06    .0006062
          lnhours |          1  (offset)
-----------------------------------------------------------------------------------
(est1 stored)

. esttab using `"`directory'Model.`injury_label'.`time_label'.`violation_level_label'.B.PP.4.csv"', replace plain wide p eform
(output written to C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/Model.PS.Y.P.B.PP.4.csv)

. 
. pause "next"

. 
. // diagnostics/assessment
. lfit

Logistic model for dv_indicator, goodness-of-fit test

       number of observations =       192
 number of covariate patterns =       192
            Pearson chi2(177) =       130.25
                  Prob > chi2 =         0.9966

. 
. pause "next"

. 
. linktest

Iteration 0:   log likelihood = -50.134837  
Iteration 1:   log likelihood = -40.541933  
Iteration 2:   log likelihood = -31.359289  
Iteration 3:   log likelihood =  -30.51231  
Iteration 4:   log likelihood = -30.170976  
Iteration 5:   log likelihood = -29.780655  
Iteration 6:   log likelihood = -29.746433  
Iteration 7:   log likelihood = -29.746326  
Iteration 8:   log likelihood = -29.746326  

Logistic regression                             Number of obs     =        192
                                                LR chi2(2)        =      40.78
                                                Prob > chi2       =     0.0000
Log likelihood = -29.746326                     Pseudo R2         =     0.4067

------------------------------------------------------------------------------
dv_indicator |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        _hat |   .8292681   .3411621     2.43   0.015     .1606028    1.497933
      _hatsq |   .0699592   .1128949     0.62   0.535    -.1513108    .2912292
       _cons |  -.0317031   .4896209    -0.06   0.948    -.9913424    .9279363
------------------------------------------------------------------------------
Note: 0 failures and 23 successes completely determined.

. 
. pause "next"

. 
. estat classification

Logistic model for dv_indicator

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |       176             8  |        184
     -     |         2             6  |          8
-----------+--------------------------+-----------
   Total   |       178            14  |        192

Classified + if predicted Pr(D) >= .5
True D defined as dv_indicator != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   98.88%
Specificity                     Pr( -|~D)   42.86%
Positive predictive value       Pr( D| +)   95.65%
Negative predictive value       Pr(~D| -)   75.00%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   57.14%
False - rate for true D         Pr( -| D)    1.12%
False + rate for classified +   Pr(~D| +)    4.35%
False - rate for classified -   Pr( D| -)   25.00%
--------------------------------------------------
Correctly classified                        94.79%
--------------------------------------------------

. 
. pause "next"

. 
. predict bpp4_yhat 
(option pr assumed; Pr(dv_indicator))
(508 missing values generated)

. gen bpp4_res = dv_indicator - bpp4_yhat
(508 missing values generated)

. 
. summ dv_indicator bpp4_yhat

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
dv_indicator |        835    .9748503    .1566735          0          1
   bpp4_yhat |        327    .9242868    .1473011   .0465145          1

. /*
> pause "next"
> 
> scatter dv_indicator bpp4_yhat
> 
> pause "next"
> 
> scatter bpp4_res dv_indicator
> 
> pause "next"
> 
> scatter bpp4_res bpp4_yhat
> */
. pause "complete: B.PP.4"

. 
. ********************************************************************************
. ********************************************************************************
. 
. log close
      name:  <unnamed>
       log:  C:/Users/slevine2/Dropbox (Stanford Law School)/R-code/Injury-Classification/All Mines/Model Summaries 10-19/PS/PS_log_part_year_bad_viol.txt
  log type:  text
 closed on:  20 Oct 2016, 13:46:38
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
